
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=".net,java,php,python,docker,web">
      
      
        <meta name="author" content="BurningMyself">
      
      
        <link rel="canonical" href="https://burningmyself.gitee.io/cloud/kubernetes/kubernetes_gitops/">
      
      
        <link rel="prev" href="../kubernetes_kubesphere_devops/">
      
      
        <link rel="next" href="../kubernetes_velero/">
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.15">
    
    
      
        <title>云原生多云持续交付GitOps - BurningMyself</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gitops" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="BurningMyself" class="md-header__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BurningMyself
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              云原生多云持续交付GitOps
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="BurningMyself" class="md-nav__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BurningMyself
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        介绍
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          技术博文
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          技术博文
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          .NET
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          .NET
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sharp/" class="md-nav__link">
        C#新特性语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_docker/" class="md-nav__link">
        .Net Core Docker 部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sqlserver_nginx/" class="md-nav__link">
        Docker 容器化部署 ASP.NET Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_safety/" class="md-nav__link">
        让你的ASP.NET Core应用程序更安全
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_study_route/" class="md-nav__link">
        ASP.NET Core开发者指南
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/feature/" class="md-nav__link">
        Java特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/load-class/" class="md-nav__link">
        Java类加载
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/orm/" class="md-nav__link">
        Orm的优缺点
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/bio-nio/" class="md-nav__link">
        BIO与NIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/rocketmq/rmq-1/" class="md-nav__link">
        RocketMq下载与安装
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springAnnotation/" class="md-nav__link">
        Spring常用注解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/javavm/" class="md-nav__link">
        Java 虚拟机
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springdesign/" class="md-nav__link">
        Spring 常用设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/spring-cloud/" class="md-nav__link">
        Spring Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-simple/" class="md-nav__link">
        Java simple
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-validator/" class="md-nav__link">
        Java Validator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-string/" class="md-nav__link">
        Java String
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-utils/" class="md-nav__link">
        Java Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/feature/" class="md-nav__link">
        Python特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/str_joint/" class="md-nav__link">
        Python字符拼接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/syntax_rule/" class="md-nav__link">
        Python语法技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/fabric/" class="md-nav__link">
        远程部署神器 Fabric
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          Go
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Go
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../go/go_base/" class="md-nav__link">
        Go基础语法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
          PHP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          PHP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/kj/" class="md-nav__link">
        框架
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
          Web
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/es6/" class="md-nav__link">
        es6语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/ali_js_style/" class="md-nav__link">
        阿里js样式规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/node.js/" class="md-nav__link">
        node.js文档
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react/" class="md-nav__link">
        React 开发者指南
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../dart/syntax/" class="md-nav__link">
        Dart语法学习
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react_interview/" class="md-nav__link">
        React 面试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/js_tool_method/" class="md-nav__link">
        js 工具函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/vue_cp_react/" class="md-nav__link">
        vue与react比较
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/javascript/" class="md-nav__link">
        JavaScript 基础
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
      
      
      
        <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
          SQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh17/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_log/" class="md-nav__link">
        MySQL日志
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_index/" class="md-nav__link">
        MySQL索引
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_pxc/" class="md-nav__link">
        MySQL PXC集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_use/" class="md-nav__link">
        MySQL 数据库应用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_backups/" class="md-nav__link">
        MySql 备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/sql_server_master/" class="md-nav__link">
        Sql Server 主从备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/data_split/" class="md-nav__link">
        数据库之互联网常用分库分表方案
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mybatis/" class="md-nav__link">
        Mybatis使用心德
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
      
      
      
        <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/linux/" class="md-nav__link">
        Linux学习笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/often/" class="md-nav__link">
        常用命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/ope/" class="md-nav__link">
        实用的Linux 命令
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
      
      
      
        <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker/" class="md-nav__link">
        Docker全科
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker_core/" class="md-nav__link">
        Docker 核心技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-compose/" class="md-nav__link">
        docker和docker-compose配置常用环境
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-jenkins/" class="md-nav__link">
        Docker部署Jenkins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-phabricator/" class="md-nav__link">
        Docker部署Phabricator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
      
      
      
        <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_fw_rule_and_object_design/" class="md-nav__link">
        Kubernetes架构原则和对象设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_etcd/" class="md-nav__link">
        Kubernetes控制平面组件etcd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_kube_APIServer/" class="md-nav__link">
        深入理解Kube-APIServer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_controller_manager/" class="md-nav__link">
        kubernetes控制平面组件
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
      
      
      
        <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
          Tool
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_11">
          <span class="md-nav__icon md-icon"></span>
          Tool
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitusual/" class="md-nav__link">
        Git动画展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitquestion/" class="md-nav__link">
        Git问题处理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitflow/" class="md-nav__link">
        GitFlow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitbook/" class="md-nav__link">
        GitBook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitcmr/" class="md-nav__link">
        Git提交日志规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/markdown/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cicd/" class="md-nav__link">
        CI/CD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/mkdocs/" class="md-nav__link">
        mkdocs简单使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitstudy/" class="md-nav__link">
        Git的黑魔法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/minio/" class="md-nav__link">
        MinIO 搭建使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cat-monitoring/" class="md-nav__link">
        Cat分布式监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          云架构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          云架构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../native/" class="md-nav__link">
        云原生
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual/" class="md-nav__link">
        虚拟化技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/" class="md-nav__link">
        云计算
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../apprelease/" class="md-nav__link">
        应用部署容器化演进
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../containerlinux/" class="md-nav__link">
        容器技术所涉及Linux内核关键技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_native/" class="md-nav__link">
        容器管理工具Docker生态架构及部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_nginx/" class="md-nav__link">
        使用容器运行Nginx应用及Docker命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image/" class="md-nav__link">
        Docker容器镜像
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image_fast/" class="md-nav__link">
        Docker容器镜像加速器及本地容器镜像仓库
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container_enterprice/" class="md-nav__link">
        Docker容器化部署企业级应用集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_file/" class="md-nav__link">
        Dockerfile精讲及新型容器镜像构建技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_network/" class="md-nav__link">
        Docker容器网络与通信原理深度解析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_date/" class="md-nav__link">
        Docker容器数据持久化存储机制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_compose/" class="md-nav__link">
        Docker容器服务编排利器Docker Compose应用实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_swarm/" class="md-nav__link">
        Docker主机集群化方案 Docker Swarm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_devops/" class="md-nav__link">
        基于Docker容器DevOps应用方案 企业业务代码发布系统
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container/" class="md-nav__link">
        轻量级或工业级容器管理工具
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        kubeadm极速部署Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_introduce/" class="md-nav__link">
        kubernetes介绍与集群架构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_way/" class="md-nav__link">
        Kubernetes集群部署方式说明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_master/" class="md-nav__link">
        kubeadm部署单Master节点kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight/" class="md-nav__link">
        kubeadm部署高可用kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rke/" class="md-nav__link">
        使用RKE构建企业生产级Kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin1/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Docker）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin2/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Containerd）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        Kubernetes集群UI及主机资源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_sealos/" class="md-nav__link">
        使用sealos部署kubernetes集群并实现集群管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster/" class="md-nav__link">
        kubernetes集群命令语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_core/" class="md-nav__link">
        Kubernetes核心概念
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_nginx_ingress_controller/" class="md-nav__link">
        Kubernetes集群 服务暴露 Nginx Ingress Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_traefik/" class="md-nav__link">
        Kubernetes集群 服务暴露 Traefik
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_configMap_secret/" class="md-nav__link">
        Kubernetes配置与密钥管理 ConfigMap&Secret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_harbor/" class="md-nav__link">
        Kubernetes集群使用容器镜像仓库Harbor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_safety/" class="md-nav__link">
        Kubernetes集群安全管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_volume/" class="md-nav__link">
        kubernetes持久化存储卷
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_ceph/" class="md-nav__link">
        kubernetes存储解决方案Ceph
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster_serve/" class="md-nav__link">
        Kubernetes集群公共服务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_java/" class="md-nav__link">
        kubernetes集群java项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_python/" class="md-nav__link">
        kubernetes集群Python项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_golang/" class="md-nav__link">
        Kubernetes集群golang项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_helm_prometheus/" class="md-nav__link">
        helm部署prometheus监控系统及应用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_logs_collect/" class="md-nav__link">
        kubernetes日志收集方案ELK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_zookeeper/" class="md-nav__link">
        企业级中间件上云部署zookeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kafka/" class="md-nav__link">
        kubernetes云原生中间件上云部署kafka
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rokectmq/" class="md-nav__link">
        rocketmq部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_helm/" class="md-nav__link">
        Kubernetes集群包管理解决方案 Helm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kustomize/" class="md-nav__link">
        Kubernetes原生配置管理利器 kustomize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_flannel/" class="md-nav__link">
        kubernetes集群网络解决方案 flannel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_calico/" class="md-nav__link">
        kubernetes集群网络解决方案 calico
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hybridnet/" class="md-nav__link">
        kubernetes集群 underlay 网络方案 hybridnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ipv4_and_ipv6/" class="md-nav__link">
        kubernetes版本双栈协议（IPv4&IPv6）集群部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rancher/" class="md-nav__link">
        Rancher容器云管理平台
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubeconfig/" class="md-nav__link">
        使用kubeconfig管理多集群方法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_karmada/" class="md-nav__link">
        karmada实现k8s集群联邦
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubesphere/" class="md-nav__link">
        安装kubesphere使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ack/" class="md-nav__link">
        阿里云容器服务ACK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_devops/" class="md-nav__link">
        基于kubernetes集群构建大中型企业CICD应用平台
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubesphere_devops/" class="md-nav__link">
        基于KubeSphere实现DevOps
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        云原生多云持续交付GitOps
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_velero/" class="md-nav__link">
        kubernetes集群备份与恢复管理利器Velero
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kurator/" class="md-nav__link">
        kubernetes集群舰队管理Kurator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_openfass/" class="md-nav__link">
        Serverless之OpenFaaS函数即服务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_flink/" class="md-nav__link">
        Flink基于Kubernetes部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hdfs/" class="md-nav__link">
        大数据HDFS分布式文件系统搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_spark/" class="md-nav__link">
        Spark与Kubernetes整合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          微服务
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          微服务
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/fbs-lock/" class="md-nav__link">
        分布式锁
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/design/" class="md-nav__link">
        微服务设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/distrimsg/" class="md-nav__link">
        分布式系统与消息的投递
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/ddd/" class="md-nav__link">
        基于DDD的微服务设计和开发实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/kafka/" class="md-nav__link">
        Kafka架构原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/redis_cluster/" class="md-nav__link">
        Redis Cluster原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/spring-cloud-micro/" class="md-nav__link">
        分布式架构
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          经验分析
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          经验分析
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/devops/" class="md-nav__link">
        DevOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/micro-service/" class="md-nav__link">
        Micro-Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/raft-gossip/" class="md-nav__link">
        Raft算法和Gossip协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cl/" class="md-nav__link">
        集群和负载均衡
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/ai/" class="md-nav__link">
        人工智能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/code-principle/" class="md-nav__link">
        代码原则
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/techbig/" class="md-nav__link">
        如何成为技术大牛
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/learnweetout/" class="md-nav__link">
        程序员如何技术成长
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/pt/" class="md-nav__link">
        产品与技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/four_deep_learning/" class="md-nav__link">
        深度学习框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/tl/" class="md-nav__link">
        在阿里做了5年技术Leader，我总结出这些套路！
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cto/" class="md-nav__link">
        CTO 技能图谱
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          构架
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          构架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/split/" class="md-nav__link">
        构架拆分
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fgb/" class="md-nav__link">
        分布式、高并发、多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/agility/" class="md-nav__link">
        如何理解敏捷开发
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fwork/" class="md-nav__link">
        走向架构师必备的技能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/data_middle/" class="md-nav__link">
        数据中台的思考与总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/algorithm-ten/" class="md-nav__link">
        必学的 10 大算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          情感
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          情感
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/eq/" class="md-nav__link">
        情商
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/workheard/" class="md-nav__link">
        工作心得
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lookbook/" class="md-nav__link">
        看书
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/selfdiscipline/" class="md-nav__link">
        自律
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/livefail/" class="md-nav__link">
        为什么活着失败
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/emotion/" class="md-nav__link">
        情绪管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/losecome/" class="md-nav__link">
        所有的失去，都会以另一种方式归来
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/threeheart/" class="md-nav__link">
        人生有这三种好心态
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/onepath/" class="md-nav__link">
        余生，学会一个人走，不管有没有人陪
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/twopath/" class="md-nav__link">
        往后余生还很精彩，别被熬夜拖垮了
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lifetime/" class="md-nav__link">
        心态好的人，一辈子都好
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="gitops">GitOps<a class="headerlink" href="#gitops" title="Permanent link">&para;</a></h1>
<h1 id="gitops_1">一、什么是GitOps<a class="headerlink" href="#gitops_1" title="Permanent link">&para;</a></h1>
<p>说起GitOps，可能马上会联想到我们前面讲的DevOps，那么GitOps和DevOps之间有什么关系、又有什么区别呢？</p>
<p>DevOps是一种文化</p>
<p>DevOps包含了Development和Operations两个部分，是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化或惯例。通过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。</p>
<p>如今很多团队当中都在践行着DevOps文化，其中核心的一条理念就是“自动化一切可自动化的”。而GitOps，也正是基于这种理念下而诞生的一种持续交付方式。</p>
<h1 id="gitops_2">二、为什么需要GitOps<a class="headerlink" href="#gitops_2" title="Permanent link">&para;</a></h1>
<p>GitOps核心思想是将应用系统的声明性基础架构和应用程序存放在Git版本库中。</p>
<p>将Git作为交付流水线的核心，每个开发人员都可以提交拉取请求（Pull Request）并使用Git来加速和简化应用程序部署和运维任务。通过使用Git，开发人员可以更高效地将注意力集中在创建新功能而不是运维相关任务上（例如，应用系统安装、配置、迁移等）。</p>
<p>同时，GitOps还是一整套CI/CD流水线方案。</p>
<p>在GitOps中可以自由地为流水线的不同部分选择最佳工具。可以从开源生态系统中选择一组工具，也可以从封闭源中选择一组工具，或者根据使用情况，甚至可以将它们组合在一起。</p>
<h1 id="gitops_3">三、GitOps怎么实现<a class="headerlink" href="#gitops_3" title="Permanent link">&para;</a></h1>
<h2 id="31">3.1实现方式介绍<a class="headerlink" href="#31" title="Permanent link">&para;</a></h2>
<p>通过gitlab实现CI流程，将 CD 部分使用 Argo CD 来完成，以实现应用部署及应用部署回滚的可控性。</p>
<p><img alt="git_argo" src="../../../img/kubernetes/kubernetes_gitops/git_argo.png" /></p>
<h2 id="32">3.2 环境准备<a class="headerlink" href="#32" title="Permanent link">&para;</a></h2>
<h3 id="321">3.2.1主机规划<a class="headerlink" href="#321" title="Permanent link">&para;</a></h3>
<p><img alt="image-20220908104352788" src="../../../img/kubernetes/kubernetes_gitops/image-20220908104352788.png" /></p>
<table>
<thead>
<tr>
<th>序号</th>
<th>主机名</th>
<th>主机ip</th>
<th>主机功能</th>
<th>软件</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>dev</td>
<td>192.168.10.1</td>
<td>开发者 项目代码 apidemo</td>
<td>go、golang 、goland</td>
</tr>
<tr>
<td>2</td>
<td>gitlab</td>
<td>192.168.10.11</td>
<td>代码仓库，CI操作</td>
<td>git-lab、git、golang、docker</td>
</tr>
<tr>
<td>3</td>
<td>harbor</td>
<td>192.168.10.21</td>
<td>管理和存储容器镜像</td>
<td>docker、docker-compose、harbor</td>
</tr>
<tr>
<td>4</td>
<td>k8s-master01</td>
<td>192.168.10.31</td>
<td>k8s-master</td>
<td>k8s、ArgoCd</td>
</tr>
<tr>
<td>5</td>
<td>k8s-worker01</td>
<td>192.168.10.32</td>
<td>k8s-worker</td>
<td>k8s、ArgoCd</td>
</tr>
<tr>
<td>6</td>
<td>k8s-worker02</td>
<td>192.168.10.33</td>
<td>k8s-worker</td>
<td>k8s、ArgoCd</td>
</tr>
</tbody>
</table>
<p><img alt="image-20220908104623080" src="../../../img/kubernetes/kubernetes_gitops/image-20220908104623080.png" /></p>
<h3 id="322">3.2.2主机准备<a class="headerlink" href="#322" title="Permanent link">&para;</a></h3>
<h4 id="3221ip">3.2.2.1主机ip地址配置<a class="headerlink" href="#3221ip" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># vim /etc/sysconfig/network-scripts/ifcfg-ens33</span>
<span class="c"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span>
<span class="n">TYPE</span><span class="p">=</span><span class="s2">&quot;Ethernet&quot;</span>
<span class="n">PROXY_METHOD</span><span class="p">=</span><span class="s2">&quot;none&quot;</span>
<span class="n">BROWSER_ONLY</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">BOOTPROTO</span><span class="p">=</span><span class="s2">&quot;none&quot;</span> <span class="n">配置为静态IP</span>
<span class="n">DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV4_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6INIT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_AUTOCONF</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6_ADDR_GEN_MODE</span><span class="p">=</span><span class="s2">&quot;stable-privacy&quot;</span>
<span class="n">NAME</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">UUID</span><span class="p">=</span><span class="s2">&quot;ec87533a-8151-4aa0-9d0f-1e970affcdc6&quot;</span>
<span class="n">DEVICE</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">ONBOOT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPADDR</span><span class="p">=</span><span class="s2">&quot;192.168.10.x&quot;</span>  <span class="n">把x替换为对应的IP地址</span>
<span class="n">PREFIX</span><span class="p">=</span><span class="s2">&quot;24&quot;</span>
<span class="n">GATEWAY</span><span class="p">=</span><span class="s2">&quot;192.168.10.2&quot;</span>
<span class="n">DNS1</span><span class="p">=</span><span class="s2">&quot;223.5.5.5&quot;</span>
<span class="n">DNS1</span><span class="p">=</span><span class="s2">&quot;223.6.6.6&quot;</span>
</code></pre></div>
<h4 id="3222">3.2.2.2主机名准备<a class="headerlink" href="#3222" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># hostnamectl set-hostname xxx</span>
</code></pre></div>
<blockquote>
<p>根据主机规划实施配置</p>
</blockquote>
<h4 id="3223ip">3.2.2.3主机名与ip地址解析配置<a class="headerlink" href="#3223ip" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># vim /etc/hosts</span>
<span class="c"># cat /etc/hosts</span>
<span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>   <span class="n">localhost</span> <span class="n">localhost</span><span class="p">.</span><span class="n">localdomain</span> <span class="n">localhost4</span> <span class="n">localhost4</span><span class="p">.</span><span class="n">localdomain4</span>
<span class="p">::</span><span class="n">1</span>         <span class="n">localhost</span> <span class="n">localhost</span><span class="p">.</span><span class="n">localdomain</span> <span class="n">localhost6</span> <span class="n">localhost6</span><span class="p">.</span><span class="n">localdomain6</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">11</span> <span class="n">gitlab</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">21</span> <span class="n">harbor</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">31</span> <span class="n">k8s-master01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">32</span> <span class="n">k8s-worker01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">33</span> <span class="n">k8s-worker02</span>
</code></pre></div>
<h4 id="3224">3.2.2.4 主机安全设置<a class="headerlink" href="#3224" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># systemctl stop firewalld;systemctl disable firewalld</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># firewall-cmd --state</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># sestatus 关闭selinux</span>
</code></pre></div>
<h4 id="3225">3.2.2.5主机时间同步<a class="headerlink" href="#3225" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">编辑</span>
<span class="c"># crontab -e</span>

<span class="n">查看</span>
<span class="c"># crotab -l</span>
<span class="n">0</span> <span class="p">*/</span><span class="n">1</span> <span class="p">*</span> <span class="p">*</span> <span class="p">*</span> <span class="n">ntpdate</span> <span class="n">time1</span><span class="p">.</span><span class="n">aliyun</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<h2 id="33">3.3主机中工具安装<a class="headerlink" href="#33" title="Permanent link">&para;</a></h2>
<h3 id="331_gitlab">3.3.1 gitlab主机<a class="headerlink" href="#331_gitlab" title="Permanent link">&para;</a></h3>
<h4 id="3311_yum">3.3.1.1 获取yum源<a class="headerlink" href="#3311_yum" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># vim /etc/yum.repos.d/gitlab.repo</span>
<span class="no">[gitlab]</span>
<span class="n">name</span><span class="p">=</span><span class="n">gitlab-ce</span>
<span class="n">baseurl</span><span class="p">=</span><span class="n">https</span><span class="p">://</span><span class="n">mirrors</span><span class="p">.</span><span class="n">tuna</span><span class="p">.</span><span class="n">tsinghua</span><span class="p">.</span><span class="n">edu</span><span class="p">.</span><span class="n">cn</span><span class="p">/</span><span class="n">gitlab-ce</span><span class="p">/</span><span class="n">yum</span><span class="p">/</span><span class="n">el7</span>
<span class="n">enabled</span><span class="p">=</span><span class="n">1</span>
<span class="n">gpgcheck</span><span class="p">=</span><span class="n">0</span>
</code></pre></div>
<h4 id="3312_gitlab-ce">3.3.1.2 gitlab-ce安装<a class="headerlink" href="#3312_gitlab-ce" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># yum -y install gitlab-ce</span>
</code></pre></div>
<h4 id="3313_gitlab-ce">3.3.1.3 gitlab-ce配置<a class="headerlink" href="#3313_gitlab-ce" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># vim /etc/gitlab/gitlab.rb</span>
<span class="n">32</span> <span class="n">external_url</span> <span class="s1">&#39;http://192.168.10.11&#39;</span>  <span class="c">#此ip为在gitlab上创建项目的url前缀</span>
</code></pre></div>
<h4 id="3314_gitlab-ce">3.3.1.4 启动gitlab-ce<a class="headerlink" href="#3314_gitlab-ce" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># gitlab-ctl reconfigure</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># gitlab-ctl status</span>
</code></pre></div>
<h4 id="3315_gitlab-ce">3.3.1.5 访问gitlab-ce<a class="headerlink" href="#3315_gitlab-ce" title="Permanent link">&para;</a></h4>
<p>浏览器输入gitlab-ce的服务器地址：<a href="http://192.168.10.11">http://192.168.10.11</a></p>
<p><img alt="登录gitlab-01" src="../../../img/kubernetes/kubernetes_gitops/%E7%99%BB%E5%BD%95gitlab-01.png" /></p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># cat /etc/gitlab/initial_root_password  #获取gitlab-ce登录初始密码，登录账户名为：root</span>
<span class="p">......</span>

<span class="n">Password</span><span class="p">:</span> <span class="n">znS4Bqlp0cfYUKg2dHzFiNCAN0GnhtnD4ENjEtEXMVE</span><span class="p">=</span>
</code></pre></div>
<p>通过命令行获取初始化密码后登录gitlab-ce</p>
<p><img alt="登录gitlab-02" src="../../../img/kubernetes/kubernetes_gitops/%E7%99%BB%E5%BD%95gitlab-02.png" /></p>
<p>gitlab-ce的UI界面</p>
<p><img alt="gitlab-ui" src="../../../img/kubernetes/kubernetes_gitops/gitlab-ui.png" /></p>
<h4 id="3316_gitlab-ce_root">3.3.1.6 修改gitlab-ce root用户的密码<a class="headerlink" href="#3316_gitlab-ce_root" title="Permanent link">&para;</a></h4>
<p>方便后续操作，修改root用户的登录密码</p>
<p><img alt="修改gitlab-ce,root用户密码-01" src="../../../img/kubernetes/kubernetes_gitops/%E4%BF%AE%E6%94%B9gitlab-ce%2Croot%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81-01.png" /></p>
<p><img alt="修改gitlab-ce,root用户密码-02" src="../../../img/kubernetes/kubernetes_gitops/%E4%BF%AE%E6%94%B9gitlab-ce%2Croot%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81-02.png" /></p>
<p><img alt="修改gitlab-ce,root用户密码-03" src="../../../img/kubernetes/kubernetes_gitops/%E4%BF%AE%E6%94%B9gitlab-ce%2Croot%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81-03.png" /></p>
<p><img alt="修改gitlab-ce,root用户密码-04" src="../../../img/kubernetes/kubernetes_gitops/%E4%BF%AE%E6%94%B9gitlab-ce%2Croot%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81-04.png" /></p>
<p>重新登录gitlab-ce</p>
<p><img alt="重新登录gitlab" src="../../../img/kubernetes/kubernetes_gitops/%E9%87%8D%E6%96%B0%E7%99%BB%E5%BD%95gitlab.png" /></p>
<h4 id="3317_git">3.3.1.7 git安装<a class="headerlink" href="#3317_git" title="Permanent link">&para;</a></h4>
<p>当开发者push代码以后，gitlab-runner会在gitlab-ce服务器执行流水线里定义的具体操作，流水线步骤里定义了gitlab-runner通过kustomize客户端工具修改应用部署资源清单文件里的容器镜像版本，并重新push代码到代码仓库，所以需要在gitlab-ce服务器安装git</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@gitlab<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum -y install git</span>
操作系统自带的源里的git版本可能过低，gitlab-runner无法使用，需要升级下git版本
<span class="o">[</span>root@gitlab<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum install -y  http://opensource.wandisco.com/centos/7/git/x86_64/wandisco-git-release-7-2.noarch.rpm</span>
<span class="o">[</span>root@gitlab<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum update -y  git</span>
查看git版本
<span class="o">[</span>root@gitlab<span class="w"> </span>~<span class="o">]</span><span class="c1"># git --version</span>
git<span class="w"> </span>version<span class="w"> </span><span class="m">2</span>.31.1
</code></pre></div>
<h4 id="3318_go">3.3.1.8 go环境安装<a class="headerlink" href="#3318_go" title="Permanent link">&para;</a></h4>
<p>本次应用demo是用go语言开发的，gitlab-runner在编译项目源码时，需要使用go命令，所以需要安装go环境</p>
<p>参考链接：<a href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a></p>
<div class="highlight"><pre><span></span><code><span class="n">安装go解释器</span><span class="err">，</span><span class="n">并创建对应目录</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># wget https://dl.google.com/go/go1.19.linux-amd64.tar.gz</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># tar xzvf go1.19.linux-amd64.tar.gz -C /usr/local/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># mkdir /usr/local/go/gopath</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># mkdir /usr/local/go/gopath/src</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># mkdir /usr/local/go/gopath/bin</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># mkdir /usr/local/go/gopath/pkg</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># vim /etc/profile</span>
<span class="n">添加如下几行</span>
<span class="n">export</span> <span class="n">GOROOT</span><span class="p">=</span><span class="s2">&quot;/usr/local/go&quot;</span>
<span class="n">export</span> <span class="n">GOPATH</span><span class="p">=</span><span class="s2">&quot;/usr/local/go/gopath&quot;</span>
<span class="n">export</span> <span class="n">GOBIN</span><span class="p">=</span><span class="nv">$GOROOT</span><span class="p">/</span><span class="n">bin</span>
<span class="n">export</span> <span class="n">PATH</span><span class="p">=</span><span class="nv">$PATH</span><span class="p">:</span><span class="nv">$GOBIN</span>

<span class="n">加载环境变量</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># source /etc/profile</span>

<span class="n">配置go环境变量</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># go env -w GOPROXY=https://goproxy.cn</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># go env -w GO111MODULE=on</span>

<span class="n">将go可执行文件软链到</span><span class="p">/</span><span class="n">usr</span><span class="p">/</span><span class="n">bin</span><span class="p">/</span><span class="n">下</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># ln -s /usr/local/go/bin/go /usr/bin/go</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">为GOPATH添加其他用户可写权限</span><span class="err">，</span><span class="n">不然gitlab-runner无法执行相关命令</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># chmod -R 757 /usr/local/go/gopath</span>
</code></pre></div>
<h4 id="3319_docker">3.3.1.9 docker安装<a class="headerlink" href="#3319_docker" title="Permanent link">&para;</a></h4>
<p>gitlab-runner在执行流水线时需要将源码编译后的可执行文件制作成容器镜像，所以需要安装docker</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># yum -y install docker-ce</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># systemctl enable docker</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># systemctl start docker</span>
</code></pre></div>
<h3 id="332_harbor">3.3.2 harbor主机<a class="headerlink" href="#332_harbor" title="Permanent link">&para;</a></h3>
<h4 id="3321_docker">3.3.2.1 docker安装<a class="headerlink" href="#3321_docker" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># yum -y install docker-ce</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># systemctl enable docker</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># systemctl start docker</span>
</code></pre></div>
<h4 id="3322_docker-compose">3.3.2.2 docker-compose安装<a class="headerlink" href="#3322_docker-compose" title="Permanent link">&para;</a></h4>
<p>参考链接：<a href="https://github.com/docker/compose">https://github.com/docker/compose</a></p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># wget https://github.com/docker/compose/releases/download/v2.2.3/docker-compose-linux-x86_64</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># ls</span>
<span class="n">docker-compose-linux-x86_64</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># chmod +x docker-compose-linux-x86_64</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># mv docker-compose-linux-x86_64 /usr/bin/docker-compose</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># docker-compose version</span>
<span class="n">Docker</span> <span class="n">Compose</span> <span class="n">version</span> <span class="n">v2</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">3</span>
</code></pre></div>
<h4 id="3323_harbor">3.3.2.3 部署harbor<a class="headerlink" href="#3323_harbor" title="Permanent link">&para;</a></h4>
<p>参考链接：<a href="https://github.com/goharbor/harbor">https://github.com/goharbor/harbor</a></p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># wget https://github.com/goharbor/harbor/releases/download/v2.4.1/harbor-offline-installer-v2.4.1.tgz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># ls</span>
<span class="n">harbor-offline-installer-v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">tgz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># tar xf harbor-offline-installer-v2.4.1.tgz -C /home</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># cd /home</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">home</span><span class="p">]</span><span class="c"># ls</span>
<span class="n">harbor</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">home</span><span class="p">]</span><span class="c"># cd harbor/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">harbor</span><span class="p">]</span><span class="c"># ls</span>
<span class="n">common</span><span class="p">.</span><span class="n">sh</span>  <span class="n">harbor</span><span class="p">.</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>  <span class="n">harbor</span><span class="p">.</span><span class="n">yml</span><span class="p">.</span><span class="n">tmpl</span>  <span class="n">install</span><span class="p">.</span><span class="n">sh</span>  <span class="n">LICENSE</span>  <span class="n">prepare</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">harbor</span><span class="p">]</span><span class="c"># mv harbor.yml.tmpl harbor.yml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">harbor</span><span class="p">]</span><span class="c"># vim harbor.yml</span>
<span class="c"># Configuration file of Harbor</span>

<span class="c"># The IP address or hostname to access admin UI and registry service.</span>
<span class="c"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span>
<span class="n">hostname</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">21</span> <span class="n">修改</span>

<span class="c"># http related config</span>
<span class="n">http</span><span class="p">:</span>
  <span class="c"># port for http, default is 80. If https enabled, this port will redirect to https port</span>
  <span class="n">port</span><span class="p">:</span> <span class="n">80</span>

<span class="c"># https related config</span>
<span class="c">#https: 注释</span>
  <span class="c"># https port for harbor, default is 443</span>
<span class="c">#  port: 443 注释</span>
  <span class="c"># The path of cert and key files for nginx</span>
<span class="c">#  certificate: /your/certificate/path 注释</span>
<span class="c">#  private_key: /your/private/key/path 注释</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">harbor</span><span class="p">]</span><span class="c"># ./prepare </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">harbor</span><span class="p">]</span><span class="c"># ./install.sh</span>
<span class="p">......</span>
<span class="p">[+]</span> <span class="n">Running</span> <span class="n">10</span><span class="p">/</span><span class="n">10</span>
 <span class="err">⠿</span> <span class="n">Network</span> <span class="n">harbor_harbor</span>        <span class="n">Created</span>                                                                                                                                                                                                                                                                                                <span class="n">0</span><span class="p">.</span><span class="n">0s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">harbor-log</span>         <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">0</span><span class="p">.</span><span class="n">3s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">harbor-portal</span>      <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">1</span><span class="p">.</span><span class="n">2s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">harbor-db</span>          <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">1</span><span class="p">.</span><span class="n">3s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">registry</span>           <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">1</span><span class="p">.</span><span class="n">3s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">registryctl</span>        <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">1</span><span class="p">.</span><span class="n">3s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">redis</span>              <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">1</span><span class="p">.</span><span class="n">2s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">harbor-core</span>        <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">2</span><span class="p">.</span><span class="n">0s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">nginx</span>              <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">2</span><span class="p">.</span><span class="n">8s</span>
 <span class="err">⠿</span> <span class="n">Container</span> <span class="n">harbor-jobservice</span>  <span class="n">Started</span>                                                                                                                                                                                                                                                                                                <span class="n">2</span><span class="p">.</span><span class="n">8s</span>
<span class="err">✔</span> <span class="p">---</span><span class="n">-Harbor</span> <span class="n">has</span> <span class="n">been</span> <span class="n">installed</span> <span class="n">and</span> <span class="n">started</span> <span class="n">successfully</span><span class="p">.----</span>
<span class="n">输出以上内容</span><span class="err">，</span><span class="n">harbor安装成功</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="n">harbor</span><span class="p">]</span><span class="c"># docker ps</span>
<span class="n">CONTAINER</span> <span class="n">ID</span>   <span class="n">IMAGE</span>                                <span class="n">COMMAND</span>                  <span class="n">CREATED</span>          <span class="n">STATUS</span>                    <span class="n">PORTS</span>                                   <span class="n">NAMES</span>
<span class="n">18cf67f9557c</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">harbor-jobservice</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>    <span class="s2">&quot;/harbor/entrypoint.…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">50</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>                                           <span class="n">harbor-jobservice</span>
<span class="n">4469424da41a</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">nginx-photon</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>         <span class="s2">&quot;nginx -g &#39;daemon of…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">50</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>   <span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">:</span><span class="n">80</span><span class="p">-&gt;</span><span class="n">8080</span><span class="p">/</span><span class="n">tcp</span><span class="p">,</span> <span class="p">:::</span><span class="n">80</span><span class="p">-&gt;</span><span class="n">8080</span><span class="p">/</span><span class="n">tcp</span>   <span class="n">nginx</span>
<span class="n">813ca518828f</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">harbor-core</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>          <span class="s2">&quot;/harbor/entrypoint.…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">51</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>                                           <span class="n">harbor-core</span>
<span class="n">6119c3a9fe69</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">harbor-db</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>            <span class="s2">&quot;/docker-entrypoint.…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">52</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>                                           <span class="n">harbor-db</span>
<span class="n">87b262aee8f4</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">harbor-portal</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>        <span class="s2">&quot;nginx -g &#39;daemon of…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">52</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>                                           <span class="n">harbor-portal</span>
<span class="n">b2dfca1561f4</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">redis-photon</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>         <span class="s2">&quot;redis-server /etc/r…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">52</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>                                           <span class="n">redis</span>
<span class="n">b9462946a5ca</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">harbor-registryctl</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>   <span class="s2">&quot;/home/harbor/start.…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">52</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>                                           <span class="n">registryctl</span>
<span class="n">c95cb337f764</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">registry-photon</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>      <span class="s2">&quot;/home/harbor/entryp…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">51</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>                                           <span class="n">registry</span>
<span class="n">58621f64a41f</span>   <span class="n">goharbor</span><span class="p">/</span><span class="n">harbor-log</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span>           <span class="s2">&quot;/bin/sh -c /usr/loc…&quot;</span>   <span class="n">53</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">53</span> <span class="n">seconds</span> <span class="p">(</span><span class="n">healthy</span><span class="p">)</span>   <span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span><span class="p">:</span><span class="n">1514</span><span class="p">-&gt;</span><span class="n">10514</span><span class="p">/</span><span class="n">tcp</span>               <span class="n">harbor-log</span>
</code></pre></div>
<h4 id="3324_harbor">3.3.2.4 访问harbor<a class="headerlink" href="#3324_harbor" title="Permanent link">&para;</a></h4>
<p>浏览器输入安装harbor配置文件里的hostname，<a href="http://192.168.10.21,用户名为admin,密码为配置文件里设置的Harbor12345">http://192.168.10.21,用户名为admin,密码为配置文件里设置的Harbor12345</a></p>
<p><img alt="登录harbor" src="../../../img/kubernetes/kubernetes_gitops/%E7%99%BB%E5%BD%95harbor.png" /></p>
<p>harborUI界面</p>
<p><img alt="harborUI" src="../../../img/kubernetes/kubernetes_gitops/harborUI.png" /></p>
<h3 id="333_k8s">3.3.3 k8s安装<a class="headerlink" href="#333_k8s" title="Permanent link">&para;</a></h3>
<h4 id="3331_ip">3.3.3.1 配置主机名与IP地址解析<a class="headerlink" href="#3331_ip" title="Permanent link">&para;</a></h4>
<blockquote>
<p>下面解析是管理员添加，sealos在运行过程中，也会自动添加主机名与IP地址解析关系。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># cat /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">31</span> <span class="n">k8s-master01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">32</span> <span class="n">k8s-worker01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">33</span> <span class="n">k8s-worker02</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-worker01</span> <span class="p">~]</span><span class="c"># cat /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">31</span> <span class="n">k8s-master01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">32</span> <span class="n">k8s-worker01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">33</span> <span class="n">k8s-worker02</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-worker02</span> <span class="p">~]</span><span class="c"># cat /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">31</span> <span class="n">k8s-master01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">32</span> <span class="n">k8s-worker01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">33</span> <span class="n">k8s-worker02</span>
</code></pre></div>
<h4 id="3332">3.3.3.2 升级操作系统内核<a class="headerlink" href="#3332" title="Permanent link">&para;</a></h4>
<blockquote>
<p>k8s集群所有机器都需要升级内核</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span>

<span class="c"># yum -y install https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm</span>

<span class="c"># yum --enablerepo=&quot;elrepo-kernel&quot; -y install kernel-lt.x86_64</span>

<span class="c"># awk -F \&#39; &#39;$1==&quot;menuentry &quot; {print i++ &quot; : &quot; $2}&#39; /etc/grub2.cfg</span>

<span class="c"># grub2-set-default &quot;CentOS Linux (5.4.204-1.el7.elrepo.x86_64) 7 (Core)&quot;</span>

<span class="c"># reboot</span>
</code></pre></div>
<h4 id="3333_kubernetessealos">3.3.3.3 kubernetes集群快速部署工具sealos准备<a class="headerlink" href="#3333_kubernetessealos" title="Permanent link">&para;</a></h4>
<blockquote>
<p>参考链接：<a href="https://github.com/labring/sealos">https://github.com/labring/sealos</a></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># wget https://github.com/labring/sealos/releases/download/v4.0.0/sealos_4.0.0_linux_amd64.tar.gz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># tar xf sealos_4.0.0_linux_amd64.tar.gz</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># ls</span>
<span class="n">sealctl</span>
<span class="n">sealos</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># mv seal* /usr/bin/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># sealos version</span>
<span class="p">{</span><span class="s2">&quot;gitVersion&quot;</span><span class="p">:</span><span class="s2">&quot;4.0.0&quot;</span><span class="p">,</span><span class="s2">&quot;gitCommit&quot;</span><span class="p">:</span><span class="s2">&quot;7146cfe&quot;</span><span class="p">,</span><span class="s2">&quot;buildDate&quot;</span><span class="p">:</span><span class="s2">&quot;2022-06-30T14:24:31Z&quot;</span><span class="p">,</span><span class="s2">&quot;goVersion&quot;</span><span class="p">:</span><span class="s2">&quot;go1.17.11&quot;</span><span class="p">,</span><span class="s2">&quot;compiler&quot;</span><span class="p">:</span><span class="s2">&quot;gc&quot;</span><span class="p">,</span><span class="s2">&quot;platform&quot;</span><span class="p">:</span><span class="s2">&quot;linux/amd64&quot;</span><span class="p">}</span>
</code></pre></div>
<h4 id="3334_kubernetes">3.3.3.4 kubernetes集群快速部署<a class="headerlink" href="#3334_kubernetes" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># vim sealos-install-k8s.sh</span>
<span class="n">sealos</span> <span class="n">run</span> <span class="n">labring</span><span class="p">/</span><span class="n">kubernetes</span><span class="p">:</span><span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span> <span class="n">labring</span><span class="p">/</span><span class="n">calico</span><span class="p">:</span><span class="n">v3</span><span class="p">.</span><span class="n">22</span><span class="p">.</span><span class="n">1</span>     <span class="p">\</span>
    <span class="p">-</span><span class="n">-masters</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">31</span>     <span class="p">\</span>
    <span class="p">-</span><span class="n">-nodes</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">32</span><span class="p">,</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">33</span>     <span class="p">\</span>
    <span class="p">-</span><span class="n">-passwd</span> <span class="n">123</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># sh sealos-install-k8s.sh</span>
</code></pre></div>
<h4 id="3335_kubernetes">3.3.3.5 kubernetes集群可用性验证<a class="headerlink" href="#3335_kubernetes" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl get nodes</span>
<span class="n">NAME</span>           <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>   <span class="n">VERSION</span>
<span class="n">k8s-master01</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">80s</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span>
<span class="n">k8s-worker01</span>   <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">50s</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span>
<span class="n">k8s-worker02</span>   <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">50s</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl get pod -A</span>
<span class="n">NAMESPACE</span>         <span class="n">NAME</span>                                       <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>      <span class="n">AGE</span>
<span class="n">calico-system</span>     <span class="n">calico-kube-controllers</span><span class="p">-</span><span class="n">6b44b54755</span><span class="p">-</span><span class="n">8ps2r</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">57s</span>
<span class="n">calico-system</span>     <span class="n">calico-node-q6s64</span>                          <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">57s</span>
<span class="n">calico-system</span>     <span class="n">calico-node-rflzc</span>                          <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">57s</span>
<span class="n">calico-system</span>     <span class="n">calico-node-x2kv6</span>                          <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">57s</span>
<span class="n">calico-system</span>     <span class="n">calico-typha</span><span class="p">-</span><span class="n">7df84cd569-sqmnb</span>              <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">57s</span>
<span class="n">calico-system</span>     <span class="n">calico-typha</span><span class="p">-</span><span class="n">7df84cd569-ss49p</span>              <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">48s</span>
<span class="n">kube-system</span>       <span class="n">coredns</span><span class="p">-</span><span class="n">6d4b75cb6d-g67cj</span>                   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">94s</span>
<span class="n">kube-system</span>       <span class="n">coredns</span><span class="p">-</span><span class="n">6d4b75cb6d-knxfk</span>                   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">94s</span>
<span class="n">kube-system</span>       <span class="n">etcd-k8s-master01</span>                          <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">108s</span>
<span class="n">kube-system</span>       <span class="n">kube-apiserver-k8s-master01</span>                <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">108s</span>
<span class="n">kube-system</span>       <span class="n">kube-controller-manager-k8s-master01</span>       <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">108s</span>
<span class="n">kube-system</span>       <span class="n">kube-proxy</span><span class="p">-</span><span class="n">5ncc6</span>                           <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">95s</span>
<span class="n">kube-system</span>       <span class="n">kube-proxy-rvntq</span>                           <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">81s</span>
<span class="n">kube-system</span>       <span class="n">kube-proxy-s7gfr</span>                           <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">81s</span>
<span class="n">kube-system</span>       <span class="n">kube-scheduler-k8s-master01</span>                <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">108s</span>
<span class="n">kube-system</span>       <span class="n">kube-sealyun-lvscare-k8s-worker01</span>          <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">74s</span>
<span class="n">kube-system</span>       <span class="n">kube-sealyun-lvscare-k8s-worker02</span>          <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>             <span class="n">72s</span>
<span class="n">tigera-operator</span>   <span class="n">tigera-operator-d7957f5cc</span><span class="p">-</span><span class="n">4twhq</span>            <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">1</span> <span class="p">(</span><span class="n">60s</span> <span class="n">ago</span><span class="p">)</span>   <span class="n">79s</span>
</code></pre></div>
<h4 id="3336_ingress-nginx">3.3.3.6 安装ingress-nginx<a class="headerlink" href="#3336_ingress-nginx" title="Permanent link">&para;</a></h4>
<p>通过配置ingress-nginx对象暴露服务</p>
<blockquote>
<p>参考链接：<a href="https://github.com/kubernetes/ingress-nginx">https://github.com/kubernetes/ingress-nginx</a></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># curl -k https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/baremetal/deploy.yaml  -o deploy.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master1<span class="w"> </span>~<span class="o">]</span><span class="c1"># ls</span>
deploy.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># vim deploy.yaml</span>

<span class="m">334</span><span class="w"> </span>apiVersion:<span class="w"> </span>v1
<span class="m">335</span><span class="w"> </span>kind:<span class="w"> </span>Service
<span class="m">336</span><span class="w"> </span>metadata:
<span class="m">337</span><span class="w">   </span>labels:
<span class="m">338</span><span class="w">     </span>app.kubernetes.io/component:<span class="w"> </span>controller
<span class="m">339</span><span class="w">     </span>app.kubernetes.io/instance:<span class="w"> </span>ingress-nginx
<span class="m">340</span><span class="w">     </span>app.kubernetes.io/name:<span class="w"> </span>ingress-nginx
<span class="m">341</span><span class="w">     </span>app.kubernetes.io/part-of:<span class="w"> </span>ingress-nginx
<span class="m">342</span><span class="w">     </span>app.kubernetes.io/version:<span class="w"> </span><span class="m">1</span>.3.0
<span class="m">343</span><span class="w">   </span>name:<span class="w"> </span>ingress-nginx-controller
<span class="m">344</span><span class="w">   </span>namespace:<span class="w"> </span>ingress-nginx
<span class="m">345</span><span class="w"> </span>spec:
<span class="m">346</span><span class="w">   </span>ipFamilies:
<span class="m">347</span><span class="w">   </span>-<span class="w"> </span>IPv4
<span class="m">348</span><span class="w">   </span>ipFamilyPolicy:<span class="w"> </span>SingleStack
<span class="m">349</span><span class="w">   </span>ports:
<span class="m">350</span><span class="w">   </span>-<span class="w"> </span>appProtocol:<span class="w"> </span>http
<span class="m">351</span><span class="w">     </span>name:<span class="w"> </span>http
<span class="m">352</span><span class="w">     </span>port:<span class="w"> </span><span class="m">80</span>
<span class="m">353</span><span class="w">     </span>protocol:<span class="w"> </span>TCP
<span class="m">354</span><span class="w">     </span>targetPort:<span class="w"> </span>http
<span class="m">355</span><span class="w">   </span>-<span class="w"> </span>appProtocol:<span class="w"> </span>https
<span class="m">356</span><span class="w">     </span>name:<span class="w"> </span>https
<span class="m">357</span><span class="w">     </span>port:<span class="w"> </span><span class="m">443</span>
<span class="m">358</span><span class="w">     </span>protocol:<span class="w"> </span>TCP
<span class="m">359</span><span class="w">     </span>targetPort:<span class="w"> </span>https
<span class="m">360</span><span class="w">   </span>selector:
<span class="m">361</span><span class="w">     </span>app.kubernetes.io/component:<span class="w"> </span>controller
<span class="m">362</span><span class="w">     </span>app.kubernetes.io/instance:<span class="w"> </span>ingress-nginx
<span class="m">363</span><span class="w">     </span>app.kubernetes.io/name:<span class="w"> </span>ingress-nginx
<span class="m">364</span><span class="w">   </span>type:<span class="w"> </span>LoadBalancer

把364行修改为LoadBalancer
<span class="m">365</span><span class="w"> </span>---
<span class="m">366</span><span class="w"> </span>apiVersion:<span class="w"> </span>v1
<span class="m">367</span><span class="w"> </span>kind:<span class="w"> </span>Service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl apply -f deploy.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">验证部署</span><span class="err">：</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl get pod -n ingress-nginx</span>
<span class="n">NAME</span>                                        <span class="n">READY</span>   <span class="n">STATUS</span>      <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">ingress-nginx-admission-create-rksbr</span>        <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Completed</span>   <span class="n">0</span>          <span class="n">104s</span>
<span class="n">ingress-nginx-admission-patch-zg8f8</span>         <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Completed</span>   <span class="n">3</span>          <span class="n">104s</span>
<span class="n">ingress-nginx-controller</span><span class="p">-</span><span class="n">6dc865cd86</span><span class="p">-</span><span class="n">7rvfx</span>   <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>     <span class="n">0</span>          <span class="n">104s</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl get all -n ingress-nginx</span>
<span class="n">NAME</span>                                            <span class="n">READY</span>   <span class="n">STATUS</span>      <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">pod</span><span class="p">/</span><span class="n">ingress-nginx-admission-create-rksbr</span>        <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Completed</span>   <span class="n">0</span>          <span class="n">111s</span>
<span class="n">pod</span><span class="p">/</span><span class="n">ingress-nginx-admission-patch-zg8f8</span>         <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Completed</span>   <span class="n">3</span>          <span class="n">111s</span>
<span class="n">pod</span><span class="p">/</span><span class="n">ingress-nginx-controller</span><span class="p">-</span><span class="n">6dc865cd86</span><span class="p">-</span><span class="n">7rvfx</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>     <span class="n">0</span>          <span class="n">111s</span>

<span class="n">NAME</span>                                         <span class="nb">TYPE </span>          <span class="n">CLUSTER-IP</span>    <span class="n">EXTERNAL-IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                      <span class="n">AGE</span>
<span class="n">service</span><span class="p">/</span><span class="n">ingress-nginx-controller</span>             <span class="n">LoadBalancer</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">211</span>   <span class="p">&lt;</span><span class="n">pending</span><span class="p">&gt;</span>     <span class="n">80</span><span class="p">:</span><span class="n">32210</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">443</span><span class="p">:</span><span class="n">32004</span><span class="p">/</span><span class="n">TCP</span>   <span class="n">111s</span>
<span class="n">service</span><span class="p">/</span><span class="n">ingress-nginx-controller-admission</span>   <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">20</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">443</span><span class="p">/</span><span class="n">TCP</span>                      <span class="n">111s</span>

<span class="n">NAME</span>                                       <span class="n">READY</span>   <span class="n">UP-TO-DATE</span>   <span class="n">AVAILABLE</span>   <span class="n">AGE</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">ingress-nginx-controller</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">1</span>            <span class="n">1</span>           <span class="n">111s</span>

<span class="n">NAME</span>                                                  <span class="n">DESIRED</span>   <span class="n">CURRENT</span>   <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">replicaset</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">ingress-nginx-controller</span><span class="p">-</span><span class="n">6dc865cd86</span>   <span class="n">1</span>         <span class="n">1</span>         <span class="n">1</span>       <span class="n">111s</span>

<span class="n">NAME</span>                                       <span class="n">COMPLETIONS</span>   <span class="n">DURATION</span>   <span class="n">AGE</span>
<span class="n">job</span><span class="p">.</span><span class="n">batch</span><span class="p">/</span><span class="n">ingress-nginx-admission-create</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>           <span class="n">43s</span>        <span class="n">111s</span>
<span class="n">job</span><span class="p">.</span><span class="n">batch</span><span class="p">/</span><span class="n">ingress-nginx-admission-patch</span>    <span class="n">1</span><span class="p">/</span><span class="n">1</span>           <span class="n">68s</span>        <span class="n">111s</span>
</code></pre></div>
<h4 id="3337_metallb">3.3.3.7 安装metallb<a class="headerlink" href="#3337_metallb" title="Permanent link">&para;</a></h4>
<p>MetalLB可以为kubernetes集群中的Service提供网络负载均衡功能。</p>
<p>MetalLB两大功能为:</p>
<ul>
<li>地址分配，类似于DHCP</li>
<li>外部通告，一旦MetalLB为服务分配了外部IP地址，它就需要使群集之外的网络意识到该IP在群集中“存在”。MetalLB使用标准路由协议来实现此目的：ARP，NDP或BGP。</li>
</ul>
<p>参考链接： <a href="https://metallb.universe.tf/installation/">https://metallb.universe.tf/installation/</a></p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.12.1/manifests/namespace.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.12.1/manifests/metallb.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># vim metallb-conf.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ConfigMap</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">metallb-system</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">config</span><span class="p">:</span> <span class="p">|</span>
    <span class="n">address-pools</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="k">default</span>
      <span class="n">protocol</span><span class="p">:</span> <span class="n">layer2</span>
      <span class="n">addresses</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">90</span><span class="p">-</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">100</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">90</span><span class="p">-</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">100是集群节点服务器IP同一段</span><span class="err">。</span>      
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl apply -f metallb-conf.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">验证配置</span><span class="err">：</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl get svc -n ingress-nginx</span>
<span class="n">NAME</span>                                 <span class="nb">TYPE </span>          <span class="n">CLUSTER-IP</span>    <span class="n">EXTERNAL-IP</span>     <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                      <span class="n">AGE</span>
<span class="n">ingress-nginx-controller</span>             <span class="n">LoadBalancer</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">211</span>   <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">90</span>   <span class="n">80</span><span class="p">:</span><span class="n">32210</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">443</span><span class="p">:</span><span class="n">32004</span><span class="p">/</span><span class="n">TCP</span>   <span class="n">7m49s</span>
<span class="n">ingress-nginx-controller-admission</span>   <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">20</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">443</span><span class="p">/</span><span class="n">TCP</span>                      <span class="n">7m49s</span>
<span class="n">ingress-nginx-controller已获取到metallb分配的LB-IP</span>
</code></pre></div>
<h3 id="334_argocd">3.3.4 ArgoCd安装<a class="headerlink" href="#334_argocd" title="Permanent link">&para;</a></h3>
<blockquote>
<p>参考链接：<a href="https://argo-cd.readthedocs.io/en/stable/">https://argo-cd.readthedocs.io/en/stable/</a></p>
</blockquote>
<h4 id="3341_arog">3.3.4.1 Arog介绍<a class="headerlink" href="#3341_arog" title="Permanent link">&para;</a></h4>
<p>Argo(<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fargoproj.github.io%2Fprojects%2Fargo">https://argoproj.github.io/projects/argo</a>) 项目是一组 Kubernetes 原生工具集合，用于运行和管理 Kubernetes 上的作业和应用程序。Argo 提供了一种在 Kubernetes 上创建工作和应用程序的三种计算模式 – 服务模式、工作流模式和基于事件的模式 。所有的 Argo 工具都实现为控制器和自定义资源。</p>
<p><strong>为什么选用Argo CD</strong></p>
<p>应用程序定义、配置和环境应该是声明性的，并受版本控制。应用程序部署和生命周期管理应该是自动化的、可审计的、易于理解的。</p>
<h4 id="3342_argo">3.3.4.2 Argo安装<a class="headerlink" href="#3342_argo" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">创建命名空间</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl create namespace argocd</span>
<span class="n">namespace</span><span class="p">/</span><span class="n">argocd</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">由于后期使用ingress暴露服务</span><span class="err">，</span><span class="n">所以不建议直接使用</span><span class="err">，</span><span class="n">可下载下来</span><span class="err">，</span><span class="n">修改后再执行</span><span class="err">。</span>
<span class="nb">wget </span><span class="n">https</span><span class="p">://</span><span class="n">raw</span><span class="p">.</span><span class="n">githubusercontent</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">argoproj</span><span class="p">/</span><span class="n">argo-cd</span><span class="p">/</span><span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">11</span><span class="p">/</span><span class="n">manifests</span><span class="p">/</span><span class="n">install</span><span class="p">.</span><span class="n">yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">在10184行下面添加如下内容</span><span class="err">：</span><span class="n">默认必须使用TLS证书才能访问</span><span class="err">，</span><span class="n">下面案例中</span><span class="err">，</span><span class="n">不使用TLS证书</span><span class="err">。</span>
<span class="c"># vim install.yaml</span>

<span class="n">10184</span>       <span class="p">-</span> <span class="n">command</span><span class="p">:</span>
<span class="n">10185</span>         <span class="p">-</span> <span class="n">argocd-server</span>
<span class="n">10186</span>         <span class="p">-</span> <span class="p">-</span><span class="n">-insecure</span> <span class="n">添加此行内容</span>
<span class="n">10187</span>         <span class="n">env</span><span class="p">:</span>
<span class="n">10188</span>         <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ARGOCD_SERVER_INSECURE</span>
<span class="n">10189</span>           <span class="n">valueFrom</span><span class="p">:</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl apply -f install.yaml -n argocd</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl get pod -n argocd</span>
NAME<span class="w">                                                </span>READY<span class="w">   </span>STATUS<span class="w">             </span>RESTARTS<span class="w">   </span>AGE
argocd-application-controller-0<span class="w">                     </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">            </span><span class="m">0</span><span class="w">          </span>20m
argocd-applicationset-controller-7b74965f8c-zvxbc<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">            </span><span class="m">0</span><span class="w">          </span>20m
argocd-dex-server-7f75d56bc6-xqzqj<span class="w">                  </span><span class="m">0</span>/1<span class="w">     </span>ImagePullBackOff<span class="w">   </span><span class="m">0</span><span class="w">          </span>20m
argocd-notifications-controller-54dd686846-gknrm<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">            </span><span class="m">0</span><span class="w">          </span>20m
argocd-redis-5dff748d9c-rknln<span class="w">                       </span><span class="m">0</span>/1<span class="w">     </span>ImagePullBackOff<span class="w">   </span><span class="m">0</span><span class="w">          </span>20m
argocd-repo-server-5576f8d84b-sf24d<span class="w">                 </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">            </span><span class="m">0</span><span class="w">          </span>20m
argocd-server-54b95b8c6-7xxcf<span class="w">                       </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">            </span><span class="m">0</span><span class="w">          </span>20m
</code></pre></div>
<p><strong>注意：如果argocd-dex-server-7f75d56bc6-xqzqj，argocd-redis-5dff748d9c-rknln两个pod无法拉取镜像的话需要修改Argocd部署方式</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">以下操作在所有k8s集群服务器上操作</span>
<span class="n">上传</span><span class="err">“</span><span class="n">资源</span><span class="err">”</span><span class="n">文件夹下的镜像tar包</span><span class="err">（</span><span class="n">redis</span><span class="p">.</span><span class="n">tar</span><span class="p">,</span><span class="n">dex</span><span class="p">.</span><span class="n">tar</span><span class="err">）</span><span class="n">至所有k8s集群服务器</span><span class="err">，</span><span class="n">然后导入镜像</span>
<span class="c"># ctr -n=k8s.io image import redis.tar</span>
<span class="c"># ctr -n=k8s.io image import dex.tar</span>
<span class="c"># crictl ../../img/kubernetes/kubernetes_gitops list</span>
<span class="n">IMAGE</span>                                       <span class="n">TAG</span>                 <span class="n">IMAGE</span> <span class="n">ID</span>            <span class="n">SIZE</span>
<span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">library</span><span class="p">/</span><span class="n">redis</span>                     <span class="n">7</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">4-alpine</span>        <span class="n">9192ed4e49554</span>       <span class="n">29</span><span class="p">.</span><span class="n">7MB</span>
<span class="n">ghcr</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">dexidp</span><span class="p">/</span><span class="n">dex</span>                          <span class="n">v2</span><span class="p">.</span><span class="n">32</span><span class="p">.</span><span class="n">0</span>             <span class="n">cee62569fdc12</span>       <span class="n">80</span><span class="p">.</span><span class="n">5MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">calico</span><span class="p">/</span><span class="n">cni</span>                  <span class="n">v3</span><span class="p">.</span><span class="n">22</span><span class="p">.</span><span class="n">1</span>             <span class="n">2a8ef6985a3e5</span>       <span class="n">80</span><span class="p">.</span><span class="n">5MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">calico</span><span class="p">/</span><span class="n">node</span>                 <span class="n">v3</span><span class="p">.</span><span class="n">22</span><span class="p">.</span><span class="n">1</span>             <span class="n">7a71aca7b60fc</span>       <span class="n">69</span><span class="p">.</span><span class="n">6MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">calico</span><span class="p">/</span><span class="n">pod2daemon-flexvol</span>   <span class="n">v3</span><span class="p">.</span><span class="n">22</span><span class="p">.</span><span class="n">1</span>             <span class="n">17300d20daf93</span>       <span class="n">8</span><span class="p">.</span><span class="n">46MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">coredns</span><span class="p">/</span><span class="n">coredns</span>             <span class="n">v1</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">6</span>              <span class="n">a4ca41631cc7a</span>       <span class="n">13</span><span class="p">.</span><span class="n">6MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">etcd</span>                        <span class="n">3</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">3</span><span class="p">-</span><span class="n">0</span>             <span class="n">aebe758cef4cd</span>       <span class="n">102MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">kube-apiserver</span>              <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span>             <span class="n">529072250ccc6</span>       <span class="n">33</span><span class="p">.</span><span class="n">8MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">kube-controller-manager</span>     <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span>             <span class="n">88784fb4ac2f6</span>       <span class="n">31MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">kube-proxy</span>                  <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span>             <span class="n">77b49675beae1</span>       <span class="n">39</span><span class="p">.</span><span class="n">5MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">kube-scheduler</span>              <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">0</span>             <span class="n">e3ed7dee73e93</span>       <span class="n">15</span><span class="p">.</span><span class="n">5MB</span>
<span class="n">sealos</span><span class="p">.</span><span class="n">hub</span><span class="p">:</span><span class="n">5000</span><span class="p">/</span><span class="n">pause</span>                       <span class="n">3</span><span class="p">.</span><span class="n">7</span>                 <span class="n">221177c6082a8</span>       <span class="n">311kB</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">修改ArgoCd安装资源清单文件中</span><span class="err">，</span><span class="n">这两个镜像的拉取策略</span>
 <span class="n">9763</span>       <span class="n">containers</span><span class="p">:</span>
 <span class="n">9764</span>       <span class="p">-</span> <span class="n">command</span><span class="p">:</span>
 <span class="n">9765</span>         <span class="p">-</span> <span class="p">/</span><span class="n">shared</span><span class="p">/</span><span class="n">argocd-dex</span>
 <span class="n">9766</span>         <span class="p">-</span> <span class="n">rundex</span>
 <span class="n">9767</span>         <span class="n">image</span><span class="p">:</span> <span class="n">ghcr</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">dexidp</span><span class="p">/</span><span class="n">dex</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">32</span><span class="p">.</span><span class="n">0</span>
 <span class="n">9768</span>         <span class="n">imagePullPolicy</span><span class="p">:</span> <span class="n">IfNotPresent</span>
 <span class="n">修改9768行镜像拉取策略为IfNotPresent</span>
 <span class="n">9769</span>         <span class="n">name</span><span class="p">:</span> <span class="n">dex</span>
 <span class="n">9770</span>         <span class="n">ports</span><span class="p">:</span>
 <span class="n">9771</span>         <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">5556</span>
 <span class="n">9772</span>         <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">5557</span>
 <span class="n">9773</span>         <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">5558</span>

<span class="p">...</span>
 <span class="n">9901</span>       <span class="n">containers</span><span class="p">:</span>
 <span class="n">9902</span>       <span class="p">-</span> <span class="n">args</span><span class="p">:</span>
 <span class="n">9903</span>         <span class="p">-</span> <span class="p">-</span><span class="n">-save</span>
 <span class="n">9904</span>         <span class="p">-</span> <span class="s2">&quot;&quot;</span>
 <span class="n">9905</span>         <span class="p">-</span> <span class="p">-</span><span class="n">-appendonly</span>
 <span class="n">9906</span>         <span class="p">-</span> <span class="s2">&quot;no&quot;</span>
 <span class="n">9907</span>         <span class="n">image</span><span class="p">:</span> <span class="n">redis</span><span class="p">:</span><span class="n">7</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">4-alpine</span>
 <span class="n">9908</span>         <span class="n">imagePullPolicy</span><span class="p">:</span> <span class="n">IfNotPresent</span>
 <span class="n">修改9908行镜像拉取策略为IfNotPresent</span>
 <span class="n">9909</span>         <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
 <span class="n">9910</span>         <span class="n">ports</span><span class="p">:</span>
 <span class="n">9911</span>         <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">6379</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">然后重新应用ArgoCd部署资源清单文件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl apply -f install.yaml -n argocd</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get pods -n argocd</span>
<span class="n">NAME</span>                                                <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">argocd-application-controller</span><span class="p">-</span><span class="n">0</span>                     <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">7m27s</span>
<span class="n">argocd-applicationset-controller</span><span class="p">-</span><span class="n">7b74965f8c</span><span class="p">-</span><span class="n">7wsv6</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">7m28s</span>
<span class="n">argocd-dex-server</span><span class="p">-</span><span class="n">7f75d56bc6-j6bmk</span>                  <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">7m28s</span>
<span class="n">argocd-notifications-controller</span><span class="p">-</span><span class="n">54dd686846-kj579</span>    <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">7m28s</span>
<span class="n">argocd-redis</span><span class="p">-</span><span class="n">5dff748d9c-vxlbx</span>                       <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">7m28s</span>
<span class="n">argocd-repo-server</span><span class="p">-</span><span class="n">5576f8d84b-ztv4l</span>                 <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">7m28s</span>
<span class="n">argocd-server</span><span class="p">-</span><span class="n">54b95b8c6-rdc74</span>                       <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">7m28s</span>

<span class="c"># kubectl get svc -n argocd</span>
<span class="n">NAME</span>                                      <span class="nb">TYPE </span>       <span class="n">CLUSTER-IP</span>    <span class="n">EXTERNAL-IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                      <span class="n">AGE</span>
<span class="n">argocd-applicationset-controller</span>          <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">13</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">7000</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">8080</span><span class="p">/</span><span class="n">TCP</span>            <span class="n">7m36s</span>
<span class="n">argocd-dex-server</span>                         <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">96</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">5556</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">5557</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">5558</span><span class="p">/</span><span class="n">TCP</span>   <span class="n">7m36s</span>
<span class="n">argocd-metrics</span>                            <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">126</span>   <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">8082</span><span class="p">/</span><span class="n">TCP</span>                     <span class="n">7m36s</span>
<span class="n">argocd-notifications-controller-metrics</span>   <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">53</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">9001</span><span class="p">/</span><span class="n">TCP</span>                     <span class="n">7m36s</span>
<span class="n">argocd-redis</span>                              <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">83</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">6379</span><span class="p">/</span><span class="n">TCP</span>                     <span class="n">7m36s</span>
<span class="n">argocd-repo-server</span>                        <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">163</span>   <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">8081</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">8084</span><span class="p">/</span><span class="n">TCP</span>            <span class="n">7m36s</span>
<span class="n">argocd-server</span>                             <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">54</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">80</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">443</span><span class="p">/</span><span class="n">TCP</span>               <span class="n">7m36s</span>
<span class="n">argocd-server-metrics</span>                     <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">3</span>     <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">8083</span><span class="p">/</span><span class="n">TCP</span>                     <span class="n">7m36s</span>
</code></pre></div>
<h4 id="3343_argo_ingress">3.3.4.3 创建Argo Ingress对象<a class="headerlink" href="#3343_argo_ingress" title="Permanent link">&para;</a></h4>
<blockquote>
<p>使用ingress，方便在k8s集群外访问。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># vim ingress-argocd.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Ingress</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingress</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">argocd</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">ingress</span><span class="p">.</span><span class="n">class</span><span class="p">:</span> <span class="n">nginx</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">rules</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">host</span><span class="p">:</span> <span class="n">argocd</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
    <span class="n">http</span><span class="p">:</span>
      <span class="n">paths</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">pathType</span><span class="p">:</span> <span class="n">Prefix</span>
        <span class="n">path</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span>
        <span class="n">backend</span><span class="p">:</span>
          <span class="n">service</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">argocd-server</span>
            <span class="n">port</span><span class="p">:</span>
              <span class="n">number</span><span class="p">:</span> <span class="n">80</span>        
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl apply -f ingress-argocd.yaml </span>
ingress.networking.k8s.io/ingress<span class="w"> </span>created
<span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl get ingress -n argocd</span>
NAME<span class="w">      </span>CLASS<span class="w">    </span>HOSTS<span class="w">             </span>ADDRESS<span class="w">         </span>PORTS<span class="w">   </span>AGE
ingress<span class="w">   </span>&lt;none&gt;<span class="w">   </span>argocd.alan.com<span class="w">   </span><span class="m">192</span>.168.10.32<span class="w">   </span><span class="m">80</span><span class="w">      </span>14s
</code></pre></div>
<h4 id="3344_argocdkubemsbcom">3.3.4.4 添加argocd.kubemsb.com域名解析<a class="headerlink" href="#3344_argocdkubemsbcom" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">在k8s-master01上添加hosts</span><span class="p">,</span><span class="n">通过argocd客户端修改argocd登录密码时</span><span class="err">，</span><span class="n">访问argocd</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># vim /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">90</span> <span class="n">argocd</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<p>在pc添加hosts,访问argocdWeb界面</p>
<p>PC按住win+R键，输入drivers,点击确定</p>
<p><img alt="配置hosts-01" src="../../../img/kubernetes/kubernetes_gitops/%E9%85%8D%E7%BD%AEhosts-01.png" /></p>
<p><img alt="配置hosts-02" src="../../../img/kubernetes/kubernetes_gitops/%E9%85%8D%E7%BD%AEhosts-02.png" /></p>
<p><img alt="配置hosts-03" src="../../../img/kubernetes/kubernetes_gitops/%E9%85%8D%E7%BD%AEhosts-03.png" /></p>
<p><img alt="配置hosts-04" src="../../../img/kubernetes/kubernetes_gitops/%E9%85%8D%E7%BD%AEhosts-04.png" /></p>
<h4 id="3345_argo_ui">3.3.4.5 访问Argo UI界面<a class="headerlink" href="#3345_argo_ui" title="Permanent link">&para;</a></h4>
<p>浏览器输入argocd域名：<a href="http://argocd.kubemsb.com">http://argocd.kubemsb.com</a></p>
<p><img alt="登录argocd-01" src="../../../img/kubernetes/kubernetes_gitops/%E7%99%BB%E5%BD%95argocd-01.png" /></p>
<h4 id="3346">3.3.4.6 获取登录密码<a class="headerlink" href="#3346" title="Permanent link">&para;</a></h4>
<blockquote>
<p>用户名为：admin，密码需要查询后解密方可知晓</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">查看加密后的密码</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl get secret argocd-initial-admin-secret -o yaml -n argocd</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">password</span><span class="p">:</span> <span class="n">clpYZ3d4dkY4TGlmMTV4Qw</span><span class="p">==</span>  <span class="n">此处为加密后密码</span><span class="err">，</span><span class="n">需要解密才能使用</span><span class="err">。</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
<span class="n">metadata</span><span class="p">:</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">把加密后的密码进行解密</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># echo clpYZ3d4dkY4TGlmMTV4Qw== | base64 -d</span>
<span class="n">g50ElRK4jlYElORK</span> <span class="n">此为真正的密码</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">或使用下面命令直接获取登录密码</span><span class="err">：</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=&quot;{.data.password}&quot; | base64 -d</span>
<span class="n">g50ElRK4jlYElORK</span>
</code></pre></div>
<p>重新登录argo cd:<a href="http://argocd.kubemsb.com">http://argocd.kubemsb.com</a></p>
<p><img alt="登录argocd-02" src="../../../img/kubernetes/kubernetes_gitops/%E7%99%BB%E5%BD%95argocd-02.png" /></p>
<p>ArgoCd web界面</p>
<p><img alt="argocd-ui" src="../../../img/kubernetes/kubernetes_gitops/argocd-ui.png" /></p>
<h4 id="3347">3.3.4.7 客户端安装<a class="headerlink" href="#3347" title="Permanent link">&para;</a></h4>
<blockquote>
<p>可通过客户端登录Argocd命令行或直接修改admin登录密码等</p>
</blockquote>
<p>参考链接：<a href="https://github.com/argoproj/argo-cd/releases">https://github.com/argoproj/argo-cd/releases</a></p>
<div class="highlight"><pre><span></span><code><span class="n">下载argocd客户端软件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># wget https://github.com/argoproj/argo-cd/releases/download/v2.4.11/argocd-linux-amd64</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">安装Argocd客户端软件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># chmod +x argocd-linux-amd64</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># mv argocd-linux-amd64 /usr/local/bin/argocd</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">使用argocd</span> <span class="n">version查看版本相关信息</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># argocd version</span>
<span class="n">argocd</span><span class="p">:</span> <span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">11</span><span class="p">+</span><span class="n">3d9e9f2</span>
  <span class="n">BuildDate</span><span class="p">:</span> <span class="n">2022</span><span class="p">-</span><span class="n">08</span><span class="p">-</span><span class="n">22T09</span><span class="p">:</span><span class="n">35</span><span class="p">:</span><span class="n">38Z</span>
  <span class="n">GitCommit</span><span class="p">:</span> <span class="n">3d9e9f2f95b7801b90377ecfc4073e5f0f07205b</span>
  <span class="n">GitTreeState</span><span class="p">:</span> <span class="n">clean</span>
  <span class="n">GoVersion</span><span class="p">:</span> <span class="n">go1</span><span class="p">.</span><span class="n">18</span><span class="p">.</span><span class="n">5</span>
  <span class="n">Compiler</span><span class="p">:</span> <span class="nb">gc</span>
  <span class="n">Platform</span><span class="p">:</span> <span class="n">linux</span><span class="p">/</span><span class="n">amd64</span>
<span class="n">WARN</span><span class="p">[</span><span class="n">0000</span><span class="p">]</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">grpc</span> <span class="n">call</span><span class="p">.</span> <span class="n">Use</span> <span class="n">flag</span> <span class="p">-</span><span class="n">-grpc-web</span> <span class="k">in</span> <span class="n">grpc</span> <span class="n">calls</span><span class="p">.</span> <span class="n">To</span> <span class="n">avoid</span> <span class="n">this</span> <span class="n">warning</span> <span class="n">message</span><span class="p">,</span> <span class="n">use</span> <span class="n">flag</span> <span class="p">-</span><span class="n">-grpc-web</span><span class="p">.</span> 
<span class="n">argocd-server</span><span class="p">:</span> <span class="n">v2</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">11</span><span class="p">+</span><span class="n">3d9e9f2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">在命令行登录</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># argocd login argocd.alan.com</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="n">server</span> <span class="n">certificate</span> <span class="n">had</span> <span class="n">error</span><span class="p">:</span> <span class="n">x509</span><span class="p">:</span> <span class="n">certificate</span> <span class="n">is</span> <span class="n">valid</span> <span class="k">for</span> <span class="n">ingress</span><span class="p">.</span><span class="n">local</span><span class="p">,</span> <span class="n">not</span> <span class="n">argocd</span><span class="p">.</span><span class="n">alan</span><span class="p">.</span><span class="n">com</span><span class="p">.</span> <span class="n">Proceed</span> <span class="n">insecurely</span> <span class="p">(</span><span class="n">y</span><span class="p">/</span><span class="n">n</span><span class="p">)?</span> <span class="n">y</span>
<span class="n">WARN</span><span class="p">[</span><span class="n">0002</span><span class="p">]</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">grpc</span> <span class="n">call</span><span class="p">.</span> <span class="n">Use</span> <span class="n">flag</span> <span class="p">-</span><span class="n">-grpc-web</span> <span class="k">in</span> <span class="n">grpc</span> <span class="n">calls</span><span class="p">.</span> <span class="n">To</span> <span class="n">avoid</span> <span class="n">this</span> <span class="n">warning</span> <span class="n">message</span><span class="p">,</span> <span class="n">use</span> <span class="n">flag</span> <span class="p">-</span><span class="n">-grpc-web</span><span class="p">.</span> 
<span class="n">Username</span><span class="p">:</span> <span class="n">admin</span>
<span class="n">Password</span><span class="p">:</span> <span class="n">输入初始密码</span>
<span class="s1">&#39;admin:login&#39;</span> <span class="n">logged</span> <span class="k">in</span> <span class="n">successfully</span>
<span class="n">Context</span> <span class="s1">&#39;argocd.alan.com&#39;</span> <span class="n">updated</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">修改admin管理员密码</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># argocd account update-password</span>
<span class="n">WARN</span><span class="p">[</span><span class="n">0000</span><span class="p">]</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">grpc</span> <span class="n">call</span><span class="p">.</span> <span class="n">Use</span> <span class="n">flag</span> <span class="p">-</span><span class="n">-grpc-web</span> <span class="k">in</span> <span class="n">grpc</span> <span class="n">calls</span><span class="p">.</span> <span class="n">To</span> <span class="n">avoid</span> <span class="n">this</span> <span class="n">warning</span> <span class="n">message</span><span class="p">,</span> <span class="n">use</span> <span class="n">flag</span> <span class="p">-</span><span class="n">-grpc-web</span><span class="p">.</span>
<span class="p">***</span> <span class="n">Enter</span> <span class="n">password</span> <span class="n">of</span> <span class="n">currently</span> <span class="n">logged</span> <span class="k">in</span> <span class="n">user</span> <span class="p">(</span><span class="n">admin</span><span class="p">):</span> <span class="n">输入当前密码</span><span class="err">，</span><span class="n">可直接复制粘贴</span>
<span class="p">***</span> <span class="n">Enter</span> <span class="n">new</span> <span class="n">password</span> <span class="k">for</span> <span class="n">user</span> <span class="n">admin</span><span class="p">:</span> <span class="n">12345678</span> <span class="n">必须为8</span><span class="p">-</span><span class="n">32位</span>
<span class="p">***</span> <span class="n">Confirm</span> <span class="n">new</span> <span class="n">password</span> <span class="k">for</span> <span class="n">user</span> <span class="n">admin</span><span class="p">:</span> <span class="n">密码确认</span>
<span class="n">Password</span> <span class="n">updated</span> <span class="n">更新成功</span><span class="err">，</span><span class="n">可使用此密码登录WEB</span> <span class="n">UI界面</span><span class="err">。</span>
<span class="n">Context</span> <span class="s1">&#39;argocd.alan.com&#39;</span> <span class="n">updated</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">登出argocd</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># argocd logout argocd.alan.com</span>
<span class="n">Logged</span> <span class="n">out</span> <span class="n">from</span> <span class="s1">&#39;argocd.alan.com&#39;</span>
</code></pre></div>
<p>重新登录argocd:<a href="http://argocd.kubemsb.com">http://argocd.kubemsb.com</a></p>
<p><img alt="重新登录argocd" src="../../../img/kubernetes/kubernetes_gitops/%E9%87%8D%E6%96%B0%E7%99%BB%E5%BD%95argocd.png" /></p>
<h2 id="34">3.4 工具集成配置<a class="headerlink" href="#34" title="Permanent link">&para;</a></h2>
<h3 id="341_harbor">3.4.1 配置主机使用harbor<a class="headerlink" href="#341_harbor" title="Permanent link">&para;</a></h3>
<h4 id="3411_harbor">3.4.1.1 harbor<a class="headerlink" href="#3411_harbor" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># vim /etc/docker/daemon.json</span>
<span class="p">{</span>
        <span class="s2">&quot;insecure-registries&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://192.168.10.21&quot;</span><span class="p">],</span>
         <span class="s2">&quot;registry-mirrors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://a237mf1e.mirror.aliyuncs.com&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># docker-compose down</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># systemctl restart docker</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># docker-compose up -d</span>
</code></pre></div>
<h4 id="3412_k8s">3.4.1.2 k8s<a class="headerlink" href="#3412_k8s" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="p">~]</span><span class="c"># cd /etc/containerd/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">containerd</span><span class="p">]</span><span class="c"># vim config.toml</span>
<span class="n">添加如下内容</span>
<span class="p">[</span><span class="n">plugins</span><span class="p">.</span><span class="s2">&quot;io.containerd.grpc.v1.cri&quot;</span><span class="p">.</span><span class="n">registry</span><span class="p">.</span><span class="n">configs</span><span class="p">.</span><span class="s2">&quot;192.168.10.21&quot;</span><span class="p">.</span><span class="n">auth</span><span class="p">]</span>
            <span class="n">username</span> <span class="p">=</span> <span class="s2">&quot;admin&quot;</span>
            <span class="n">password</span> <span class="p">=</span> <span class="s2">&quot;Harbor12345&quot;</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">containerd</span><span class="p">]</span><span class="c"># cd /etc/containerd/certs.d/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">certs</span><span class="p">.</span><span class="n">d</span><span class="p">]</span><span class="c"># mkdir 192.168.10.21</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">certs</span><span class="p">.</span><span class="n">d</span><span class="p">]</span><span class="c"># cp sealos.hub\:5000/hosts.toml 192.168.10.21/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">certs</span><span class="p">.</span><span class="n">d</span><span class="p">]</span><span class="c"># cd 192.168.10.21/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">21</span><span class="p">]</span><span class="c"># vim hosts.toml</span>
<span class="n">server</span> <span class="p">=</span> <span class="s2">&quot;http://192.168.10.21&quot;</span>

<span class="p">[</span><span class="n">host</span><span class="p">.</span><span class="s2">&quot;http://192.168.10.21&quot;</span><span class="p">]</span>
  <span class="n">capabilities</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&quot;pull&quot;</span><span class="p">,</span> <span class="s2">&quot;resolve&quot;</span><span class="p">,</span> <span class="s2">&quot;push&quot;</span><span class="p">]</span>
  <span class="n">skip_verify</span> <span class="p">=</span> <span class="n">true</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">21</span><span class="p">]</span><span class="c"># systemctl restart containerd</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">将私有仓库连接配置文件同步到k8s其他节点</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">certs</span><span class="p">.</span><span class="n">d</span><span class="p">]</span><span class="c"># cd /etc/containerd/certs.d/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">certs</span><span class="p">.</span><span class="n">d</span><span class="p">]</span><span class="c"># scp -r 192.168.10.21/  k8s-worker01:/etc/containerd/certs.d/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">certs</span><span class="p">.</span><span class="n">d</span><span class="p">]</span><span class="c"># scp -r 192.168.10.21/  k8s-worker02:/etc/containerd/certs.d/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">certs</span><span class="p">.</span><span class="n">d</span><span class="p">]</span><span class="c"># cd /etc/containerd/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">containerd</span><span class="p">]</span><span class="c"># scp -r config.toml  k8s-worker01:/etc/containerd/config.toml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-master01</span> <span class="n">containerd</span><span class="p">]</span><span class="c"># scp -r config.toml  k8s-worker02:/etc/containerd/config.toml</span>

<span class="n">k8s其他节点重启containerd</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-worker01</span> <span class="p">~]</span><span class="c"># systemctl restart containerdcd </span>
<span class="p">[</span><span class="n">root</span><span class="nv">@k8s</span><span class="n">-worker02</span> <span class="p">~]</span><span class="c"># systemctl restart containerd</span>
</code></pre></div>
<h4 id="3413_gitlab">3.4.1.3 gitlab<a class="headerlink" href="#3413_gitlab" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># vim /etc/docker/daemon.json</span>
<span class="p">{</span>
        <span class="s2">&quot;insecure-registries&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://192.168.10.21&quot;</span><span class="p">],</span>
         <span class="s2">&quot;registry-mirrors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;https://a237mf1e.mirror.aliyuncs.com&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@harbor</span> <span class="p">~]</span><span class="c"># systemctl restart docker</span>
</code></pre></div>
<h3 id="342_kustomize">3.4.2 Kustomize安装<a class="headerlink" href="#342_kustomize" title="Permanent link">&para;</a></h3>
<blockquote>
<p>安装参考链接：<a href="https://kubectl.docs.kubernetes.io/installation/kustomize/">https://kubectl.docs.kubernetes.io/installation/kustomize/</a></p>
<p>使用参考链接：<a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/">https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/</a></p>
</blockquote>
<p>当开发者push代码以后，gitlab-runner会在gitlab-ce服务器执行流水线里定义的具体操作，流水线步骤里定义了gitlab-runner通过kustomize客户端工具修改应用部署资源清单文件里的容器镜像版本，并重新push代码到代码仓库，所以需要在gitlab-ce服务器安装kustomize</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># curl -s &quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot;  | bash</span>
<span class="p">{</span><span class="n">Version</span><span class="p">:</span><span class="n">kustomize</span><span class="p">/</span><span class="n">v4</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">7</span> <span class="n">GitCommit</span><span class="p">:</span><span class="n">56d82a8378dfc8dc3b3b1085e5a6e67b82966bd7</span> <span class="n">BuildDate</span><span class="p">:</span><span class="n">2022</span><span class="p">-</span><span class="n">08</span><span class="p">-</span><span class="n">02T16</span><span class="p">:</span><span class="n">35</span><span class="p">:</span><span class="n">54Z</span> <span class="n">GoOs</span><span class="p">:</span><span class="n">linux</span> <span class="n">GoArch</span><span class="p">:</span><span class="n">amd64</span><span class="p">}</span>
<span class="n">kustomize</span> <span class="n">installed</span> <span class="n">to</span> <span class="p">//</span><span class="n">root</span><span class="p">/</span><span class="n">kustomize</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># mv /root/kustomize /usr/bin/</span>
</code></pre></div>
<h3 id="343_runner">3.4.3 runner安装<a class="headerlink" href="#343_runner" title="Permanent link">&para;</a></h3>
<h4 id="3431_runner">3.4.3.1 runner介绍<a class="headerlink" href="#3431_runner" title="Permanent link">&para;</a></h4>
<p>GitLab Runner是一个开源项目，用于运行您的作业并将结果发送回GitLab。它与GitLab CI一起使用，GitLab CI是GitLab随附的开源持续集成服务，用于协调作业。相当于流水线工人。</p>
<h4 id="3432_runner">3.4.3.2 runner安装<a class="headerlink" href="#3432_runner" title="Permanent link">&para;</a></h4>
<p><img alt="安装runner-01" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-01.png" /></p>
<p><img alt="安装runner-02" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-02.png" /></p>
<p><img alt="安装runner-03" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-03.png" /></p>
<p><img alt="安装runner-04" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-04.png" /></p>
<p><img alt="安装runner-05" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-05.png" /></p>
<p><img alt="安装runner-06" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-06.png" /></p>
<p><img alt="安装runner-07" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-07.png" /></p>
<p><img alt="安装runner-08" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-08.png" /></p>
<p><img alt="安装runner-09" src="../../../img/kubernetes/kubernetes_gitops/%E5%AE%89%E8%A3%85runner-09.png" /></p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># chmod +x /usr/local/bin/gitlab-runner</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># useradd --comment &#39;GitLab Runner&#39; --create-home gitlab-runner --shell /bin/bash #添加gitlab-runner用户</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner #配置runner工作目录</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># gitlab-runner start</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># gitlab-runner register #添加runner实例</span>
<span class="n">Runtime</span> <span class="n">platform</span>                                    <span class="n">arch</span><span class="p">=</span><span class="n">amd64</span> <span class="n">os</span><span class="p">=</span><span class="n">linux</span> <span class="n">pid</span><span class="p">=</span><span class="n">25519</span> <span class="n">revision</span><span class="p">=</span><span class="n">bbcb5aba</span> <span class="n">version</span><span class="p">=</span><span class="n">15</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">0</span>
<span class="n">Running</span> <span class="k">in</span> <span class="n">system-mode</span><span class="p">.</span>                            

<span class="n">Enter</span> <span class="n">the</span> <span class="n">GitLab</span> <span class="n">instance</span> <span class="n">URL</span> <span class="p">(</span><span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">https</span><span class="p">://</span><span class="n">gitlab</span><span class="p">.</span><span class="n">com</span><span class="p">/):</span>
<span class="n">http</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">11</span><span class="p">/</span>  <span class="c">#gitlab地址</span>
<span class="n">Enter</span> <span class="n">the</span> <span class="n">registration</span> <span class="n">token</span><span class="p">:</span>
<span class="n">GR1348941CGPH49ziznkXMcX6sumR</span> <span class="c">#runner配置页面复制的仓库token</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">description</span> <span class="k">for</span> <span class="n">the</span> <span class="n">runner</span><span class="p">:</span>
<span class="no">[gitlab]</span><span class="p">:</span> <span class="n">apidemo</span> <span class="c">#runner实例描述，这里设置为apidemo，意为这个runner为apidemo项目的runner</span>
<span class="n">Enter</span> <span class="n">tags</span> <span class="k">for</span> <span class="n">the</span> <span class="n">runner</span> <span class="p">(</span><span class="n">comma-separated</span><span class="p">):</span>

<span class="n">Enter</span> <span class="n">optional</span> <span class="n">maintenance</span> <span class="n">note</span> <span class="k">for</span> <span class="n">the</span> <span class="n">runner</span><span class="p">:</span>

<span class="n">Registering</span> <span class="n">runner</span><span class="p">...</span> <span class="n">succeeded</span>                     <span class="n">runner</span><span class="p">=</span><span class="n">GR1348941CGPH49zi</span>
<span class="n">Enter</span> <span class="n">an</span> <span class="n">executor</span><span class="p">:</span> <span class="n">virtualbox</span><span class="p">,</span> <span class="n">docker-ssh</span><span class="p">+</span><span class="n">machine</span><span class="p">,</span> <span class="n">custom</span><span class="p">,</span> <span class="n">docker</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span> <span class="n">docker</span><span class="p">+</span><span class="n">machine</span><span class="p">,</span> <span class="n">kubernetes</span><span class="p">,</span> <span class="n">docker-ssh</span><span class="p">,</span> <span class="n">parallels</span><span class="p">,</span> <span class="n">ssh</span><span class="p">:</span>
<span class="n">shell</span>
<span class="n">Runner</span> <span class="n">registered</span> <span class="n">successfully</span><span class="p">.</span> <span class="n">Feel</span> <span class="n">free</span> <span class="n">to</span> <span class="nb">start </span><span class="n">it</span><span class="p">,</span> <span class="n">but</span> <span class="k">if</span> <span class="n">it</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">running</span> <span class="n">already</span> <span class="n">the</span> <span class="n">config</span> <span class="n">should</span> <span class="n">be</span> <span class="n">automatically</span> <span class="n">reloaded</span><span class="p">!</span>

<span class="n">Configuration</span> <span class="p">(</span><span class="n">with</span> <span class="n">the</span> <span class="n">authentication</span> <span class="n">token</span><span class="p">)</span> <span class="n">was</span> <span class="n">saved</span> <span class="k">in</span> <span class="s2">&quot;/etc/gitlab-runner/config.toml&quot;</span>
<span class="n">启动runner</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># gitlab-runner run &amp;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">配置gitlab-runner用户能使用docker</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># usermod -G docker gitlab-runner</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="p">~]</span><span class="c"># grep docker /etc/group</span>
<span class="n">docker</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="n">989</span><span class="p">:</span><span class="n">gitlab-runner</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">为runner配置构建目录</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="n">gitlab-runner</span><span class="p">]</span><span class="c"># cd /etc/gitlab-runner/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@gitlab</span> <span class="n">gitlab-runner</span><span class="p">]</span><span class="c"># vim config.toml </span>
<span class="n">concurrent</span> <span class="p">=</span> <span class="n">1</span>
<span class="n">check_interval</span> <span class="p">=</span> <span class="n">0</span>

<span class="no">[session_server]</span>
  <span class="n">session_timeout</span> <span class="p">=</span> <span class="n">1800</span>

<span class="no">[[runners]]</span>
  <span class="n">name</span> <span class="p">=</span> <span class="s2">&quot;apidemo&quot;</span>
  <span class="n">url</span> <span class="p">=</span> <span class="s2">&quot;http://192.168.10.11/&quot;</span>
  <span class="n">id</span> <span class="p">=</span> <span class="n">2</span>
  <span class="n">token</span> <span class="p">=</span> <span class="s2">&quot;DGzeaCQPGvQHjbH5kUt2&quot;</span>
  <span class="n">token_obtained_at</span> <span class="p">=</span> <span class="n">2022</span><span class="p">-</span><span class="n">09</span><span class="p">-</span><span class="n">04T11</span><span class="p">:</span><span class="n">46</span><span class="p">:</span><span class="n">00Z</span>
  <span class="n">token_expires_at</span> <span class="p">=</span> <span class="n">0001</span><span class="p">-</span><span class="n">01</span><span class="p">-</span><span class="n">01T00</span><span class="p">:</span><span class="n">00</span><span class="p">:</span><span class="n">00Z</span>
  <span class="n">executor</span> <span class="p">=</span> <span class="s2">&quot;shell&quot;</span>
  <span class="no">[runners.custom_build_dir]</span>
    <span class="n">enabled</span> <span class="p">=</span> <span class="n">true</span>
  <span class="no">[runners.cache]</span>
    <span class="no">[runners.cache.s3]</span>
    <span class="no">[runners.cache.gcs]</span>
    <span class="no">[runners.cache.azure]</span>

<span class="n">输出如下内容表示配置生效</span>
<span class="n">Configuration</span> <span class="n">loaded</span>                                <span class="n">builds</span><span class="p">=</span><span class="n">0</span>
</code></pre></div>
<h4 id="3433_runner">3.4.3.3 为项目配置runner<a class="headerlink" href="#3433_runner" title="Permanent link">&para;</a></h4>
<p><img alt="image-20220907132058971" src="../../../img/kubernetes/kubernetes_gitops/image-20220907132058971.png" /></p>
<p><img alt="runner配置01" src="../../../img/kubernetes/kubernetes_gitops/runner%E9%85%8D%E7%BD%AE01.png" /></p>
<p><img alt="runner配置02" src="../../../img/kubernetes/kubernetes_gitops/runner%E9%85%8D%E7%BD%AE02.png" /></p>
<h2 id="35">3.5 项目代码发布<a class="headerlink" href="#35" title="Permanent link">&para;</a></h2>
<blockquote>
<p>本次项目代码发布使用自己pc作为开发者环境</p>
</blockquote>
<h3 id="351">3.5.1 获取项目源码<a class="headerlink" href="#351" title="Permanent link">&para;</a></h3>
<p>项目源代码在“资源”目录下apidemo</p>
<h3 id="352_go">3.5.2 go环境安装<a class="headerlink" href="#352_go" title="Permanent link">&para;</a></h3>
<blockquote>
<p>安装git工具,这个是重点</p>
</blockquote>
<p>进入“资源”目录下，双击”go1.17.11.windows-386“安装程序，安装go</p>
<p>go安装完成后，配置环境变量</p>
<p><img alt="image-20220907134513508" src="../../../img/kubernetes/kubernetes_gitops/image-20220907134513508.png" /></p>
<p><img alt="配置go环境变量-01" src="../../../img/kubernetes/kubernetes_gitops/%E9%85%8D%E7%BD%AEgo%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-01.png" /></p>
<p><img alt="配置go环境变量-02" src="../../../img/kubernetes/kubernetes_gitops/%E9%85%8D%E7%BD%AEgo%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-02.png" /></p>
<p><img alt="配置go环境变量-03" src="../../../img/kubernetes/kubernetes_gitops/%E9%85%8D%E7%BD%AEgo%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-03.png" /></p>
<h3 id="353_goidegoland">3.5.3 安装goIDE(goland)<a class="headerlink" href="#353_goidegoland" title="Permanent link">&para;</a></h3>
<p>进入“资源”目录下，双击”goland“安装程序，安装goland</p>
<h3 id="354_ide">3.5.4 IDE中打开项目<a class="headerlink" href="#354_ide" title="Permanent link">&para;</a></h3>
<h4 id="3541_goland">3.5.4.1 打开goland，选择项目<a class="headerlink" href="#3541_goland" title="Permanent link">&para;</a></h4>
<p><img alt="打开go项目-01" src="../../../img/kubernetes/kubernetes_gitops/%E6%89%93%E5%BC%80go%E9%A1%B9%E7%9B%AE-01.png" /></p>
<p><img alt="打开go项目-02" src="../../../img/kubernetes/kubernetes_gitops/%E6%89%93%E5%BC%80go%E9%A1%B9%E7%9B%AE-02.png" /></p>
<h4 id="3542">3.5.4.2 项目结构<a class="headerlink" href="#3542" title="Permanent link">&para;</a></h4>
<p><img alt="项目结构" src="../../../img/kubernetes/kubernetes_gitops/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png" /></p>
<h3 id="355_dockerfile">3.5.5 编写Dockerfile文件<a class="headerlink" href="#355_dockerfile" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">centos:centos7</span><span class="w"> </span><span class="c">#基础镜像</span>

<span class="k">ADD</span><span class="w"> </span>./apidemo<span class="w"> </span>/root<span class="w"> </span>#将编译后的可执行文件添加至/root目录下

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">10088  #镜像实例为容器时，容器暴露的端口</span>

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/root/apidemo&quot;</span><span class="p">]</span><span class="w"> </span>#镜像实例为容器时，容器执行的命令
</code></pre></div>
<h3 id="356">3.5.6 编写应用部署资源清单文件<a class="headerlink" href="#356" title="Permanent link">&para;</a></h3>
<h4 id="3561_deployment">3.5.6.1 编写项目Deployment资源清单文件<a class="headerlink" href="#3561_deployment" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"> </span><span class="c1">#k8s资源版本</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"> </span><span class="c1">#k8s资源类型</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span><span class="w"> </span><span class="c1">#资源所在命名空间</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span><span class="w"> </span><span class="c1">#资源名称</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1">#资源副本数</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.10.21/apidemo/apidemo:v3.0</span><span class="w"> </span><span class="c1">#容器镜像，会通过kustomize进行修改，版本信息会随项目提交而发生变化</span>
<span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10088</span><span class="w"> </span><span class="c1">#容器端口</span>
</code></pre></div>
<h4 id="3562_svc">3.5.6.2 编写项目Svc资源清单文件<a class="headerlink" href="#3562_svc" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"> </span><span class="c1">#k8s资源版本</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"> </span><span class="c1">#k8s资源类型</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span><span class="w"> </span><span class="c1">#资源所在命名空间</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span><span class="w"> </span><span class="c1">#资源名称</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span><span class="w"> </span><span class="c1">#svc类型</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemoport</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10088</span><span class="w"> </span><span class="c1">#svc集群内访问端口</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10088</span><span class="w"> </span><span class="c1">#容器端口</span>
<span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30080</span><span class="w"> </span><span class="c1">#nodePort暴露端口</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
</code></pre></div>
<h4 id="3563_ingress">3.5.6.3 编写ingress资源清单文件<a class="headerlink" href="#3563_ingress" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span><span class="w"> </span><span class="c1">#k8s资源版本</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span><span class="w"> </span><span class="c1">#k8s资源类型</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-apidemo</span><span class="w">                    </span><span class="c1">#自定义ingress名称</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ingressclass.kubernetes.io/is-default-class</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo.alan.com</span><span class="w">                   </span><span class="c1"># 自定义域名</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span><span class="w">     </span><span class="c1"># 对应上面创建的service名称</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10088</span><span class="w">  </span><span class="c1"># 对应上面创建的service端口</span>
</code></pre></div>
<h4 id="3564_kustomizationyaml">3.5.6.4 编写kustomization.yaml文件，管理资源清单文件<a class="headerlink" href="#3564_kustomizationyaml" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c1">#依赖的资源清单文件</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo-deployment.yaml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo-service.yaml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo-ingress.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span><span class="w"> </span><span class="c1">#k8s资源版本</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span><span class="w">  </span><span class="c1">#k8s资源类型</span>
</code></pre></div>
<h3 id="357_gitlabcigitlab-ciyml">3.5.7 编写gitlabCi流水线文件(.gitlab-ci.yml)<a class="headerlink" href="#357_gitlabcigitlab-ciyml" title="Permanent link">&para;</a></h3>
<p>注意：此文件必须放在项目根目录下</p>
<div class="highlight"><pre><span></span><code><span class="nt">workflow</span><span class="p">:</span><span class="w">  </span><span class="c1">#设置工作流</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_BRANCH == &#39;master&#39;</span><span class="w">  </span><span class="c1">#如果代码分支为master则使用以下环境变量</span>
<span class="w">      </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">        </span><span class="nt">registry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$ci_registry</span><span class="w">  </span><span class="c1">#镜像仓库地址，gitlab配置全局变量</span>
<span class="w">        </span><span class="nt">registry_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$ci_registry_name</span><span class="w"> </span><span class="c1">#镜像仓库登录用户，gitlab配置全局变量</span>
<span class="w">        </span><span class="nt">registry_passwd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$ci_registry_passwd</span><span class="w"> </span><span class="c1">#镜像仓库登录密码，gitlab配置全局变量</span>

<span class="nt">variables</span><span class="p">:</span><span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="nt">app_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PROJECT_NAME</span><span class="w"> </span><span class="c1">#项目名，gitlab项目仓库名，gitlab内置变量</span>
<span class="w">  </span><span class="nt">app_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_SHORT_SHA</span><span class="w"> </span><span class="c1">#app版本号，每次push项目的编号，后面会作为镜像版本，gitlab内置变量</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CI_PROJECT_NAMESPACE</span><span class="w"> </span><span class="c1">#项目所在组，gitlab内置变量</span>
<span class="w">  </span><span class="nt">GIT_CLONE_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;$CI_BUILDS_DIR/$CI_JOB_ID/$CI_PROJECT_NAME&#39;</span><span class="w"> </span><span class="c1">#定义gitlab-runner,clone代码的位置</span>

<span class="nt">stages</span><span class="p">:</span><span class="w"> </span><span class="c1">#定义流水线有几个阶段</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span><span class="w"> </span><span class="c1">#编译阶段</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="w"> </span><span class="c1">#部署阶段</span>

<span class="nt">build code</span><span class="p">:</span><span class="w"> </span><span class="c1">#自定义的步骤名称</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span><span class="w"> </span><span class="c1">#此步骤为build阶段</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">go build</span><span class="w"> </span><span class="c1">#具体执行的命令，此处为编译go项目，编译完成会产生apidemo可执行文件</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"> </span><span class="c1">#gitlab流水线文件内置关键字，作用为保留制品</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="c1">#保留制品所在位置</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apidemo</span><span class="w"> </span><span class="c1">#当前步骤需要保留的制品文件，提供个下一步骤使用</span>

<span class="nt">docker build</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t $app_name:$app_version .</span><span class="w">  </span><span class="c1">#此步骤通过项目源码内的Dockerfile文件编译docker镜像</span>
<span class="w">  </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="c1">#gitlab流水线文件内置关键字，作用为此步骤所依赖的步骤，只有当被依赖的步骤完成后，此步骤才会执行</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build code</span><span class="w"> </span><span class="c1">#此步骤被依赖的步骤</span>

<span class="nt">docker tag</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker tag $app_name:$app_version $registry/$app_name/$app_name:$app_version</span><span class="w"> </span><span class="c1">#此步骤为上一步骤生成的镜像打上仓库标签</span>
<span class="w">  </span><span class="nt">needs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker build</span>

<span class="nt">docker push</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker login -u $ci_registry_name -p $ci_registry_passwd $ci_registry</span><span class="w"> </span><span class="c1">#登录镜像仓库</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker push $registry/$app_name/$app_name:$app_version</span><span class="w"> </span><span class="c1">#推送镜像至镜像仓库</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker logout</span><span class="w"> </span><span class="c1">#登出镜像仓库</span>
<span class="w">  </span><span class="nt">needs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker tag</span>

<span class="nt">deploy dev</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span><span class="w"> </span><span class="c1">#gitlab流水线内置关键字，作用为在该步骤执行流水线操作前所依赖步骤。这里需要runner通过修改kustomization.yaml文件，来修改镜像版本信息</span>
<span class="w">  </span><span class="c1">#所以需要在修改镜像版本信息后，重新push代码</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git remote set-url origin http://${CI_USERNAME}:${CI_PASSWORD}@192.168.10.11/apidemo/apidemo.git</span><span class="w"> </span><span class="c1">#设置远程仓库地址，CI_USERNAME为代码仓库登录用户名，需要在gitlab自定义全局变量，CI_PASSWORD为代码仓库登录密码，需要在gitlab自定义全局变量</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git config --global user.name &quot;Administrator&quot;</span><span class="w"> </span><span class="c1">#配置本地仓库用户名信息</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git config --global user.email &quot;admin@example.com&quot;</span><span class="w"> </span><span class="c1">#配置本地仓库邮箱信息</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git checkout -B master</span><span class="w"> </span><span class="c1">#切换项目分支</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cd base</span><span class="w"> </span><span class="c1">#进入资源清单文件目录</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize edit set image 192.168.10.21/apidemo/apidemo:v3.0=$registry/$app_name/$app_name:$app_version</span><span class="w"> </span><span class="c1">#runner通过kustomize客户端工具修改镜像版本信息</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat kustomization.yaml</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git commit -am &#39;[skip ci] DEV image update&#39;</span><span class="w">  </span><span class="c1">#git 本地提交，注意“skip ci”为gitlab流水线文件内置关键字，作用为跳过ci流水线操作，未设置可能导致流水线进入死循环</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git push origin master</span><span class="w"> </span><span class="c1">#重新提交修改镜像版本后的代码</span>
<span class="w">  </span><span class="nt">needs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker push</span>
</code></pre></div>
<h3 id="358_gitlab">3.5.8 gitlab全局变量配置<img alt="gitlab配置环境变量-01" src="../../../img/kubernetes/kubernetes_gitops/gitlab%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-01.png" /><a class="headerlink" href="#358_gitlab" title="Permanent link">&para;</a></h3>
<p><img alt="gitlab配置环境变量-02" src="../../../img/kubernetes/kubernetes_gitops/gitlab%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-02.png" /></p>
<p><img alt="gitlab配置环境变量-03" src="../../../img/kubernetes/kubernetes_gitops/gitlab%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-03.png" /></p>
<p><img alt="gitlab配置环境变量-04" src="../../../img/kubernetes/kubernetes_gitops/gitlab%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-04.png" /></p>
<p><img alt="gitlab配置环境变量-05" src="../../../img/kubernetes/kubernetes_gitops/gitlab%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-05.png" /></p>
<p><img alt="gitlab配置环境变量-06" src="../../../img/kubernetes/kubernetes_gitops/gitlab%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-06.png" /></p>
<p><img alt="gitlab配置环境变量-07" src="../../../img/kubernetes/kubernetes_gitops/gitlab%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-07.png" /></p>
<h3 id="359">3.5.9 开发者环境添加远程地址仓库<a class="headerlink" href="#359" title="Permanent link">&para;</a></h3>
<p><img alt="本地添加远程仓库" src="../../../img/kubernetes/kubernetes_gitops/%E6%9C%AC%E5%9C%B0%E6%B7%BB%E5%8A%A0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93.png" /></p>
<p><img alt="本地添加远程仓库-02" src="../../../img/kubernetes/kubernetes_gitops/%E6%9C%AC%E5%9C%B0%E6%B7%BB%E5%8A%A0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93-02.png" /></p>
<h3 id="3510_argocd">3.5.10 在ArgoCd中创建项目<a class="headerlink" href="#3510_argocd" title="Permanent link">&para;</a></h3>
<p><img alt="argo添加项目-01" src="../../../img/kubernetes/kubernetes_gitops/argo%E6%B7%BB%E5%8A%A0%E9%A1%B9%E7%9B%AE-01.png" /></p>
<p><img alt="argo添加项目-02" src="../../../img/kubernetes/kubernetes_gitops/argo%E6%B7%BB%E5%8A%A0%E9%A1%B9%E7%9B%AE-02.png" /></p>
<p><img alt="argo添加代码仓库-01" src="../../../img/kubernetes/kubernetes_gitops/argo%E6%B7%BB%E5%8A%A0%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93-01.png" /></p>
<p><img alt="argo添加代码仓库-02" src="../../../img/kubernetes/kubernetes_gitops/argo%E6%B7%BB%E5%8A%A0%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93-02.png" /></p>
<h3 id="3511_argocd">3.5.11 ArgoCd中项目配置<a class="headerlink" href="#3511_argocd" title="Permanent link">&para;</a></h3>
<p><img alt="argo项目配置01" src="../../../img/kubernetes/kubernetes_gitops/argo%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE01.png" /></p>
<p><img alt="argo项目配置02" src="../../../img/kubernetes/kubernetes_gitops/argo%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE02.png" /></p>
<p><img alt="argo项目配置03" src="../../../img/kubernetes/kubernetes_gitops/argo%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE03.png" /></p>
<p><img alt="argo项目配置04" src="../../../img/kubernetes/kubernetes_gitops/argo%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE04.png" /></p>
<h3 id="3512_argocd">3.5.12 ArgoCd中应用配置<a class="headerlink" href="#3512_argocd" title="Permanent link">&para;</a></h3>
<p><img alt="image-20220907224523395" src="../../../img/kubernetes/kubernetes_gitops/image-20220907224523395.png" /></p>
<p><img alt="image-20220907224746513" src="../../../img/kubernetes/kubernetes_gitops/image-20220907224746513.png" /></p>
<p><img alt="image-20220907224925515" src="../../../img/kubernetes/kubernetes_gitops/image-20220907224925515.png" /></p>
<p><img alt="image-20220907224948483" src="../../../img/kubernetes/kubernetes_gitops/image-20220907224948483.png" /></p>
<p><img alt="image-20220907225007964" src="../../../img/kubernetes/kubernetes_gitops/image-20220907225007964.png" /></p>
<h3 id="3513">3.5.13 本地提交代码<a class="headerlink" href="#3513" title="Permanent link">&para;</a></h3>
<p><img alt="本地提交代码" src="../../../img/kubernetes/kubernetes_gitops/%E6%9C%AC%E5%9C%B0%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81.png" /></p>
<h3 id="3514_pipeline">3.5.14 查看pipeline执行情况<a class="headerlink" href="#3514_pipeline" title="Permanent link">&para;</a></h3>
<p><img alt="查看ci" src="../../../img/kubernetes/kubernetes_gitops/%E6%9F%A5%E7%9C%8Bci.png" /></p>
<h3 id="3515_argocd">3.5.15 查看ArgoCd执行情况<a class="headerlink" href="#3515_argocd" title="Permanent link">&para;</a></h3>
<p><img alt="查看cd" src="../../../img/kubernetes/kubernetes_gitops/%E6%9F%A5%E7%9C%8Bcd.png" /></p>
<h3 id="3516">3.5.16 查看应用部署情况<a class="headerlink" href="#3516" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl get all -n apidemo</span>
NAME<span class="w">                           </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
pod/apidemo-75f68d8584-6ttqz<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>55s
pod/apidemo-75f68d8584-bznbr<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>53s
pod/apidemo-75f68d8584-fbjtw<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>50s
pod/apidemo-75f68d8584-vvv9m<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>55s

NAME<span class="w">              </span>TYPE<span class="w">       </span>CLUSTER-IP<span class="w">    </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">           </span>AGE
service/apidemo<span class="w">   </span>NodePort<span class="w">   </span><span class="m">10</span>.96.1.218<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">10088</span>:30080/TCP<span class="w">   </span>12m

NAME<span class="w">                      </span>READY<span class="w">   </span>UP-TO-DATE<span class="w">   </span>AVAILABLE<span class="w">   </span>AGE
deployment.apps/apidemo<span class="w">   </span><span class="m">4</span>/4<span class="w">     </span><span class="m">4</span><span class="w">            </span><span class="m">4</span><span class="w">           </span>12m

NAME<span class="w">                                 </span>DESIRED<span class="w">   </span>CURRENT<span class="w">   </span>READY<span class="w">   </span>AGE
replicaset.apps/apidemo-596865b76<span class="w">    </span><span class="m">0</span><span class="w">         </span><span class="m">0</span><span class="w">         </span><span class="m">0</span><span class="w">       </span>6m22s
replicaset.apps/apidemo-75f68d8584<span class="w">   </span><span class="m">4</span><span class="w">         </span><span class="m">4</span><span class="w">         </span><span class="m">4</span><span class="w">       </span>55s
replicaset.apps/apidemo-776c87dfb8<span class="w">   </span><span class="m">0</span><span class="w">         </span><span class="m">0</span><span class="w">         </span><span class="m">0</span><span class="w">       </span>4m11s
replicaset.apps/apidemo-f5dd44695<span class="w">    </span><span class="m">0</span><span class="w">         </span><span class="m">0</span><span class="w">         </span><span class="m">0</span><span class="w">       </span>12m
访问应用
<span class="o">[</span>root@k8s-master01<span class="w"> </span>~<span class="o">]</span><span class="c1"># curl http://apidemo.alan.com/info</span>
<span class="o">{</span><span class="s2">&quot;version&quot;</span>:<span class="s2">&quot;1.1.1&quot;</span><span class="o">}</span>
</code></pre></div>
<h2 id="36_argo_cd">3.6 Argo CD项目回滚<a class="headerlink" href="#36_argo_cd" title="Permanent link">&para;</a></h2>
<p><img alt="image-20220907230140527" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230140527.png" /></p>
<p><img alt="image-20220907230348772" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230348772.png" /></p>
<p><img alt="image-20220907230413912" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230413912.png" /></p>
<p><img alt="image-20220907230610324" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230610324.png" /></p>
<p><img alt="image-20220907230632019" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230632019.png" /></p>
<p><img alt="image-20220907230654857" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230654857.png" /></p>
<p><img alt="image-20220907230703654" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230703654.png" /></p>
<p><img alt="image-20220907230715094" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230715094.png" /></p>
<p><img alt="image-20220907230729871" src="../../../img/kubernetes/kubernetes_gitops/image-20220907230729871.png" /></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      BurningMyself<a href='https://beian.miit.gov.cn/' target='_blank'>  蜀ICP备15033200号-1</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/burningmyself" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://gitee.com/burningmyself" target="_blank" rel="noopener" title="gitee.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
        <script src="../../../js/baidu-tongji.js"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155084439-1"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155132293-1"></script>
      
        <script src="../../../js/google.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>