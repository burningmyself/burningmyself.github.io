
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=".net,java,php,python,docker,web">
      
      
        <meta name="author" content="BurningMyself">
      
      
        <link rel="canonical" href="https://burningmyself.gitee.io/cloud/kubernetes/kubernetes_devops/">
      
      
        <link rel="prev" href="../kubernetes_ack/">
      
      
        <link rel="next" href="../kubernetes_kubesphere_devops/">
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.15">
    
    
      
        <title>基于kubernetes集群构建大中型企业CICD应用平台 - BurningMyself</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#devops" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="BurningMyself" class="md-header__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BurningMyself
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              基于kubernetes集群构建大中型企业CICD应用平台
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="BurningMyself" class="md-nav__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BurningMyself
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        介绍
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          技术博文
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          技术博文
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          .NET
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          .NET
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sharp/" class="md-nav__link">
        C#新特性语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_docker/" class="md-nav__link">
        .Net Core Docker 部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sqlserver_nginx/" class="md-nav__link">
        Docker 容器化部署 ASP.NET Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_safety/" class="md-nav__link">
        让你的ASP.NET Core应用程序更安全
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_study_route/" class="md-nav__link">
        ASP.NET Core开发者指南
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/feature/" class="md-nav__link">
        Java特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/load-class/" class="md-nav__link">
        Java类加载
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/orm/" class="md-nav__link">
        Orm的优缺点
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/bio-nio/" class="md-nav__link">
        BIO与NIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/rocketmq/rmq-1/" class="md-nav__link">
        RocketMq下载与安装
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springAnnotation/" class="md-nav__link">
        Spring常用注解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/javavm/" class="md-nav__link">
        Java 虚拟机
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springdesign/" class="md-nav__link">
        Spring 常用设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/spring-cloud/" class="md-nav__link">
        Spring Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-simple/" class="md-nav__link">
        Java simple
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-validator/" class="md-nav__link">
        Java Validator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-string/" class="md-nav__link">
        Java String
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-utils/" class="md-nav__link">
        Java Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/feature/" class="md-nav__link">
        Python特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/str_joint/" class="md-nav__link">
        Python字符拼接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/syntax_rule/" class="md-nav__link">
        Python语法技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/fabric/" class="md-nav__link">
        远程部署神器 Fabric
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          Go
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Go
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../go/go_base/" class="md-nav__link">
        Go基础语法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
          PHP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          PHP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/kj/" class="md-nav__link">
        框架
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
          Web
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/es6/" class="md-nav__link">
        es6语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/ali_js_style/" class="md-nav__link">
        阿里js样式规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/node.js/" class="md-nav__link">
        node.js文档
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react/" class="md-nav__link">
        React 开发者指南
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../dart/syntax/" class="md-nav__link">
        Dart语法学习
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react_interview/" class="md-nav__link">
        React 面试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/js_tool_method/" class="md-nav__link">
        js 工具函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/vue_cp_react/" class="md-nav__link">
        vue与react比较
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/javascript/" class="md-nav__link">
        JavaScript 基础
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
      
      
      
        <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
          SQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh17/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_log/" class="md-nav__link">
        MySQL日志
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_index/" class="md-nav__link">
        MySQL索引
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_pxc/" class="md-nav__link">
        MySQL PXC集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_use/" class="md-nav__link">
        MySQL 数据库应用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_backups/" class="md-nav__link">
        MySql 备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/sql_server_master/" class="md-nav__link">
        Sql Server 主从备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/data_split/" class="md-nav__link">
        数据库之互联网常用分库分表方案
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mybatis/" class="md-nav__link">
        Mybatis使用心德
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
      
      
      
        <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/linux/" class="md-nav__link">
        Linux学习笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/often/" class="md-nav__link">
        常用命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/ope/" class="md-nav__link">
        实用的Linux 命令
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
      
      
      
        <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker/" class="md-nav__link">
        Docker全科
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker_core/" class="md-nav__link">
        Docker 核心技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-compose/" class="md-nav__link">
        docker和docker-compose配置常用环境
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-jenkins/" class="md-nav__link">
        Docker部署Jenkins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-phabricator/" class="md-nav__link">
        Docker部署Phabricator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
      
      
      
        <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_fw_rule_and_object_design/" class="md-nav__link">
        Kubernetes架构原则和对象设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_etcd/" class="md-nav__link">
        Kubernetes控制平面组件etcd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_kube_APIServer/" class="md-nav__link">
        深入理解Kube-APIServer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_controller_manager/" class="md-nav__link">
        kubernetes控制平面组件
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
      
      
      
        <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
          Tool
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_11">
          <span class="md-nav__icon md-icon"></span>
          Tool
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitusual/" class="md-nav__link">
        Git动画展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitquestion/" class="md-nav__link">
        Git问题处理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitflow/" class="md-nav__link">
        GitFlow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitbook/" class="md-nav__link">
        GitBook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitcmr/" class="md-nav__link">
        Git提交日志规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/markdown/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cicd/" class="md-nav__link">
        CI/CD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/mkdocs/" class="md-nav__link">
        mkdocs简单使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitstudy/" class="md-nav__link">
        Git的黑魔法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/minio/" class="md-nav__link">
        MinIO 搭建使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cat-monitoring/" class="md-nav__link">
        Cat分布式监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          云架构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          云架构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../native/" class="md-nav__link">
        云原生
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual/" class="md-nav__link">
        虚拟化技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/" class="md-nav__link">
        云计算
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../apprelease/" class="md-nav__link">
        应用部署容器化演进
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../containerlinux/" class="md-nav__link">
        容器技术所涉及Linux内核关键技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_native/" class="md-nav__link">
        容器管理工具Docker生态架构及部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_nginx/" class="md-nav__link">
        使用容器运行Nginx应用及Docker命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image/" class="md-nav__link">
        Docker容器镜像
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image_fast/" class="md-nav__link">
        Docker容器镜像加速器及本地容器镜像仓库
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container_enterprice/" class="md-nav__link">
        Docker容器化部署企业级应用集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_file/" class="md-nav__link">
        Dockerfile精讲及新型容器镜像构建技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_network/" class="md-nav__link">
        Docker容器网络与通信原理深度解析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_date/" class="md-nav__link">
        Docker容器数据持久化存储机制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_compose/" class="md-nav__link">
        Docker容器服务编排利器Docker Compose应用实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_swarm/" class="md-nav__link">
        Docker主机集群化方案 Docker Swarm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_devops/" class="md-nav__link">
        基于Docker容器DevOps应用方案 企业业务代码发布系统
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container/" class="md-nav__link">
        轻量级或工业级容器管理工具
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        kubeadm极速部署Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_introduce/" class="md-nav__link">
        kubernetes介绍与集群架构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_way/" class="md-nav__link">
        Kubernetes集群部署方式说明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_master/" class="md-nav__link">
        kubeadm部署单Master节点kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight/" class="md-nav__link">
        kubeadm部署高可用kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rke/" class="md-nav__link">
        使用RKE构建企业生产级Kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin1/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Docker）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin2/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Containerd）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        Kubernetes集群UI及主机资源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_sealos/" class="md-nav__link">
        使用sealos部署kubernetes集群并实现集群管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster/" class="md-nav__link">
        kubernetes集群命令语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_core/" class="md-nav__link">
        Kubernetes核心概念
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_nginx_ingress_controller/" class="md-nav__link">
        Kubernetes集群 服务暴露 Nginx Ingress Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_traefik/" class="md-nav__link">
        Kubernetes集群 服务暴露 Traefik
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_configMap_secret/" class="md-nav__link">
        Kubernetes配置与密钥管理 ConfigMap&Secret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_harbor/" class="md-nav__link">
        Kubernetes集群使用容器镜像仓库Harbor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_safety/" class="md-nav__link">
        Kubernetes集群安全管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_volume/" class="md-nav__link">
        kubernetes持久化存储卷
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_ceph/" class="md-nav__link">
        kubernetes存储解决方案Ceph
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster_serve/" class="md-nav__link">
        Kubernetes集群公共服务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_java/" class="md-nav__link">
        kubernetes集群java项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_python/" class="md-nav__link">
        kubernetes集群Python项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_golang/" class="md-nav__link">
        Kubernetes集群golang项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_helm_prometheus/" class="md-nav__link">
        helm部署prometheus监控系统及应用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_logs_collect/" class="md-nav__link">
        kubernetes日志收集方案ELK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_zookeeper/" class="md-nav__link">
        企业级中间件上云部署zookeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kafka/" class="md-nav__link">
        kubernetes云原生中间件上云部署kafka
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rokectmq/" class="md-nav__link">
        rocketmq部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_helm/" class="md-nav__link">
        Kubernetes集群包管理解决方案 Helm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kustomize/" class="md-nav__link">
        Kubernetes原生配置管理利器 kustomize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_flannel/" class="md-nav__link">
        kubernetes集群网络解决方案 flannel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_calico/" class="md-nav__link">
        kubernetes集群网络解决方案 calico
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hybridnet/" class="md-nav__link">
        kubernetes集群 underlay 网络方案 hybridnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ipv4_and_ipv6/" class="md-nav__link">
        kubernetes版本双栈协议（IPv4&IPv6）集群部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rancher/" class="md-nav__link">
        Rancher容器云管理平台
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubeconfig/" class="md-nav__link">
        使用kubeconfig管理多集群方法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_karmada/" class="md-nav__link">
        karmada实现k8s集群联邦
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubesphere/" class="md-nav__link">
        安装kubesphere使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ack/" class="md-nav__link">
        阿里云容器服务ACK
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          基于kubernetes集群构建大中型企业CICD应用平台
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        基于kubernetes集群构建大中型企业CICD应用平台
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#devops_1" class="md-nav__link">
    一、DevOps介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" class="md-nav__link">
    二、Code阶段工具
  </a>
  
    <nav class="md-nav" aria-label="二、Code阶段工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_git" class="md-nav__link">
    2.1 Git安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_gitlab" class="md-nav__link">
    2.2 GitLab安装
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    三、Build阶段工具
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operate" class="md-nav__link">
    四、Operate阶段工具
  </a>
  
    <nav class="md-nav" aria-label="四、Operate阶段工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41_docker" class="md-nav__link">
    4.1 Docker安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42_docker-compose" class="md-nav__link">
    4.2 Docker-Compose安装
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrate" class="md-nav__link">
    五、Integrate工具
  </a>
  
    <nav class="md-nav" aria-label="五、Integrate工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_jenkins" class="md-nav__link">
    5.1 Jenkins介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_jenkins" class="md-nav__link">
    5.2 Jenkins安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53_jenkins" class="md-nav__link">
    5.3 Jenkins入门配置
  </a>
  
    <nav class="md-nav" aria-label="5.3 Jenkins入门配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531" class="md-nav__link">
    5.3.1 构建任务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#531_1" class="md-nav__link">
    5.3.1 配置源码拉取地址
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532_maven" class="md-nav__link">
    5.3.2 配置Maven构建代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533_publish" class="md-nav__link">
    5.3.3 配置Publish发布&amp;远程操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cicd" class="md-nav__link">
    六、CI、CD入门操作
  </a>
  
    <nav class="md-nav" aria-label="六、CI、CD入门操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1 持续集成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2 持续交付、部署
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sonar_qube" class="md-nav__link">
    七、集成Sonar Qube
  </a>
  
    <nav class="md-nav" aria-label="七、集成Sonar Qube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71_sonar_qube" class="md-nav__link">
    7.1 Sonar Qube介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72_sonar_qube" class="md-nav__link">
    7.2 Sonar Qube环境搭建
  </a>
  
    <nav class="md-nav" aria-label="7.2 Sonar Qube环境搭建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#721_sonar_qube" class="md-nav__link">
    7.2.1 Sonar Qube安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722" class="md-nav__link">
    7.2.2 安装中文插件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73_sonar_qube" class="md-nav__link">
    7.3 Sonar Qube基本使用
  </a>
  
    <nav class="md-nav" aria-label="7.3 Sonar Qube基本使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#731_maven" class="md-nav__link">
    7.3.1 Maven实现代码检测
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#732_sonar-scanner" class="md-nav__link">
    7.3.2 Sonar-scanner实现代码检测
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74_jenkinssonar_qube" class="md-nav__link">
    7.4 Jenkins集成Sonar Qube
  </a>
  
    <nav class="md-nav" aria-label="7.4 Jenkins集成Sonar Qube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#741_jenkins" class="md-nav__link">
    7.4.1 Jenkins安装插件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#742_jenkinssonar_qube" class="md-nav__link">
    7.4.2 Jenkins配置Sonar Qube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#743_sonar-scanner" class="md-nav__link">
    7.4.3 配置Sonar-scanner
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#744" class="md-nav__link">
    7.4.4 构建任务
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#harbor" class="md-nav__link">
    八、集成Harbor
  </a>
  
    <nav class="md-nav" aria-label="八、集成Harbor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81_harbor" class="md-nav__link">
    8.1 Harbor介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82_harbor" class="md-nav__link">
    8.2 Harbor安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83_harbor" class="md-nav__link">
    8.3 Harbor使用方式
  </a>
  
    <nav class="md-nav" aria-label="8.3 Harbor使用方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#831" class="md-nav__link">
    8.3.1 添加用户构建项目
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#832_harbor" class="md-nav__link">
    8.3.2 发布镜像到Harbor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#833_harborls" class="md-nav__link">
    8.3.3 从Harbor拉取镜像ls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#834_jenkinsdocker" class="md-nav__link">
    8.3.4 Jenkins容器使用宿主机Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#835" class="md-nav__link">
    8.3.5 添加构建操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#836" class="md-nav__link">
    8.3.6 编写部署脚本
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#837" class="md-nav__link">
    8.3.7 配置构建后操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins" class="md-nav__link">
    九、Jenkins流水线
  </a>
  
    <nav class="md-nav" aria-label="九、Jenkins流水线">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91_jenkins" class="md-nav__link">
    9.1 Jenkins流水线任务介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92_jenkins" class="md-nav__link">
    9.2 Jenkins流水线任务
  </a>
  
    <nav class="md-nav" aria-label="9.2 Jenkins流水线任务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#921_jenkins" class="md-nav__link">
    9.2.1 构建Jenkins流水线任务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#922_groovy" class="md-nav__link">
    9.2.2 Groovy脚本
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#923_jenkinsfile" class="md-nav__link">
    9.2.3 Jenkinsfile实现
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93_jenkins" class="md-nav__link">
    9.3 Jenkins流水线任务实现
  </a>
  
    <nav class="md-nav" aria-label="9.3 Jenkins流水线任务实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    9.3.1 参数化构建
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932_git" class="md-nav__link">
    9.3.2 拉取Git代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933" class="md-nav__link">
    9.3.3 构建代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#934" class="md-nav__link">
    9.3.4 代码质量检测
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#935" class="md-nav__link">
    9.3.5 制作自定义镜像并发布
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94_jenkins" class="md-nav__link">
    9.4 Jenkins流水线整合钉钉
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes" class="md-nav__link">
    十、Kubernetes编排工具
  </a>
  
    <nav class="md-nav" aria-label="十、Kubernetes编排工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101_kubernetes" class="md-nav__link">
    10.1 Kubernetes介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102_kubernetes" class="md-nav__link">
    10.2 Kubernetes架构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103_kubernetes" class="md-nav__link">
    10.3 Kubernetes安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#104_kubernetes" class="md-nav__link">
    10.4 Kubernetes操作
  </a>
  
    <nav class="md-nav" aria-label="10.4 Kubernetes操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1041_namespace" class="md-nav__link">
    10.4.1 Namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1042_pod" class="md-nav__link">
    10.4.2 Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1043_deployment" class="md-nav__link">
    10.4.3 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1044_service" class="md-nav__link">
    10.4.4 Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1045_ingress" class="md-nav__link">
    10.4.5 Ingress
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#105_jenkinskubernetes" class="md-nav__link">
    10.5 Jenkins集成Kubernetes
  </a>
  
    <nav class="md-nav" aria-label="10.5 Jenkins集成Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1051_yml" class="md-nav__link">
    10.5.1 准备部署的yml文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1052_harbor" class="md-nav__link">
    10.5.2 Harbor私服配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1053" class="md-nav__link">
    10.5.3 测试使用效果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1053_jenkins" class="md-nav__link">
    10.5.3 Jenkins远程调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#106_gitlabwebhooks" class="md-nav__link">
    10.6 基于GitLab的WebHooks
  </a>
  
    <nav class="md-nav" aria-label="10.6 基于GitLab的WebHooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1061_webhooks" class="md-nav__link">
    10.6.1 WebHooks通知
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1062" class="md-nav__link">
    10.6.2 修改配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1063" class="md-nav__link">
    10.6.3 滚动更新
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubesphere_devops/" class="md-nav__link">
        基于KubeSphere实现DevOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_gitops/" class="md-nav__link">
        云原生多云持续交付GitOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_velero/" class="md-nav__link">
        kubernetes集群备份与恢复管理利器Velero
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kurator/" class="md-nav__link">
        kubernetes集群舰队管理Kurator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_openfass/" class="md-nav__link">
        Serverless之OpenFaaS函数即服务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_flink/" class="md-nav__link">
        Flink基于Kubernetes部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hdfs/" class="md-nav__link">
        大数据HDFS分布式文件系统搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_spark/" class="md-nav__link">
        Spark与Kubernetes整合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          微服务
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          微服务
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/fbs-lock/" class="md-nav__link">
        分布式锁
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/design/" class="md-nav__link">
        微服务设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/distrimsg/" class="md-nav__link">
        分布式系统与消息的投递
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/ddd/" class="md-nav__link">
        基于DDD的微服务设计和开发实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/kafka/" class="md-nav__link">
        Kafka架构原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/redis_cluster/" class="md-nav__link">
        Redis Cluster原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/spring-cloud-micro/" class="md-nav__link">
        分布式架构
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          经验分析
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          经验分析
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/devops/" class="md-nav__link">
        DevOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/micro-service/" class="md-nav__link">
        Micro-Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/raft-gossip/" class="md-nav__link">
        Raft算法和Gossip协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cl/" class="md-nav__link">
        集群和负载均衡
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/ai/" class="md-nav__link">
        人工智能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/code-principle/" class="md-nav__link">
        代码原则
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/techbig/" class="md-nav__link">
        如何成为技术大牛
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/learnweetout/" class="md-nav__link">
        程序员如何技术成长
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/pt/" class="md-nav__link">
        产品与技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/four_deep_learning/" class="md-nav__link">
        深度学习框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/tl/" class="md-nav__link">
        在阿里做了5年技术Leader，我总结出这些套路！
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cto/" class="md-nav__link">
        CTO 技能图谱
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          构架
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          构架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/split/" class="md-nav__link">
        构架拆分
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fgb/" class="md-nav__link">
        分布式、高并发、多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/agility/" class="md-nav__link">
        如何理解敏捷开发
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fwork/" class="md-nav__link">
        走向架构师必备的技能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/data_middle/" class="md-nav__link">
        数据中台的思考与总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/algorithm-ten/" class="md-nav__link">
        必学的 10 大算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          情感
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          情感
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/eq/" class="md-nav__link">
        情商
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/workheard/" class="md-nav__link">
        工作心得
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lookbook/" class="md-nav__link">
        看书
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/selfdiscipline/" class="md-nav__link">
        自律
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/livefail/" class="md-nav__link">
        为什么活着失败
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/emotion/" class="md-nav__link">
        情绪管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/losecome/" class="md-nav__link">
        所有的失去，都会以另一种方式归来
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/threeheart/" class="md-nav__link">
        人生有这三种好心态
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/onepath/" class="md-nav__link">
        余生，学会一个人走，不管有没有人陪
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/twopath/" class="md-nav__link">
        往后余生还很精彩，别被熬夜拖垮了
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lifetime/" class="md-nav__link">
        心态好的人，一辈子都好
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#devops_1" class="md-nav__link">
    一、DevOps介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" class="md-nav__link">
    二、Code阶段工具
  </a>
  
    <nav class="md-nav" aria-label="二、Code阶段工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21_git" class="md-nav__link">
    2.1 Git安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22_gitlab" class="md-nav__link">
    2.2 GitLab安装
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    三、Build阶段工具
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operate" class="md-nav__link">
    四、Operate阶段工具
  </a>
  
    <nav class="md-nav" aria-label="四、Operate阶段工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41_docker" class="md-nav__link">
    4.1 Docker安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42_docker-compose" class="md-nav__link">
    4.2 Docker-Compose安装
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integrate" class="md-nav__link">
    五、Integrate工具
  </a>
  
    <nav class="md-nav" aria-label="五、Integrate工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51_jenkins" class="md-nav__link">
    5.1 Jenkins介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52_jenkins" class="md-nav__link">
    5.2 Jenkins安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53_jenkins" class="md-nav__link">
    5.3 Jenkins入门配置
  </a>
  
    <nav class="md-nav" aria-label="5.3 Jenkins入门配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531" class="md-nav__link">
    5.3.1 构建任务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#531_1" class="md-nav__link">
    5.3.1 配置源码拉取地址
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532_maven" class="md-nav__link">
    5.3.2 配置Maven构建代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533_publish" class="md-nav__link">
    5.3.3 配置Publish发布&amp;远程操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cicd" class="md-nav__link">
    六、CI、CD入门操作
  </a>
  
    <nav class="md-nav" aria-label="六、CI、CD入门操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1 持续集成
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2 持续交付、部署
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sonar_qube" class="md-nav__link">
    七、集成Sonar Qube
  </a>
  
    <nav class="md-nav" aria-label="七、集成Sonar Qube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71_sonar_qube" class="md-nav__link">
    7.1 Sonar Qube介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72_sonar_qube" class="md-nav__link">
    7.2 Sonar Qube环境搭建
  </a>
  
    <nav class="md-nav" aria-label="7.2 Sonar Qube环境搭建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#721_sonar_qube" class="md-nav__link">
    7.2.1 Sonar Qube安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722" class="md-nav__link">
    7.2.2 安装中文插件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73_sonar_qube" class="md-nav__link">
    7.3 Sonar Qube基本使用
  </a>
  
    <nav class="md-nav" aria-label="7.3 Sonar Qube基本使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#731_maven" class="md-nav__link">
    7.3.1 Maven实现代码检测
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#732_sonar-scanner" class="md-nav__link">
    7.3.2 Sonar-scanner实现代码检测
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74_jenkinssonar_qube" class="md-nav__link">
    7.4 Jenkins集成Sonar Qube
  </a>
  
    <nav class="md-nav" aria-label="7.4 Jenkins集成Sonar Qube">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#741_jenkins" class="md-nav__link">
    7.4.1 Jenkins安装插件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#742_jenkinssonar_qube" class="md-nav__link">
    7.4.2 Jenkins配置Sonar Qube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#743_sonar-scanner" class="md-nav__link">
    7.4.3 配置Sonar-scanner
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#744" class="md-nav__link">
    7.4.4 构建任务
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#harbor" class="md-nav__link">
    八、集成Harbor
  </a>
  
    <nav class="md-nav" aria-label="八、集成Harbor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81_harbor" class="md-nav__link">
    8.1 Harbor介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82_harbor" class="md-nav__link">
    8.2 Harbor安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83_harbor" class="md-nav__link">
    8.3 Harbor使用方式
  </a>
  
    <nav class="md-nav" aria-label="8.3 Harbor使用方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#831" class="md-nav__link">
    8.3.1 添加用户构建项目
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#832_harbor" class="md-nav__link">
    8.3.2 发布镜像到Harbor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#833_harborls" class="md-nav__link">
    8.3.3 从Harbor拉取镜像ls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#834_jenkinsdocker" class="md-nav__link">
    8.3.4 Jenkins容器使用宿主机Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#835" class="md-nav__link">
    8.3.5 添加构建操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#836" class="md-nav__link">
    8.3.6 编写部署脚本
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#837" class="md-nav__link">
    8.3.7 配置构建后操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jenkins" class="md-nav__link">
    九、Jenkins流水线
  </a>
  
    <nav class="md-nav" aria-label="九、Jenkins流水线">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91_jenkins" class="md-nav__link">
    9.1 Jenkins流水线任务介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92_jenkins" class="md-nav__link">
    9.2 Jenkins流水线任务
  </a>
  
    <nav class="md-nav" aria-label="9.2 Jenkins流水线任务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#921_jenkins" class="md-nav__link">
    9.2.1 构建Jenkins流水线任务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#922_groovy" class="md-nav__link">
    9.2.2 Groovy脚本
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#923_jenkinsfile" class="md-nav__link">
    9.2.3 Jenkinsfile实现
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93_jenkins" class="md-nav__link">
    9.3 Jenkins流水线任务实现
  </a>
  
    <nav class="md-nav" aria-label="9.3 Jenkins流水线任务实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#931" class="md-nav__link">
    9.3.1 参数化构建
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#932_git" class="md-nav__link">
    9.3.2 拉取Git代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#933" class="md-nav__link">
    9.3.3 构建代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#934" class="md-nav__link">
    9.3.4 代码质量检测
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#935" class="md-nav__link">
    9.3.5 制作自定义镜像并发布
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94_jenkins" class="md-nav__link">
    9.4 Jenkins流水线整合钉钉
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes" class="md-nav__link">
    十、Kubernetes编排工具
  </a>
  
    <nav class="md-nav" aria-label="十、Kubernetes编排工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101_kubernetes" class="md-nav__link">
    10.1 Kubernetes介绍
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102_kubernetes" class="md-nav__link">
    10.2 Kubernetes架构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103_kubernetes" class="md-nav__link">
    10.3 Kubernetes安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#104_kubernetes" class="md-nav__link">
    10.4 Kubernetes操作
  </a>
  
    <nav class="md-nav" aria-label="10.4 Kubernetes操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1041_namespace" class="md-nav__link">
    10.4.1 Namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1042_pod" class="md-nav__link">
    10.4.2 Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1043_deployment" class="md-nav__link">
    10.4.3 Deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1044_service" class="md-nav__link">
    10.4.4 Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1045_ingress" class="md-nav__link">
    10.4.5 Ingress
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#105_jenkinskubernetes" class="md-nav__link">
    10.5 Jenkins集成Kubernetes
  </a>
  
    <nav class="md-nav" aria-label="10.5 Jenkins集成Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1051_yml" class="md-nav__link">
    10.5.1 准备部署的yml文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1052_harbor" class="md-nav__link">
    10.5.2 Harbor私服配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1053" class="md-nav__link">
    10.5.3 测试使用效果
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1053_jenkins" class="md-nav__link">
    10.5.3 Jenkins远程调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#106_gitlabwebhooks" class="md-nav__link">
    10.6 基于GitLab的WebHooks
  </a>
  
    <nav class="md-nav" aria-label="10.6 基于GitLab的WebHooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1061_webhooks" class="md-nav__link">
    10.6.1 WebHooks通知
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1062" class="md-nav__link">
    10.6.2 修改配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1063" class="md-nav__link">
    10.6.3 滚动更新
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="devops">DevOps<a class="headerlink" href="#devops" title="Permanent link">&para;</a></h1>
<h3 id="devops_1">一、DevOps介绍<a class="headerlink" href="#devops_1" title="Permanent link">&para;</a></h3>
<p>软件开发最开始是由两个团队组成：</p>
<ul>
<li>开发计划由<a href="">开发团队</a>从头开始设计和整体系统的构建。需要系统不停的迭代更新。</li>
<li><a href="">运维团队</a>将开发团队的Code进行测试后部署上线。希望系统稳定安全运行。</li>
</ul>
<p>这看似两个目标不同的团队需要协同完成一个软件的开发。</p>
<p>在开发团队指定好计划并完成coding后，需要提供到运维团队。</p>
<p>运维团队向开发团队反馈需要修复的BUG以及一些需要返工的任务。</p>
<p>这时开发团队需要经常等待运维团队的反馈。这无疑延长了事件并推迟了整个软件开发的周期。</p>
<p>会有一种方式，在开发团队等待的时候，让开发团队转移到下一个项目中。等待运维团队为之前的代码提供反馈。</p>
<p>可是这样就意味着一个完整的项目需要一个更长的周期才可以开发出最终代码。</p>
<hr />
<p>基于现在的互联网现状，更推崇敏捷式开发，这样就导致项目的迭代速度更快，但是由于开发团队与运维团队的沟通问题，会导致新版本上线的时间成本很高。这又违背的敏捷式开发的最初的目的。</p>
<p>那么如果让开发团队和运维团队整合到成一个团队，协同应对一套软件呢？这就被称为<a href="">DevOps</a>。</p>
<p><a href="">DevOps</a>，字面意思是Development &amp;Operations的缩写，也就是开发&amp;运维。</p>
<p>虽然字面意思只涉及到了开发团队和运维团队，其实QA测试团队也是参与其中的。</p>
<p>网上可以查看到<a href="">DevOps</a>的符号类似于一个无穷大的符号</p>
<table>
<thead>
<tr>
<th align="center"><a href="">DevOps</a></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124130409521" src="../../../img/kubernetes/kubernetes_devops/image-20211124130409521.png" /></td>
</tr>
</tbody>
</table>
<p>这表明<a href="">DevOps</a>是一个不断提高效率并且持续不断工作的过程</p>
<p><a href="">DevOps</a>的方式可以让公司能够更快地应对更新和市场发展变化，开发可以快速交付，部署也更加稳定。</p>
<p>核心就在于<a href="">简化Dev和Ops团队之间的流程，使整体软件开发过程更快速。</a></p>
<p>整体的软件开发流程包括：</p>
<ul>
<li>PLAN：开发团队根据客户的目标制定开发计划</li>
<li>CODE：根据PLAN开始编码过程，需要将不同版本的代码存储在一个库中。</li>
<li>BUILD：编码完成后，需要将代码构建并且运行。</li>
<li>TEST：成功构建项目后，需要测试代码是否存在BUG或错误。</li>
<li>DEPLOY：代码经过手动测试和自动化测试后，认定代码已经准备好部署并且交给运维团队。</li>
<li>OPERATE：运维团队将代码部署到生产环境中。</li>
<li>MONITOR：项目部署上线后，需要持续的监控产品。</li>
<li>INTEGRATE：然后将监控阶段收到的反馈发送回PLAN阶段，整体反复的流程就是<a href="">DevOps</a>的核心，即持续集成、持续部署。</li>
</ul>
<p>为了保证整体流程可以高效的完成，各个阶段都有比较常见的工具，如下图：</p>
<table>
<thead>
<tr>
<th align="center">软件开发过程&amp;涉及工具</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="2021-11-23_175935" src="../../../img/kubernetes/kubernetes_devops/2021-11-23_175935.png" /></td>
</tr>
</tbody>
</table>
<p>最终可以给<a href="">DevOps</a>下一个定义：<a href="">DevOps 强调的是高效组织团队之间如何通过自动化的工具协作和沟通来完成软件的生命周期管理，从而更快、更频繁地交付更稳定的软件。</a></p>
<p>自动化的工具协作和沟通来完成软件的生命周期管理</p>
<h3 id="code">二、Code阶段工具<a class="headerlink" href="#code" title="Permanent link">&para;</a></h3>
<p>在code阶段，我们需要将不同版本的代码存储到一个仓库中，常见的版本控制工具就是SVN或者Git，这里我们采用Git作为版本控制工具，GitLab作为远程仓库。</p>
<h4 id="21_git">2.1 Git安装<a class="headerlink" href="#21_git" title="Permanent link">&para;</a></h4>
<p><a href="https://git-scm.com/">https://git-scm.com/</a>（傻瓜式安装）</p>
<h4 id="22_gitlab">2.2 GitLab安装<a class="headerlink" href="#22_gitlab" title="Permanent link">&para;</a></h4>
<p>单独准备服务器，采用Docker安装</p>
<ul>
<li>查看GitLab镜像</li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>search<span class="w"> </span>gitlab
</code></pre></div>
<ul>
<li>拉取GitLab镜像</li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>gitlab/gitlab-ce
</code></pre></div>
<ul>
<li>准备docker-compose.yml文件</li>
</ul>
<div class="highlight"><pre><span></span><code>version: &#39;3.1&#39;
services:
  gitlab:
    image: &#39;gitlab/gitlab-ce:latest&#39;
    container_name: gitlab
    restart: always
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url &#39;http://192.168.11.11:8929&#39;
        gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 2224
    ports:
      - &#39;8929:8929&#39;
      - &#39;2224:2224&#39;
    volumes:
      - &#39;./config:/etc/gitlab&#39;
      - &#39;./logs:/var/log/gitlab&#39;
      - &#39;./data:/var/opt/gitlab&#39;
</code></pre></div>
<ul>
<li>启动容器（需要稍等一小会……）</li>
</ul>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<ul>
<li>访问GitLab首页</li>
</ul>
<table>
<thead>
<tr>
<th align="center">首页</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124182140596" src="../../../img/kubernetes/kubernetes_devops/image-20211124182140596.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>查看root用户初始密码</li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>gitlab<span class="w"> </span>cat<span class="w"> </span>/etc/gitlab/initial_root_password
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">初始密码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124182921234" src="../../../img/kubernetes/kubernetes_devops/image-20211124182921234.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>登录root用户</li>
</ul>
<table>
<thead>
<tr>
<th align="center">登录成功后跳转页面</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124183003858" src="../../../img/kubernetes/kubernetes_devops/image-20211124183003858.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>第一次登录后需要修改密码</li>
</ul>
<table>
<thead>
<tr>
<th align="center">修改密码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124193444561" src="../../../img/kubernetes/kubernetes_devops/image-20211124193444561.png" /></td>
</tr>
</tbody>
</table>
<p>搞定后，即可像Gitee、GitHub一样使用。</p>
<h3 id="build">三、Build阶段工具<a class="headerlink" href="#build" title="Permanent link">&para;</a></h3>
<p>构建Java项目的工具一般有两种选择，一个是Maven，一个是Gradle。</p>
<p>这里我们选择Maven作为项目的编译工具。</p>
<p>具体安装Maven流程不做阐述，但是需要确保配置好Maven仓库私服以及JDK编译版本。</p>
<h3 id="operate">四、Operate阶段工具<a class="headerlink" href="#operate" title="Permanent link">&para;</a></h3>
<p>部署过程，会采用Docker进行部署，暂时只安装Docker即可，后续还需安装Kubenetes</p>
<h4 id="41_docker">4.1 Docker安装<a class="headerlink" href="#41_docker" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>准备测试环境&amp;生产环境</p>
</li>
<li>
<p>下载Docker依赖组件</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>yum-utils<span class="w"> </span>device-mapper-persistent-data<span class="w"> </span>lvm2
</code></pre></div>
<ul>
<li>设置下载Docker的镜像源为阿里云</li>
</ul>
<div class="highlight"><pre><span></span><code>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div>
<ul>
<li>安装Docker服务</li>
</ul>
<div class="highlight"><pre><span></span><code>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>docker-ce
</code></pre></div>
<ul>
<li>安装成功后，启动Docker并设置开机自启</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 启动Docker服务</span>
systemctl<span class="w"> </span>start<span class="w"> </span>docker
<span class="c1"># 设置开机自动启动</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>docker
</code></pre></div>
<ul>
<li>测试安装成功</li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>version
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124200317795" src="../../../img/kubernetes/kubernetes_devops/image-20211124200317795.png" /></td>
</tr>
</tbody>
</table>
<h4 id="42_docker-compose">4.2 Docker-Compose安装<a class="headerlink" href="#42_docker-compose" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>下载Docker/Compose：<a href="https://github.com/docker/compose">https://github.com/docker/compose</a></p>
</li>
<li>
<p>将下载好的<a href="">docker-compose-Linux-x86_64</a>文件移动到Linux操作系统：……</p>
</li>
<li>
<p>设置<a href="">docker-compose-Linux-x86_64</a>文件权限，并移动到$PATH目录中</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 设置文件权限</span>
chmod<span class="w"> </span>a+x<span class="w"> </span>docker-compose-Linux-x86_64
<span class="c1"># 移动到/usr/bin目录下，并重命名为docker-compose</span>
mv<span class="w"> </span>docker-compose-Linux-x86_64<span class="w"> </span>/usr/bin/docker-compose
</code></pre></div>
<ul>
<li>测试安装成功</li>
</ul>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>version
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124200658107" src="../../../img/kubernetes/kubernetes_devops/image-20211124200658107.png" /></td>
</tr>
</tbody>
</table>
<h3 id="integrate">五、Integrate工具<a class="headerlink" href="#integrate" title="Permanent link">&para;</a></h3>
<p>持续集成、持续部署的工具很多，其中Jenkins是一个开源的持续集成平台。</p>
<p>Jenkins涉及到将编写完毕的代码发布到测试环境和生产环境的任务，并且还涉及到了构建项目等任务。</p>
<p>Jenkins需要大量的插件保证工作，安装成本较高，下面会基于Docker搭建Jenkins。</p>
<h4 id="51_jenkins">5.1 Jenkins介绍<a class="headerlink" href="#51_jenkins" title="Permanent link">&para;</a></h4>
<p>Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具</p>
<p>Jenkins应用广泛，大多数互联网公司都采用Jenkins配合GitLab、Docker、K8s作为实现<a href="">DevOps</a>的核心工具。</p>
<p>Jenkins最强大的就在于插件，Jenkins官方提供了大量的插件库，来自动化CI/CD过程中的各种琐碎功能。</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125141950900" src="../../../img/kubernetes/kubernetes_devops/image-20211125141950900.png" /></td>
<td align="center"><img alt="image-20211124200317795" src="../../../img/kubernetes/kubernetes_devops/image-20211125141701495.png" /></td>
</tr>
</tbody>
</table>
<p>Jenkins最主要的工作就是将GitLab上可以构建的工程代码拉取并且进行构建，再根据流程可以选择发布到测试环境或是生产环境。</p>
<p>一般是GitLab上的代码经过大量的测试后，确定发行版本，再发布到生产环境。</p>
<p>CI/CD可以理解为：</p>
<ul>
<li>CI过程即是通过Jenkins将代码拉取、构建、制作镜像交给测试人员测试。</li>
<li>持续集成：让软件代码可以持续的集成到主干上，并自动构建和测试。</li>
<li>CD过程即是通过Jenkins将打好标签的发行版本代码拉取、构建、制作镜像交给运维人员部署。</li>
<li>持续交付：让经过持续集成的代码可以进行手动部署。</li>
<li>持续部署：让可以持续交付的代码随时随地的自动化部署。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">CI、CD</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125154112097" src="../../../img/kubernetes/kubernetes_devops/image-20211125154112097.png" /></td>
</tr>
</tbody>
</table>
<h4 id="52_jenkins">5.2 Jenkins安装<a class="headerlink" href="#52_jenkins" title="Permanent link">&para;</a></h4>
<ul>
<li>拉取Jenkins镜像</li>
</ul>
<div class="highlight"><pre><span></span><code>docker pull jenkins/jenkins
</code></pre></div>
<ul>
<li>编写docker-compose.yml</li>
</ul>
<div class="highlight"><pre><span></span><code>version: &quot;3.1&quot;
services:
  jenkins:
    image: jenkins/jenkins
    container_name: jenkins
    ports:
      - 8080:8080
      - 50000:50000
    volumes:
      - ./data/:/var/jenkins_home/
</code></pre></div>
<ul>
<li>首次启动会因为数据卷data目录没有权限导致启动失败，设置data目录写权限</li>
</ul>
<table>
<thead>
<tr>
<th align="center">错误日志</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124202610243" src="../../../img/kubernetes/kubernetes_devops/image-20211124202610243.png" /></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>-R<span class="w"> </span>a+w<span class="w"> </span>data/
</code></pre></div>
<ul>
<li>重新启动Jenkins容器后，由于Jenkins需要下载大量内容，但是由于默认下载地址下载速度较慢，需要重新设置下载地址为国内镜像站</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 修改数据卷中的hudson.model.UpdateCenter.xml文件</span>
&lt;?xml<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s1">&#39;1.1&#39;</span><span class="w"> </span><span class="nv">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span>?&gt;
&lt;sites&gt;
<span class="w">  </span>&lt;site&gt;
<span class="w">    </span>&lt;id&gt;default&lt;/id&gt;
<span class="w">    </span>&lt;url&gt;https://updates.jenkins.io/update-center.json&lt;/url&gt;
<span class="w">  </span>&lt;/site&gt;
&lt;/sites&gt;
<span class="c1"># 将下载地址替换为http://mirror.esuni.jp/jenkins/updates/update-center.json</span>
&lt;?xml<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s1">&#39;1.1&#39;</span><span class="w"> </span><span class="nv">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span>?&gt;
&lt;sites&gt;
<span class="w">  </span>&lt;site&gt;
<span class="w">    </span>&lt;id&gt;default&lt;/id&gt;
<span class="w">    </span>&lt;url&gt;http://mirror.esuni.jp/jenkins/updates/update-center.json&lt;/url&gt;
<span class="w">  </span>&lt;/site&gt;
&lt;/sites&gt;
<span class="c1"># 清华大学的插件源也可以https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span>
</code></pre></div>
<ul>
<li>再次重启Jenkins容器，访问Jenkins（需要稍微等会）</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Jenkins首页</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124204517433" src="../../../img/kubernetes/kubernetes_devops/image-20211124204517433.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211124203336300" src="../../../img/kubernetes/kubernetes_devops/image-20211124203336300.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>查看密码登录Jenkins，并登录下载插件</li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>jenkins<span class="w"> </span>cat<span class="w"> </span>/var/jenkins_home/secrets/initialAdminPassword
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">登录并下载插件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124205050484" src="../../../img/kubernetes/kubernetes_devops/image-20211124205050484.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211124205513465" src="../../../img/kubernetes/kubernetes_devops/image-20211124205513465.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>选择需要安装的插件</li>
</ul>
<table>
<thead>
<tr>
<th align="center">选择需要安装的插件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211124205854418" src="../../../img/kubernetes/kubernetes_devops/image-20211124205854418.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211124205858730" src="../../../img/kubernetes/kubernetes_devops/image-20211124205858730.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211124205917317" src="../../../img/kubernetes/kubernetes_devops/image-20211124205917317.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>下载完毕设置信息进入首页（可能会出现下载失败的插件）</li>
</ul>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="image-20211124211635550" src="../../../img/kubernetes/kubernetes_devops/image-20211124211635550.png" /></td>
</tr>
<tr>
<td><img alt="image-20211124211700999" src="../../../img/kubernetes/kubernetes_devops/image-20211124211700999.png" /></td>
</tr>
<tr>
<td><img alt="image-20211124211720836" src="../../../img/kubernetes/kubernetes_devops/image-20211124211720836.png" /></td>
</tr>
</tbody>
</table>
<h4 id="53_jenkins">5.3 Jenkins入门配置<a class="headerlink" href="#53_jenkins" title="Permanent link">&para;</a></h4>
<p>由于Jenkins需要从Git拉取代码、需要本地构建、甚至需要直接发布自定义镜像到Docker仓库，所以Jenkins需要配置大量内容。</p>
<h5 id="531">5.3.1 构建任务<a class="headerlink" href="#531" title="Permanent link">&para;</a></h5>
<p>准备好GitLab仓库中的项目，并且通过Jenkins配置项目的实现当前项目的<a href="">DevOps</a>基本流程。</p>
<ul>
<li>构建Maven工程发布到GitLab（Gitee、Github均可）</li>
</ul>
<table>
<thead>
<tr>
<th align="center">GitLab查看项目</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125195818670" src="../../../img/kubernetes/kubernetes_devops/image-20211125195818670.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>Jenkins点击左侧导航新建任务</li>
</ul>
<table>
<thead>
<tr>
<th align="center">新建任务</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125163541645" src="../../../img/kubernetes/kubernetes_devops/image-20211125163541645.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>选择自由风格构建任务</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建任务</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125170350811" src="../../../img/kubernetes/kubernetes_devops/image-20211125170350811.png" /></td>
</tr>
</tbody>
</table>
<h5 id="531_1">5.3.1 配置源码拉取地址<a class="headerlink" href="#531_1" title="Permanent link">&para;</a></h5>
<p>Jenkins需要将Git上存放的源码存储到Jenkins服务所在磁盘的本地</p>
<ul>
<li>配置任务源码拉取的地址</li>
</ul>
<table>
<thead>
<tr>
<th align="center">源码管理</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125170418337" src="../../../img/kubernetes/kubernetes_devops/image-20211125170418337.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>Jenkins立即构建</li>
</ul>
<table>
<thead>
<tr>
<th align="center">点击任务test中的立即构建</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125200218093" src="../../../img/kubernetes/kubernetes_devops/image-20211125200218093.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>查看构建工程的日志，点击上述③的任务条即可</li>
</ul>
<table>
<thead>
<tr>
<th align="center">查看任务拉取Git源码日志</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125201701443" src="../../../img/kubernetes/kubernetes_devops/image-20211125201701443.png" /></td>
</tr>
</tbody>
</table>
<p>可以看到源码已经拉取带Jenkins本地，可以根据第三行日志信息，查看Jenkins本地拉取到的源码。</p>
<ul>
<li>查看Jenkins容器中<a href="">/var/jenkins_home/workspace/test</a>的源码</li>
</ul>
<table>
<thead>
<tr>
<th align="center">源码存放位置</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125201919108" src="../../../img/kubernetes/kubernetes_devops/image-20211125201919108.png" /></td>
</tr>
</tbody>
</table>
<h5 id="532_maven">5.3.2 配置Maven构建代码<a class="headerlink" href="#532_maven" title="Permanent link">&para;</a></h5>
<p>代码拉取到Jenkins本地后，需要在Jenkins中对代码进行构建，这里需要Maven的环境，而Maven需要Java的环境，接下来需要在Jenkins中安装JDK和Maven，并且配置到Jenkins服务。</p>
<ul>
<li>准备JDK、Maven压缩包通过数据卷映射到Jenkins容器内部</li>
</ul>
<table>
<thead>
<tr>
<th align="center">数据卷存放位置</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125203757232" src="../../../img/kubernetes/kubernetes_devops/image-20211125203757232.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>解压压缩包，并配置Maven的settings.xml</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- 阿里云镜像地址 --&gt;</span>
<span class="nt">&lt;mirror&gt;</span><span class="w">  </span>
<span class="w">    </span><span class="nt">&lt;id&gt;</span>alimaven<span class="nt">&lt;/id&gt;</span><span class="w">  </span>
<span class="w">    </span><span class="nt">&lt;name&gt;</span>aliyun<span class="w"> </span>maven<span class="nt">&lt;/name&gt;</span><span class="w">  </span>
<span class="w">    </span><span class="nt">&lt;url&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="nt">&lt;/url&gt;</span>
<span class="w">    </span><span class="nt">&lt;mirrorOf&gt;</span>central<span class="nt">&lt;/mirrorOf&gt;</span><span class="w">          </span>
<span class="nt">&lt;/mirror&gt;</span>
<span class="cm">&lt;!-- JDK1.8编译插件 --&gt;</span>
<span class="nt">&lt;profile&gt;</span>
<span class="w">    </span><span class="nt">&lt;id&gt;</span>jdk-1.8<span class="nt">&lt;/id&gt;</span>
<span class="w">    </span><span class="nt">&lt;activation&gt;</span>
<span class="w">        </span><span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
<span class="w">        </span><span class="nt">&lt;jdk&gt;</span>1.8<span class="nt">&lt;/jdk&gt;</span>
<span class="w">    </span><span class="nt">&lt;/activation&gt;</span>
<span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<span class="w">        </span><span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
<span class="w">        </span><span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
<span class="w">        </span><span class="nt">&lt;maven.compiler.compilerVersion&gt;</span>1.8<span class="nt">&lt;/maven.compiler.compilerVersion&gt;</span>
<span class="w">    </span><span class="nt">&lt;/properties&gt;</span><span class="w">        </span>
<span class="nt">&lt;/profile&gt;</span>
</code></pre></div>
<ul>
<li>Jenkins配置JDK&amp;Maven并保存</li>
</ul>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="image-20211125204811759" src="../../../img/kubernetes/kubernetes_devops/image-20211125204811759.png" /></td>
</tr>
<tr>
<td><img alt="image-20211125204818869" src="../../../img/kubernetes/kubernetes_devops/image-20211125204818869.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>配置Jenkins任务构建代码</li>
</ul>
<table>
<thead>
<tr>
<th align="center">配置Maven构建代码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125205027013" src="../../../img/kubernetes/kubernetes_devops/image-20211125205027013.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211125205020738" src="../../../img/kubernetes/kubernetes_devops/image-20211125205020738.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>立即构建测试，查看target下的jar包</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建源码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125205240208" src="../../../img/kubernetes/kubernetes_devops/image-20211125205240208.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211125205725948" src="../../../img/kubernetes/kubernetes_devops/image-20211125205725948.png" /></td>
</tr>
</tbody>
</table>
<h5 id="533_publish">5.3.3 配置Publish发布&amp;远程操作<a class="headerlink" href="#533_publish" title="Permanent link">&para;</a></h5>
<p>jar包构建好之后，就可以根据情况发布到测试或生产环境，这里需要用到之前下载好的插件Publish Over SSH。</p>
<ul>
<li>配置Publish Over SSH连接测试、生产环境</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Publish Over SSH配置</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125210148202" src="../../../img/kubernetes/kubernetes_devops/image-20211125210148202.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>配置任务的构建后操作，发布jar包到目标服务</li>
</ul>
<table>
<thead>
<tr>
<th align="center">配置构建后操作</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125205027013" src="../../../img/kubernetes/kubernetes_devops/image-20211125205027013.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211125210424346" src="../../../img/kubernetes/kubernetes_devops/image-20211125210424346.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211125210626631" src="../../../img/kubernetes/kubernetes_devops/image-20211125210626631.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>立即构建任务，并去目标服务查看</li>
</ul>
<table>
<thead>
<tr>
<th align="center">立即构建</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211125210755556" src="../../../img/kubernetes/kubernetes_devops/image-20211125210755556.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211125210826057" src="../../../img/kubernetes/kubernetes_devops/image-20211125210826057.png" /></td>
</tr>
</tbody>
</table>
<h3 id="cicd">六、CI、CD入门操作<a class="headerlink" href="#cicd" title="Permanent link">&para;</a></h3>
<p>基于Jenkins拉取GitLab的SpringBoot代码进行构建发布到测试环境实现持续集成</p>
<p>基于Jenkins拉取GitLab指定发行版本的SpringBoot代码进行构建发布到生产环境实现CD实现持续部署</p>
<h4 id="61">6.1 持续集成<a class="headerlink" href="#61" title="Permanent link">&para;</a></h4>
<p>为了让程序代码可以自动推送到测试环境基于Docker服务运行，需要添加Docker配置和脚本文件让程序可以在集成到主干的同时运行起来。</p>
<ul>
<li>添加Dockerfile文件</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建自定义镜像</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126161304485" src="../../../img/kubernetes/kubernetes_devops/image-20211126161304485.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>添加docker-compose.yml文件</li>
</ul>
<table>
<thead>
<tr>
<th align="center">加载自定义镜像启动容器</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126161331991" src="../../../img/kubernetes/kubernetes_devops/image-20211126161331991.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>追加Jenkins构建后操作脚本命令</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建后发布并执行脚本命令</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126161408514" src="../../../img/kubernetes/kubernetes_devops/image-20211126161408514.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>发布到GitLab后由Jenkins立即构建并托送到目标服务器</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建日志</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126161448527" src="../../../img/kubernetes/kubernetes_devops/image-20211126161448527.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>测试部署到目标服务器程序</li>
</ul>
<table>
<thead>
<tr>
<th align="center">查看目标服务器并测试接口</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126161504715" src="../../../img/kubernetes/kubernetes_devops/image-20211126161504715.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211126161509411" src="../../../img/kubernetes/kubernetes_devops/image-20211126161509411.png" /></td>
</tr>
</tbody>
</table>
<h4 id="62">6.2 持续交付、部署<a class="headerlink" href="#62" title="Permanent link">&para;</a></h4>
<p>程序代码在经过多次集成操作到达最终可以交付，持续交付整体流程和持续集成类似，不过需要选取指定的发行版本</p>
<ul>
<li>下载Git Parameter插件</li>
</ul>
<table>
<thead>
<tr>
<th align="center">下载Git Parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126165209057" src="../../../img/kubernetes/kubernetes_devops/image-20211126165209057.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>设置项目参数化构建</li>
</ul>
<table>
<thead>
<tr>
<th align="center">基于Git标签构建</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126165444124" src="../../../img/kubernetes/kubernetes_devops/image-20211126165444124.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211126172828266" src="../../../img/kubernetes/kubernetes_devops/image-20211126172828266.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>给项目添加tag版本</li>
</ul>
<table>
<thead>
<tr>
<th align="center">添加tag版本</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126165639286" src="../../../img/kubernetes/kubernetes_devops/image-20211126165639286.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>任务构建时，采用Shell方式构建，拉取指定tag版本代码</li>
</ul>
<table>
<thead>
<tr>
<th align="center">切换指定标签并构建项目</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126174715028" src="../../../img/kubernetes/kubernetes_devops/image-20211126174715028.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>基于Parameter构建任务，任务发布到目标服务器</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建任务</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211126174159487" src="../../../img/kubernetes/kubernetes_devops/image-20211126174159487.png" /></td>
</tr>
</tbody>
</table>
<h3 id="sonar_qube">七、集成Sonar Qube<a class="headerlink" href="#sonar_qube" title="Permanent link">&para;</a></h3>
<h4 id="71_sonar_qube">7.1 Sonar Qube介绍<a class="headerlink" href="#71_sonar_qube" title="Permanent link">&para;</a></h4>
<p>Sonar Qube是一个开源的代码分析平台，支持Java、Python、PHP、JavaScript、CSS等25种以上的语言，可以检测出重复代码、代码漏洞、代码规范和安全性漏洞的问题。</p>
<p>Sonar Qube可以与多种软件整合进行代码扫描，比如Maven，Gradle，Git，Jenkins等，并且会将代码检测结果推送回Sonar Qube并且在系统提供的UI界面上显示出来</p>
<table>
<thead>
<tr>
<th align="center">Sonar Qube的UI界面</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129190039986" src="../../../img/kubernetes/kubernetes_devops/image-20211129190039986.png" /></td>
</tr>
</tbody>
</table>
<h4 id="72_sonar_qube">7.2 Sonar Qube环境搭建<a class="headerlink" href="#72_sonar_qube" title="Permanent link">&para;</a></h4>
<h5 id="721_sonar_qube">7.2.1 Sonar Qube安装<a class="headerlink" href="#721_sonar_qube" title="Permanent link">&para;</a></h5>
<p>Sonar Qube在7.9版本中已经放弃了对MySQL的支持，并且建议在商业环境中采用PostgreSQL，那么安装Sonar Qube时需要依赖PostgreSQL。</p>
<p>并且这里会安装Sonar Qube的长期支持版本<a href="">8.9</a></p>
<ul>
<li>拉取镜像</li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>postgres
docker<span class="w"> </span>pull<span class="w"> </span>sonarqube:8.9.3-community
</code></pre></div>
<ul>
<li>编写docker-compoe.yml</li>
</ul>
<div class="highlight"><pre><span></span><code>version: &quot;3.1&quot;
services:
  db:
    image: postgres
    container_name: db
    ports:
      - 5432:5432
    networks:
      - sonarnet
    environment:
      POSTGRES_USER: sonar
      POSTGRES_PASSWORD: sonar
  sonarqube:
    image: sonarqube:8.9.3-community
    container_name: sonarqube
    depends_on:
      - db
    ports:
      - &quot;9000:9000&quot;
    networks:
      - sonarnet
    environment:
      SONAR_JDBC_URL: jdbc:postgresql://db:5432/sonar
      SONAR_JDBC_USERNAME: sonar
      SONAR_JDBC_PASSWORD: sonar
networks:
  sonarnet:
    driver: bridge
</code></pre></div>
<ul>
<li>启动容器</li>
</ul>
<div class="highlight"><pre><span></span><code>docker-compose up -d
</code></pre></div>
<ul>
<li>需要设置sysctl.conf文件信息</li>
</ul>
<table>
<thead>
<tr>
<th align="center">设置vm.max_map_count</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211207145215817" src="../../../img/kubernetes/kubernetes_devops/image-20211207145215817.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211207145342350" src="../../../img/kubernetes/kubernetes_devops/image-20211207145342350.png" /></td>
</tr>
</tbody>
</table>
<p>并执行命令刷新</p>
<div class="highlight"><pre><span></span><code>sysctl -p
</code></pre></div>
<ul>
<li>重新启动需要一定时间启动，可以可以查看容器日志，看到如下内容代表启动成功</li>
</ul>
<table>
<thead>
<tr>
<th align="center">容器日志</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129191426344" src="../../../img/kubernetes/kubernetes_devops/image-20211129191426344.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>访问Sonar Qube首页</li>
</ul>
<table>
<thead>
<tr>
<th align="center">登录</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129191537050" src="../../../img/kubernetes/kubernetes_devops/image-20211129191537050.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>还需要重新设置一次密码</li>
</ul>
<table>
<thead>
<tr>
<th align="center">重新设置密码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129193824428" src="../../../img/kubernetes/kubernetes_devops/image-20211129193824428.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>Sonar Qube首页</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Sonar Qube首页</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129194148239" src="../../../img/kubernetes/kubernetes_devops/image-20211129194148239.png" /></td>
</tr>
</tbody>
</table>
<h5 id="722">7.2.2 安装中文插件<a class="headerlink" href="#722" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th align="center">安装中文插件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129194621820" src="../../../img/kubernetes/kubernetes_devops/image-20211129194621820.png" /></td>
</tr>
</tbody>
</table>
<p>安装成功后需要重启，安装失败重新点击install重装即可。</p>
<p>安装成功后，会查看到重启按钮，点击即可</p>
<table>
<thead>
<tr>
<th align="center">重启按钮</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129194748765" src="../../../img/kubernetes/kubernetes_devops/image-20211129194748765.png" /></td>
</tr>
</tbody>
</table>
<p>重启后查看效果</p>
<table>
<thead>
<tr>
<th align="center">首页效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129194931944" src="../../../img/kubernetes/kubernetes_devops/image-20211129194931944.png" /></td>
</tr>
</tbody>
</table>
<h4 id="73_sonar_qube">7.3 Sonar Qube基本使用<a class="headerlink" href="#73_sonar_qube" title="Permanent link">&para;</a></h4>
<p>Sonar Qube的使用方式很多，Maven可以整合，也可以采用sonar-scanner的方式，再查看Sonar Qube的检测效果</p>
<h5 id="731_maven">7.3.1 Maven实现代码检测<a class="headerlink" href="#731_maven" title="Permanent link">&para;</a></h5>
<ul>
<li>修改Maven的settings.xml文件配置Sonar Qube信息</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;profile&gt;</span>
<span class="w">    </span><span class="nt">&lt;id&gt;</span>sonar<span class="nt">&lt;/id&gt;</span>
<span class="w">    </span><span class="nt">&lt;activation&gt;</span>
<span class="w">        </span><span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
<span class="w">    </span><span class="nt">&lt;/activation&gt;</span>
<span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<span class="w">        </span><span class="nt">&lt;sonar.login&gt;</span>admin<span class="nt">&lt;/sonar.login&gt;</span>
<span class="w">        </span><span class="nt">&lt;sonar.password&gt;</span>123456789<span class="nt">&lt;/sonar.password&gt;</span>
<span class="w">        </span><span class="nt">&lt;sonar.host.url&gt;</span>http://192.168.11.11:9000<span class="nt">&lt;/sonar.host.url&gt;</span>
<span class="w">    </span><span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/profile&gt;</span>
</code></pre></div>
<ul>
<li>在代码位置执行命令：mvn sonar:sonar</li>
</ul>
<table>
<thead>
<tr>
<th align="center">执行代码检测</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129195430146" src="../../../img/kubernetes/kubernetes_devops/image-20211129195430146.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>查看Sonar Qube界面检测结果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Sonar Qube检测结果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129195503762" src="../../../img/kubernetes/kubernetes_devops/image-20211129195503762.png" /></td>
</tr>
</tbody>
</table>
<h5 id="732_sonar-scanner">7.3.2 Sonar-scanner实现代码检测<a class="headerlink" href="#732_sonar-scanner" title="Permanent link">&para;</a></h5>
<ul>
<li>下载Sonar-scanner：<a href="https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/">https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/</a></li>
</ul>
<p>下载4.6.x版本即可，要求Linux版本</p>
<ul>
<li>
<p>解压并配置sonar服务端信息</p>
</li>
<li>
<p>由于是zip压缩包，需要安装unzip解压插件</p>
<div class="highlight"><pre><span></span><code>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>unzip
</code></pre></div>
</li>
<li>
<p>解压压缩包</p>
<div class="highlight"><pre><span></span><code>unzip<span class="w"> </span>sonar-scanner-cli/sonar-scanner-cli-4.6.0.2311-linux.zip
</code></pre></div>
</li>
<li>
<p>配置sonarQube服务端地址，修改conf下的sonar-scanner.properties</p>
<table>
<thead>
<tr>
<th align="center">配置服务端信息</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130140043382" src="../../../img/kubernetes/kubernetes_devops/image-20211130140043382.png" /></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>执行命令检测代码</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 在项目所在目录执行以下命令</span>
~/sonar-scanner/bin/sonar-scanner<span class="w"> </span>-Dsonar.sources<span class="o">=</span>./<span class="w"> </span>-Dsonar.projectname<span class="o">=</span>demo<span class="w"> </span>-Dsonar.projectKey<span class="o">=</span>java<span class="w"> </span>-Dsonar.java.binaries<span class="o">=</span>target/
</code></pre></div>
<p><a href="">Ps：主要查看我的sonar-scanner执行命令的位置</a></p>
<table>
<thead>
<tr>
<th align="center">查看日志信息</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130141303457" src="../../../img/kubernetes/kubernetes_devops/image-20211130141303457.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>查看SonarQube界面检测结果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">检测结果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130144608025" src="../../../img/kubernetes/kubernetes_devops/image-20211130144608025.png" /></td>
</tr>
</tbody>
</table>
<h4 id="74_jenkinssonar_qube">7.4 Jenkins集成Sonar Qube<a class="headerlink" href="#74_jenkinssonar_qube" title="Permanent link">&para;</a></h4>
<p>Jenkins继承Sonar Qube实现代码扫描需要先下载整合插件</p>
<h5 id="741_jenkins">7.4.1 Jenkins安装插件<a class="headerlink" href="#741_jenkins" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th align="center">下载Sonar Qube插件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129201625561" src="../../../img/kubernetes/kubernetes_devops/image-20211129201625561.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211129201607240" src="../../../img/kubernetes/kubernetes_devops/image-20211129201607240.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211129202147390" src="../../../img/kubernetes/kubernetes_devops/image-20211129202147390.png" /></td>
</tr>
</tbody>
</table>
<h5 id="742_jenkinssonar_qube">7.4.2 Jenkins配置Sonar Qube<a class="headerlink" href="#742_jenkinssonar_qube" title="Permanent link">&para;</a></h5>
<ul>
<li>开启Sonar Qube权限验证</li>
</ul>
<table>
<thead>
<tr>
<th align="center">开启Sonar Qube权限校验</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130144850186" src="../../../img/kubernetes/kubernetes_devops/image-20211130144850186.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>获取Sonar Qube的令牌</li>
</ul>
<table>
<thead>
<tr>
<th align="center">获取令牌</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211129203102334" src="../../../img/kubernetes/kubernetes_devops/image-20211129203102334.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>配置Jenkins的Sonar Qube信息</li>
</ul>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="image-20211129203235019" src="../../../img/kubernetes/kubernetes_devops/image-20211129203235019.png" /></td>
</tr>
<tr>
<td><img alt="image-20211129203342171" src="../../../img/kubernetes/kubernetes_devops/image-20211129203342171.png" /></td>
</tr>
<tr>
<td><img alt="image-20211129203457604" src="../../../img/kubernetes/kubernetes_devops/image-20211129203457604.png" /></td>
</tr>
</tbody>
</table>
<h5 id="743_sonar-scanner">7.4.3 配置Sonar-scanner<a class="headerlink" href="#743_sonar-scanner" title="Permanent link">&para;</a></h5>
<ul>
<li>将Sonar-scaner添加到Jenkins数据卷中并配置全局配置</li>
</ul>
<table>
<thead>
<tr>
<th align="center">配置Sonar-scanner</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130153628925" src="../../../img/kubernetes/kubernetes_devops/image-20211130153628925.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>配置任务的Sonar-scanner</li>
</ul>
<table>
<thead>
<tr>
<th align="center">配置任务的Sonar-scanner</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130155849143" src="../../../img/kubernetes/kubernetes_devops/image-20211130155849143.png" /></td>
</tr>
</tbody>
</table>
<h5 id="744">7.4.4 构建任务<a class="headerlink" href="#744" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th align="center">构建任务</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130160017465" src="../../../img/kubernetes/kubernetes_devops/image-20211130160017465.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211130160047648" src="../../../img/kubernetes/kubernetes_devops/image-20211130160047648.png" /></td>
</tr>
</tbody>
</table>
<h3 id="harbor">八、集成Harbor<a class="headerlink" href="#harbor" title="Permanent link">&para;</a></h3>
<h4 id="81_harbor">8.1 Harbor介绍<a class="headerlink" href="#81_harbor" title="Permanent link">&para;</a></h4>
<p>前面在部署项目时，我们主要采用Jenkins推送jar包到指定服务器，再通过脚本命令让目标服务器对当前jar进行部署，这种方式在项目较多时，每个目标服务器都需要将jar包制作成自定义镜像再通过docker进行启动，重复操作比较多，会降低项目部署时间。</p>
<p>我们可以通过Harbor作为私有的Docker镜像仓库。让Jenkins统一将项目打包并制作成Docker镜像发布到Harbor仓库中，只需要通知目标服务，让目标服务统一去Harbor仓库上拉取镜像并在本地部署即可。</p>
<p>Docker官方提供了Registry镜像仓库，但是Registry的功能相对简陋。Harbor是VMware公司提供的一款镜像仓库，提供了权限控制、分布式发布、强大的安全扫描与审查机制等功能</p>
<h4 id="82_harbor">8.2 Harbor安装<a class="headerlink" href="#82_harbor" title="Permanent link">&para;</a></h4>
<p>这里采用原生的方式安装Harbor。</p>
<ul>
<li>
<p>下载Harbor安装包：<a href="https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz">https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz</a></p>
</li>
<li>
<p>拖拽到Linux并解压：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>tar -zxvf harbor-offline-installer-v2.3.4.tgz -C /usr/local/
</code></pre></div>
<ul>
<li>
<p>修改Harbor配置文件：</p>
</li>
<li>
<p>首先复制一份harbor.yml配置</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>harbor.yml.tmpl<span class="w"> </span>harbor.yml
</code></pre></div>
</li>
<li>
<p>编辑harbor.yml配置文件</p>
<table>
<thead>
<tr>
<th align="center">配置Harbor文件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130215555218" src="../../../img/kubernetes/kubernetes_devops/image-20211130215555218.png" /></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>启动Harbor</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>./install.sh
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">查看日志</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130215941857" src="../../../img/kubernetes/kubernetes_devops/image-20211130215941857.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>登录Harbor</li>
</ul>
<table>
<thead>
<tr>
<th align="center">登录Harbor</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130220028840" src="../../../img/kubernetes/kubernetes_devops/image-20211130220028840.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>首页信息</li>
</ul>
<table>
<thead>
<tr>
<th align="center">首页信息</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211130220111602" src="../../../img/kubernetes/kubernetes_devops/image-20211130220111602.png" /></td>
</tr>
</tbody>
</table>
<h4 id="83_harbor">8.3 Harbor使用方式<a class="headerlink" href="#83_harbor" title="Permanent link">&para;</a></h4>
<p>Harbor作为镜像仓库，主要的交互方式就是将镜像上传到Harbor上，以及从Harbor上下载指定镜像</p>
<p>在传输镜像前，可以先使用Harbor提供的权限管理，将项目设置为私有项目，并对不同用户设置不同角色，从而更方便管理镜像。</p>
<h5 id="831">8.3.1 添加用户构建项目<a class="headerlink" href="#831" title="Permanent link">&para;</a></h5>
<ul>
<li>创建用户</li>
</ul>
<table>
<thead>
<tr>
<th align="center">创建用户</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211201213427157" src="../../../img/kubernetes/kubernetes_devops/image-20211201213427157.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>构建项目（设置为私有）</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建项目</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211201213751780" src="../../../img/kubernetes/kubernetes_devops/image-20211201213751780.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>给项目追加用户</li>
</ul>
<table>
<thead>
<tr>
<th align="center">追加用户管理</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211201213832458" src="../../../img/kubernetes/kubernetes_devops/image-20211201213832458.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>切换测试用户</li>
</ul>
<table>
<thead>
<tr>
<th align="center">切换测试用户</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211201214008303" src="../../../img/kubernetes/kubernetes_devops/image-20211201214008303.png" /></td>
</tr>
</tbody>
</table>
<h5 id="832_harbor">8.3.2 发布镜像到Harbor<a class="headerlink" href="#832_harbor" title="Permanent link">&para;</a></h5>
<ul>
<li>修改镜像名称</li>
</ul>
<p>名称要求：<a href="">harbor地址/项目名/镜像名:版本</a></p>
<table>
<thead>
<tr>
<th>修改镜像名称</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="image-20211201221040200" src="../../../img/kubernetes/kubernetes_devops/image-20211201221040200.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>修改daemon.json，支持Docker仓库，并重启Docker</li>
</ul>
<table>
<thead>
<tr>
<th align="center">修改daemon.json，支持Docker仓库</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211201215931237" src="../../../img/kubernetes/kubernetes_devops/image-20211201215931237.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>设置登录仓库信息</li>
</ul>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>login<span class="w"> </span>-u<span class="w"> </span>用户名<span class="w"> </span>-p<span class="w"> </span>密码<span class="w"> </span>Harbor地址
</code></pre></div>
<ul>
<li>推送镜像到Harbor</li>
</ul>
<table>
<thead>
<tr>
<th align="center">推送镜像到Harbor</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211201221225196" src="../../../img/kubernetes/kubernetes_devops/image-20211201221225196.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211201221300055" src="../../../img/kubernetes/kubernetes_devops/image-20211201221300055.png" /></td>
</tr>
</tbody>
</table>
<h5 id="833_harborls">8.3.3 从Harbor拉取镜像ls<a class="headerlink" href="#833_harborls" title="Permanent link">&para;</a></h5>
<p>跟传统方式一样，不过需要先配置<a href="">/etc/docker/daemon.json</a>文件</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;registry-mirrors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://pee6w651.mirror.aliyuncs.com&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;insecure-registries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;192.168.11.11:80&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">拉取镜像</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211201222450091" src="../../../img/kubernetes/kubernetes_devops/image-20211201222450091.png" /></td>
</tr>
</tbody>
</table>
<h5 id="834_jenkinsdocker">8.3.4 Jenkins容器使用宿主机Docker<a class="headerlink" href="#834_jenkinsdocker" title="Permanent link">&para;</a></h5>
<p>构建镜像和发布镜像到harbor都需要使用到docker命令。而在Jenkins容器内部安装Docker官方推荐直接采用宿主机带的Docker即可。</p>
<p>设置Jenkins容器使用宿主机Docker</p>
<ul>
<li>设置宿主机docker.sock权限：</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>chown<span class="w"> </span>root:root<span class="w"> </span>/var/run/docker.sock
sudo<span class="w"> </span>chmod<span class="w"> </span>o+rw<span class="w"> </span>/var/run/docker.sock
</code></pre></div>
<ul>
<li>添加数据卷</li>
</ul>
<div class="highlight"><pre><span></span><code>version: &quot;3.1&quot;
services:
  jenkins:
    image: jenkins/jenkins
    container_name: jenkins
    ports:
      - 8080:8080
      - 50000:50000
    volumes:
      - ./data/:/var/jenkins_home/
      - /usr/bin/docker:/usr/bin/docker
      - /var/run/docker.sock:/var/run/docker.sock
      - /etc/docker/daemon.json:/etc/docker/daemon.json
</code></pre></div>
<h5 id="835">8.3.5 添加构建操作<a class="headerlink" href="#835" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th align="center">制作自定义镜像</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211229155834500" src="../../../img/kubernetes/kubernetes_devops/image-20211229155834500.png" /></td>
</tr>
</tbody>
</table>
<h5 id="836">8.3.6 编写部署脚本<a class="headerlink" href="#836" title="Permanent link">&para;</a></h5>
<p>部署项目需要通过Publish Over SSH插件，让目标服务器执行命令。为了方便一次性实现拉取镜像和启动的命令，推荐采用脚本文件的方式。</p>
<p>添加脚本文件到目标服务器，再通过Publish Over SSH插件让目标服务器执行脚本即可。</p>
<ul>
<li>编写脚本文件，添加到目标服务器</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nv">harbor_url</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">harbor_project_name</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">project_name</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">tag</span><span class="o">=</span><span class="nv">$4</span>
<span class="nv">port</span><span class="o">=</span><span class="nv">$5</span>

<span class="nv">imageName</span><span class="o">=</span><span class="nv">$harbor_url</span>/<span class="nv">$harbor_project_name</span>/<span class="nv">$project_name</span>:<span class="nv">$tag</span>

<span class="nv">containerId</span><span class="o">=</span><span class="sb">`</span>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="si">${</span><span class="nv">project_name</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$containerId</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>docker<span class="w"> </span>stop<span class="w"> </span><span class="nv">$containerId</span>
<span class="w">    </span>docker<span class="w"> </span>rm<span class="w"> </span><span class="nv">$containerId</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Delete Container Success&quot;</span>
<span class="k">fi</span>

<span class="nv">imageId</span><span class="o">=</span><span class="sb">`</span>docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="si">${</span><span class="nv">project_name</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="sb">`</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$imageId</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>docker<span class="w"> </span>rmi<span class="w"> </span>-f<span class="w"> </span><span class="nv">$imageId</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Delete Image Success&quot;</span>
<span class="k">fi</span>

docker<span class="w"> </span>login<span class="w"> </span>-u<span class="w"> </span>DevOps<span class="w"> </span>-p<span class="w"> </span>P@ssw0rd<span class="w"> </span><span class="nv">$harbor_url</span>

docker<span class="w"> </span>pull<span class="w"> </span><span class="nv">$imageName</span>

docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="nv">$port</span>:<span class="nv">$port</span><span class="w"> </span>--name<span class="w"> </span><span class="nv">$project_name</span><span class="w"> </span><span class="nv">$imageName</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Start Container Success&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$project_name</span>
</code></pre></div>
<p>并设置权限为可执行</p>
<div class="highlight"><pre><span></span><code>chmod a+x deploy.sh
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">如图</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211203192047357" src="../../../img/kubernetes/kubernetes_devops/image-20211203192047357.png" /></td>
</tr>
</tbody>
</table>
<h5 id="837">8.3.7 配置构建后操作<a class="headerlink" href="#837" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th align="center">执行脚本文件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211229155949038" src="../../../img/kubernetes/kubernetes_devops/image-20211229155949038.png" /></td>
</tr>
</tbody>
</table>
<h3 id="jenkins">九、Jenkins流水线<a class="headerlink" href="#jenkins" title="Permanent link">&para;</a></h3>
<h4 id="91_jenkins">9.1 Jenkins流水线任务介绍<a class="headerlink" href="#91_jenkins" title="Permanent link">&para;</a></h4>
<p>之前采用Jenkins的自由风格构建的项目，每个步骤流程都要通过不同的方式设置，并且构建过程中整体流程是不可见的，无法确认每个流程花费的时间，并且问题不方便定位问题。</p>
<p>Jenkins的Pipeline可以让项目的发布整体流程可视化，明确执行的阶段，可以快速的定位问题。并且整个项目的生命周期可以通过一个Jenkinsfile文件管理，而且Jenkinsfile文件是可以放在项目中维护。</p>
<p>所以Pipeline相对自由风格或者其他的项目风格更容易操作。</p>
<h4 id="92_jenkins">9.2 Jenkins流水线任务<a class="headerlink" href="#92_jenkins" title="Permanent link">&para;</a></h4>
<h5 id="921_jenkins">9.2.1 构建Jenkins流水线任务<a class="headerlink" href="#921_jenkins" title="Permanent link">&para;</a></h5>
<ul>
<li>构建任务</li>
</ul>
<table>
<thead>
<tr>
<th>构建Jenkins流水线任务</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="image-20211202144429302" src="../../../img/kubernetes/kubernetes_devops/image-20211202144429302.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>生成Groovy脚本</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Hello World脚本生成</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202144531749" src="../../../img/kubernetes/kubernetes_devops/image-20211202144531749.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>构建后查看视图</li>
</ul>
<table>
<thead>
<tr>
<th align="center">构建后查看视图</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202144616117" src="../../../img/kubernetes/kubernetes_devops/image-20211202144616117.png" /></td>
</tr>
</tbody>
</table>
<h5 id="922_groovy">9.2.2 Groovy脚本<a class="headerlink" href="#922_groovy" title="Permanent link">&para;</a></h5>
<ul>
<li>Groovy脚本基础语法</li>
</ul>
<div class="highlight"><pre><span></span><code>//<span class="w"> </span>所有脚本命令包含在pipeline<span class="o">{}</span>中
pipeline<span class="w"> </span><span class="o">{</span><span class="w">  </span>
<span class="w">  </span>//<span class="w"> </span>指定任务在哪个节点执行（Jenkins支持分布式）
<span class="w">    </span>agent<span class="w"> </span>any

<span class="w">    </span>//<span class="w"> </span>配置全局环境，指定变量名<span class="o">=</span>变量值信息
<span class="w">    </span>environment<span class="o">{</span>
<span class="w">      </span><span class="nv">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;192.168.11.11&#39;</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>//<span class="w"> </span>存放所有任务的合集
<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>
<span class="w">      </span>//<span class="w"> </span>单个任务
<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;任务1&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">          </span>//<span class="w"> </span>实现任务的具体流程
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;do something&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">      </span>//<span class="w"> </span>单个任务
<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;任务2&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">          </span>//<span class="w"> </span>实现任务的具体流程
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;do something&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span>//<span class="w"> </span>……
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li>编写例子测试</li>
</ul>
<div class="highlight"><pre><span></span><code>pipeline<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>agent<span class="w"> </span>any

<span class="w">    </span>//<span class="w"> </span>存放所有任务的合集
<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;拉取Git代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;拉取Git代码&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;检测代码质量&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;检测代码质量&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;构建代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;构建代码&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;制作自定义镜像并发布Harbor&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;制作自定义镜像并发布Harbor&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;基于Harbor部署工程&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;基于Harbor部署工程&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">配置Grovvy脚本</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202145155428" src="../../../img/kubernetes/kubernetes_devops/image-20211202145155428.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>查看效果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">查看效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202145240166" src="../../../img/kubernetes/kubernetes_devops/image-20211202145240166.png" /></td>
</tr>
</tbody>
</table>
<p><a href="">Ps：涉及到特定脚本，Jenkins给予了充足的提示，可以自动生成命令</a></p>
<table>
<thead>
<tr>
<th align="center">生成命令位置</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202145349043" src="../../../img/kubernetes/kubernetes_devops/image-20211202145349043.png" /></td>
</tr>
</tbody>
</table>
<h5 id="923_jenkinsfile">9.2.3 Jenkinsfile实现<a class="headerlink" href="#923_jenkinsfile" title="Permanent link">&para;</a></h5>
<p>Jenkinsfile方式需要将脚本内容编写到项目中的Jenkinsfile文件中，每次构建会自动拉取项目并且获取项目中Jenkinsfile文件对项目进行构建</p>
<ul>
<li>配置pipeline</li>
</ul>
<table>
<thead>
<tr>
<th align="center">配置pipeline</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202151127254" src="../../../img/kubernetes/kubernetes_devops/image-20211202151127254.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>准备Jenkinsfile</li>
</ul>
<table>
<thead>
<tr>
<th align="center">准备Jenkinsfile文件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202151155145" src="../../../img/kubernetes/kubernetes_devops/image-20211202151155145.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>测试效果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">测试效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202151225161" src="../../../img/kubernetes/kubernetes_devops/image-20211202151225161.png" /></td>
</tr>
</tbody>
</table>
<h4 id="93_jenkins">9.3 Jenkins流水线任务实现<a class="headerlink" href="#93_jenkins" title="Permanent link">&para;</a></h4>
<h5 id="931">9.3.1 参数化构建<a class="headerlink" href="#931" title="Permanent link">&para;</a></h5>
<p>添加参数化构建，方便选择不的项目版本</p>
<table>
<thead>
<tr>
<th align="center">Git参数化构建</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202191944277" src="../../../img/kubernetes/kubernetes_devops/image-20211202191944277.png" /></td>
</tr>
</tbody>
</table>
<h5 id="932_git">9.3.2 拉取Git代码<a class="headerlink" href="#932_git" title="Permanent link">&para;</a></h5>
<p>通过流水线语法生成Checkout代码的脚本</p>
<table>
<thead>
<tr>
<th align="center">语法生成</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211202192047619" src="../../../img/kubernetes/kubernetes_devops/image-20211202192047619.png" /></td>
</tr>
</tbody>
</table>
<p><img alt="image-20211202192129895" src="../../../img/kubernetes/kubernetes_devops/image-20211202192129895.png" />将*/master更改为标签<a href="">${tag}</a></p>
<div class="highlight"><pre><span></span><code>pipeline<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>agent<span class="w"> </span>any
<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;拉取Git代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>checkout<span class="o">([</span><span class="nv">$class</span>:<span class="w"> </span><span class="s1">&#39;GitSCM&#39;</span>,<span class="w"> </span>branches:<span class="w"> </span><span class="o">[[</span>name:<span class="w"> </span><span class="s1">&#39;${tag}&#39;</span><span class="o">]]</span>,<span class="w"> </span>extensions:<span class="w"> </span><span class="o">[]</span>,<span class="w"> </span>userRemoteConfigs:<span class="w"> </span><span class="o">[[</span>url:<span class="w"> </span><span class="s1">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="o">]]])</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h5 id="933">9.3.3 构建代码<a class="headerlink" href="#933" title="Permanent link">&para;</a></h5>
<p>通过脚本执行mvn的构建命令</p>
<div class="highlight"><pre><span></span><code>pipeline<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>agent<span class="w"> </span>any

<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;拉取Git代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>checkout<span class="o">([</span><span class="nv">$class</span>:<span class="w"> </span><span class="s1">&#39;GitSCM&#39;</span>,<span class="w"> </span>branches:<span class="w"> </span><span class="o">[[</span>name:<span class="w"> </span><span class="s1">&#39;${tag}&#39;</span><span class="o">]]</span>,<span class="w"> </span>extensions:<span class="w"> </span><span class="o">[]</span>,<span class="w"> </span>userRemoteConfigs:<span class="w"> </span><span class="o">[[</span>url:<span class="w"> </span><span class="s1">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="o">]]])</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;构建代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h5 id="934">9.3.4 代码质量检测<a class="headerlink" href="#934" title="Permanent link">&para;</a></h5>
<p>通过脚本执行sonar-scanner命令即可</p>
<div class="highlight"><pre><span></span><code>pipeline<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>agent<span class="w"> </span>any

<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;拉取Git代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>checkout<span class="o">([</span><span class="nv">$class</span>:<span class="w"> </span><span class="s1">&#39;GitSCM&#39;</span>,<span class="w"> </span>branches:<span class="w"> </span><span class="o">[[</span>name:<span class="w"> </span><span class="s1">&#39;${tag}&#39;</span><span class="o">]]</span>,<span class="w"> </span>extensions:<span class="w"> </span><span class="o">[]</span>,<span class="w"> </span>userRemoteConfigs:<span class="w"> </span><span class="o">[[</span>url:<span class="w"> </span><span class="s1">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="o">]]])</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;构建代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;检测代码质量&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#39;</span><span class="w"> </span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h5 id="935">9.3.5 制作自定义镜像并发布<a class="headerlink" href="#935" title="Permanent link">&para;</a></h5>
<ul>
<li>生成自定义镜像脚本</li>
</ul>
<div class="highlight"><pre><span></span><code>pipeline<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>agent<span class="w"> </span>any
<span class="w">    </span>environment<span class="o">{</span>
<span class="w">        </span><span class="nv">harborHost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;192.168.11.11:80&#39;</span>
<span class="w">        </span><span class="nv">harborRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;repository&#39;</span>
<span class="w">        </span><span class="nv">harborUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;DevOps&#39;</span>
<span class="w">        </span><span class="nv">harborPasswd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P@ssw0rd&#39;</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>//<span class="w"> </span>存放所有任务的合集
<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;拉取Git代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>checkout<span class="o">([</span><span class="nv">$class</span>:<span class="w"> </span><span class="s1">&#39;GitSCM&#39;</span>,<span class="w"> </span>branches:<span class="w"> </span><span class="o">[[</span>name:<span class="w"> </span><span class="s1">&#39;${tag}&#39;</span><span class="o">]]</span>,<span class="w"> </span>extensions:<span class="w"> </span><span class="o">[]</span>,<span class="w"> </span>userRemoteConfigs:<span class="w"> </span><span class="o">[[</span>url:<span class="w"> </span><span class="s1">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="o">]]])</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;构建代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;检测代码质量&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#39;</span><span class="w"> </span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;制作自定义镜像并发布Harbor&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;&#39;&#39;cp ./target/*.jar ./docker/</span>
<span class="s1">                cd ./docker</span>
<span class="s1">                docker build -t ${JOB_NAME}:${tag} ./&#39;&#39;&#39;</span>

<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;&#39;&#39;docker login -u ${harborUser} -p ${harborPasswd} ${harborHost}</span>
<span class="s1">                docker tag ${JOB_NAME}:${tag} ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}</span>
<span class="s1">                docker push ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}&#39;&#39;&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li>生成Publish Over SSH脚本</li>
</ul>
<div class="highlight"><pre><span></span><code>pipeline<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>agent<span class="w"> </span>any
<span class="w">    </span>environment<span class="o">{</span>
<span class="w">        </span><span class="nv">harborHost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;192.168.11.11:80&#39;</span>
<span class="w">        </span><span class="nv">harborRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;repository&#39;</span>
<span class="w">        </span><span class="nv">harborUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;DevOps&#39;</span>
<span class="w">        </span><span class="nv">harborPasswd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P@ssw0rd&#39;</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>//<span class="w"> </span>存放所有任务的合集
<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;拉取Git代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>checkout<span class="o">([</span><span class="nv">$class</span>:<span class="w"> </span><span class="s1">&#39;GitSCM&#39;</span>,<span class="w"> </span>branches:<span class="w"> </span><span class="o">[[</span>name:<span class="w"> </span><span class="s1">&#39;${tag}&#39;</span><span class="o">]]</span>,<span class="w"> </span>extensions:<span class="w"> </span><span class="o">[]</span>,<span class="w"> </span>userRemoteConfigs:<span class="w"> </span><span class="o">[[</span>url:<span class="w"> </span><span class="s1">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="o">]]])</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;构建代码&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>docker

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;检测代码质量&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=7d66af4b39cfe4f52ac0a915d4c9d5c513207098&#39;</span><span class="w"> </span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;制作自定义镜像并发布Harbor&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;&#39;&#39;cp ./target/*.jar ./docker/</span>
<span class="s1">                cd ./docker</span>
<span class="s1">                docker build -t ${JOB_NAME}:${tag} ./&#39;&#39;&#39;</span>

<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;&#39;&#39;docker login -u ${harborUser} -p ${harborPasswd} ${harborHost}</span>
<span class="s1">                docker tag ${JOB_NAME}:${tag} ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}</span>
<span class="s1">                docker push ${harborHost}/${harborRepo}/${JOB_NAME}:${tag}&#39;&#39;&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;目标服务器拉取镜像并运行&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sshPublisher<span class="o">(</span>publishers:<span class="w"> </span><span class="o">[</span>sshPublisherDesc<span class="o">(</span>configName:<span class="w"> </span><span class="s1">&#39;testEnvironment&#39;</span>,<span class="w"> </span>transfers:<span class="w"> </span><span class="o">[</span>sshTransfer<span class="o">(</span>cleanRemote:<span class="w"> </span>false,<span class="w"> </span>excludes:<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span>execCommand:<span class="w"> </span><span class="s2">&quot;/usr/bin/deploy.sh </span><span class="nv">$harborHost</span><span class="s2"> </span><span class="nv">$harborRepo</span><span class="s2"> </span><span class="nv">$JOB_NAME</span><span class="s2"> </span><span class="nv">$tag</span><span class="s2"> </span><span class="nv">$port</span><span class="s2"> &quot;</span>,<span class="w"> </span>execTimeout:<span class="w"> </span><span class="m">120000</span>,<span class="w"> </span>flatten:<span class="w"> </span>false,<span class="w"> </span>makeEmptyDirs:<span class="w"> </span>false,<span class="w"> </span>noDefaultExcludes:<span class="w"> </span>false,<span class="w"> </span>patternSeparator:<span class="w"> </span><span class="s1">&#39;[, ]+&#39;</span>,<span class="w"> </span>remoteDirectory:<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span>remoteDirectorySDF:<span class="w"> </span>false,<span class="w"> </span>removePrefix:<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span>sourceFiles:<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">)]</span>,<span class="w"> </span>usePromotionTimestamp:<span class="w"> </span>false,<span class="w"> </span>useWorkspaceInPromotion:<span class="w"> </span>false,<span class="w"> </span>verbose:<span class="w"> </span><span class="nb">false</span><span class="o">)])</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p><a href="">Ps：由于采用变量，记得使用双引号</a></p>
<h4 id="94_jenkins">9.4 Jenkins流水线整合钉钉<a class="headerlink" href="#94_jenkins" title="Permanent link">&para;</a></h4>
<p>在程序部署成功后，可以通过钉钉的机器人及时向群众发送部署的最终结果通知</p>
<ul>
<li>安装插件</li>
</ul>
<table>
<thead>
<tr>
<th align="center">安装插件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211209151549412" src="../../../img/kubernetes/kubernetes_devops/image-20211209151549412.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>钉钉内部创建群组并构建机器人</li>
</ul>
<table>
<thead>
<tr>
<th align="center">钉钉内部创建群组并构建机器人</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211209152217433" src="../../../img/kubernetes/kubernetes_devops/image-20211209152217433.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211209152252050" src="../../../img/kubernetes/kubernetes_devops/image-20211209152252050.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20211209152403312" src="../../../img/kubernetes/kubernetes_devops/image-20211209152403312.png" /></td>
</tr>
</tbody>
</table>
<p>最终或获取到Webhook信息</p>
<div class="highlight"><pre><span></span><code>https://oapi.dingtalk.com/robot/send?access_token=kej4ehkj34gjhg34jh5bh5jb34hj53b4
</code></pre></div>
<ul>
<li>系统配置添加钉钉通知</li>
</ul>
<table>
<thead>
<tr>
<th align="center">配置钉钉通知</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211209162923440" src="../../../img/kubernetes/kubernetes_devops/image-20211209162923440.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>任务中追加流水线配置</li>
</ul>
<div class="highlight"><pre><span></span><code>pipeline<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>agent<span class="w"> </span>any

<span class="w">    </span>environment<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="nv">sonarLogin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2bab7bf7d5af25e2c2ca2f178af2c3c55c64d5d8&#39;</span>
<span class="w">        </span><span class="nv">harborUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span>
<span class="w">        </span><span class="nv">harborPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Harbor12345&#39;</span>
<span class="w">        </span><span class="nv">harborHost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;192.168.11.12:8888&#39;</span>
<span class="w">        </span><span class="nv">harborRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;repository&#39;</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>stages<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;拉取Git代码&#39;</span><span class="o">){</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>checkout<span class="o">([</span><span class="nv">$class</span>:<span class="w"> </span><span class="s1">&#39;GitSCM&#39;</span>,<span class="w"> </span>branches:<span class="w"> </span><span class="o">[[</span>name:<span class="w"> </span><span class="s1">&#39;$tag&#39;</span><span class="o">]]</span>,<span class="w"> </span>extensions:<span class="w"> </span><span class="o">[]</span>,<span class="w"> </span>userRemoteConfigs:<span class="w"> </span><span class="o">[[</span>url:<span class="w"> </span><span class="s1">&#39;http://49.233.115.171:8929/root/lsx.git&#39;</span><span class="o">]]])</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;Maven构建代码&#39;</span><span class="o">){</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;SonarQube检测代码&#39;</span><span class="o">){</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=${sonarLogin}&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;制作自定义镜像&#39;</span><span class="o">){</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;&#39;&#39;cd docker</span>
<span class="s1">                mv ../target/*.jar ./</span>
<span class="s1">                docker build -t ${JOB_NAME}:$tag .</span>
<span class="s1">                &#39;&#39;&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;推送自定义镜像&#39;</span><span class="o">){</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sh<span class="w"> </span><span class="s1">&#39;&#39;&#39;docker login -u ${harborUser} -p ${harborPassword} ${harborHost}</span>
<span class="s1">                docker tag ${JOB_NAME}:$tag ${harborHost}/${harborRepo}/${JOB_NAME}:$tag</span>
<span class="s1">                docker push ${harborHost}/${harborRepo}/${JOB_NAME}:$tag&#39;&#39;&#39;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>stage<span class="o">(</span><span class="s1">&#39;通知目标服务器&#39;</span><span class="o">){</span>
<span class="w">            </span>steps<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>sshPublisher<span class="o">(</span>publishers:<span class="w"> </span><span class="o">[</span>sshPublisherDesc<span class="o">(</span>configName:<span class="w"> </span><span class="s1">&#39;centos-docker&#39;</span>,<span class="w"> </span>transfers:<span class="w"> </span><span class="o">[</span>sshTransfer<span class="o">(</span>cleanRemote:<span class="w"> </span>false,<span class="w"> </span>excludes:<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span>execCommand:<span class="w"> </span><span class="s2">&quot;/usr/bin/deploy.sh </span><span class="nv">$harborHost</span><span class="s2"> </span><span class="nv">$harborRepo</span><span class="s2"> </span><span class="nv">$JOB_NAME</span><span class="s2"> </span><span class="nv">$tag</span><span class="s2"> </span><span class="nv">$port</span><span class="s2">&quot;</span>,<span class="w"> </span>execTimeout:<span class="w"> </span><span class="m">120000</span>,<span class="w"> </span>flatten:<span class="w"> </span>false,<span class="w"> </span>makeEmptyDirs:<span class="w"> </span>false,<span class="w"> </span>noDefaultExcludes:<span class="w"> </span>false,<span class="w"> </span>patternSeparator:<span class="w"> </span><span class="s1">&#39;[, ]+&#39;</span>,<span class="w"> </span>remoteDirectory:<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span>remoteDirectorySDF:<span class="w"> </span>false,<span class="w"> </span>removePrefix:<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span>sourceFiles:<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">)]</span>,<span class="w"> </span>usePromotionTimestamp:<span class="w"> </span>false,<span class="w"> </span>useWorkspaceInPromotion:<span class="w"> </span>false,<span class="w"> </span>verbose:<span class="w"> </span><span class="nb">false</span><span class="o">)])</span>
<span class="w">            </span><span class="o">}</span><span class="w">  </span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span>post<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>success<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>dingtalk<span class="w"> </span><span class="o">(</span>
<span class="w">                </span>robot:<span class="w"> </span><span class="s1">&#39;Jenkins-DingDing&#39;</span>,
<span class="w">                </span>type:<span class="s1">&#39;MARKDOWN&#39;</span>,
<span class="w">                </span>title:<span class="w"> </span><span class="s2">&quot;success: </span><span class="si">${</span><span class="nv">JOB_NAME</span><span class="si">}</span><span class="s2">&quot;</span>,
<span class="w">                </span>text:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;- 成功构建:</span><span class="si">${</span><span class="nv">JOB_NAME</span><span class="si">}</span><span class="s2">项目!\n- 版本:</span><span class="si">${</span><span class="nv">tag</span><span class="si">}</span><span class="s2">\n- 持续时间:</span><span class="si">${</span><span class="nv">currentBuild</span><span class="p">.durationString</span><span class="si">}</span><span class="s2">\n- 任务:#</span><span class="si">${</span><span class="nv">JOB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">]</span>
<span class="w">            </span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span>failure<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>dingtalk<span class="w"> </span><span class="o">(</span>
<span class="w">                </span>robot:<span class="w"> </span><span class="s1">&#39;Jenkins-DingDing&#39;</span>,
<span class="w">                </span>type:<span class="s1">&#39;MARKDOWN&#39;</span>,
<span class="w">                </span>title:<span class="w"> </span><span class="s2">&quot;fail: </span><span class="si">${</span><span class="nv">JOB_NAME</span><span class="si">}</span><span class="s2">&quot;</span>,
<span class="w">                </span>text:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;- 失败构建:</span><span class="si">${</span><span class="nv">JOB_NAME</span><span class="si">}</span><span class="s2">项目!\n- 版本:</span><span class="si">${</span><span class="nv">tag</span><span class="si">}</span><span class="s2">\n- 持续时间:</span><span class="si">${</span><span class="nv">currentBuild</span><span class="p">.durationString</span><span class="si">}</span><span class="s2">\n- 任务:#</span><span class="si">${</span><span class="nv">JOB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">]</span>
<span class="w">            </span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li>查看效果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">钉钉通知效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211209163021396" src="../../../img/kubernetes/kubernetes_devops/image-20211209163021396.png" /></td>
</tr>
</tbody>
</table>
<h3 id="kubernetes">十、Kubernetes编排工具<a class="headerlink" href="#kubernetes" title="Permanent link">&para;</a></h3>
<h4 id="101_kubernetes">10.1 Kubernetes介绍<a class="headerlink" href="#101_kubernetes" title="Permanent link">&para;</a></h4>
<p>Kubernetes是一个开源的，用于管理云平台中多个主机上的容器化的应用，Kubernetes的目标是让部署容器化的应用简单并且高效（powerful），Kubernetes提供了应用部署，规划，更新，维护的一种机制。</p>
<p>Kubernetes一个核心的特点就是能够自主的管理容器来保证云平台中的容器按照用户的期望状态运行着，管理员可以加载一个微型服务，让规划器来找到合适的位置，同时，Kubernetes也系统提升工具以及人性化方面，让用户能够方便的部署自己的应用。</p>
<p>Kubernetes主要能帮助我们完成：</p>
<ul>
<li>服务发现和负载均衡</li>
</ul>
<p>Kubernetes 可以使用 DNS 名称或自己的 IP 地址公开容器，如果进入容器的流量很大， Kubernetes 可以负载均衡并分配网络流量，从而使部署稳定。</p>
<ul>
<li>存储编排</li>
</ul>
<p>Kubernetes 允许你自动挂载你选择的存储系统，比如本地存储，类似Docker的数据卷。</p>
<ul>
<li>自动部署和回滚</li>
</ul>
<p>你可以使用 Kubernetes 描述已部署容器的所需状态，它可以以受控的速率将实际状态 更改为期望状态。Kubernetes 会自动帮你根据情况部署创建新容器，并删除现有容器给新容器提供资源。</p>
<ul>
<li>自动完成装箱计算</li>
</ul>
<p>Kubernetes 允许你设置每个容器的资源，比如CPU和内存。</p>
<ul>
<li>自我修复</li>
</ul>
<p>Kubernetes 重新启动失败的容器、替换容器、杀死不响应用户定义的容器，并运行状况检查的容器。</p>
<ul>
<li>秘钥与配置管理</li>
</ul>
<p>Kubernetes 允许你存储和管理敏感信息，例如密码、OAuth 令牌和 ssh 密钥。你可以在不重建容器镜像的情况下部署和更新密钥和应用程序配置，也无需在堆栈配置中暴露密钥。</p>
<h4 id="102_kubernetes">10.2 Kubernetes架构<a class="headerlink" href="#102_kubernetes" title="Permanent link">&para;</a></h4>
<p>Kubernetes 搭建需要至少两个节点，一个Master负责管理，一个Slave搭建在工作服务器上负责分配。</p>
<table>
<thead>
<tr>
<th align="center">kubernetes架构</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211210114507638" src="../../../img/kubernetes/kubernetes_devops/image-20211210114507638.png" /></td>
</tr>
</tbody>
</table>
<p>从图中可以看到各个组件的基本功能：</p>
<ul>
<li>API Server：作为K8s通讯的核心组件，K8s内部交互以及接收发送指令的组件。</li>
<li>controller-manager：作为K8s的核心组件，主要做资源调度，根据集群情况分配资源</li>
<li>etcd：一个key-value的数据库，存储存储集群的状态信息</li>
<li>scheduler：负责调度每个工作节点</li>
<li>cloud-controller-manager：负责调度其他云服务产品</li>
<li>kubelet：管理Pods上面的容器。</li>
<li>kube-proxy：负责处理其他Slave或客户端的请求。</li>
<li>Pod：可以理解为就是运行的容器</li>
</ul>
<h4 id="103_kubernetes">10.3 Kubernetes安装<a class="headerlink" href="#103_kubernetes" title="Permanent link">&para;</a></h4>
<p>这里会采用https://kuboard.cn/提供的方式安装K8s，安装单Master节点</p>
<ul>
<li>要求使用Centos7.8版本：<a href="https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso">https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso</a></li>
<li>至少2台 <strong>2核4G</strong> 的服务器</li>
</ul>
<p>安装流程</p>
<table>
<thead>
<tr>
<th align="center">安装流程</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211210190653687" src="../../../img/kubernetes/kubernetes_devops/image-20211210190653687.png" /></td>
</tr>
</tbody>
</table>
<p>准备好服务器后开始安装</p>
<ul>
<li>重新设置hostname，不允许为localhost</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 修改 hostname，名字不允许使用下划线、小数点、大写字母，不能叫master</span>
hostnamectl<span class="w"> </span>set-hostname<span class="w"> </span>your-new-host-name
<span class="c1"># 查看修改结果</span>
hostnamectl<span class="w"> </span>status
<span class="c1"># 设置 hostname 解析</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;127.0.0.1   </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/hosts
</code></pre></div>
<ul>
<li>
<p>要求2台服务之间可以相互通讯</p>
</li>
<li>
<p>安装软件</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 阿里云 docker hub 镜像</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">REGISTRY_MIRROR</span><span class="o">=</span>https://registry.cn-hangzhou.aliyuncs.com
curl<span class="w"> </span>-sSL<span class="w"> </span>https://kuboard.cn/install-script/v1.19.x/install_kubelet.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>.19.5
</code></pre></div>
<p>首先初始化Master节点</p>
<blockquote>
<p>关于初始化时用到的环境变量</p>
<ul>
<li><strong>APISERVER_NAME</strong> 不能是 master 的 hostname</li>
<li><strong>APISERVER_NAME</strong> 必须全为小写字母、数字、小数点，不能包含减号</li>
<li><strong>POD_SUBNET</strong> 所使用的网段不能与 <strong><em>master节点/worker节点</em></strong> 所在的网段重叠。该字段的取值为一个 <a href="https://kuboard.cn/glossary/cidr.html">CIDR</a> 值，如果您对 CIDR 这个概念还不熟悉，请仍然执行 export POD_SUBNET=10.100.0.0/16 命令，不做修改</li>
</ul>
</blockquote>
<ul>
<li>设置ip，域名，网段并执行初始化操作</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 只在 master 节点执行</span>
<span class="c1"># 替换 x.x.x.x 为 master 节点实际 IP（请使用内网 IP）</span>
<span class="c1"># export 命令只在当前 shell 会话中有效，开启新的 shell 窗口后，如果要继续安装过程，请重新执行此处的 export 命令</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MASTER_IP</span><span class="o">=</span><span class="m">192</span>.168.11.32
<span class="c1"># 替换 apiserver.demo 为 您想要的 dnsName</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">APISERVER_NAME</span><span class="o">=</span>apiserver.demo
<span class="c1"># Kubernetes 容器组所在的网段，该网段安装完成后，由 kubernetes 创建，事先并不存在于您的物理网络中</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">POD_SUBNET</span><span class="o">=</span><span class="m">10</span>.100.0.1/16
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MASTER_IP</span><span class="si">}</span><span class="s2">    </span><span class="si">${</span><span class="nv">APISERVER_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/hosts
curl<span class="w"> </span>-sSL<span class="w"> </span>https://kuboard.cn/install-script/v1.19.x/init_master.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span><span class="m">1</span>.19.5
</code></pre></div>
<ul>
<li>检查Master启动状态</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 只在 master 节点执行</span>

<span class="c1"># 执行如下命令，等待 3-10 分钟，直到所有的容器组处于 Running 状态</span>
watch<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>-o<span class="w"> </span>wide

<span class="c1"># 查看 master 节点初始化结果</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<p><code>Ps：如果出现NotReady的情况执行（最新版本的BUG，1.19一般没有）</code></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>quay.io/coreos/flannel:v0.10.0-amd64<span class="w"> </span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/cni/net.d/
cat<span class="w"> </span><span class="s">&lt;&lt;EOF&gt; /etc/cni/net.d/10-flannel.conf</span>
<span class="s">{&quot;name&quot;:&quot;cbr0&quot;,&quot;type&quot;:&quot;flannel&quot;,&quot;delegate&quot;: {&quot;isDefaultGateway&quot;: true}}</span>
<span class="s">EOF</span>
mkdir<span class="w"> </span>/usr/share/oci-umount/oci-umount.d<span class="w"> </span>-p
mkdir<span class="w"> </span>/run/flannel/
cat<span class="w"> </span><span class="s">&lt;&lt;EOF&gt; /run/flannel/subnet.env</span>
<span class="s">FLANNEL_NETWORK=172.100.0.0/16</span>
<span class="s">FLANNEL_SUBNET=172.100.1.0/24</span>
<span class="s">FLANNEL_MTU=1450</span>
<span class="s">FLANNEL_IPMASQ=true</span>
<span class="s">EOF</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml
</code></pre></div>
<p>安装网络服务插件</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">POD_SUBNET</span><span class="o">=</span><span class="m">10</span>.100.0.0/16
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://kuboard.cn/install-script/v1.22.x/calico-operator.yaml
wget<span class="w"> </span>https://kuboard.cn/install-script/v1.22.x/calico-custom-resources.yaml
sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s#192.168.0.0/16#</span><span class="si">${</span><span class="nv">POD_SUBNET</span><span class="si">}</span><span class="s2">#&quot;</span><span class="w"> </span>calico-custom-resources.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>calico-custom-resources.yaml
</code></pre></div>
<p>初始化worker节点</p>
<ul>
<li>获取Join命令参数，在Master节点执行</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 只在 master 节点执行</span>
kubeadm<span class="w"> </span>token<span class="w"> </span>create<span class="w"> </span>--print-join-command
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">获取命令</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211213183025291" src="../../../img/kubernetes/kubernetes_devops/image-20211213183025291.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>在worker节点初始化</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 只在 worker 节点执行</span>
<span class="c1"># 替换 x.x.x.x 为 master 节点的内网 IP</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MASTER_IP</span><span class="o">=</span><span class="m">192</span>.168.11.32
<span class="c1"># 替换 apiserver.demo 为初始化 master 节点时所使用的 APISERVER_NAME</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">APISERVER_NAME</span><span class="o">=</span>apiserver.demo
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MASTER_IP</span><span class="si">}</span><span class="s2">    </span><span class="si">${</span><span class="nv">APISERVER_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/hosts

<span class="c1"># 替换为 master 节点上 kubeadm token create 命令的输出</span>
kubeadm<span class="w"> </span>join<span class="w"> </span>apiserver.demo:6443<span class="w"> </span>--token<span class="w"> </span>vwfilu.3nhndohc5gn1jv9k<span class="w">     </span>--discovery-token-ca-cert-hash<span class="w"> </span>sha256:22ff15cabfe87ab48a7db39b3bbf986fee92ec92eb8efc7fe9b0abe2175ff0c2
</code></pre></div>
<p>检查最终运行效果</p>
<ul>
<li>在 master 节点上执行</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 只在 master 节点执行</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<p><code>Ps：如果出现NotReady的情况执行（最新版本的BUG，1.19一般没有）</code></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>pull<span class="w"> </span>quay.io/coreos/flannel:v0.10.0-amd64<span class="w"> </span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/cni/net.d/
cat<span class="w"> </span><span class="s">&lt;&lt;EOF&gt; /etc/cni/net.d/10-flannel.conf</span>
<span class="s">{&quot;name&quot;:&quot;cbr0&quot;,&quot;type&quot;:&quot;flannel&quot;,&quot;delegate&quot;: {&quot;isDefaultGateway&quot;: true}}</span>
<span class="s">EOF</span>
mkdir<span class="w"> </span>/usr/share/oci-umount/oci-umount.d<span class="w"> </span>-p
mkdir<span class="w"> </span>/run/flannel/
cat<span class="w"> </span><span class="s">&lt;&lt;EOF&gt; /run/flannel/subnet.env</span>
<span class="s">FLANNEL_NETWORK=172.100.0.0/16</span>
<span class="s">FLANNEL_SUBNET=172.100.1.0/24</span>
<span class="s">FLANNEL_MTU=1450</span>
<span class="s">FLANNEL_IPMASQ=true</span>
<span class="s">EOF</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml
</code></pre></div>
<ul>
<li>输出结果如下所示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@k8smaster<span class="w"> </span>~<span class="o">]</span><span class="c1"># kubectl get nodes</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">搭建成功效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211210184851810" src="../../../img/kubernetes/kubernetes_devops/image-20211210184851810.png" /></td>
</tr>
</tbody>
</table>
<p>安装Kuboard管理K8s集群</p>
<ul>
<li>安装Kuboard</li>
</ul>
<div class="highlight"><pre><span></span><code>kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml
# 您也可以使用下面的指令，唯一的区别是，该指令使用华为云的镜像仓库替代 docker hub 分发 Kuboard 所需要的镜像
# kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3-swr.yaml
</code></pre></div>
<ul>
<li>查看启动情况</li>
</ul>
<div class="highlight"><pre><span></span><code>watch kubectl get pods -n kuboard
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">查看效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211213184701784" src="../../../img/kubernetes/kubernetes_devops/image-20211213184701784.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>在浏览器中打开链接 <a href="http://your-node-ip-address:30080">http://your-node-ip-address:30080</a></li>
</ul>
<table>
<thead>
<tr>
<th align="center">首页</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211213184742709" src="../../../img/kubernetes/kubernetes_devops/image-20211213184742709.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>输入初始用户名和密码，并登录</p>
</li>
<li>
<p>用户名： <code>admin</code></p>
</li>
<li>密码： <code>Kuboard123</code></li>
</ul>
<table>
<thead>
<tr>
<th align="center">首页效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20211213184840120" src="../../../img/kubernetes/kubernetes_devops/image-20211213184840120.png" /></td>
</tr>
</tbody>
</table>
<h4 id="104_kubernetes">10.4 Kubernetes操作<a class="headerlink" href="#104_kubernetes" title="Permanent link">&para;</a></h4>
<p>首先我们要了解Kubernetes在运行我们的资源时，关联到了哪些内容</p>
<ul>
<li>
<p>资源的构建方式：</p>
</li>
<li>
<p>采用kubectl的命令方式</p>
</li>
<li>yaml文件方式</li>
</ul>
<h5 id="1041_namespace">10.4.1 Namespace<a class="headerlink" href="#1041_namespace" title="Permanent link">&para;</a></h5>
<ul>
<li>命名空间：主要是为了对Kubernetes中运行的资源进行过隔离， 但是网络是互通的，类似Docker的容器，可以将多个资源配置到一个NameSpace中。而NameSpace可以对不同环境进行资源隔离，默认情况下Kubernetes提供了default命名空间，在构建资源时，如果不指定资源，默认采用default资源。
  命令方式：</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="c1"># 查看现有的全部命名空间</span>
kubectl<span class="w"> </span>get<span class="w"> </span>ns

<span class="c1"># 构建命名空间</span>
kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>命名空间名称

<span class="c1"># 删除现有命名空间， 并且会删除空间下的全部资源</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>ns<span class="w"> </span>命名空间名称
</code></pre></div>
  yaml文件方式：（构建资源时，设置命名空间）</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</code></pre></div>
<h5 id="1042_pod">10.4.2 Pod<a class="headerlink" href="#1042_pod" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Pod：Kubernetes运行的一组容器，Pod是Kubernetes的最小单位，但是对于Docker而然，Pod中会运行多个Docker容器</p>
</li>
<li>
<p>命令方式：
    <div class="highlight"><pre><span></span><code><span class="c1"># 查看所有运行的pod</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-A

<span class="c1"># 查看指定Namespace下的Pod</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span><span class="o">[</span>-n<span class="w"> </span>命名空间<span class="o">]</span><span class="w">  </span><span class="c1">#（默认default）</span>

<span class="c1"># 创建Pod</span>
kubectl<span class="w"> </span>run<span class="w"> </span>pod名称<span class="w"> </span>--image<span class="o">=</span>镜像名称

<span class="c1"># 查看Pod详细信息</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>pod名称

<span class="c1"># 删除pod</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>pod名称<span class="w"> </span><span class="o">[</span>-n<span class="w"> </span>命名空间<span class="o">]</span><span class="w">  </span><span class="c1">#（默认default）</span>

<span class="c1"># 查看pod输出的日志</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>pod名称

<span class="c1"># 进去pod容器内部</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>pod名称<span class="w"> </span>--<span class="w"> </span>bash

<span class="c1"># 查看kubernetes给Pod分配的ip信息，并且通过ip和容器的端口，可以直接访问</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-owide
</code></pre></div></p>
</li>
<li>
<p>yaml方式（推荐）
    <div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">运行的pod名称</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod名称</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">命名空间</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">镜像名称</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">容器名称</span>

<span class="c1"># 启动Pod：kubectl apply -f yaml文件名称</span>
<span class="c1"># 删除Pod：kubectl delete -f yaml文件名称</span>
</code></pre></div></p>
</li>
<li>
<p>Pod中运行多个容器</p>
<div class="highlight"><pre><span></span><code>apiVersion: v1
kind: Pod
metadata:
  labels:
    run: 运行的pod名称
  name: pod名称
  namespace: 命名空间
spec:
  containers:
  - image: 镜像名称
    name: 容器名称
  - image: 镜像名称
    name: 容器名称
…………    
</code></pre></div>
<p>启动后可以查看到</p>
<table>
<thead>
<tr>
<th align="center">Kuboard效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220104203155749" src="../../../img/kubernetes/kubernetes_devops/image-20220104203155749.png" /></td>
</tr>
</tbody>
</table>
</li>
</ul>
<h5 id="1043_deployment">10.4.3 Deployment<a class="headerlink" href="#1043_deployment" title="Permanent link">&para;</a></h5>
<p>部署时，可以通过Deployment管理和编排Pod</p>
<p>Deployment部署实现</p>
<ul>
<li>命令方式</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 基于Deployment启动容器</span>
kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>deployment名称<span class="w"> </span>--image<span class="o">=</span>镜像名称
<span class="c1"># 用deployment启动的容器会在被删除后自动再次创建，达到故障漂移的效果</span>
<span class="c1"># 需要使用deploy的方式删除deploy</span>
<span class="c1"># 查看现在的deployment</span>
kubectl<span class="w"> </span>get<span class="w"> </span>deployment

<span class="c1"># 删除deployment</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>deployment<span class="w"> </span>deployment名称

<span class="c1"># 基于Deployment启动容器并设置Pod集群数</span>
kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>deployment名称<span class="w"> </span>--image<span class="o">=</span>镜像名称<span class="w"> </span>--replicas<span class="w"> </span>集群个数
</code></pre></div>
<ul>
<li><a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/">配置文件方式</a></li>
</ul>
<div class="highlight"><pre><span></span><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
       image: nginx
       ports:
       - containerPort: 80
</code></pre></div>
<p>正常使用kubectl运行yaml即可</p>
<p>弹性伸缩功能</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 基于scale实现弹性伸缩</span>
kubectl<span class="w"> </span>scale<span class="w"> </span>deploy/Deployment名称<span class="w"> </span>--replicas<span class="w"> </span>集群个数
<span class="c1"># 或者修改yaml文件</span>
kubectl<span class="w"> </span>edit<span class="w"> </span>deploy<span class="w"> </span>Deployment名称
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">图形化页面修改</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220104210823057" src="../../../img/kubernetes/kubernetes_devops/image-20220104210823057.png" /></td>
</tr>
</tbody>
</table>
<p>灰度发布</p>
<p>Deploy可以在部署新版本数据时，成功启动一个pod，才会下线一个老版本的Pod</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>image<span class="w"> </span>deployment/Deployment名称<span class="w"> </span><span class="nv">容器名</span><span class="o">=</span>镜像:版本
</code></pre></div>
<h5 id="1044_service">10.4.4 Service<a class="headerlink" href="#1044_service" title="Permanent link">&para;</a></h5>
<p>可以将多个Pod对外暴露一个Service，让客户端可以通过Service访问到这一组Pod，并且可以实现负载均衡</p>
<p>ClusterIP方式：</p>
<p>ClusterIP是集群内部Pod之间的访问方式</p>
<ul>
<li>命令实现效果</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 通过生成service映射一个Deployment下的所有pod中的某一个端口的容器</span>
kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>Deployment名称<span class="w"> </span>--port<span class="o">=</span>Service端口号<span class="w"> </span>--target-port<span class="o">=</span>Pod内容器端口
</code></pre></div>
<p>之后通过<code>kubectl get service</code>查看Service提供的ip，即可访问</p>
<table>
<thead>
<tr>
<th align="center">kubectl get service</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220104214659229" src="../../../img/kubernetes/kubernetes_devops/image-20220104214659229.png" /></td>
</tr>
</tbody>
</table>
<p>也可以通过<code>Deployment名称.namespace名称.svc</code>作为域名访问</p>
<table>
<thead>
<tr>
<th align="center">在服务容器内执行</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220104215030265" src="../../../img/kubernetes/kubernetes_devops/image-20220104215030265.png" /></td>
</tr>
</tbody>
</table>
<p>NodePort方式</p>
<p>ClusterIP的方式只能在Pod内部实现访问，但是一般需要对外暴露网关，所以需要NodePort的方式Pod外暴露访问</p>
<ul>
<li>命令实现方式</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 通过生成service映射一个Deployment下的所有pod中的某一个端口的容器</span>
kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>Deployment名称<span class="w"> </span>--port<span class="o">=</span>Service端口号<span class="w"> </span>--target-port<span class="o">=</span>Pod内容器端口<span class="w"> </span>--type<span class="o">=</span>NodePort
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">查看Service效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220104222750733" src="../../../img/kubernetes/kubernetes_devops/image-20220104222750733.png" /></td>
</tr>
<tr>
<td align="center"><img alt="image-20220104222819455" src="../../../img/kubernetes/kubernetes_devops/image-20220104222819455.png" /></td>
</tr>
</tbody>
</table>
<p>Service也可以通过yaml文件实现</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">labels</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">app</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span>
<span class="w">    </span><span class="w w-Error"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">     </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<p>通过apply启动就也可以创建Service</p>
<p>测试效果-Deployment部署，通过Service暴露</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-service</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</code></pre></div>
<p>可以查看到暴露的信息</p>
<table>
<thead>
<tr>
<th align="center">Service信息</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220105205334996" src="../../../img/kubernetes/kubernetes_devops/image-20220105205334996.png" /></td>
</tr>
</tbody>
</table>
<h5 id="1045_ingress">10.4.5 Ingress<a class="headerlink" href="#1045_ingress" title="Permanent link">&para;</a></h5>
<p>Kubernetes推荐将Ingress作为所有Service的入口，提供统一的入口，避免多个服务之间需要记录大量的IP或者域名，毕竟IP可能改变，服务太多域名记录不方便。</p>
<p>Ingress底层其实就是一个Nginx， 可以在Kuboard上直接点击安装</p>
<table>
<thead>
<tr>
<th align="center">Kuboard安装</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220105153343642" src="../../../img/kubernetes/kubernetes_devops/image-20220105153343642.png" /></td>
</tr>
<tr>
<td align="center"><strong><img alt="image-20220105153416367" src="../../../img/kubernetes/kubernetes_devops/image-20220105153416367.png" /></strong></td>
</tr>
</tbody>
</table>
<p>因为副本数默认为1，但是k8s整体集群就2个节点，所以显示下面即为安装成功</p>
<table>
<thead>
<tr>
<th align="center">安装成功</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220105153502619" src="../../../img/kubernetes/kubernetes_devops/image-20220105153502619.png" /></td>
</tr>
</tbody>
</table>
<p>可以将Ingress接收到的请求转发到不同的Service中。</p>
<p>推荐使用yaml文件方式</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx.mashibing.com</span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-service</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span>
<span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="center">启动时问题</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220105203819715" src="../../../img/kubernetes/kubernetes_devops/image-20220105203819715.png" /></td>
</tr>
</tbody>
</table>
<p>Kuboard安装的Ingress有admission的校验配置，需要先删除配置再启动</p>
<p>找到指定的ingress的校验信息，删除即可</p>
<table>
<thead>
<tr>
<th align="center">删除信息</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220105204434044" src="../../../img/kubernetes/kubernetes_devops/image-20220105204434044.png" /></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="c1"># 查看校验webhook的配置</span>
kubectl<span class="w"> </span>get<span class="w"> </span>-A<span class="w"> </span>ValidatingWebhookConfiguration

<span class="c1"># 删除指定的校验</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>ValidatingWebhookConfiguration<span class="w"> </span>ingress-nginx-admission-my-ingress-controller
</code></pre></div>
<p>配置本地hosts文件</p>
<table>
<thead>
<tr>
<th align="center">配置hosts</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220105204921272" src="../../../img/kubernetes/kubernetes_devops/image-20220105204921272.png" /></td>
</tr>
</tbody>
</table>
<p>记下来既可以访问在Service中暴露的Nginx信息</p>
<table>
<thead>
<tr>
<th align="center">服通过Ingress访问</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="image-20220105205407393" src="../../../img/kubernetes/kubernetes_devops/image-20220105205407393.png" /></td>
</tr>
</tbody>
</table>
<h4 id="105_jenkinskubernetes">10.5 Jenkins集成Kubernetes<a class="headerlink" href="#105_jenkinskubernetes" title="Permanent link">&para;</a></h4>
<h5 id="1051_yml">10.5.1 准备部署的yml文件<a class="headerlink" href="#1051_yml" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code>apiVersion: apps/v1
kind: Deployment
metadata:
  namespace: test
  name: pipeline
  labels:
    app: pipeline
spec:
  replicas: 2
  selector:
    matchLabels:
      app: pipeline
  template:
    metadata:
      labels:
        app: pipeline    
    spec:
      containers:
      - name: pipeline
        image: 192.168.11.102:80/repo/pipeline:v4.0.0
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  namespace: test
  labels:
    app: pipeline
  name: pipeline  
spec:
  selector:
    app: pipeline
  ports:
  - port: 8081
    targetPort: 8080
  type: NodePort
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  namespace: test
  name: pipeline
spec:
  ingressClassName: ingress
  rules:
  - host: mashibing.pipeline.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: pipeline
            port:
              number: 8081
</code></pre></div>
<h5 id="1052_harbor">10.5.2 Harbor私服配置<a class="headerlink" href="#1052_harbor" title="Permanent link">&para;</a></h5>
<p>在尝试用kubernetes的yml文件启动pipeline服务时，会出现Kubernetes无法拉取镜像的问题，这里需要在kubernetes所在的Linux中配置Harbor服务信息，并且保证Kubernetes可以拉取Harbor上的镜像</p>
<ul>
<li>设置Master和Worker的私服地址信息</li>
</ul>
<table>
<thead>
<tr>
<th align="center">设置Harbor私服地址</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642498962716" src="../../../img/kubernetes/kubernetes_devops/1642498962716.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>在Kuboard上设置私服密文信息</li>
</ul>
<table>
<thead>
<tr>
<th align="center">设置密文并测试</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642498994935" src="../../../img/kubernetes/kubernetes_devops/1642498994935.png" /></td>
</tr>
</tbody>
</table>
<p>按照复制指令的位置测试认证，效果如下</p>
<table>
<thead>
<tr>
<th align="center">测试效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642499172789" src="../../../img/kubernetes/kubernetes_devops/1642499172789.png" /></td>
</tr>
</tbody>
</table>
<h5 id="1053">10.5.3 测试使用效果<a class="headerlink" href="#1053" title="Permanent link">&para;</a></h5>
<p>执行kubectl命令，基于yml启动服务，并且基于部署后服务的提示信息以及Ingress的设置，直接访问</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="1642499368121" src="../../../img/kubernetes/kubernetes_devops/1642499368121.png" /></td>
</tr>
<tr>
<td><img alt="1642499788199" src="../../../img/kubernetes/kubernetes_devops/1642499788199.png" /></td>
</tr>
</tbody>
</table>
<h5 id="1053_jenkins">10.5.3 Jenkins远程调用<a class="headerlink" href="#1053_jenkins" title="Permanent link">&para;</a></h5>
<ul>
<li>将pipeline.yml配置到Gitlab中</li>
</ul>
<table>
<thead>
<tr>
<th align="center">配置yml文件</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642499885324" src="../../../img/kubernetes/kubernetes_devops/1642499885324.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>配置Jenkins的目标服务器，可以将yml文件传输到K8s的Master上</li>
</ul>
<table>
<thead>
<tr>
<th align="center">设置目标服务器</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642499992148" src="../../../img/kubernetes/kubernetes_devops/1642499992148.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>修改Jenkinsfile，重新设置流水线任务脚本，并测试效果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">传递yml文件脚本</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642500061153" src="../../../img/kubernetes/kubernetes_devops/1642500061153.png" /></td>
</tr>
<tr>
<td align="center"><img alt="1642500102996" src="../../../img/kubernetes/kubernetes_devops/1642500102996.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>设置Jenkins无密码登录k8s-master</li>
</ul>
<p>将Jenkins中公钥信息复制到k8s-master的~/.ssh/authorized_keysz中，保证远程连接无密码</p>
<table>
<thead>
<tr>
<th align="center">远程执行命令无需密码</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642500239406" src="../../../img/kubernetes/kubernetes_devops/1642500239406.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>设置执行kubectl的脚本到Jenkinsfile</li>
</ul>
<table>
<thead>
<tr>
<th align="center">设置Jenkinsfile</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642500378788" src="../../../img/kubernetes/kubernetes_devops/1642500378788.png" /></td>
</tr>
</tbody>
</table>
<ul>
<li>执行查看效果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">执行流水线</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642500413802" src="../../../img/kubernetes/kubernetes_devops/1642500413802.png" /></td>
</tr>
</tbody>
</table>
<p>可以查看到yml文件是由变化的， 这样k8s就会重新加载</p>
<ul>
<li>查看效果</li>
</ul>
<table>
<thead>
<tr>
<th align="center">效果</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642500474036" src="../../../img/kubernetes/kubernetes_devops/1642500474036.png" /></td>
</tr>
</tbody>
</table>
<p><a href="">Ps：这种方式更适应与CD操作，将项目将基于某个版本部署到指定的目标服务器</a></p>
<h4 id="106_gitlabwebhooks">10.6 基于GitLab的WebHooks<a class="headerlink" href="#106_gitlabwebhooks" title="Permanent link">&para;</a></h4>
<p>这里要实现自动化的一个CI操作，也就是开发人员Push代码到Git仓库后，Jenkins会自动的构建项目，将最新的提交点代码构建并进行打包部署，这里区别去上述的CD操作，CD操作需要基于某个版本进行部署，而这里每次都是将最新的提交点集成到主干上并测试。</p>
<h5 id="1061_webhooks">10.6.1 WebHooks通知<a class="headerlink" href="#1061_webhooks" title="Permanent link">&para;</a></h5>
<p>开启Jenkins的自动构建</p>
<table>
<thead>
<tr>
<th align="center">构建触发器</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642500817131" src="../../../img/kubernetes/kubernetes_devops/1642500817131.png" /></td>
</tr>
</tbody>
</table>
<p>设置Gitlab的Webhooks</p>
<table>
<thead>
<tr>
<th align="center">设置Gitlab的Webhooks</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642500933316" src="../../../img/kubernetes/kubernetes_devops/1642500933316.png" /></td>
</tr>
</tbody>
</table>
<p>需要关闭Jenkins的Gitlab认证</p>
<table>
<thead>
<tr>
<th align="center">关闭Jenkins的Gitlab认证</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642501016474" src="../../../img/kubernetes/kubernetes_devops/1642501016474.png" /></td>
</tr>
</tbody>
</table>
<p>再次测试Gitlab</p>
<table>
<thead>
<tr>
<th align="center">再次测试</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642501065243" src="../../../img/kubernetes/kubernetes_devops/1642501065243.png" /></td>
</tr>
</tbody>
</table>
<h5 id="1062">10.6.2 修改配置<a class="headerlink" href="#1062" title="Permanent link">&para;</a></h5>
<p>修改Jenkinsfile实现基于最新提交点实现持续集成效果，将之前引用${tag}的全部去掉</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 所有的脚本命令都放在pipeline中</span>
<span class="err">pipeli</span><span class="kc">ne</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 指定任务再哪个集群节点中执行</span>
<span class="w">    </span><span class="err">age</span><span class="kc">nt</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">y</span>

<span class="w">    </span><span class="c1">// 声明全局变量，方便后面使用</span>
<span class="w">    </span><span class="err">e</span><span class="kc">n</span><span class="err">viro</span><span class="kc">n</span><span class="err">me</span><span class="kc">nt</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">harborUser</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">&#39;admi</span><span class="kc">n</span><span class="err">&#39;</span>
<span class="w">        </span><span class="err">harborPasswd</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">&#39;Harbor</span><span class="mi">12345</span><span class="err">&#39;</span>
<span class="w">        </span><span class="err">harborAddress</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mf">192.168.11.102</span><span class="p">:</span><span class="mi">80</span><span class="err">&#39;</span>
<span class="w">        </span><span class="err">harborRepo</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">&#39;repo&#39;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">s</span><span class="kc">ta</span><span class="err">ges</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">s</span><span class="kc">ta</span><span class="err">ge(&#39;拉取gi</span><span class="kc">t</span><span class="err">仓库代码&#39;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">s</span><span class="kc">te</span><span class="err">ps</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">checkou</span><span class="kc">t</span><span class="err">(</span><span class="p">[</span><span class="err">$class</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Gi</span><span class="kc">t</span><span class="err">SCM&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">bra</span><span class="kc">n</span><span class="err">ches</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;*/mas</span><span class="kc">ter</span><span class="err">&#39;</span><span class="p">]],</span><span class="w"> </span><span class="err">ex</span><span class="kc">tens</span><span class="err">io</span><span class="kc">ns</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="err">userRemo</span><span class="kc">te</span><span class="err">Co</span><span class="kc">nf</span><span class="err">igs</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="err">url</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;h</span><span class="kc">tt</span><span class="err">p</span><span class="p">:</span><span class="c1">//192.168.11.101:8929/root/mytest.git&#39;]]])</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="err">s</span><span class="kc">ta</span><span class="err">ge(&#39;通过mave</span><span class="kc">n</span><span class="err">构建项目&#39;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">s</span><span class="kc">te</span><span class="err">ps</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">sh</span><span class="w"> </span><span class="err">&#39;/var/je</span><span class="kc">n</span><span class="err">ki</span><span class="kc">ns</span><span class="err">_home/mave</span><span class="kc">n</span><span class="err">/bi</span><span class="kc">n</span><span class="err">/mv</span><span class="kc">n</span><span class="w"> </span><span class="err">clea</span><span class="kc">n</span><span class="w"> </span><span class="err">package</span><span class="w"> </span><span class="mi">-</span><span class="err">DskipTes</span><span class="kc">ts</span><span class="err">&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="err">s</span><span class="kc">ta</span><span class="err">ge(&#39;通过So</span><span class="kc">nar</span><span class="err">Qube做代码质量检测&#39;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">s</span><span class="kc">te</span><span class="err">ps</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">sh</span><span class="w"> </span><span class="err">&#39;/var/je</span><span class="kc">n</span><span class="err">ki</span><span class="kc">ns</span><span class="err">_home/so</span><span class="kc">nar</span><span class="mi">-</span><span class="err">sca</span><span class="kc">nner</span><span class="err">/bi</span><span class="kc">n</span><span class="err">/so</span><span class="kc">nar</span><span class="mi">-</span><span class="err">sca</span><span class="kc">nner</span><span class="w"> </span><span class="mi">-</span><span class="err">Dso</span><span class="kc">nar</span><span class="err">.source=./</span><span class="w"> </span><span class="mi">-</span><span class="err">Dso</span><span class="kc">nar</span><span class="err">.projec</span><span class="kc">tna</span><span class="err">me=$</span><span class="p">{</span><span class="err">JOB_NAME</span><span class="p">}</span><span class="w"> </span><span class="mi">-</span><span class="err">Dso</span><span class="kc">nar</span><span class="err">.projec</span><span class="kc">t</span><span class="err">Key=$</span><span class="p">{</span><span class="err">JOB_NAME</span><span class="p">}</span><span class="w"> </span><span class="mi">-</span><span class="err">Dso</span><span class="kc">nar</span><span class="err">.java.bi</span><span class="kc">nar</span><span class="err">ies=./</span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">/</span><span class="w"> </span><span class="mi">-</span><span class="err">Dso</span><span class="kc">nar</span><span class="err">.logi</span><span class="kc">n</span><span class="err">=</span><span class="mi">40306</span><span class="err">ae</span><span class="mf">8e</span><span class="err">a</span><span class="mi">69</span><span class="err">a</span><span class="mi">4792</span><span class="err">d</span><span class="kc">f</span><span class="mi">2</span><span class="err">ceb</span><span class="mi">4</span><span class="err">d</span><span class="mi">9</span><span class="err">d</span><span class="mi">25</span><span class="kc">fe</span><span class="mi">8</span><span class="err">a</span><span class="mi">6</span><span class="err">ab</span><span class="mi">1701</span><span class="err">&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="err">s</span><span class="kc">ta</span><span class="err">ge(&#39;通过Docker制作自定义镜像&#39;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">s</span><span class="kc">te</span><span class="err">ps</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">sh</span><span class="w"> </span><span class="err">&#39;&#39;&#39;mv</span><span class="w"> </span><span class="err">./</span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">/*.jar ./docker/</span>
<span class="err">                docker build -t ${JOB_NAME}:latest ./docker/&#39;&#39;&#39;</span>
<span class="err">            }</span>
<span class="err">        }</span>
<span class="err">        stage(&#39;将自定义镜像推送到Harbor&#39;) {</span>
<span class="err">            steps {</span>
<span class="err">                sh &#39;&#39;&#39;docker login -u ${harborUser} -p ${harborPasswd} ${harborAddress}</span>
<span class="err">                docker tag ${JOB_NAME}:latest  ${harborAddress}/${harborRepo}/${JOB_NAME}:latest</span>
<span class="err">                docker push ${harborAddress}/${harborRepo}/${JOB_NAME}:latest &#39;&#39;&#39;</span>
<span class="err">            }</span>
<span class="err">        }</span>
<span class="err">        stage(&#39;将yml文件传到k8s-master上&#39;) {</span>
<span class="err">            steps {</span>
<span class="err">                sshPublisher(publishers: [sshPublisherDesc(configName: &#39;k8s&#39;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &#39;&#39;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;&#39;, remoteDirectorySDF: false, removePrefix: &#39;&#39;, sourceFiles: &#39;pipeline.yml&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])</span>
<span class="err">            }</span>
<span class="err">        }</span>
<span class="err">        stage(&#39;远程执行k8s-master的kubectl命令&#39;) {</span>
<span class="err">            steps {</span>
<span class="err">               sh &#39;&#39;&#39;ssh root@192.168.11.201 kubectl apply -f /usr/local/k8s/pipeline.yml</span>
<span class="err">                ssh root@192.168.11.201 kubectl rollout restart deployment pipeline -n test&#39;&#39;&#39;</span>
<span class="err">            }</span>
<span class="err">        }</span>

<span class="err">    }</span>
<span class="err">    post {</span>
<span class="err">        success {</span>
<span class="err">            dingtalk(</span>
<span class="err">                robot: &#39;Jenkins-DingDing&#39;,</span>
<span class="err">                type: &#39;MARKDOWN&#39;,</span>
<span class="err">                title: &quot;success: ${JOB_NAME}&quot;,</span>
<span class="err">                text: [&quot;- 成功构建：${JOB_NAME}! \n- 版本：latest \n- 持续时间：${currentBuild.durationString}&quot; ]</span>
<span class="err">            )</span>
<span class="err">        }</span>
<span class="err">        failure {</span>
<span class="err">            dingtalk(</span>
<span class="err">                robot: &#39;Jenkins-DingDing&#39;,</span>
<span class="err">                type: &#39;MARKDOWN&#39;,</span>
<span class="err">                title: &quot;success: ${JOB_NAME}&quot;,</span>
<span class="err">                text: [&quot;- 构建失败：${JOB_NAME}! \n- 版本：latest \n- 持续时间：${currentBuild.durationString}&quot; ]</span>
<span class="err">            )</span>
<span class="err">        }</span>
<span class="err">    }</span>
<span class="err">}</span>
</code></pre></div>
<p>修改pipeline.yml，更改镜像版本</p>
<div class="highlight"><pre><span></span><code>apiVersion: apps/v1
kind: Deployment
metadata:
  namespace: test
  name: pipeline
  labels:
    app: pipeline
spec:
  replicas: 2
  selector:
    matchLabels:
      app: pipeline
  template:
    metadata:
      labels:
        app: pipeline    
    spec:
      containers:
      - name: pipeline
        image: 192.168.11.102:80/repo/pipeline:latest   # 这里
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
# 省略其他内容…………
</code></pre></div>
<h5 id="1063">10.6.3 滚动更新<a class="headerlink" href="#1063" title="Permanent link">&para;</a></h5>
<p>因为pipeline没有改变时，每次不会重新加载，这样会导致Pod中的容器不会动态更新，这里需要使用kubectl的rollout restart命令滚动更新</p>
<table>
<thead>
<tr>
<th align="center">设置Jenkinsfle</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="1642501521065" src="../../../img/kubernetes/kubernetes_devops/1642501521065.png" /></td>
</tr>
<tr>
<td align="center"><img alt="1642501549176" src="../../../img/kubernetes/kubernetes_devops/1642501549176.png" /></td>
</tr>
</tbody>
</table>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      BurningMyself<a href='https://beian.miit.gov.cn/' target='_blank'>  蜀ICP备15033200号-1</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/burningmyself" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://gitee.com/burningmyself" target="_blank" rel="noopener" title="gitee.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
        <script src="../../../js/baidu-tongji.js"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155084439-1"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155132293-1"></script>
      
        <script src="../../../js/google.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>