
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=".net,java,php,python,docker,web">
      
      
        <meta name="author" content="BurningMyself">
      
      
        <link rel="canonical" href="https://burningmyself.gitee.io/cloud/kubernetes/kubernetes_kurator/">
      
      
        <link rel="prev" href="../kubernetes_velero/">
      
      
        <link rel="next" href="../kubernetes_openfass/">
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.15">
    
    
      
        <title>kubernetes集群舰队管理Kurator - BurningMyself</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kubernetes_kurator" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="BurningMyself" class="md-header__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BurningMyself
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              kubernetes集群舰队管理Kurator
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="BurningMyself" class="md-nav__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BurningMyself
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        介绍
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          技术博文
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          技术博文
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          .NET
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          .NET
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sharp/" class="md-nav__link">
        C#新特性语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_docker/" class="md-nav__link">
        .Net Core Docker 部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sqlserver_nginx/" class="md-nav__link">
        Docker 容器化部署 ASP.NET Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_safety/" class="md-nav__link">
        让你的ASP.NET Core应用程序更安全
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_study_route/" class="md-nav__link">
        ASP.NET Core开发者指南
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/feature/" class="md-nav__link">
        Java特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/load-class/" class="md-nav__link">
        Java类加载
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/orm/" class="md-nav__link">
        Orm的优缺点
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/bio-nio/" class="md-nav__link">
        BIO与NIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/rocketmq/rmq-1/" class="md-nav__link">
        RocketMq下载与安装
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springAnnotation/" class="md-nav__link">
        Spring常用注解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/javavm/" class="md-nav__link">
        Java 虚拟机
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springdesign/" class="md-nav__link">
        Spring 常用设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/spring-cloud/" class="md-nav__link">
        Spring Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-simple/" class="md-nav__link">
        Java simple
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-validator/" class="md-nav__link">
        Java Validator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-string/" class="md-nav__link">
        Java String
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-utils/" class="md-nav__link">
        Java Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/feature/" class="md-nav__link">
        Python特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/str_joint/" class="md-nav__link">
        Python字符拼接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/syntax_rule/" class="md-nav__link">
        Python语法技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/fabric/" class="md-nav__link">
        远程部署神器 Fabric
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          Go
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Go
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../go/go_base/" class="md-nav__link">
        Go基础语法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
          PHP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          PHP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/kj/" class="md-nav__link">
        框架
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
          Web
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/es6/" class="md-nav__link">
        es6语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/ali_js_style/" class="md-nav__link">
        阿里js样式规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/node.js/" class="md-nav__link">
        node.js文档
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react/" class="md-nav__link">
        React 开发者指南
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../dart/syntax/" class="md-nav__link">
        Dart语法学习
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react_interview/" class="md-nav__link">
        React 面试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/js_tool_method/" class="md-nav__link">
        js 工具函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/vue_cp_react/" class="md-nav__link">
        vue与react比较
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/javascript/" class="md-nav__link">
        JavaScript 基础
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
      
      
      
        <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
          SQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh17/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_log/" class="md-nav__link">
        MySQL日志
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_index/" class="md-nav__link">
        MySQL索引
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_pxc/" class="md-nav__link">
        MySQL PXC集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_use/" class="md-nav__link">
        MySQL 数据库应用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_backups/" class="md-nav__link">
        MySql 备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/sql_server_master/" class="md-nav__link">
        Sql Server 主从备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/data_split/" class="md-nav__link">
        数据库之互联网常用分库分表方案
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mybatis/" class="md-nav__link">
        Mybatis使用心德
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
      
      
      
        <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/linux/" class="md-nav__link">
        Linux学习笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/often/" class="md-nav__link">
        常用命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/ope/" class="md-nav__link">
        实用的Linux 命令
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
      
      
      
        <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker/" class="md-nav__link">
        Docker全科
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker_core/" class="md-nav__link">
        Docker 核心技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-compose/" class="md-nav__link">
        docker和docker-compose配置常用环境
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-jenkins/" class="md-nav__link">
        Docker部署Jenkins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-phabricator/" class="md-nav__link">
        Docker部署Phabricator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
      
      
      
        <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_fw_rule_and_object_design/" class="md-nav__link">
        Kubernetes架构原则和对象设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_etcd/" class="md-nav__link">
        Kubernetes控制平面组件etcd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_kube_APIServer/" class="md-nav__link">
        深入理解Kube-APIServer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubernetes/k8s_controller_manager/" class="md-nav__link">
        kubernetes控制平面组件
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
      
      
      
        <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
          Tool
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_11">
          <span class="md-nav__icon md-icon"></span>
          Tool
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitusual/" class="md-nav__link">
        Git动画展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitquestion/" class="md-nav__link">
        Git问题处理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitflow/" class="md-nav__link">
        GitFlow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitbook/" class="md-nav__link">
        GitBook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitcmr/" class="md-nav__link">
        Git提交日志规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/markdown/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cicd/" class="md-nav__link">
        CI/CD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/mkdocs/" class="md-nav__link">
        mkdocs简单使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitstudy/" class="md-nav__link">
        Git的黑魔法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/minio/" class="md-nav__link">
        MinIO 搭建使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cat-monitoring/" class="md-nav__link">
        Cat分布式监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          云架构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          云架构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../native/" class="md-nav__link">
        云原生
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual/" class="md-nav__link">
        虚拟化技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/" class="md-nav__link">
        云计算
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../apprelease/" class="md-nav__link">
        应用部署容器化演进
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../containerlinux/" class="md-nav__link">
        容器技术所涉及Linux内核关键技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_native/" class="md-nav__link">
        容器管理工具Docker生态架构及部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_nginx/" class="md-nav__link">
        使用容器运行Nginx应用及Docker命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image/" class="md-nav__link">
        Docker容器镜像
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image_fast/" class="md-nav__link">
        Docker容器镜像加速器及本地容器镜像仓库
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container_enterprice/" class="md-nav__link">
        Docker容器化部署企业级应用集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_file/" class="md-nav__link">
        Dockerfile精讲及新型容器镜像构建技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_network/" class="md-nav__link">
        Docker容器网络与通信原理深度解析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_date/" class="md-nav__link">
        Docker容器数据持久化存储机制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_compose/" class="md-nav__link">
        Docker容器服务编排利器Docker Compose应用实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_swarm/" class="md-nav__link">
        Docker主机集群化方案 Docker Swarm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_devops/" class="md-nav__link">
        基于Docker容器DevOps应用方案 企业业务代码发布系统
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container/" class="md-nav__link">
        轻量级或工业级容器管理工具
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        kubeadm极速部署Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_introduce/" class="md-nav__link">
        kubernetes介绍与集群架构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_way/" class="md-nav__link">
        Kubernetes集群部署方式说明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_master/" class="md-nav__link">
        kubeadm部署单Master节点kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight/" class="md-nav__link">
        kubeadm部署高可用kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rke/" class="md-nav__link">
        使用RKE构建企业生产级Kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin1/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Docker）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin2/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Containerd）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        Kubernetes集群UI及主机资源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_sealos/" class="md-nav__link">
        使用sealos部署kubernetes集群并实现集群管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster/" class="md-nav__link">
        kubernetes集群命令语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_core/" class="md-nav__link">
        Kubernetes核心概念
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_nginx_ingress_controller/" class="md-nav__link">
        Kubernetes集群 服务暴露 Nginx Ingress Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_traefik/" class="md-nav__link">
        Kubernetes集群 服务暴露 Traefik
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_configMap_secret/" class="md-nav__link">
        Kubernetes配置与密钥管理 ConfigMap&Secret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_harbor/" class="md-nav__link">
        Kubernetes集群使用容器镜像仓库Harbor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_safety/" class="md-nav__link">
        Kubernetes集群安全管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_volume/" class="md-nav__link">
        kubernetes持久化存储卷
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_ceph/" class="md-nav__link">
        kubernetes存储解决方案Ceph
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster_serve/" class="md-nav__link">
        Kubernetes集群公共服务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_java/" class="md-nav__link">
        kubernetes集群java项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_python/" class="md-nav__link">
        kubernetes集群Python项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_deploy_golang/" class="md-nav__link">
        Kubernetes集群golang项目上云部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_helm_prometheus/" class="md-nav__link">
        helm部署prometheus监控系统及应用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_logs_collect/" class="md-nav__link">
        kubernetes日志收集方案ELK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_zookeeper/" class="md-nav__link">
        企业级中间件上云部署zookeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kafka/" class="md-nav__link">
        kubernetes云原生中间件上云部署kafka
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rokectmq/" class="md-nav__link">
        rocketmq部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_helm/" class="md-nav__link">
        Kubernetes集群包管理解决方案 Helm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kustomize/" class="md-nav__link">
        Kubernetes原生配置管理利器 kustomize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_flannel/" class="md-nav__link">
        kubernetes集群网络解决方案 flannel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_calico/" class="md-nav__link">
        kubernetes集群网络解决方案 calico
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hybridnet/" class="md-nav__link">
        kubernetes集群 underlay 网络方案 hybridnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ipv4_and_ipv6/" class="md-nav__link">
        kubernetes版本双栈协议（IPv4&IPv6）集群部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rancher/" class="md-nav__link">
        Rancher容器云管理平台
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubeconfig/" class="md-nav__link">
        使用kubeconfig管理多集群方法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_karmada/" class="md-nav__link">
        karmada实现k8s集群联邦
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubesphere/" class="md-nav__link">
        安装kubesphere使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        阿里云容器服务ACK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_devops/" class="md-nav__link">
        基于kubernetes集群构建大中型企业CICD应用平台
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_kubesphere_devops/" class="md-nav__link">
        基于KubeSphere实现DevOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_gitops/" class="md-nav__link">
        云原生多云持续交付GitOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_velero/" class="md-nav__link">
        kubernetes集群备份与恢复管理利器Velero
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        kubernetes集群舰队管理Kurator
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_openfass/" class="md-nav__link">
        Serverless之OpenFaaS函数即服务
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_flink/" class="md-nav__link">
        Flink基于Kubernetes部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hdfs/" class="md-nav__link">
        大数据HDFS分布式文件系统搭建
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_spark/" class="md-nav__link">
        Spark与Kubernetes整合
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          微服务
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          微服务
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/fbs-lock/" class="md-nav__link">
        分布式锁
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/design/" class="md-nav__link">
        微服务设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/distrimsg/" class="md-nav__link">
        分布式系统与消息的投递
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/ddd/" class="md-nav__link">
        基于DDD的微服务设计和开发实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/kafka/" class="md-nav__link">
        Kafka架构原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/redis_cluster/" class="md-nav__link">
        Redis Cluster原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/spring-cloud-micro/" class="md-nav__link">
        分布式架构
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          经验分析
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          经验分析
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/devops/" class="md-nav__link">
        DevOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/micro-service/" class="md-nav__link">
        Micro-Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/raft-gossip/" class="md-nav__link">
        Raft算法和Gossip协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cl/" class="md-nav__link">
        集群和负载均衡
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/ai/" class="md-nav__link">
        人工智能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/code-principle/" class="md-nav__link">
        代码原则
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/techbig/" class="md-nav__link">
        如何成为技术大牛
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/learnweetout/" class="md-nav__link">
        程序员如何技术成长
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/pt/" class="md-nav__link">
        产品与技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/four_deep_learning/" class="md-nav__link">
        深度学习框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/tl/" class="md-nav__link">
        在阿里做了5年技术Leader，我总结出这些套路！
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cto/" class="md-nav__link">
        CTO 技能图谱
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          构架
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          构架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/split/" class="md-nav__link">
        构架拆分
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fgb/" class="md-nav__link">
        分布式、高并发、多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/agility/" class="md-nav__link">
        如何理解敏捷开发
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fwork/" class="md-nav__link">
        走向架构师必备的技能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/data_middle/" class="md-nav__link">
        数据中台的思考与总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/algorithm-ten/" class="md-nav__link">
        必学的 10 大算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          情感
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          情感
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/eq/" class="md-nav__link">
        情商
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/workheard/" class="md-nav__link">
        工作心得
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lookbook/" class="md-nav__link">
        看书
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/selfdiscipline/" class="md-nav__link">
        自律
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/livefail/" class="md-nav__link">
        为什么活着失败
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/emotion/" class="md-nav__link">
        情绪管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/losecome/" class="md-nav__link">
        所有的失去，都会以另一种方式归来
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/threeheart/" class="md-nav__link">
        人生有这三种好心态
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/onepath/" class="md-nav__link">
        余生，学会一个人走，不管有没有人陪
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/twopath/" class="md-nav__link">
        往后余生还很精彩，别被熬夜拖垮了
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lifetime/" class="md-nav__link">
        心态好的人，一辈子都好
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="kubernetes_kurator">kubernetes集群舰队管理 Kurator<a class="headerlink" href="#kubernetes_kurator" title="Permanent link">&para;</a></h1>
<h1 id="kurator">一、Kurator介绍<a class="headerlink" href="#kurator" title="Permanent link">&para;</a></h1>
<h2 id="11_kurator">1.1 Kurator是什么？<a class="headerlink" href="#11_kurator" title="Permanent link">&para;</a></h2>
<p>2023年4月8日，Kurator正式发布v0.3.0版本。</p>
<p>Kurator 是华为云推出的分布式云原生开源套件，通过集成业界主流开源技术栈，帮助用户一站式构建专属的分布式云原生基础设施，助力企业业务跨云跨边、分布式化升级。</p>
<p>Kurator v0.2 版本已具备管理多云基础设施和异构基础设施的核心能力，通过引入Cluster Operator组件，支持“AWS自建集群”和“本地数据中心集群”包括集群创建、清理等在内的生命周期管理特性。</p>
<p>在最新发布的v0.3.0版本中，Cluster Operator不仅分别对两类集群的生命周期管理能力进行了增强，也将v0.2.0版本中的多个API对象抽象成一个API对象cluster，方便用户使用。 </p>
<p>同时，在 cluster 对象基础上，Kurator引入了舰队的概念。每个舰队代表一个物理集群组，方便Kurator未来进行统一的编排、调度，统一的流量治理以及统一的监控运维。目前，Kurator的舰队管理支持多个特性，包括舰队控制平面的生命周期管理，以及集群注册和注销到舰队等。</p>
<p>至此，Kurator 通过集群舰队统一了集群视图。这意味着，Kurator开始具备了支持用户体验一致地管理分布在任何云上的集群的能力，从而进一步协助用户的分布式云原生架构的升级。</p>
<h2 id="12_kurator_v030">1.2 Kurator v0.3.0关键特性介绍<a class="headerlink" href="#12_kurator_v030" title="Permanent link">&para;</a></h2>
<ul>
<li>集群生命周期管理能力增强</li>
</ul>
<p>Kurator 通过 Cluster Operator组件对集群的生命周期进行管理。基于Cluster API，Cluster Operator 不仅可以管理集群生命周期，还统一并简化了创建集群所需的配置，为用户在不同云平台上管理集群提供了简单易用的API。目前Cluster Operator 支持“本地数据中心集群”和“AWS自建集群”。</p>
<ul>
<li>本地数据中心集群</li>
</ul>
<p>Kurator基于kubespray对本地数据中心集群的生命周期进行管理。与 kubespray不同的地方在于，Kurator采用了更易于理解和配置的云原生声明式的方法管理集群。</p>
<p>相比较v0.2.0版本，v0.3.0版本的Kurator 带来了以下几个方面的增强特性：</p>
<ul>
<li>批量的工作节点扩缩容。 现在Kurator支持以声明式的方式，在原有集群上增加、删除或者替换多个工作节点。 用户只需要声明集群所需要的最终工作节点状态，Kurator即可在没有任何外部干预的情况下完成节点的批量扩缩容。</li>
<li>集群版本升级。 用户可以在API对象上声明要升级到的Kubernetes版本，Kurator便会自动对目标集群的各节点进行升级。</li>
<li>增强集群控制面高可用。Kurator为用户提供了一种基于VIP的增强集群控制面高可用的方案。在这种方案下，Kurator利用kube-vip的能力，使用VIP实现跨多个控制平面副本的入站流量负载均衡。</li>
</ul>
<p><img alt="img" src="../../../img/kubernetes/kubernetes_kurator/v2-298182337030964ef3d83ef70beb747d_r.jpg" /></p>
<h2 id="13">1.3 云原生舰队管理<a class="headerlink" href="#13" title="Permanent link">&para;</a></h2>
<p>Kurator引入了代表物理集群组的逻辑单元“舰队”，旨在一致地管理一组集群，舰队允许您轻松、一致地管理分布在任何云中的集群。</p>
<p>Kurator通过Fleet Manager实现了对舰队控制平面生命周期管理，并且可以轻松的将集群添加到或从舰队中删除。 未来，Kurator将支持Fleet级的应用编排，并且在Fleet的所有集群中提供统一的命名空间、ServiceAccount、Service，以支持在多个集群之间实现服务发现和通信。此外，Kurator将汇总来自所有集群的监控指标。</p>
<p>Kurator Fleet Manager作为一个Kubernetes Operator运行，负责Fleet控制平面生命周期管理，也负责集群的注册和注销。</p>
<p><img alt="img" src="https://pic3.zhimg.com/v2-9b621d72a7b926276742fce0f9e78aae_r.jpg" /></p>
<h1 id="kurator_1">二、Kurator部署<a class="headerlink" href="#kurator_1" title="Permanent link">&para;</a></h1>
<h2 id="21_k8s">2.1 k8s管理集群准备<a class="headerlink" href="#21_k8s" title="Permanent link">&para;</a></h2>
<blockquote>
<p>使用kubespray或kubeasz快速部署一套K8S集群用于实现对其它集群进行管理操作。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># cat &gt; /etc/yum.repos.d/k8s.repo &lt;&lt;EOF</span>
<span class="no">[kubernetes]</span>
<span class="n">name</span><span class="p">=</span><span class="n">Kubernetes</span>
<span class="n">baseurl</span><span class="p">=</span><span class="n">https</span><span class="p">://</span><span class="n">mirrors</span><span class="p">.</span><span class="n">aliyun</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">kubernetes</span><span class="p">/</span><span class="n">yum</span><span class="p">/</span><span class="n">repos</span><span class="p">/</span><span class="n">kubernetes-el7-x86_64</span><span class="p">/</span>
<span class="n">enabled</span><span class="p">=</span><span class="n">1</span>
<span class="n">gpgcheck</span><span class="p">=</span><span class="n">0</span>
<span class="n">repo_gpgcheck</span><span class="p">=</span><span class="n">0</span>
<span class="n">gpgkey</span><span class="p">=</span><span class="n">https</span><span class="p">://</span><span class="n">mirrors</span><span class="p">.</span><span class="n">aliyun</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">kubernetes</span><span class="p">/</span><span class="n">yum</span><span class="p">/</span><span class="n">doc</span><span class="p">/</span><span class="n">yum-key</span><span class="p">.</span><span class="n">gpg</span> <span class="n">https</span><span class="p">://</span><span class="n">mirrors</span><span class="p">.</span><span class="n">aliyun</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">kubernetes</span><span class="p">/</span><span class="n">yum</span><span class="p">/</span><span class="n">doc</span><span class="p">/</span><span class="n">rpm-package-key</span><span class="p">.</span><span class="n">gpg</span>
<span class="n">EOF</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># yum -y install kubectl-1.26.3</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">需要在kubespray主机上准备kubeconfig文件</span><span class="p">,</span><span class="n">注意修改连接master节点的IP地址</span><span class="err">。</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls /root/.kube/</span>
<span class="n">config</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get nodes</span>
<span class="n">NAME</span>    <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>   <span class="n">VERSION</span>
<span class="n">node1</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">40d</span>   <span class="n">v1</span><span class="p">.</span><span class="n">26</span><span class="p">.</span><span class="n">3</span>
<span class="n">node2</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">40d</span>   <span class="n">v1</span><span class="p">.</span><span class="n">26</span><span class="p">.</span><span class="n">3</span>
<span class="n">node3</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">40d</span>   <span class="n">v1</span><span class="p">.</span><span class="n">26</span><span class="p">.</span><span class="n">3</span>
<span class="n">node4</span>   <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">40d</span>   <span class="n">v1</span><span class="p">.</span><span class="n">26</span><span class="p">.</span><span class="n">3</span>
<span class="n">node5</span>   <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">40d</span>   <span class="n">v1</span><span class="p">.</span><span class="n">26</span><span class="p">.</span><span class="n">3</span>
</code></pre></div>
<h2 id="22_kurator">2.2 安装Kurator客户端<a class="headerlink" href="#22_kurator" title="Permanent link">&para;</a></h2>
<p><img alt="image-20230614101114746" src="../../../img/kubernetes/kubernetes_kurator/image-20230614101114746.png" /></p>
<p><img alt="image-20230614101147258" src="../../../img/kubernetes/kubernetes_kurator/image-20230614101147258.png" /></p>
<p><img alt="image-20230614101231227" src="../../../img/kubernetes/kubernetes_kurator/image-20230614101231227.png" /></p>
<p><img alt="image-20230614101304410" src="../../../img/kubernetes/kubernetes_kurator/image-20230614101304410.png" /></p>
<p><img alt="image-20230614101336467" src="../../../img/kubernetes/kubernetes_kurator/image-20230614101336467.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">下载kurator工具包</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># wget https://github.com/kurator-dev/kurator/releases/download/v0.3.0/kurator-linux-amd64-v0.3.0.tar.gz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">解压工具包</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># tar xf kurator-linux-amd64-v0.3.0.tar.gz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看解压目录包含内容</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out</span>
<span class="n">charts</span>  <span class="n">linux-amd64</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/linux-amd64/</span>
<span class="n">cluster-operator</span>  <span class="n">Dockerfile</span>  <span class="n">fleet-manager</span>  <span class="n">kurator</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">复制kurator至</span><span class="p">/</span><span class="n">usr</span><span class="p">/</span><span class="n">bin目录完成安装</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># cp out/linux-amd64/kurator /usr/bin/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">验证kurator客户端是否可用</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kurator</span>
<span class="n">Kurator</span> <span class="n">builds</span> <span class="n">distributed</span> <span class="n">cloud-native</span> <span class="n">stacks</span><span class="p">.</span>

<span class="n">Usage</span><span class="p">:</span>
  <span class="n">kurator</span> <span class="no">[command]</span>

<span class="n">Available</span> <span class="n">Commands</span><span class="p">:</span>
  <span class="n">completion</span>  <span class="n">Generate</span> <span class="n">the</span> <span class="n">autocompletion</span> <span class="n">script</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">shell</span>
  <span class="n">help</span>        <span class="n">Help</span> <span class="n">about</span> <span class="n">any</span> <span class="n">command</span>
  <span class="n">install</span>     <span class="n">Install</span> <span class="n">a</span> <span class="n">target</span> <span class="n">component</span>
  <span class="n">join</span>        <span class="n">Register</span> <span class="n">a</span> <span class="n">cluster</span> <span class="n">or</span> <span class="n">node</span>
  <span class="n">tool</span>        <span class="n">Tool</span> <span class="n">information</span> <span class="k">for</span> <span class="n">the</span> <span class="n">component</span>
  <span class="n">version</span>     <span class="n">Print</span> <span class="n">the</span> <span class="n">version</span> <span class="n">of</span> <span class="n">kurator</span>

<span class="n">Flags</span><span class="p">:</span>
      <span class="p">-</span><span class="n">-context</span> <span class="n">string</span>           <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">kubeconfig</span> <span class="n">context</span> <span class="n">to</span> <span class="n">use</span>
      <span class="p">-</span><span class="n">-dry-run</span>                  <span class="n">console</span><span class="p">/</span><span class="n">log</span> <span class="n">output</span> <span class="n">only</span><span class="p">,</span> <span class="n">make</span> <span class="n">no</span> <span class="n">changes</span><span class="p">.</span>
  <span class="n">-h</span><span class="p">,</span> <span class="p">-</span><span class="n">-help</span>                     <span class="n">help</span> <span class="k">for</span> <span class="n">kurator</span>
      <span class="p">-</span><span class="n">-home-dir</span> <span class="n">string</span>          <span class="n">install</span> <span class="n">path</span><span class="p">,</span> <span class="k">default</span> <span class="n">to</span> <span class="nv">$HOME</span><span class="p">/.</span><span class="n">kurator</span> <span class="p">(</span><span class="k">default</span> <span class="s2">&quot;/root/.kurator&quot;</span><span class="p">)</span>
  <span class="n">-c</span><span class="p">,</span> <span class="p">-</span><span class="n">-kubeconfig</span> <span class="n">string</span>        <span class="n">path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">kubeconfig</span> <span class="n">file</span><span class="p">,</span> <span class="k">default</span> <span class="n">to</span> <span class="n">karmada</span> <span class="n">apiserver</span> <span class="n">config</span> <span class="p">(</span><span class="k">default</span> <span class="s2">&quot;/etc/karmada/karmada-apiserver.config&quot;</span><span class="p">)</span>
      <span class="p">-</span><span class="n">-wait-interval</span> <span class="n">duration</span>   <span class="n">interval</span> <span class="n">used</span> <span class="k">for</span> <span class="n">checking</span> <span class="n">pod</span> <span class="n">ready</span><span class="p">,</span> <span class="k">default</span> <span class="n">value</span> <span class="n">is</span> <span class="n">1s</span><span class="p">.</span> <span class="p">(</span><span class="k">default</span> <span class="n">1s</span><span class="p">)</span>
      <span class="p">-</span><span class="n">-wait-timeout</span> <span class="n">duration</span>    <span class="n">timeout</span> <span class="n">used</span> <span class="k">for</span> <span class="n">checking</span> <span class="n">pod</span> <span class="n">ready</span><span class="p">,</span> <span class="k">default</span> <span class="n">value</span> <span class="n">is</span> <span class="n">2m</span><span class="p">.</span> <span class="p">(</span><span class="k">default</span> <span class="n">2m0s</span><span class="p">)</span>

<span class="n">Use</span> <span class="s2">&quot;kurator [command] --help&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">a</span> <span class="n">command</span><span class="p">.</span>
</code></pre></div>
<h2 id="23_cluster_operator">2.3 Cluster Operator安装<a class="headerlink" href="#23_cluster_operator" title="Permanent link">&para;</a></h2>
<blockquote>
<p>部署Cluster Operator，用于实现对自建K8S集群进行管理。</p>
</blockquote>
<h3 id="231_helm">2.3.1 helm准备<a class="headerlink" href="#231_helm" title="Permanent link">&para;</a></h3>
<blockquote>
<p>部署Cluster Operator需要使用Helm部署。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">下载helm源文件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># wget https://get.helm.sh/helm-v3.12.0-linux-amd64.tar.gz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">解压helm源文件</span> 
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># tar xf helm-v3.12.0-linux-amd64.tar.gz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">安装helm</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># cp linux-amd64/helm /usr/bin/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">验证helm版本</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm version</span>
<span class="n">version</span><span class="p">.</span><span class="n">BuildInfo</span><span class="p">{</span><span class="n">Version</span><span class="p">:</span><span class="s2">&quot;v3.12.0&quot;</span><span class="p">,</span> <span class="n">GitCommit</span><span class="p">:</span><span class="s2">&quot;c9f554d75773799f72ceef38c51210f1842a1dea&quot;</span><span class="p">,</span> <span class="n">GitTreeState</span><span class="p">:</span><span class="s2">&quot;clean&quot;</span><span class="p">,</span> <span class="n">GoVersion</span><span class="p">:</span><span class="s2">&quot;go1.20.3&quot;</span><span class="p">}</span>
</code></pre></div>
<h3 id="232_cert_manager">2.3.2 安装cert manager<a class="headerlink" href="#232_cert_manager" title="Permanent link">&para;</a></h3>
<blockquote>
<p>证书管理器，关于cert manager更多介绍，可参考如下链接：<a href="https://cert-manager.io/docs/">https://cert-manager.io/docs/</a></p>
</blockquote>
<p>由于Kurator cluster operator 需要 webhook 证书，默认情况下，使用Helm安装时会导入所需要的证书，当然也可以由cert manager进行自动注入，所以需要提前准备好cert manager证书管理器。cert manager的作用如下：</p>
<ul>
<li>cert-manager 将证书和证书颁发者作为资源类型添加到 Kubernetes 集群中，并简化了这些证书的获取、更新和使用过程。</li>
<li>它可以从各种受支持的来源颁发证书，包括 <a href="https://letsencrypt.org/">Let's Encrypt</a>、<a href="https://www.vaultproject.io/">HashiCorp Vault</a>和<a href="https://www.venafi.com/">Venafi</a>以及私有 PKI。</li>
<li>它将确保证书有效且最新，并尝试在到期前的配置时间更新证书。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">添加cert</span> <span class="n">manager部署使用的helm仓库</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm repo add jetstack https://charts.jetstack.io</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">更新仓库</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm repo update</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">在管理集群中创建命名空间</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl create namespace cert-manager</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">使用helm部署cert</span> <span class="n">manager</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm install -n cert-manager cert-manager jetstack/cert-manager --set installCRDs=true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">输出内容如下</span><span class="err">：</span>
<span class="n">NAME</span><span class="p">:</span> <span class="n">cert-manager</span>
<span class="n">LAST</span> <span class="n">DEPLOYED</span><span class="p">:</span> <span class="n">Wed</span> <span class="n">Jun</span> <span class="n">14</span> <span class="n">08</span><span class="p">:</span><span class="n">25</span><span class="p">:</span><span class="n">15</span> <span class="n">2023</span>
<span class="n">NAMESPACE</span><span class="p">:</span> <span class="n">cert-manager</span>
<span class="n">STATUS</span><span class="p">:</span> <span class="n">deployed</span>
<span class="n">REVISION</span><span class="p">:</span> <span class="n">1</span>
<span class="n">TEST</span> <span class="n">SUITE</span><span class="p">:</span> <span class="n">None</span>
<span class="n">NOTES</span><span class="p">:</span>
<span class="n">cert-manager</span> <span class="n">v1</span><span class="p">.</span><span class="n">12</span><span class="p">.</span><span class="n">1</span> <span class="n">has</span> <span class="n">been</span> <span class="n">deployed</span> <span class="n">successfully</span><span class="p">!</span>

<span class="k">In</span> <span class="n">order</span> <span class="n">to</span> <span class="k">begin</span> <span class="n">issuing</span> <span class="n">certificates</span><span class="p">,</span> <span class="n">you</span> <span class="n">will</span> <span class="n">need</span> <span class="n">to</span> <span class="nb">set </span><span class="n">up</span> <span class="n">a</span> <span class="n">ClusterIssuer</span>
<span class="n">or</span> <span class="n">Issuer</span> <span class="n">resource</span> <span class="p">(</span><span class="k">for</span> <span class="n">example</span><span class="p">,</span> <span class="n">by</span> <span class="n">creating</span> <span class="n">a</span> <span class="s1">&#39;letsencrypt-staging&#39;</span> <span class="n">issuer</span><span class="p">).</span>

<span class="n">More</span> <span class="n">information</span> <span class="n">on</span> <span class="n">the</span> <span class="n">different</span> <span class="n">types</span> <span class="n">of</span> <span class="n">issuers</span> <span class="n">and</span> <span class="n">how</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">them</span>
<span class="n">can</span> <span class="n">be</span> <span class="n">found</span> <span class="k">in</span> <span class="n">our</span> <span class="n">documentation</span><span class="p">:</span>

<span class="n">https</span><span class="p">://</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">docs</span><span class="p">/</span><span class="n">configuration</span><span class="p">/</span>

<span class="k">For</span> <span class="n">information</span> <span class="n">on</span> <span class="n">how</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">cert-manager</span> <span class="n">to</span> <span class="n">automatically</span> <span class="n">provision</span>
<span class="n">Certificates</span> <span class="k">for</span> <span class="n">Ingress</span> <span class="n">resources</span><span class="p">,</span> <span class="n">take</span> <span class="n">a</span> <span class="n">look</span> <span class="n">at</span> <span class="n">the</span> <span class="p">`</span><span class="n">ingress-shim</span><span class="p">`</span>
<span class="n">documentation</span><span class="p">:</span>

<span class="n">https</span><span class="p">://</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">docs</span><span class="p">/</span><span class="n">usage</span><span class="p">/</span><span class="n">ingress</span><span class="p">/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看命名空间创建情况</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get ns</span>
<span class="n">NAME</span>              <span class="n">STATUS</span>   <span class="n">AGE</span>
<span class="n">cert-manager</span>      <span class="n">Active</span>   <span class="n">126m</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看命名空间中pod运行情况</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get pods -n cert-manager</span>
<span class="n">NAME</span>                                       <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cert-manager</span><span class="p">-</span><span class="n">7b5cc56d74-v4zj2</span>              <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">126m</span>
<span class="n">cert-manager-cainjector</span><span class="p">-</span><span class="n">7d948796d5-bjdl6</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">126m</span>
<span class="n">cert-manager-webhook</span><span class="p">-</span><span class="n">68f677967c-czb76</span>      <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">126m</span>
</code></pre></div>
<h3 id="233_install_cluster_operator_from_release_package">2.3.3 Install cluster operator from release package<a class="headerlink" href="#233_install_cluster_operator_from_release_package" title="Permanent link">&para;</a></h3>
<blockquote>
<p>从发布版中安装Cluster Operator</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">查看安装使用的源</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/</span>
<span class="n">charts</span>  <span class="n">linux-amd64</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/charts/</span>
<span class="n">cluster-operator</span>  <span class="n">cluster-operator-v0</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">tgz</span>  <span class="n">fleet-manager</span>  <span class="n">fleet-manager-v0</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">tgz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">使用helm安装Cluster</span> <span class="n">Operator</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm install kurator-cluster-operator out/charts/cluster-operator-v0.3.0.tgz -n kurator-system --create-namespace</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">输出内容如下</span><span class="err">：</span>
<span class="n">NAME</span><span class="p">:</span> <span class="n">kurator-cluster-operator</span>
<span class="n">LAST</span> <span class="n">DEPLOYED</span><span class="p">:</span> <span class="n">Wed</span> <span class="n">Jun</span> <span class="n">14</span> <span class="n">09</span><span class="p">:</span><span class="n">02</span><span class="p">:</span><span class="n">55</span> <span class="n">2023</span>
<span class="n">NAMESPACE</span><span class="p">:</span> <span class="n">kurator-system</span>
<span class="n">STATUS</span><span class="p">:</span> <span class="n">deployed</span>
<span class="n">REVISION</span><span class="p">:</span> <span class="n">1</span>
<span class="n">TEST</span> <span class="n">SUITE</span><span class="p">:</span> <span class="n">None</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看命名空间创建情况</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get ns</span>
<span class="n">NAME</span>              <span class="n">STATUS</span>   <span class="n">AGE</span>
<span class="n">cert-manager</span>      <span class="n">Active</span>   <span class="n">38m</span>
<span class="k">default</span>           <span class="n">Active</span>   <span class="n">40d</span>
<span class="n">ingress-nginx</span>     <span class="n">Active</span>   <span class="n">40d</span>
<span class="n">kube-node-lease</span>   <span class="n">Active</span>   <span class="n">40d</span>
<span class="n">kube-public</span>       <span class="n">Active</span>   <span class="n">40d</span>
<span class="n">kube-system</span>       <span class="n">Active</span>   <span class="n">40d</span>
<span class="n">kurator-system</span>    <span class="n">Active</span>   <span class="n">61s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看命名空间中pod创建情况</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get pods -n kurator-system</span>
<span class="n">NAME</span>                                        <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">kurator-cluster-operator</span><span class="p">-</span><span class="n">67d8bd6b68-t64db</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">73s</span>
</code></pre></div>
<h2 id="24_fleet_manager">2.4 安装 Fleet Manager<a class="headerlink" href="#24_fleet_manager" title="Permanent link">&para;</a></h2>
<blockquote>
<p>安装舰队管理器，用于对K8S集群进行逻辑分组</p>
</blockquote>
<h3 id="241_install_fluxcd_with_helm">2.4.1 Install FluxCD with Helm<a class="headerlink" href="#241_install_fluxcd_with_helm" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Fleet Manager借助于FluxCD实现对应用程序的部署。参考：<a href="https://fluxcd.io">https://fluxcd.io</a></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">添加FluxCD部署Charts库</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm repo add fluxcd-community https://fluxcd-community.github.io/helm-charts</span>
<span class="s2">&quot;fluxcd-community&quot;</span> <span class="n">has</span> <span class="n">been</span> <span class="n">added</span> <span class="n">to</span> <span class="n">your</span> <span class="n">repositories</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm repo list</span>
<span class="n">NAME</span>                    <span class="n">URL</span>
<span class="n">jetstack</span>                <span class="n">https</span><span class="p">://</span><span class="n">charts</span><span class="p">.</span><span class="n">jetstack</span><span class="p">.</span><span class="n">io</span>
<span class="n">fluxcd-community</span>        <span class="n">https</span><span class="p">://</span><span class="n">fluxcd-community</span><span class="p">.</span><span class="n">github</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">helm-charts</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">更新</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm repo update</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">使用helm部署FluxCD</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># cat &lt;&lt;EOF | helm install fluxcd fluxcd-community/flux2 --version 2.7.0 -n fluxcd-system --create-namespace -f -</span>
<span class="n">imageAutomationController</span><span class="p">:</span>
  <span class="n">create</span><span class="p">:</span> <span class="n">false</span>
<span class="n">imageReflectionController</span><span class="p">:</span>
  <span class="n">create</span><span class="p">:</span> <span class="n">false</span>
<span class="n">notificationController</span><span class="p">:</span>
  <span class="n">create</span><span class="p">:</span> <span class="n">false</span>
<span class="n">EOF</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">输出内容如下</span><span class="err">：</span>
<span class="n">NAME</span><span class="p">:</span> <span class="n">fluxcd</span>
<span class="n">LAST</span> <span class="n">DEPLOYED</span><span class="p">:</span> <span class="n">Wed</span> <span class="n">Jun</span> <span class="n">14</span> <span class="n">09</span><span class="p">:</span><span class="n">09</span><span class="p">:</span><span class="n">28</span> <span class="n">2023</span>
<span class="n">NAMESPACE</span><span class="p">:</span> <span class="n">fluxcd-system</span>
<span class="n">STATUS</span><span class="p">:</span> <span class="n">deployed</span>
<span class="n">REVISION</span><span class="p">:</span> <span class="n">1</span>
<span class="n">TEST</span> <span class="n">SUITE</span><span class="p">:</span> <span class="n">None</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看是否创建命名空间</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get ns</span>
<span class="n">NAME</span>              <span class="n">STATUS</span>   <span class="n">AGE</span>
<span class="n">cert-manager</span>      <span class="n">Active</span>   <span class="n">47m</span>
<span class="k">default</span>           <span class="n">Active</span>   <span class="n">40d</span>
<span class="n">fluxcd-system</span>     <span class="n">Active</span>   <span class="n">3m7s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看是否运行FluxCD组件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get pods -n fluxcd-system</span>
<span class="n">NAME</span>                                    <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">helm-controller</span><span class="p">-</span><span class="n">7c5ff5d6b4-lwhp7</span>        <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">3m12s</span>
<span class="n">kustomize-controller</span><span class="p">-</span><span class="n">5b86757bb4</span><span class="p">-</span><span class="n">6mmgj</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">3m12s</span>
<span class="n">source-controller</span><span class="p">-</span><span class="n">79b7ddc9fc</span><span class="p">-</span><span class="n">9k6gz</span>      <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">3m12s</span>
</code></pre></div>
<h3 id="242_install_fleet_manager_from_release_package">2.4.2 Install fleet manager from release package<a class="headerlink" href="#242_install_fleet_manager_from_release_package" title="Permanent link">&para;</a></h3>
<blockquote>
<p>从发行版中安装Fleet Manager</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">查看安装源</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/</span>
<span class="n">charts</span>  <span class="n">linux-amd64</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/charts/</span>
<span class="n">cluster-operator</span>  <span class="n">cluster-operator-v0</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">tgz</span>  <span class="n">fleet-manager</span>  <span class="n">fleet-manager-v0</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">tgz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">使用helm对Fleet-manager进行管理</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># helm install --create-namespace kurator-fleet-manager out/charts/fleet-manager-v0.3.0.tgz -n kurator-system</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">输出内容如下</span><span class="err">：</span>
<span class="n">NAME</span><span class="p">:</span> <span class="n">kurator-fleet-manager</span>
<span class="n">LAST</span> <span class="n">DEPLOYED</span><span class="p">:</span> <span class="n">Wed</span> <span class="n">Jun</span> <span class="n">14</span> <span class="n">09</span><span class="p">:</span><span class="n">15</span><span class="p">:</span><span class="n">24</span> <span class="n">2023</span>
<span class="n">NAMESPACE</span><span class="p">:</span> <span class="n">kurator-system</span>
<span class="n">STATUS</span><span class="p">:</span> <span class="n">deployed</span>
<span class="n">REVISION</span><span class="p">:</span> <span class="n">1</span>
<span class="n">TEST</span> <span class="n">SUITE</span><span class="p">:</span> <span class="n">None</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看Fleet</span> <span class="n">Manager部署情况</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get pods -n kurator-system</span>
<span class="n">NAME</span>                                        <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">kurator-cluster-operator</span><span class="p">-</span><span class="n">67d8bd6b68-t64db</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">12m</span>
<span class="n">kurator-fleet-manager</span><span class="p">-</span><span class="n">6dbf69dc9d-bh2jm</span>      <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">19s</span>
</code></pre></div>
<h1 id="cluster_operatork8s">三、使用Cluster Operator部署企业生产级K8S集群<a class="headerlink" href="#cluster_operatork8s" title="Permanent link">&para;</a></h1>
<blockquote>
<p>Kurator借助KubeSpray实现对K8S集群快速部署，由于KubeSpray版本为2.20.0,目前仅能安装K8S 1.24.6版本。</p>
</blockquote>
<h2 id="31_k8s">3.1 需要准备用于部署K8S集群节点主机<a class="headerlink" href="#31_k8s" title="Permanent link">&para;</a></h2>
<blockquote>
<p>本次准备3台用于部署K8S集群节点主机，仅需要配置主机名，主机IP地址，主机名与IP地址解析即可 。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">为新建集群主机准备主机名</span>
<span class="c"># hostnamectl set-hostname  XXX</span>

<span class="n">请把XXX替换为</span>
<span class="n">master01</span>
<span class="n">node01</span>
<span class="n">node02</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">为新建集群主机准备IP地址</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@XXX</span> <span class="p">~]</span><span class="c"># vim /etc/sysconfig/network-scripts/ifcfg-ens33</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@XXX</span> <span class="p">~]</span><span class="c"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span>
<span class="n">TYPE</span><span class="p">=</span><span class="s2">&quot;Ethernet&quot;</span>
<span class="n">PROXY_METHOD</span><span class="p">=</span><span class="s2">&quot;none&quot;</span>
<span class="n">BROWSER_ONLY</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">BOOTPROTO</span><span class="p">=</span><span class="s2">&quot;none&quot;</span>
<span class="n">DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV4_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6INIT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_AUTOCONF</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6_ADDR_GEN_MODE</span><span class="p">=</span><span class="s2">&quot;stable-privacy&quot;</span>
<span class="n">NAME</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">UUID</span><span class="p">=</span><span class="s2">&quot;063bfc1c-c7c2-4c62-89d0-35ae869e44e7&quot;</span>
<span class="n">DEVICE</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">ONBOOT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPADDR</span><span class="p">=</span><span class="s2">&quot;192.168.10.14X&quot;</span>
<span class="n">PREFIX</span><span class="p">=</span><span class="s2">&quot;24&quot;</span>
<span class="n">GATEWAY</span><span class="p">=</span><span class="s2">&quot;192.168.10.2&quot;</span>
<span class="n">DNS1</span><span class="p">=</span><span class="s2">&quot;119.29.29.29&quot;</span>

<span class="c"># systemctl restart network</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">为新建集群主机准备主机名与IP地址解析文件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@XXX</span> <span class="p">~]</span><span class="c"># vim /etc/hosts</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@XXX</span> <span class="p">~]</span><span class="c"># cat /etc/hosts</span>
<span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span> <span class="n">localhost</span> <span class="n">localhost</span><span class="p">.</span><span class="n">localdomain</span> <span class="n">localhost4</span> <span class="n">localhost4</span><span class="p">.</span><span class="n">localdomain4</span>
<span class="p">::</span><span class="n">1</span> <span class="n">localhost6</span> <span class="n">localhost6</span><span class="p">.</span><span class="n">localdomain6</span> <span class="n">localhost6</span><span class="p">.</span><span class="n">localdomain</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span> <span class="n">master01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span> <span class="n">node01</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span> <span class="n">node02</span>
</code></pre></div>
<h2 id="32_ssh">3.2 准备ssh密钥<a class="headerlink" href="#32_ssh" title="Permanent link">&para;</a></h2>
<blockquote>
<p>在kubespray节点或kubeasz节点</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">生成密钥</span><span class="err">，</span><span class="n">注意</span><span class="err">：</span><span class="n">如已生成过密钥</span><span class="err">，</span><span class="n">不建议再生成</span><span class="err">，</span><span class="n">可使用原有密钥即可</span> <span class="err">。</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ssh-keygen</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">同步密钥到其它主机</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ssh-copy-id 192.168.10.140</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ssh-copy-id 192.168.10.141</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ssh-copy-id 192.168.10.142</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">基于ssh密钥创建secret</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl create secret generic cluster-secret --from-file=ssh-privatekey=/root/.ssh/id_rsa</span>
<span class="n">secret</span><span class="p">/</span><span class="n">cluster-secret</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看已创建secret</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get secret</span>
<span class="n">NAME</span>             <span class="nb">TYPE </span>    <span class="n">DATA</span>   <span class="n">AGE</span>
<span class="n">cluster-secret</span>   <span class="n">Opaque</span>   <span class="n">1</span>      <span class="n">9s</span>
</code></pre></div>
<h2 id="33_k8s">3.3 在虚拟机上部署K8S集群<a class="headerlink" href="#33_k8s" title="Permanent link">&para;</a></h2>
<h3 id="331">3.3.1 准备部署文件<a class="headerlink" href="#331" title="Permanent link">&para;</a></h3>
<p><img alt="image-20230614111813744" src="../../../img/kubernetes/kubernetes_kurator/image-20230614111813744.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">准备kurator部署K8S集群文件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># git clone https://github.com/kurator-dev/kurator.git</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看文件内容</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># cd kurator/</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># ls</span>
<span class="n">cmd</span>  <span class="n">CODE_OF_CONDUCT</span><span class="p">.</span><span class="nb">md </span> <span class="n">common</span>  <span class="n">CONTRIBUTING</span><span class="p">.</span><span class="nb">md </span> <span class="n">docs</span>  <span class="n">examples</span>  <span class="n">go</span><span class="p">.</span><span class="n">mod</span>  <span class="n">go</span><span class="p">.</span><span class="n">sum</span>  <span class="n">hack</span>  <span class="n">LICENSE</span>  <span class="n">Makefile</span>  <span class="n">manifests</span>  <span class="n">OWNERS</span>  <span class="n">pkg</span>  <span class="n">README</span><span class="p">.</span><span class="nb">md </span> <span class="n">ROADMAP</span><span class="p">.</span><span class="nb">md</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">部署过程中</span><span class="err">，</span><span class="n">如果有报crds错误</span><span class="err">，</span><span class="n">可以先执行以下目录中的文件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/</span>
<span class="n">charts</span>  <span class="n">linux-amd64</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/charts/</span>
<span class="n">cluster-operator</span>  <span class="n">cluster-operator-v0</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">tgz</span>  <span class="n">fleet-manager</span>  <span class="n">fleet-manager-v0</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">tgz</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/charts/cluster-operator</span>
<span class="n">Chart</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">crds</span>  <span class="n">templates</span>  <span class="n">values</span><span class="p">.</span><span class="n">yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls out/charts/cluster-operator/crds/</span>
<span class="n">awsclustercontrolleridentities</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">eksconfigs</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsclusterroleidentities</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>        <span class="n">eksconfigtemplates</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsclusters</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>                     <span class="n">extensionconfigs</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsclusterstaticidentities</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>      <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io_customclusters</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsclustertemplates</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>             <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io_custommachines</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsfargateprofiles</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>              <span class="n">ipaddressclaims</span><span class="p">.</span><span class="n">ipam</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsmachinepools</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>                 <span class="n">ipaddresses</span><span class="p">.</span><span class="n">ipam</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsmachines</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>                     <span class="n">kubeadmconfigs</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsmachinetemplates</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>             <span class="n">kubeadmconfigtemplates</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsmanagedclusters</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>              <span class="n">kubeadmcontrolplanes</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsmanagedcontrolplanes</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>           <span class="n">kubeadmcontrolplanetemplates</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">awsmanagedmachinepools</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>          <span class="n">machinedeployments</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">clusterclasses</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>                                 <span class="n">machinehealthchecks</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">cluster</span><span class="p">.</span><span class="n">kurator</span><span class="p">.</span><span class="n">dev_clusters</span><span class="p">.</span><span class="n">yaml</span>                                    <span class="n">machinepools</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">clusterresourcesetbindings</span><span class="p">.</span><span class="n">addons</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>              <span class="n">machines</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">clusterresourcesets</span><span class="p">.</span><span class="n">addons</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>                     <span class="n">machinesets</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
<span class="n">clusters</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">执行crds文件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl create -f out/charts/cluster-operator/crds</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看执行后的结果</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get crds</span>
<span class="n">NAME</span>                                                             <span class="n">CREATED</span> <span class="n">AT</span>
<span class="n">awsclustercontrolleridentities</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>   <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsclusterroleidentities</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>         <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsclusters</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                      <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsclusterstaticidentities</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>       <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsclustertemplates</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>              <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsfargateprofiles</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>               <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsmachinepools</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                  <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsmachines</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                      <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsmachinetemplates</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>              <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsmanagedclusters</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>               <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsmanagedcontrolplanes</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>            <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">awsmanagedmachinepools</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>           <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">bgpconfigurations</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                          <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">bgppeers</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                                   <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">blockaffinities</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                            <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">buckets</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">toolkit</span><span class="p">.</span><span class="n">fluxcd</span><span class="p">.</span><span class="n">io</span>                                 <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">08</span><span class="p">:</span><span class="n">25Z</span>
<span class="n">caliconodestatuses</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                         <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">certificaterequests</span><span class="p">.</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span>                              <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">03</span><span class="p">:</span><span class="n">55Z</span>
<span class="n">certificates</span><span class="p">.</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span>                                     <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">03</span><span class="p">:</span><span class="n">55Z</span>
<span class="n">challenges</span><span class="p">.</span><span class="n">acme</span><span class="p">.</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span>                                  <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">03</span><span class="p">:</span><span class="n">55Z</span>
<span class="n">clusterclasses</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                                  <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">clusterinformations</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                        <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">clusterissuers</span><span class="p">.</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span>                                   <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">03</span><span class="p">:</span><span class="n">55Z</span>
<span class="n">clusterresourcesetbindings</span><span class="p">.</span><span class="n">addons</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>               <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">clusterresourcesets</span><span class="p">.</span><span class="n">addons</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                      <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">clusters</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">kurator</span><span class="p">.</span><span class="n">dev</span>                                     <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">clusters</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                                        <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">customclusters</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                   <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">custommachines</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                   <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">eksconfigs</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                            <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">eksconfigtemplates</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                    <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">01Z</span>
<span class="n">extensionconfigs</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                        <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">felixconfigurations</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                        <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">fleet</span><span class="p">.</span><span class="n">fleet</span><span class="p">.</span><span class="n">kurator</span><span class="p">.</span><span class="n">dev</span>                                          <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">09</span><span class="p">:</span><span class="n">17Z</span>
<span class="n">gitrepositories</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">toolkit</span><span class="p">.</span><span class="n">fluxcd</span><span class="p">.</span><span class="n">io</span>                         <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">08</span><span class="p">:</span><span class="n">25Z</span>
<span class="n">globalnetworkpolicies</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                      <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">globalnetworksets</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                          <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">helmcharts</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">toolkit</span><span class="p">.</span><span class="n">fluxcd</span><span class="p">.</span><span class="n">io</span>                              <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">08</span><span class="p">:</span><span class="n">25Z</span>
<span class="n">helmreleases</span><span class="p">.</span><span class="n">helm</span><span class="p">.</span><span class="n">toolkit</span><span class="p">.</span><span class="n">fluxcd</span><span class="p">.</span><span class="n">io</span>                              <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">08</span><span class="p">:</span><span class="n">25Z</span>
<span class="n">helmrepositories</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">toolkit</span><span class="p">.</span><span class="n">fluxcd</span><span class="p">.</span><span class="n">io</span>                        <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">08</span><span class="p">:</span><span class="n">25Z</span>
<span class="n">hostendpoints</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                              <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">ipaddressclaims</span><span class="p">.</span><span class="n">ipam</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                            <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">ipaddresses</span><span class="p">.</span><span class="n">ipam</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                                <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">ipamblocks</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                                 <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">ipamconfigs</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                                <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">ipamhandles</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                                <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">ippools</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                                    <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">ipreservations</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                             <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">issuers</span><span class="p">.</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span>                                          <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">03</span><span class="p">:</span><span class="n">55Z</span>
<span class="n">kubeadmconfigs</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                        <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">kubeadmconfigtemplates</span><span class="p">.</span><span class="n">bootstrap</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">kubeadmcontrolplanes</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>               <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">kubeadmcontrolplanetemplates</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>       <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">kubecontrollersconfigurations</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>              <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">kustomizations</span><span class="p">.</span><span class="n">kustomize</span><span class="p">.</span><span class="n">toolkit</span><span class="p">.</span><span class="n">fluxcd</span><span class="p">.</span><span class="n">io</span>                       <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">08</span><span class="p">:</span><span class="n">25Z</span>
<span class="n">machinedeployments</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                              <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">machinehealthchecks</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                             <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">machinepools</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                                    <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">machines</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                                        <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">machinesets</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>                                     <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">19</span><span class="p">:</span><span class="n">02Z</span>
<span class="n">networkpolicies</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                            <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">networksets</span><span class="p">.</span><span class="n">crd</span><span class="p">.</span><span class="n">projectcalico</span><span class="p">.</span><span class="n">org</span>                                <span class="n">2023</span><span class="p">-</span><span class="n">05</span><span class="p">-</span><span class="n">04T14</span><span class="p">:</span><span class="n">12</span><span class="p">:</span><span class="n">39Z</span>
<span class="n">ocirepositories</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">toolkit</span><span class="p">.</span><span class="n">fluxcd</span><span class="p">.</span><span class="n">io</span>                         <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">08</span><span class="p">:</span><span class="n">25Z</span>
<span class="n">orders</span><span class="p">.</span><span class="n">acme</span><span class="p">.</span><span class="n">cert-manager</span><span class="p">.</span><span class="n">io</span>                                      <span class="n">2023</span><span class="p">-</span><span class="n">06</span><span class="p">-</span><span class="n">15T07</span><span class="p">:</span><span class="n">03</span><span class="p">:</span><span class="n">55Z</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">准备部署用K8S集群部署文件</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cp -rfp examples/infra/customcluster examples/infra/my-customcluster</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">进入准备好的K8S集群部署文件所在目录</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cd examples/infra/my-customcluster/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">my-customcluster</span><span class="p">]</span><span class="c"># ls</span>
<span class="n">cc-cluster</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-customcluster</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-custommachine</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-kcp</span><span class="p">.</span><span class="n">yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">修改cc-cluster</span><span class="p">.</span><span class="n">yaml文件</span><span class="err">，</span><span class="n">主要指定pod与service网络</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">my-customcluster</span><span class="p">]</span><span class="c"># vim cc-cluster.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cat examples/infra/my-customcluster/cc-cluster.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Cluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-cluster</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">clusterNetwork</span><span class="p">:</span>
    <span class="n">pods</span><span class="p">:</span>
      <span class="n">cidrBlocks</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">245</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
    <span class="n">services</span><span class="p">:</span>
      <span class="n">cidrBlocks</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">97</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
    <span class="n">serviceDomain</span><span class="p">:</span> <span class="n">kurator-service-domain</span>
  <span class="n">controlPlaneRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">KubeadmControlPlane</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-kcp</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">infrastructureRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">CustomCluster</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-customcluster</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">修改cc-customcluster文件</span><span class="err">，</span><span class="n">指定网络插件</span><span class="err">，</span><span class="n">默认可以不修改</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">my-customcluster</span><span class="p">]</span><span class="c"># vim cc-customcluster.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cat examples/infra/my-customcluster/cc-customcluster.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomCluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-customcluster</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">cni</span><span class="p">:</span>
    <span class="n">type</span><span class="p">:</span> <span class="n">cilium</span>
  <span class="n">machineRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">kurator</span><span class="p">.</span><span class="n">dev</span><span class="p">/</span><span class="n">v1alpha1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">修改cc-custommachine</span><span class="err">，</span><span class="n">指定K8S集群master节点及worker节点</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">my-customcluster</span><span class="p">]</span><span class="c"># vim cc-custommachine.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">my-customcluster</span><span class="p">]</span><span class="c"># cat cc-custommachine.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">master</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
  <span class="n">node</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node02</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">修改cc-kcp文件</span><span class="err">，</span><span class="n">主要指定K8S集群版本</span><span class="err">，</span><span class="n">由于受到kubespray版本影响</span><span class="err">，</span><span class="n">本次可部署最新版本为1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">my-customcluster</span><span class="p">]</span><span class="c"># vim cc-kcp.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cat examples/infra/my-customcluster/cc-kcp.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">KubeadmControlPlane</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-kcp</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">kubeadmConfigSpec</span><span class="p">:</span>
    <span class="n">clusterConfiguration</span><span class="p">:</span>
      <span class="n">clusterName</span><span class="p">:</span> <span class="n">kurator-cluster</span>
      <span class="n">imageRepository</span><span class="p">:</span>
      <span class="n">featureGates</span><span class="p">:</span>
        <span class="n">PodOverhead</span><span class="p">:</span> <span class="n">true</span>
        <span class="n">NodeSwap</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">initConfiguration</span><span class="p">:</span>
    <span class="n">joinConfiguration</span><span class="p">:</span>
  <span class="n">machineTemplate</span><span class="p">:</span>
    <span class="n">infrastructureRef</span><span class="p">:</span>
      <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">customMachine</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<h3 id="332_apply_resource_configuration_deploy_k8s">3.3.2 Apply resource configuration deploy K8S<a class="headerlink" href="#332_apply_resource_configuration_deploy_k8s" title="Permanent link">&para;</a></h3>
<blockquote>
<p>执行部署文件</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl apply -f examples/infra/my-customcluster</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">输出内容如下</span><span class="err">：</span>
<span class="n">cluster</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-cluster</span> <span class="n">created</span>
<span class="n">customcluster</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-customcluster</span> <span class="n">created</span>
<span class="n">custommachine</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-custommachine</span> <span class="n">created</span>
<span class="n">kubeadmcontrolplane</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-kcp</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看部署pod状态</span><span class="err">，</span><span class="n">需要下载kubespray镜像</span><span class="err">，</span><span class="n">共4G大小</span><span class="err">，</span><span class="n">需要等待一定时间</span><span class="err">。</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                    <span class="n">READY</span>   <span class="n">STATUS</span>              <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cc-customcluster-init</span>   <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">ContainerCreating</span>   <span class="n">0</span>          <span class="n">4m17s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看部署过程日志</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl logs cc-customcluster-init -f</span>
</code></pre></div>
<h3 id="333">3.3.3 验证是否安装成功<a class="headerlink" href="#333" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">查看部署pod状态</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                    <span class="n">READY</span>   <span class="n">STATUS</span>      <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cc-customcluster-init</span>   <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Completed</span>   <span class="n">0</span>          <span class="n">123m</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看已部署K8S集群</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get clusters.cluster.x-k8s.io</span>
<span class="n">NAME</span>         <span class="n">PHASE</span>          <span class="n">AGE</span>    <span class="n">VERSION</span>
<span class="n">cc-cluster</span>   <span class="n">Provisioning</span>   <span class="n">125m</span>
</code></pre></div>
<blockquote>
<p>在目标集群主机上进行查看。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@master01</span> <span class="p">~]</span><span class="c"># kubectl get nodes</span>
<span class="n">NAME</span>       <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>    <span class="n">VERSION</span>
<span class="n">master01</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">108m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node01</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">107m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node02</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">107m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get cc</span>
<span class="n">NAME</span>               <span class="n">AGE</span>
<span class="n">cc-customcluster</span>   <span class="n">126m</span>
</code></pre></div>
<h1 id="cluster_operatork8s_1">四、使用Cluster Operator实现对K8S高可用管理<a class="headerlink" href="#cluster_operatork8s_1" title="Permanent link">&para;</a></h1>
<blockquote>
<p>使用kube-vip实现master节点高可用。</p>
<p>需要把原集群删除</p>
<p>需要为新添加的master节点准备ssh免密登录证书</p>
</blockquote>
<h2 id="41_k8smaster">4.1 准备多个k8s集群master节点<a class="headerlink" href="#41_k8smaster" title="Permanent link">&para;</a></h2>
<blockquote>
<p>master02 IP：192.168.10.143/24；master03 IP:192.168.10.144/24</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@localhost</span> <span class="p">~]</span><span class="c"># hostnamectl set-hostname master02</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@localhost</span> <span class="p">~]</span><span class="c"># hostnamectl set-hostname master03</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@XXX</span> <span class="p">~]</span><span class="c"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span>
<span class="n">TYPE</span><span class="p">=</span><span class="s2">&quot;Ethernet&quot;</span>
<span class="n">PROXY_METHOD</span><span class="p">=</span><span class="s2">&quot;none&quot;</span>
<span class="n">BROWSER_ONLY</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">BOOTPROTO</span><span class="p">=</span><span class="s2">&quot;none&quot;</span>
<span class="n">DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV4_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6INIT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_AUTOCONF</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6_ADDR_GEN_MODE</span><span class="p">=</span><span class="s2">&quot;stable-privacy&quot;</span>
<span class="n">NAME</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">UUID</span><span class="p">=</span><span class="s2">&quot;063bfc1c-c7c2-4c62-89d0-35ae869e44e7&quot;</span>
<span class="n">DEVICE</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">ONBOOT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPADDR</span><span class="p">=</span><span class="s2">&quot;192.168.10.14X&quot;</span>
<span class="n">PREFIX</span><span class="p">=</span><span class="s2">&quot;24&quot;</span>
<span class="n">GATEWAY</span><span class="p">=</span><span class="s2">&quot;192.168.10.2&quot;</span>
<span class="n">DNS1</span><span class="p">=</span><span class="s2">&quot;119.29.29.29&quot;</span>

<span class="c"># systemctl restart network</span>
</code></pre></div>
<h2 id="42">4.2 修改声明文件<a class="headerlink" href="#42" title="Permanent link">&para;</a></h2>
<h3 id="421">4.2.1 集群主机定义文件<a class="headerlink" href="#421" title="Permanent link">&para;</a></h3>
<blockquote>
<p>examples/infra/my-customcluster/cc-custommachine.yaml</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># vim examples/infra/my-customcluster/cc-custommachine.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cat examples/infra/my-customcluster/cc-custommachine.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">master</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master02</span> <span class="n">添加新主机</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master03</span> <span class="n">添加新主机</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
  <span class="n">node</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node02</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
</code></pre></div>
<h3 id="422">4.2.2 集群定义文件<a class="headerlink" href="#422" title="Permanent link">&para;</a></h3>
<blockquote>
<p>examples/infra/my-customcluster/customcluster.yaml</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">添加如下内容</span><span class="err">：</span>
<span class="c"># add config</span>
  <span class="n">controlPlaneConfig</span><span class="p">:</span>
    <span class="c"># address is your VIP, assume your VIP is 192.x.x.0</span>
    <span class="n">address</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">100</span>
    <span class="c"># loadBalancerDomainName is an optional field that sets the load balancer domain name. </span>
    <span class="c"># If not specified, the default name, controlPlaneConfig.address is used. </span>
    <span class="n">loadBalancerDomainName</span><span class="p">:</span> <span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
    <span class="c"># optional, sets extra Subject Alternative Names for the API Server signing cert. </span>
    <span class="c"># If you don&#39;t have any want to add, you can directly remove this field.</span>
    <span class="n">certSANs</span><span class="p">:</span> <span class="p">[</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span><span class="p">,</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span><span class="p">,</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># vim examples/infra/my-customcluster/cc-customcluster.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cat examples/infra/my-customcluster/cc-customcluster.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomCluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-customcluster</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">cni</span><span class="p">:</span>
    <span class="n">type</span><span class="p">:</span> <span class="n">cilium</span>
  <span class="n">controlPlaneConfig</span><span class="p">:</span>
    <span class="n">address</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">100</span>
    <span class="n">loadBalancerDomainName</span><span class="p">:</span> <span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
    <span class="n">certSANs</span><span class="p">:</span> <span class="p">[</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span><span class="p">,</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span><span class="p">,</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span><span class="p">]</span>
  <span class="n">machineRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">kurator</span><span class="p">.</span><span class="n">dev</span><span class="p">/</span><span class="n">v1alpha1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
</code></pre></div>
<h2 id="43_master">4.3 应用资源文件创建多master节点集群<a class="headerlink" href="#43_master" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl apply -f examples/infra/my-customcluster/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">输出内容如下</span><span class="err">：</span>
<span class="n">cluster</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-cluster</span> <span class="n">created</span>
<span class="n">customcluster</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-customcluster</span> <span class="n">created</span>
<span class="n">custommachine</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-custommachine</span> <span class="n">created</span>
<span class="n">kubeadmcontrolplane</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-kcp</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl logs cc-customcluster-init -f</span>
</code></pre></div>
<blockquote>
<p>在k8s集群节点上查看</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@master01</span> <span class="p">~]</span><span class="c"># kubectl get po -A | grep kube-vip</span>
<span class="n">kube-system</span>   <span class="n">kube-vip-master01</span>                  <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>              <span class="n">9m29s</span>
<span class="n">kube-system</span>   <span class="n">kube-vip-master02</span>                  <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>              <span class="n">7m31s</span>
<span class="n">kube-system</span>   <span class="n">kube-vip-master03</span>                  <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>              <span class="n">7m31s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@master01</span> <span class="p">~]</span><span class="c"># cat /root/.kube/config</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">clusters</span><span class="p">:</span>
<span class="p">-</span> <span class="n">cluster</span><span class="p">:</span>
    <span class="n">certificate-authority-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EWXhOREEwTkRVeU1sb1hEVE16TURZeE1UQTBORFV5TWxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTmdrCjZFOTdBVjNlYXRwUXh5VG9acFA4c1duSFJoa1pTRVdBd01JSVI0N0w1U0hBcktwSDVuQVZiaS92VFdHaFNEQjIKUEsyb08xQlRYUzFNTmtxUCs4SEtvZ2s4R2RiOUllUUszbm9CaDYrR21nSEpQZkxpL1NHS3VlcC8xZHpDb3hTUgpUbE1PWVd1QmNiRUxibWJ6ZDFjMzBIRkYraHd5cHNCZE9STmlmZlZBZW5SYkx2NzdFZThrQlc5UTNDczJmdmpnClBEdzllWEl0Sitzc1F6aTNzb2I1b3RFREtKSTE0clBCYTFzaUN3eUZSYmhIZFlrSnBIZlJjNHI2NnMzQmE5dVIKMzF6QzI4R1UwRnA0RDZuUFZRMWZkVEZMS0tsYzlTeHJsdTFCcEtpbUY5WnYwYlIzMDNDd2ZVU0V0VEVMQTRvdQpNVDZya1p2cFpKcVhwNkZ1V2RFQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZHQkRldG15OGxOQzM2dnlXU1VnT09JbVNHeERNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBS0pMcUljUlBITVBFT1BNN0ltcgpuTExPWElvWlBWd3ZTN01PcGxVL3ZITzBRWjVtZFR5T0pnYk5GL2RpL2ozRTVLbTc2b0gvbXNqTUxYbnNyZmlGCkU5KzZRY3UvNEJUYkpuK21qV05wYk1VOW10OFkvQWdseEorYmpWaGdoMzF1VGdFaUJFYTVOYklmM01Td3h2TjUKL0dBU1VFU3FIaEdTNE5hMkcwQ0wzQ0ZNMW1BUWJIOFpvNk1hWlVHbHhVbE5XSG9lZU5XaFNvRU5SNWFHanM3cgpkTndkK241UkZzV2huR1NzMFFCSzViS2grSjVCSmZEVlp1WHVJVEpIeWxMNTR1cndPOWc3UkVQdmhSWUtJbEVZCms4OG5zempWNjRWdXJHaENScU1sSzFtTlphYlVaL0ZzdCtLa0w0Q1hIZC81VVhQWkRmMUJkeTdaVWVFdEN0OHYKQnhjPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="p">==</span>
    <span class="n">server</span><span class="p">:</span> <span class="n">https</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">100</span><span class="p">:</span><span class="n">6443</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">local</span>
<span class="n">contexts</span><span class="p">:</span>
<span class="p">-</span> <span class="n">context</span><span class="p">:</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">local</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">kubernetes-admin</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">kubernetes-admin</span><span class="nv">@cluster</span><span class="p">.</span><span class="n">local</span>
<span class="n">current-context</span><span class="p">:</span> <span class="n">kubernetes-admin</span><span class="nv">@cluster</span><span class="p">.</span><span class="n">local</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Config</span>
<span class="n">preferences</span><span class="p">:</span> <span class="p">{}</span>
<span class="n">users</span><span class="p">:</span>
<span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">kubernetes-admin</span>
  <span class="n">user</span><span class="p">:</span>
    <span class="n">client-certificate-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJVENDQWdtZ0F3SUJBZ0lJQjZFRnB3NC91UGt3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBMk1UUXdORFExTWpKYUZ3MHlOREEyTVRNd05EUTFNak5hTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXZPQ2xVaUFEcDZmQXFIcUYKYUE4SjZLSzdiS0EvV2plNmFhUU1xZ3dvWkJhVG1uVkQyN0J3YWpqcXMva3dHOHZHWG5nNjVhVHNTZ3l2QUczNQpTdFFyeXVNV1ZxRW43SERKYWIrc3VyNVpYeEZyczZSOGUramdjRmJDM3dLT01JNDg0N2taZ2t6L2VxUjREbTkxCkxJLytXT3RFNXJtcGY5OXdhYVRCWnlBK2hSaFdiYzJSOTd0eEdEZU1XTzZpWUdNWS92K2V0R1ZmRm81bUNtUzUKVWpudzM5eGE0VlJtS2xwcUhmbWhCRk1wSDVhdElPNnZUdGE2bEZsS21qeFBDVmI2UmQ2YU9iN1ZkSUhMWC9ubgpBcU8yaHZCQ3J5a2prY2NzWHNGa0QxVldVbjNXeEVrV2tWdmFYaGtvZk1vUUxjMHNhQUE4UUhrZ3pxZDQwNHl1CkVZZllPUUlEQVFBQm8xWXdWREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JSZ1EzclpzdkpUUXQrcjhsa2xJRGppSmtocwpRekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBSjBRZlpnc3UrNXlyemhOa0JqMC9JQm9uYTh5a1dldERhSWc3CktaZURuMHYraXZxTWFzanNtUS82OWlCWU15R0ZwOTlZY2FTcTEvUDV1a2pSV0taWXRIRzRDR0tKV3grdVIzVU8KUHZQcklJUVBkMGp4MFR6dkM5dmQ3NWlodVpmM0VJTmdoZzZBWWxtbDkveXdHV2NhaDltdWduclRwcjBrMm12OApCY0FHYnpZT2RxaHlnQzZjT1YveU1MZEhXcTF1OERHaFkzSHVwdFIydEhTTlIzV3NoQ1RUdHNRQ1NNVE82Sm1NCktFcWpIN25oSit3WWkyNGZJTGdoNWpQR0V4QXRwMTZqSzZkUXpXNUFKdFFsZjhoZURTdCs3Y2NEYkIzRU1GZmsKQmxtOG1DU2l4RzFQdFhYS2FJelhmZDNhQ2NxREpMcldKUVFkbXp2WjE1SlhnczhqaVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="p">==</span>
    <span class="n">client-key-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdk9DbFVpQURwNmZBcUhxRmFBOEo2S0s3YktBL1dqZTZhYVFNcWd3b1pCYVRtblZECjI3Qndhampxcy9rd0c4dkdYbmc2NWFUc1NneXZBRzM1U3RRcnl1TVdWcUVuN0hESmFiK3N1cjVaWHhGcnM2UjgKZStqZ2NGYkMzd0tPTUk0ODQ3a1pna3ovZXFSNERtOTFMSS8rV090RTVybXBmOTl3YWFUQlp5QStoUmhXYmMyUgo5N3R4R0RlTVdPNmlZR01ZL3YrZXRHVmZGbzVtQ21TNVVqbnczOXhhNFZSbUtscHFIZm1oQkZNcEg1YXRJTzZ2ClR0YTZsRmxLbWp4UENWYjZSZDZhT2I3VmRJSExYL25uQXFPMmh2QkNyeWtqa2Njc1hzRmtEMVZXVW4zV3hFa1cKa1Z2YVhoa29mTW9RTGMwc2FBQThRSGtnenFkNDA0eXVFWWZZT1FJREFRQUJBb0lCQUc3VWd5M0ZpMTk5bUJkRQpqYk9aMzM2YXZzL20yRVhnSFlxUHNMNjNrNXZuZzRWRytpS1hUZCtHdG5JVTdwM2czTzNpTHUxQjhVVWlYQzRzCldmUUd2QXU1WlFwQVZtVHZhY0Nic0llRDJuMW1nNFJPS0oyczhNWDZveTZwR1RaMHdGWC83Mi8rTG91UXBzSVIKdFBnSkpuNld6ejkwQW5uK2FzQVM1VW5XS2RsK2hGRE5CcExPU05oOWhqMU5OTHNVWVpCaWVTV2p3NFVtaVlpVgpqQkI2NmppMFp1WmVpUFFpdSs4blNPT2kyNkJ3Nm5STGZadzE4RG5GTlF6dS92ZDZteDZaMFVlQ2Yzc1dhOXdTCm5pUXFvY1lVOElML3VCSkQxWEpPSVhHTSsrbXVmcnpZUTlmanpITTFuQ05MamIvS0xMakhSamJlQnZLdnpyUmgKaXVyK0NlRUNnWUVBNGViN1pFaUNaZ3V3a3NZdE9FR1RReWdiL2xvdlJUQUFxNHpIanRSaFBWMXhyZU5yd0ZWdwp5MzZDbmVuUlUyUTlwNTFDRG5BL1RJNkVGMU9VQlVXcld1ci9UeGc4TWpzUjhTZmtFWWFUK0xzcTA3a2E3ckMzCmNWM1dwN1diQmc4QzRCUHFlQ01ESHVhbE1oT2dsblYzZERtcFFxcE5aaHU5OVltd2dCR25ZNHNDZ1lFQTFnclYKTjl0L3k2N080T1dtMDVDTy9nUUY2YTlIL01OL2FWVzdSeHBmSjE2alY2aGxzbFE0NnJaekxXd2ZoNk1XRDFUNwptQWZ5a3U1UGx2VFVhVCtqbmVpMlpOZzBrazRkTk9XYU5uaWw0Z0ZOUHFpZXhuZUpOV1hDWlhCNmVoUURkSUtGCjZyN1JmTHp3R3hrUlNscC90VWtaeW5lN3pPaFYvRUhzWDhOczI4c0NnWUVBMkxMdGhtWjBDQlhBblJ0VDkzb1kKSEx6V0ZhbEhYUlJPSUVJY2tDdTAxOXZTbDk3bjF3bGUrU1h6Z0MzeWFnOW5nV2srRzRHYmh3SFRQbGtqVGVkbQpHQUlEUlVsWFBVd2l5dlhjTnQrbEJGM3ZHRWloeUVSbXhHNGk0cUE0QkpqVHhrWDBqcWZ2YjI0TEc3MXVOOGFZCi96bnMzeEZreThWaTlLM1BUUnNpT2o4Q2dZRUFpN0lVU05sOGhkNDRiWFhWTk4xelJmd3dNNzFQbVh1cXEzL2wKczlsVll5ZVVLZ0RoSnN0clBsMEh2UXlGWTR3Z09LOTVhVmMrallEMTl3c2htdk9MQU9QQ0x2MGhDcC9xMWZ4SQpjdWE1TlZFdUxnZjFZSWpoeHpUNzlDSzkvUEVVOURTLzNGN2Y4SzZMY3RRZ2djdWc4QnVldHBNQXdoS2RFLytlCm16Mjd6Wk1DZ1lCbWY3MkcvVXBVcktFcjNvNGNEL0crSHFvYWNCL09JdklobkRwWXJKNWJxY29TdHZKektldjgKS041WXN2MEZnVE5IQ0VPeEpUOTFuRVRnanU2WDVuaEJiNzhKdzd5cWxiRkh6cU4rZzREZDBvY05mTjdoVVprSQp4THZGdWtxNWYzaWF6RjRHQ3VhdVVPaldaOWhDZDhuSnArY29HWVI3dmpaby8ycnozdVVhOXc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo</span><span class="p">=</span>
</code></pre></div>
<h1 id="cluster_operatork8s_2">五、使用Cluster Operator对K8S进行扩展<a class="headerlink" href="#cluster_operatork8s_2" title="Permanent link">&para;</a></h1>
<blockquote>
<p>借助 Kurator，可以以声明方式添加、删除或替换 VM 上的多个工作节点。执行缩放时，应避免修改主机名，以防同一 VM 配置了多个名称。只需要在目标 customMachine 上声明想要的最终工作节点状态，Kurator 就可以在没有任何外部干预的情况下完成节点缩放。</p>
</blockquote>
<h2 id="51">5.1 扩展工作节点<a class="headerlink" href="#51" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@localhost</span> <span class="p">~]</span><span class="c"># hostnamectl set-hostname node3</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@localhost</span> <span class="p">~]</span><span class="c"># vim /etc/sysconfig/network-scripts/ifcfg-ens33 </span>
<span class="p">[</span><span class="n">root</span><span class="nv">@localhost</span> <span class="p">~]</span><span class="c"># cat /etc/sysconfig/network-scripts/ifcfg-ens33 </span>
<span class="n">TYPE</span><span class="p">=</span><span class="s2">&quot;Ethernet&quot;</span>
<span class="n">PROXY_METHOD</span><span class="p">=</span><span class="s2">&quot;none&quot;</span>
<span class="n">BROWSER_ONLY</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">BOOTPROTO</span><span class="p">=</span><span class="s2">&quot;none&quot;</span>
<span class="n">DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV4_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6INIT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_AUTOCONF</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_DEFROUTE</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPV6_FAILURE_FATAL</span><span class="p">=</span><span class="s2">&quot;no&quot;</span>
<span class="n">IPV6_ADDR_GEN_MODE</span><span class="p">=</span><span class="s2">&quot;stable-privacy&quot;</span>
<span class="n">NAME</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">UUID</span><span class="p">=</span><span class="s2">&quot;063bfc1c-c7c2-4c62-89d0-35ae869e44e7&quot;</span>
<span class="n">DEVICE</span><span class="p">=</span><span class="s2">&quot;ens33&quot;</span>
<span class="n">ONBOOT</span><span class="p">=</span><span class="s2">&quot;yes&quot;</span>
<span class="n">IPADDR</span><span class="p">=</span><span class="s2">&quot;192.168.10.145&quot;</span>
<span class="n">PREFIX</span><span class="p">=</span><span class="s2">&quot;24&quot;</span>
<span class="n">GATEWAY</span><span class="p">=</span><span class="s2">&quot;192.168.10.2&quot;</span>
<span class="n">DNS1</span><span class="p">=</span><span class="s2">&quot;119.29.29.29&quot;</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@localhost</span> <span class="p">~]</span><span class="c"># systemctl restart network</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># ssh-copy-id 192.168.10.145</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cp examples/infra/my-customcluster/cc-custommachine.yaml examples/infra/my-customcluster/scale.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># vi examples/infra/my-customcluster/scale.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># cat examples/infra/my-customcluster/scale.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">master</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master02</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master03</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
  <span class="n">node</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node02</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node03</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">145</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">145</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl apply -f examples/infra/my-customcluster/scale.yaml</span>

<span class="n">custommachine</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-custommachine</span> <span class="n">configured</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                        <span class="n">READY</span>   <span class="n">STATUS</span>      <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cc-customcluster-init</span>       <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Completed</span>   <span class="n">0</span>          <span class="n">60m</span>
<span class="n">cc-customcluster-scale-up</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>     <span class="n">0</span>          <span class="n">29s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl logs cc-customcluster-scale-up -f</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@master01</span> <span class="p">~]</span><span class="c"># kubectl get nodes</span>
<span class="n">NAME</span>       <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>   <span class="n">VERSION</span>
<span class="n">master01</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">85m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">master02</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">84m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">master03</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">83m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node01</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">21m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node02</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">21m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node03</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">31m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<h2 id="52">5.2 删除节点<a class="headerlink" href="#52" title="Permanent link">&para;</a></h2>
<blockquote>
<p>在examples/infra/my-customcluster/scale.yaml文件中删除或注释相应的集群节点后，再使用kubectl apply -f examples/infra/my-customcluster/scale.yaml即可 。</p>
</blockquote>
<h1 id="cluster_operatork8s_3">六、使用Cluster Operator对K8S集群版本进行升级<a class="headerlink" href="#cluster_operatork8s_3" title="Permanent link">&para;</a></h1>
<blockquote>
<p>需要做的就是在 kcp 上声明所需的 Kubernetes 版本，Kurator 将在没有任何外部干预的情况下完成集群升级。由于升级实现依赖kubeadm，建议避免跳过小版本。例如，您可以从v1.22.0 升级到v1.23.9，但不能**从**v1.22.0 一步升级到v1.24.0。要声明所需的升级版本，只需编辑 kcp 的 CRD 以反映所需的升级版本</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@master01</span> <span class="p">~]</span><span class="c"># kubectl get nodes</span>
<span class="n">NAME</span>       <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>   <span class="n">VERSION</span>
<span class="n">master01</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">91m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
<span class="n">master02</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">90m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
<span class="n">master03</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">89m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
<span class="n">node01</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">27m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
<span class="n">node02</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">27m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
<span class="n">node03</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">37m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get kcp</span>
<span class="n">NAME</span>     <span class="n">CLUSTER</span>      <span class="n">INITIALIZED</span>   <span class="n">API</span> <span class="n">SERVER</span> <span class="n">AVAILABLE</span>   <span class="n">REPLICAS</span>   <span class="n">READY</span>   <span class="n">UPDATED</span>   <span class="n">UNAVAILABLE</span>   <span class="n">AGE</span>    <span class="n">VERSION</span>
<span class="n">cc-kcp</span>   <span class="n">cc-cluster</span>                                                                                   <span class="n">108m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl edit kcp cc-kcp</span>
<span class="n">原内容</span><span class="err">：</span>
<span class="n">machineTemplate</span><span class="p">:</span>
    <span class="n">infrastructureRef</span><span class="p">:</span>
      <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">customMachine</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="p">{}</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">rolloutStrategy</span><span class="p">:</span>
    <span class="n">rollingUpdate</span><span class="p">:</span>
      <span class="n">maxSurge</span><span class="p">:</span> <span class="n">1</span>
    <span class="n">type</span><span class="p">:</span> <span class="n">RollingUpdate</span>
  <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">5</span>
<span class="p">......</span>

<span class="n">修改为</span><span class="err">：</span>
<span class="n">machineTemplate</span><span class="p">:</span>
    <span class="n">infrastructureRef</span><span class="p">:</span>
      <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">customMachine</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="p">{}</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">rolloutStrategy</span><span class="p">:</span>
    <span class="n">rollingUpdate</span><span class="p">:</span>
      <span class="n">maxSurge</span><span class="p">:</span> <span class="n">1</span>
    <span class="n">type</span><span class="p">:</span> <span class="n">RollingUpdate</span>
  <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="p">......</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get kcp</span>
<span class="n">NAME</span>  <span class="n">CLUSTER</span>  <span class="n">INITIALIZED</span> <span class="n">API</span> <span class="n">SERVER</span> <span class="n">AVAILABLE</span> <span class="n">REPLICAS</span> <span class="n">READY</span> <span class="n">UPDATED</span> <span class="n">UNAVAILABLE</span> <span class="n">AGE</span>  <span class="n">VERSION</span>
<span class="n">cc-kcp</span>   <span class="n">cc-cluster</span>                                                               <span class="n">110m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                       <span class="n">READY</span>   <span class="n">STATUS</span>      <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cc-customcluster-init</span>      <span class="n">0</span><span class="p">/</span><span class="n">1</span>     <span class="n">Completed</span>   <span class="n">0</span>          <span class="n">54m</span>
<span class="n">cc-customcluster-upgrade</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>     <span class="n">0</span>          <span class="n">13s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">要确认升级工作器正在运行</span><span class="p">,</span><span class="n">命令如下</span><span class="err">：</span>

<span class="c"># kubectl get pod -A | grep -i upgrade</span>
</code></pre></div>
<h1 id="cluster_operatork8s_4">七、使用Cluster Operator删除K8S集群<a class="headerlink" href="#cluster_operatork8s_4" title="Permanent link">&para;</a></h1>
<h2 id="71">7.1 查找集群资源<a class="headerlink" href="#71" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get clusters.cluster.x-k8s.io</span>
<span class="n">NAME</span>         <span class="n">PHASE</span>          <span class="n">AGE</span>    <span class="n">VERSION</span>
<span class="n">cc-cluster</span>   <span class="n">Provisioning</span>   <span class="n">166m</span>
</code></pre></div>
<h2 id="72">7.2 删除自定义集群资源<a class="headerlink" href="#72" title="Permanent link">&para;</a></h2>
<blockquote>
<p>整个集群删除大约需要5分钟</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl delete clusters.cluster.x-k8s.io cc-cluster</span>
<span class="n">cluster</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span> <span class="s2">&quot;cc-cluster&quot;</span> <span class="n">deleted</span>
</code></pre></div>
<h2 id="73">7.3 查看是否删除完成<a class="headerlink" href="#73" title="Permanent link">&para;</a></h2>
<blockquote>
<p>可以在终端中打开一个新的命令选项卡来检查终止 pod 的状态,当此pod消失时 表示执行完成。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                         <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cc-customcluster-terminate</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">88s</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># watch kubectl get pods</span>
</code></pre></div>
<h1 id="kurator_2">八、使用kurator实现多集群管理<a class="headerlink" href="#kurator_2" title="Permanent link">&para;</a></h1>
<blockquote>
<p>需要准备2套k8s集群主机。</p>
</blockquote>
<h2 id="81_k8s">8.1 创建多K8S集群<a class="headerlink" href="#81_k8s" title="Permanent link">&para;</a></h2>
<blockquote>
<p>创建K8S集群前需要准备crds</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">infra</span><span class="p">]</span><span class="c"># pwd</span>
<span class="p">/</span><span class="n">root</span><span class="p">/</span><span class="n">kurator</span><span class="p">/</span><span class="n">examples</span><span class="p">/</span><span class="n">infra</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">infra</span><span class="p">]</span><span class="c"># ls</span>
<span class="n">customcluster</span>  <span class="n">first-customcluster</span>  <span class="n">second-customcluster</span>
</code></pre></div>
<h3 id="811_first-customcluster">8.1.1 创建first-customcluster集群<a class="headerlink" href="#811_first-customcluster" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">infra</span><span class="p">]</span><span class="c"># cd first-customcluster/</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># ls</span>
<span class="n">cc-cluster</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-customcluster</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-custommachine</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-kcp</span><span class="p">.</span><span class="n">yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># vim cc-cluster.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># cat cc-cluster.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Cluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">first-cluster</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">clusterNetwork</span><span class="p">:</span>
    <span class="n">pods</span><span class="p">:</span>
      <span class="n">cidrBlocks</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">245</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
    <span class="n">services</span><span class="p">:</span>
      <span class="n">cidrBlocks</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">97</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
    <span class="n">serviceDomain</span><span class="p">:</span> <span class="n">kurator-service-domain</span>
  <span class="n">controlPlaneRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">KubeadmControlPlane</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-kcp-first</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">infrastructureRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">CustomCluster</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-customcluster-first</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>


<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># vim cc-customcluster.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># cat cc-customcluster.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomCluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-customcluster-first</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">cni</span><span class="p">:</span>
    <span class="n">type</span><span class="p">:</span> <span class="n">cilium</span>
  <span class="n">machineRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">kurator</span><span class="p">.</span><span class="n">dev</span><span class="p">/</span><span class="n">v1alpha1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine-first</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>



<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># vim cc-custommachine.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># cat cc-custommachine.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine-first</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">master</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
  <span class="n">node</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">141</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node02</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">142</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>



<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># vim cc-kcp.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">first-customcluster</span><span class="p">]</span><span class="c"># cat cc-kcp.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">KubeadmControlPlane</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-kcp-first</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">kubeadmConfigSpec</span><span class="p">:</span>
    <span class="n">clusterConfiguration</span><span class="p">:</span>
      <span class="n">clusterName</span><span class="p">:</span> <span class="n">kurator-cluster-first</span>
      <span class="n">imageRepository</span><span class="p">:</span>
      <span class="n">featureGates</span><span class="p">:</span>
        <span class="n">PodOverhead</span><span class="p">:</span> <span class="n">true</span>
        <span class="n">NodeSwap</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">initConfiguration</span><span class="p">:</span>
    <span class="n">joinConfiguration</span><span class="p">:</span>
  <span class="n">machineTemplate</span><span class="p">:</span>
    <span class="n">infrastructureRef</span><span class="p">:</span>
      <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">customMachine</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine-first</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl apply -f examples/infra/first-customcluster</span>
<span class="n">cluster</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">first-cluster</span> <span class="n">created</span>
<span class="n">customcluster</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-customcluster</span> <span class="n">created</span>
<span class="n">custommachine</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-custommachine</span> <span class="n">created</span>
<span class="n">kubeadmcontrolplane</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-kcp-first</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                          <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cc-customcluster-first-init</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">36s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@master01</span> <span class="p">~]</span><span class="c"># kubectl get nodes</span>
<span class="n">NAME</span>       <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>    <span class="n">VERSION</span>
<span class="n">master01</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">163m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node01</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">162m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node02</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">162m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<h3 id="812_second-customcluster">8.1.2 创建second-customcluster集群<a class="headerlink" href="#812_second-customcluster" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">infra</span><span class="p">]</span><span class="c"># cd second-customcluster/</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># ls</span>
<span class="n">cc-cluster</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-customcluster</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-custommachine</span><span class="p">.</span><span class="n">yaml</span>  <span class="n">cc-kcp</span><span class="p">.</span><span class="n">yaml</span>


<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># vim cc-cluster.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># cat cc-cluster.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Cluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-cluster-second</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">clusterNetwork</span><span class="p">:</span>
    <span class="n">pods</span><span class="p">:</span>
      <span class="n">cidrBlocks</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">246</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
    <span class="n">services</span><span class="p">:</span>
      <span class="n">cidrBlocks</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">98</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
    <span class="n">serviceDomain</span><span class="p">:</span> <span class="n">kurator-service-domain</span>
  <span class="n">controlPlaneRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">KubeadmControlPlane</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-kcp-second</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">infrastructureRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">CustomCluster</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-customcluster-second</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># vim cc-customcluster.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># cat cc-customcluster.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomCluster</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-customcluster-second</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">cni</span><span class="p">:</span>
    <span class="n">type</span><span class="p">:</span> <span class="n">cilium</span>
  <span class="n">machineRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">cluster</span><span class="p">.</span><span class="n">kurator</span><span class="p">.</span><span class="n">dev</span><span class="p">/</span><span class="n">v1alpha1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine-second</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>


<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># vim cc-custommachine.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># cat cc-custommachine.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomMachine</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine-second</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">master</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">master01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
  <span class="n">node</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node01</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">144</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>
    <span class="p">-</span> <span class="n">hostName</span><span class="p">:</span> <span class="n">node02</span>
      <span class="n">publicIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">145</span>
      <span class="n">privateIP</span><span class="p">:</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">145</span>
      <span class="n">sshKey</span><span class="p">:</span>
        <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Secret</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">cluster-secret</span>

<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># vim cc-kcp.yaml</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">second-customcluster</span><span class="p">]</span><span class="c"># cat cc-kcp.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">KubeadmControlPlane</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">cc-kcp-second</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">kubeadmConfigSpec</span><span class="p">:</span>
    <span class="n">clusterConfiguration</span><span class="p">:</span>
      <span class="n">clusterName</span><span class="p">:</span> <span class="n">kurator-cluster-second</span>
      <span class="n">imageRepository</span><span class="p">:</span>
      <span class="n">featureGates</span><span class="p">:</span>
        <span class="n">PodOverhead</span><span class="p">:</span> <span class="n">true</span>
        <span class="n">NodeSwap</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">initConfiguration</span><span class="p">:</span>
    <span class="n">joinConfiguration</span><span class="p">:</span>
  <span class="n">machineTemplate</span><span class="p">:</span>
    <span class="n">infrastructureRef</span><span class="p">:</span>
      <span class="n">apiVersion</span><span class="p">:</span> <span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">customMachine</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">cc-custommachine-second</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl apply -f examples/infra/second-customcluster</span>
<span class="n">cluster</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-cluster-second</span> <span class="n">created</span>
<span class="n">customcluster</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-customcluster</span> <span class="n">created</span>
<span class="n">custommachine</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-custommachine</span> <span class="n">created</span>
<span class="n">kubeadmcontrolplane</span><span class="p">.</span><span class="n">controlplane</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-kcp-second</span> <span class="n">created</span>
<span class="n">custommachine</span><span class="p">.</span><span class="n">infrastructure</span><span class="p">.</span><span class="n">cluster</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">cc-custommachine</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="n">kurator</span><span class="p">]</span><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                    <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">cc-customcluster-second-init</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">101s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@master01</span> <span class="p">~]</span><span class="c"># kubectl get nodes</span>
<span class="n">NAME</span>       <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>   <span class="n">VERSION</span>
<span class="n">master01</span>   <span class="n">Ready</span>    <span class="n">control-plane</span>   <span class="n">44m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node01</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">43m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
<span class="n">node02</span>     <span class="n">Ready</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">43m</span>   <span class="n">v1</span><span class="p">.</span><span class="n">24</span><span class="p">.</span><span class="n">6</span>
</code></pre></div>
<h2 id="82_secret">8.2 创建用于连接集群secret<a class="headerlink" href="#82_secret" title="Permanent link">&para;</a></h2>
<h3 id="821_kubeconfig">8.2.1 准备kubeconfig文件<a class="headerlink" href="#821_kubeconfig" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># scp 192.168.10.140:/root/.kube/config /root/.kube/kurator-member1.config</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># scp 192.168.10.143:/root/.kube/config /root/.kube/kurator-member2.config</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># ls /root/.kube/</span>
<span class="n">cache</span>  <span class="n">config</span>  <span class="n">kurator-member1</span><span class="p">.</span><span class="n">config</span>  <span class="n">kurator-member2</span><span class="p">.</span><span class="n">config</span>
</code></pre></div>
<blockquote>
<p>注意修改config文件中server地址部分为每一个K8S集群master节点IP地址。注：修改集群名称、上下文名称、管理员名称等。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># cat /root/.kube/kurator-member1.config</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">clusters</span><span class="p">:</span>
<span class="p">-</span> <span class="n">cluster</span><span class="p">:</span>
    <span class="n">certificate-authority-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EWXhOVEE1TURjek9Gb1hEVE16TURZeE1qQTVNRGN6T0Zvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTnYyCmd3MXJSeTUrMGRLWE5CRDN4QkR2V0NDc1RnSDJhRUhEQ3pIU3BQaVhab3I4YVhKT3p1QzMvdFZZOXV0N01DbC8KZTBwTDRxMWV4UnBaWDErYUVrUWNhalFXWWQrc2daUWFDQXlPWnJGQVZQOGpNdkhTVEx5N0NJZVg4U3NyR2RPQgoyQjFyenJXRXZ3V1RGUklsSFdKQ0s4ZWZ4N2F3WnhHdDVQQSt5MmVVbno1QWxKVWN2ZDEreHlDV0F1UDY5Ulc3Cm1Bdzd1N2pDRytlby9MeTVOTlVLK1hQQUxhMk9LdmloODNaZi80NkJOeHNKZER3NkZialpRN1BpN2ZLNWZqeTkKb0JBenNhL084andtT0xPQUY2VUJjeCtnK3lQMVJaQldkZGNWeEZMbEJWYlhVZjRUTTZ3NlVvc092cENsMldxcApYcDBCWXhNcTZxVEd6em9VNHVVQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZFVTVTZ1dqMWpMSE42OEJWL3hrYmV1c0xBZ0JNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBTkdOWEFtMUozTHJGdnByNVVQRApRV2VWdm92VGJhTC9sQlRwV3Ewb1grOE1mVHRUVEVUbUQrL21TM1MwWWdPalBCbDFxbGtUVnJMWlVHcmxkOUNZCmRaOHViemJkRklMRTU0Q0ZxM3hyMS9yTlJFaGcyZzdkaWZGdkU4TzZyK0hWZ0RnRlNOekl3b2Fsd1kwUzltUWoKbVhSeVh6UC9UeWp3cnQ0S1FQMU9rZlJxNlBGeGFCeGNZV1VHa1ZuRTIzMVRMa01MUHI5MmpWTU00OXBIVEJMMwpCOFlkNE9WNUMyYTNuWkp1bVpJVFFkWkVoNW9rZlEydUphV0diZWhyL05MVmViM05xTXFQQmlNcDc0ZHBYeitNCklKaGN6M1hmaldNbUprOEZlUXMwR29hUmNwb1kyVS85dlpHWjhlaXhWT1BPNU0zTGtGdjIvS3dyQk5ic01uK1EKdS9ZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="p">==</span>
    <span class="n">server</span><span class="p">:</span> <span class="n">https</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">140</span><span class="p">:</span><span class="n">6443</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">member1</span>
<span class="n">contexts</span><span class="p">:</span>
<span class="p">-</span> <span class="n">context</span><span class="p">:</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">member1</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">member1-admin</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">kurator-member1</span>
<span class="n">current-context</span><span class="p">:</span> <span class="n">kurator-memeber1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Config</span>
<span class="n">preferences</span><span class="p">:</span> <span class="p">{}</span>
<span class="n">users</span><span class="p">:</span>
<span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">member1-admin</span>
  <span class="n">user</span><span class="p">:</span>
    <span class="n">client-certificate-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJVENDQWdtZ0F3SUJBZ0lJYzIycW5PcDRjVGt3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBMk1UVXdPVEEzTXpoYUZ3MHlOREEyTVRRd09UQTNNemhhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTBPYWpQcFFINDczMGhUbG0KQVVYMXJTc3FOQ1VNQXNzNEgyK1hKZ1V5RnpiL2ZpamN5RDZnQ2h5TXlzbTFtNlNHVXA2c2thMGt3WEE5cGx0Ngo4eTUzeVpHcEFDNHdqWWhVSEUyWjk5TzVwUVR6TElrdVg5SjRpdjA3NzVWRHU1TnZINmsxc3BualhxbkpDVnVQClJJR1pGaFI4TFdhVEVuTDhiRFRoWXdSMHVOSnBOZmRRSGZ4Q0RhS29rbjd1eHlVR0ZTcldRblV5enl2YUMzQmUKeEw2TTlnZ2VnRTRnOGdpWnE3SDFrc3FLeG9TK251Qy9ZTHE0bi9aQXprd013MHQ0TjFBZmhxWGRRZHRNMVduRApEaUZGY0pHNHExUkdiU1BKUTFkeS9IajVSU1Q3UkhYZnN1T1hUSzMySStoZUxWUGJYWVNOV05QZ3h2alAxK2NGCjEyaVpmUUlEQVFBQm8xWXdWREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JSRk9Vb0ZvOVl5eHpldkFWZjhaRzNyckN3SQpBVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBVnJQSEFRZ2x0ZTE4QlVNWlJHOGNKS3JXNUhTSGNFZWFPM3NzCmo5QThndk5LNFNFcENJSlJlTzZvMGtnQ09zYWpJKzE1Skc2dERtZTJTMndSOStIWnNCZ3h5eVFLYkZIREEwenQKZGJKL2h5TzBFUGVrNVIvSksxWVpqa01qNHVkRXJLSUlQSHJmbDhxeldSd05Ka2lPVUtzdzRsRjB4OFROVjJ3agpXZFZ6TUxIakR2NmpleHJta3hSYVdrTVBrZUM5ZWdrV1NIZlZoVjRCMFBCWUpHejUzS3BjdkVIaGhWRis2M2MwCkRnOUNjWk9qYUhteG00T05DbFA5emNxOVRCRE82anBneEpENjhHZVlhM3Z3bU54aTQzRStXSXl6em9aS1N6M3kKV0N1QmppYmJiUGEwVmxjZG9uV0RzZGtTWU90YzdhYSs0TXBmb1hDalB5dU9yakJSWEE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="p">==</span>
    <span class="n">client-key-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBME9halBwUUg0NzMwaFRsbUFVWDFyU3NxTkNVTUFzczRIMitYSmdVeUZ6Yi9maWpjCnlENmdDaHlNeXNtMW02U0dVcDZza2Ewa3dYQTlwbHQ2OHk1M3laR3BBQzR3alloVUhFMlo5OU81cFFUekxJa3UKWDlKNGl2MDc3NVZEdTVOdkg2azFzcG5qWHFuSkNWdVBSSUdaRmhSOExXYVRFbkw4YkRUaFl3UjB1TkpwTmZkUQpIZnhDRGFLb2tuN3V4eVVHRlNyV1FuVXl6eXZhQzNCZXhMNk05Z2dlZ0U0ZzhnaVpxN0gxa3NxS3hvUytudUMvCllMcTRuL1pBemt3TXcwdDROMUFmaHFYZFFkdE0xV25ERGlGRmNKRzRxMVJHYlNQSlExZHkvSGo1UlNUN1JIWGYKc3VPWFRLMzJJK2hlTFZQYlhZU05XTlBneHZqUDErY0YxMmlaZlFJREFRQUJBb0lCQVFDVVpUSlRzdDZENXAxNwp3aEYzR0JaMGhEUS94STFxc3FmVWxQVy9PWE9pMEJ2Z3AvQm1neTQyNEo4WE13RENaclpRbkkwa0V1WUlUODVMCmpiS2lhMEVHdkdWY1RuT0pKdTN4Q1NNMXpINlUvaFlzYmVxMmdSSEdVaXV3ZnMwVnc1N3QwOHJrYTdMN3ZRcWwKamhnUTV5c3paeXZyS0hHVGFvRnI4SWluU1RRTlVZbmx0cTY1bEFkWVljdTRuNUZONXc3MUJqaEMxSkR2SVZDYQpwTnpWTm1wa0ZFemRIMFpCMVE5L3NXN2VtWFFJRDI4YmQraEppOHhpNEh5a1hBQjMvYXlLVlkyeFdYT1I2SGRBCmdXdWpSSEdCWWJrOWh4a1lnTXc2T2xjeUM4clFPOE1BaWF3dkkzRm42Vm5tbStQTkVaMjRvLytvR21DNmQwajcKOFFPcTcrRWhBb0dCQVBYZ1BmRldnK0pwSnN0WVFQcnR0YmhqQ3NVNnRlK0xxaHo1NG1BR2J5MWtzaGtGYXBuYwpKWDZudjBzTW1QSzFaK0VhM0Frd1JwK3g4MTloUGhBZm9ndFB3QTlwNFI0VTVvZ1RGZElpNi9IaGt1N2FlR0lFCmYwTVVJM2FLNWd4eVZKeVQ4eFpSUmhONFZXbzhKbnFQVGltU2lPM20xd2tSck42cHN4aW1EVjVGQW9HQkFObUEKcFNZQjVEN1NyMEdOV0VsN0Q2YkJUUm5Jd01QbWhtWEdNZy8wVnpIa01IRkMxL0NBK0cybllWbU5tVk9uRGE2Vwp2MXNTQ2V6dlhzT05MTzRTcFEvWGNlM1JBb0ZMZVlRWHJ1V3JlRzR0K003Q0NhSklFV1J1b290S2pkS3FTNHNYClc2dFFoQTdFZlF5T29KZFpIK1JzMDhiQUtqbkpkSmZCcnI3NW5IM1pBb0dCQUkvZ3pwNkE3OS8zaERvTnhNaVIKZlhzT2llanIrRGJhMVlyck51cldHUXpKRmViS1lwenlWQWFQaHNNVjloSmcwUTdLdHVPeG1rSXMwYXVJcmRhbApqQjl1WlljZmdCb29STlp2eEo4WXpGVFltVENvS3pYQVIvQXF3cTNGamVUT3FuQ05xdnZ1UjBGeGN4b2RaSzduCldPZSsxZDNRN1JoamZYTTJmcFQzNW02NUFvR0FCT2JlVWZYMjgrZUJwYU9PMnRFWU1EVHBET3kyVTNQdGtYdWYKQXpjSmhBbFZnaWYwZitvWUx6aDNmREl4dzIzZlpCRG5yU0RCOG9JT2k2K3gxSWU5Q3BkYmJQV3A3Y29LcWd4eQpsNkIrclZVQjUzNytBcGRITlJFOVBwQm1rOW5jcS96Unh4R2dlRWk3WEw0V0puTU93ZklsNzdQQy85eG5jVWdmCkxSU3BEemtDZ1lBQXl2emUrQnlrWkVnVFcydWExL3NTN2xWMnVOaE5mWTR2RzFaaHJOOXZEckJvMU1wL01meE4KbWo0R2NCRG9wZG15dk5QSXpOc2loaVErdjZtTHdEWkZJckJHNFZadmxLM2d3WEFiMEtzNWpMbVdKa1E1ekVIKwpaTTFHdHVDTjdZVEhHdjc2NmlRSzhFOEdWR05KcDBTSVhvYzdpUzVIcDVRWStMNnBPanA4Rnc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo</span><span class="p">=</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># cat /root/.kube/kurator-member2.config</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">clusters</span><span class="p">:</span>
<span class="p">-</span> <span class="n">cluster</span><span class="p">:</span>
    <span class="n">certificate-authority-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EWXhOVEE1TURRd01Gb1hEVE16TURZeE1qQTVNRFF3TUZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBSzViCkZNZXRnRklPUzREekJtcWNyTm1SV0tmZjYxN0ZqRENBVjQrYkxpTEFaUzU0SkU1Yml0SlQzRkJYNU5oaTBneW0KWTdHZHg1NVl6QXJSS0RXbUowbTBKRm0rQXJMSGxUWGNqNzZ5WnBaeGc4MStFdjJ3dnZrcDJINndpaUc5c3diZQplMDhKRTZuQjc5NlpXNnIwRzN5aWdOMmFoOXAxL241OXJoelhYUFUwZXhSZCtwNTlNRW4zK2M5ODdqZnFtTWE4CjA1TFV3bnZnYTNTNGhBWUFGMDFkdDhGVFh4bVBWa01LSU9uTDV2T2EwTUY5LzhHNExRSlpvWUwyOTZsMnFJV0UKV2JQN0phODN1SXVWazN1N1hyZEhub21qVUpENlpHTC8wL0RNdk9EUGQ4a2JSYzN6eDZpek5lVWhnZ0VMMnRzdApOd2s5NlZTNERURXFubkIra0hVQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZNVVJ3S090VlRid3lpVlludFRBOG9jRy9IdlBNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBS0pkRHQwU0pqQjVDczBEYnJLagpEcm8zRkp3RkEzYjd5NzhJN1VYRWtoUFlOYUNGRHdYWUZhOTVPZTRLWm4yZXY5UTRzQy9GZHRaZUpCKzFyR0hTClZXSVBGQzdZK0pJdHUxYUhuaGJRQ2lRM3lmWGozM1MrMXJSUCtTNkpJdU1mRHZ3N0NWNDF0T3JMYnhlSFZhMWsKYVV4RGdwOTJldFl1TWNEWnRwT0pSVTB1TDFlU0FaU000c3c3ejNmTWVtblMzY1dCNmFZTkRxWFlHbUNyK0tkcApVWE9HakpvQkYyRnFnSThHK2VOSWZQcm05QjN3YXljcXZQL3Fod29yK1paL3ZZN2JXeUR4c255aG5BbVEwM2JlCkYrdzVZNnNjaFhmQTZsUzIvL2djRkRucS9RcVAvU3g0Y2MrQ081SWhHYTJoS0NDbGN2NTUwWHVZY2V4N2V2TEMKNUZZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="p">==</span>
    <span class="n">server</span><span class="p">:</span> <span class="n">https</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">143</span><span class="p">:</span><span class="n">6443</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">member2</span>
<span class="n">contexts</span><span class="p">:</span>
<span class="p">-</span> <span class="n">context</span><span class="p">:</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">member2</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">member2-admin</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">kurator-member2</span>
<span class="n">current-context</span><span class="p">:</span> <span class="n">kurator-member2</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Config</span>
<span class="n">preferences</span><span class="p">:</span> <span class="p">{}</span>
<span class="n">users</span><span class="p">:</span>
<span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">member2-admin</span>
  <span class="n">user</span><span class="p">:</span>
    <span class="n">client-certificate-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJVENDQWdtZ0F3SUJBZ0lJR25sd0QzNVVldmd3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBMk1UVXdPVEEwTURCYUZ3MHlOREEyTVRRd09UQTBNREZhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXlEays0SCtTSkVFV0NKV2wKRG0wb2FxMEZETFZiMjlIaVBQWWgxcDVWZW5CaFZNM2Mrc0pJVjBZR2EwbHpYV252Zy9qazF2bTdPTkZBMzZVUQpLZmlzKy9mS24wWFJYQkUvRjFTREFpU0YrZDRtT1Jkc0lrejRPRTF1eStmWGd4K3RCNllFZ2VRaDBRVzVsTDlxClZoYVJmNzM4MHY4RzB5T1JkaHd6VlB6eGJRUDE5NzBWbWluMm9XanRVNm40a201RGhYOUpMdlBJY0NXMVVLRzEKaGtqSlQ2SCtJK1VZajBiV0Q1bjFYTFhaZXZaYTREaHlCcnlWcVo0bVdtYnVjVkpjRDh0KzlIQkhiTEVnbWhrZQpna2ZoQVRWV043YzBDT0FPU21pdEZsSTF0UGZ1UHZaVmErbzVkMk0yVU81OGM0Uit5SUFFZTZieXZtYlYrMXFOCjVQUkhGd0lEQVFBQm8xWXdWREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JURkVjQ2pyVlUyOE1vbFdKN1V3UEtIQnZ4Nwp6ekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBUnNXRmoxVkpVZDVaZXlBMU9VZ2RTanJJS0lpMFdYMFFiZTIzCmswb3RISzNxNkdDZ2kxUTdJUGhZM1hJbFBXdmhjd2lLWVYyYUJVcDRwQXZwRmNtMnN5SkViM3FMLzVpQ3A3ZDgKN1BQb1RXS01xemxHQUlIa2NJdE4wQnBxbWxodG8vc1MvbHVqbzlveDBEZ2tvNDBPTHVSWGZoeVZ0QmNlSzY1ZgpYdEVYRlVpdmxhZVFOQ2ZTZmFVcXVMcGxHaHM0ci9TblMvTXIyR01YdnF2QjVOK3ZOK2NBOW1ab2JlMllQYXFtCkszVnZTQ1F6NWpBaE5ZRU4xdFlJSzlWcFgrQ3hrWVhvb0RWS1J3OWxpM1EzS0VhMmtiTGR6RGFXWUN1OC9oYUwKQ2R0K0hhVUJHV0pia0NlQmdMRXd6S0hIS1dhcjJycDQxUEhmWk9CNittZkFiN3Erb0E9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg</span><span class="p">==</span>
    <span class="n">client-key-data</span><span class="p">:</span> <span class="n">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBeURrKzRIK1NKRUVXQ0pXbERtMG9hcTBGRExWYjI5SGlQUFloMXA1VmVuQmhWTTNjCitzSklWMFlHYTBselhXbnZnL2prMXZtN09ORkEzNlVRS2ZpcysvZktuMFhSWEJFL0YxU0RBaVNGK2Q0bU9SZHMKSWt6NE9FMXV5K2ZYZ3grdEI2WUVnZVFoMFFXNWxMOXFWaGFSZjczODB2OEcweU9SZGh3elZQenhiUVAxOTcwVgptaW4yb1dqdFU2bjRrbTVEaFg5Skx2UEljQ1cxVUtHMWhrakpUNkgrSStVWWowYldENW4xWExYWmV2WmE0RGh5CkJyeVZxWjRtV21idWNWSmNEOHQrOUhCSGJMRWdtaGtlZ2tmaEFUVldON2MwQ09BT1NtaXRGbEkxdFBmdVB2WlYKYStvNWQyTTJVTzU4YzRSK3lJQUVlNmJ5dm1iVisxcU41UFJIRndJREFRQUJBb0lCQUcxbmFrWDlMdnVFWE9lLwo3UHFmQnJDVGJlanR5QTJxOTNYYi84MW5vc2xPVXNDbDVCTll5WEoybnRkTXdTN1B6Y0pNNDYzYnMwTnVnNFl3CmlVNkZ4Ty9CREFSUGdBQlFwQ3E1VVFTQXRIdzl1S0VGZlY2WXRDRC9ub1RvWDhnVUxOVzdEMGR5UWxBV1VydEcKaEhJWnp0TUFHditudmpEc2hIVUhINzFXb1F5eFgwUnZpYkZuN1gxWllrclQ2N2RGcGpLdG9RRTkyUkpRdHpQSApOb0FjMTRCa1VNVEt5ZFpISkUxTmVCRGZ5dStaOXJmeEwxbURuWDBhQWhJdS9XMkdrejZVYitTaFpXL0hsei9XClZSSFgvcHBYWnRQU3RiejJEVlZQZlBrZUtjUVh3QXFWdzMxZnNXNzV4VmZFWWNXR1JYKzZoUlA3SDdRQTV4TnYKaWsramlERUNnWUVBODdLZ3Q0QTJUK3Z5eTduUkpJYjh3ZjdwMVVXajdNWTF3bHBMNTRJUXFWK0pkU2FLRVozdgprait3V3kvUk5NV2pKVlM1M3NVbVgyN0lkWDdoeXIzdU5td2UzSW9pTlg5V09oNTRNdHlWb2E2QXkyNkIxV2wzCmsrZlBMTWxZcGZ4UUtyUDEvV1VtNU10S2dVS2FSbENhVHM0V1hTbG1HL1g3eEQvMWR2NFVMMjBDZ1lFQTBsVEsKSkFSM0RnZHdLRXB2cHBITm9UVUFvV1ovRVJmVXI5VEM0VGtjYnRMYnYxUEdJR1kzcWJHN1V6MzYyVnRRajlJMgpJa2tEd09YZUFQT2xvR2JGR0JkWVNmMmlJOUhJSkQwYm1qaC9UVEI5cU1ZVW9ZMXYrM1J6bUpMbGpYbUkxa1ZDCk5uWXRLQXRlSHNhK0QzMk1LSllWOHY3UGdPY25aNmllSEVUMGloTUNnWUJNdkFaWFFZdllocGNoQnhXUHh1RjMKeEdpa3V4VHV6VXJJTTk2S3V5Mjc1MVZGQ2ltWGVuK2hNV1M2a2NmeU1mazVIQUNhNE1GQWM0V3pXWXlIWmw3SAp6Q3U3amROUHZSVE5vQ0tCQVd3c1NPSk5MREs5bkVRRzBvc3Rzd2l5MjB2eTVrK2l4bU1Feis1WjNUcnV3UnFWCmpkY0U1ckE4UmF4TkUwYWJmVTJsMFFLQmdHY3ovWCtReFU0WDdqdUcwcVA3dE5jZDU3SktWWnp3Z1liSk1kcEwKS0oxa1R6amhCVDFPaW85MFN3TThUVUtyb0tzQkxWakRWTmtvc1Ric1ZsK1BMYlIxZC9mT1FPbXNmTFR6V3dEZwpLZTZaRlg5anVpbk8rWng3ZG1EdDZ6N3czR2l1MFI5aCt5UkQ5Nm5JUU9mZTVZL2duT0ovanhlajFGenppcWs2CldIY0xBb0dBVzJNTDlHeFVwalFmV2EyZW5qWTlybW1yaHVZU0Vmbk4zYlU3ZDBLQzdqWnl4K3RvYVBjQWFZUG4KUTkrN28yWERVa1k0OWw0U0RHZFU5dU1zUnZjaFNseDkydXc0WDNsL3M2U2tERENPUFh4LzBVcmtkbHhweGhGVQoxTUZuRmFxdy8vb2wxaXFmWGxLSnRINTJKdStBZERNUGp1L0cwZmhQY3hoYURJdEoyVjQ9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg</span><span class="p">==</span>
</code></pre></div>
<h3 id="822_secret">8.2.2 创建secret<a class="headerlink" href="#822_secret" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl create secret generic kurator-member1 --from-file=kurator-member1.config=/root/.kube/kurator-member1.config</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl create secret generic kurator-member2 --from-file=kurator-member2.config=/root/.kube/kurator-member2.config</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl get secret</span>
<span class="n">NAME</span>              <span class="nb">TYPE </span>    <span class="n">DATA</span>   <span class="n">AGE</span>
<span class="n">cluster-secret</span>    <span class="n">Opaque</span>   <span class="n">1</span>      <span class="n">11h</span>
<span class="n">kurator-member1</span>   <span class="n">Opaque</span>   <span class="n">1</span>      <span class="n">20s</span>
<span class="n">kurator-member2</span>   <span class="n">Opaque</span>   <span class="n">1</span>      <span class="n">7s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl --kubeconfig=/root/.kube/kurator-member1.config get nodes</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@kubespray</span> <span class="p">~]</span><span class="c"># kubectl --kubeconfig=/root/.kube/kurator-member2.config get nodes</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      BurningMyself<a href='https://beian.miit.gov.cn/' target='_blank'>  蜀ICP备15033200号-1</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/burningmyself" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://gitee.com/burningmyself" target="_blank" rel="noopener" title="gitee.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
        <script src="../../../js/baidu-tongji.js"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155084439-1"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155132293-1"></script>
      
        <script src="../../../js/google.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>