
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content=".net,java,php,python,docker,web">
      
      
        <meta name="author" content="BurningMyself">
      
      
        <link rel="canonical" href="https://burningmyself.gitee.io/cloud/kubernetes/kubernetes_traefik/">
      
      
        <link rel="prev" href="../kubernetes_nginx_ingress_controller/">
      
      
        <link rel="next" href="../kubernetes_configMap_secret/">
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.15">
    
    
      
        <title>Kubernetes集群 服务暴露 Traefik - BurningMyself</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kubernetes_traefik" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="BurningMyself" class="md-header__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BurningMyself
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kubernetes集群 服务暴露 Traefik
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="BurningMyself" class="md-nav__button md-logo" aria-label="BurningMyself" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BurningMyself
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/burningmyself/burningmyself.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    burningmyself.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        介绍
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          技术博文
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          技术博文
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          .NET
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          .NET
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sharp/" class="md-nav__link">
        C#新特性语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_docker/" class="md-nav__link">
        .Net Core Docker 部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_sqlserver_nginx/" class="md-nav__link">
        Docker 容器化部署 ASP.NET Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_safety/" class="md-nav__link">
        让你的ASP.NET Core应用程序更安全
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../net/c_core_study_route/" class="md-nav__link">
        ASP.NET Core开发者指南
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/feature/" class="md-nav__link">
        Java特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/load-class/" class="md-nav__link">
        Java类加载
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/orm/" class="md-nav__link">
        Orm的优缺点
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/bio-nio/" class="md-nav__link">
        BIO与NIO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/rocketmq/rmq-1/" class="md-nav__link">
        RocketMq下载与安装
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springAnnotation/" class="md-nav__link">
        Spring常用注解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/javavm/" class="md-nav__link">
        Java 虚拟机
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/springdesign/" class="md-nav__link">
        Spring 常用设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/spring-cloud/" class="md-nav__link">
        Spring Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-simple/" class="md-nav__link">
        Java simple
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-validator/" class="md-nav__link">
        Java Validator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-string/" class="md-nav__link">
        Java String
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../java/java-utils/" class="md-nav__link">
        Java Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/feature/" class="md-nav__link">
        Python特性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/str_joint/" class="md-nav__link">
        Python字符拼接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/syntax_rule/" class="md-nav__link">
        Python语法技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/fabric/" class="md-nav__link">
        远程部署神器 Fabric
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          PHP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          PHP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../php/kj/" class="md-nav__link">
        框架
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
          Web
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/es6/" class="md-nav__link">
        es6语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/ali_js_style/" class="md-nav__link">
        阿里js样式规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/node.js/" class="md-nav__link">
        node.js文档
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react/" class="md-nav__link">
        React 开发者指南
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../dart/syntax/" class="md-nav__link">
        Dart语法学习
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/react_interview/" class="md-nav__link">
        React 面试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/js_tool_method/" class="md-nav__link">
        js 工具函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/vue_cp_react/" class="md-nav__link">
        vue与react比较
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../web/javascript/" class="md-nav__link">
        JavaScript 基础
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
          SQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_yh17/" class="md-nav__link">
        MySQL优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_log/" class="md-nav__link">
        MySQL日志
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_index/" class="md-nav__link">
        MySQL索引
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_pxc/" class="md-nav__link">
        MySQL PXC集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_use/" class="md-nav__link">
        MySQL 数据库应用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mysql_backups/" class="md-nav__link">
        MySql 备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/sql_server_master/" class="md-nav__link">
        Sql Server 主从备份
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/data_split/" class="md-nav__link">
        数据库之互联网常用分库分表方案
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sql/mybatis/" class="md-nav__link">
        Mybatis使用心德
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
      
      
      
        <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/often/" class="md-nav__link">
        常用命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../linux/ope/" class="md-nav__link">
        实用的Linux 命令
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
      
      
      
        <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker/" class="md-nav__link">
        Docker全科
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-compose/" class="md-nav__link">
        docker和docker-compose配置常用环境
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-jenkins/" class="md-nav__link">
        Docker部署Jenkins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker-phabricator/" class="md-nav__link">
        Docker部署Phabricator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
      
      
      
        <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
          Tool
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          Tool
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitusual/" class="md-nav__link">
        Git动画展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitquestion/" class="md-nav__link">
        Git问题处理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitflow/" class="md-nav__link">
        GitFlow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitbook/" class="md-nav__link">
        GitBook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitcmr/" class="md-nav__link">
        Git提交日志规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/markdown/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cicd/" class="md-nav__link">
        CI/CD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/mkdocs/" class="md-nav__link">
        mkdocs简单使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/gitstudy/" class="md-nav__link">
        Git的黑魔法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/minio/" class="md-nav__link">
        MinIO 搭建使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tool/cat-monitoring/" class="md-nav__link">
        Cat分布式监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          云架构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          云架构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../native/" class="md-nav__link">
        云原生
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../virtual/" class="md-nav__link">
        虚拟化技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../compute/" class="md-nav__link">
        云计算
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../apprelease/" class="md-nav__link">
        应用部署容器化演进
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../containerlinux/" class="md-nav__link">
        容器技术所涉及Linux内核关键技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_native/" class="md-nav__link">
        容器管理工具Docker生态架构及部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_nginx/" class="md-nav__link">
        使用容器运行Nginx应用及Docker命令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image/" class="md-nav__link">
        Docker容器镜像
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_image_fast/" class="md-nav__link">
        Docker容器镜像加速器及本地容器镜像仓库
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container_enterprice/" class="md-nav__link">
        Docker容器化部署企业级应用集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_file/" class="md-nav__link">
        Dockerfile精讲及新型容器镜像构建技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_network/" class="md-nav__link">
        Docker容器网络与通信原理深度解析
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_date/" class="md-nav__link">
        Docker容器数据持久化存储机制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_compose/" class="md-nav__link">
        Docker容器服务编排利器Docker Compose应用实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_swarm/" class="md-nav__link">
        Docker主机集群化方案 Docker Swarm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_devops/" class="md-nav__link">
        基于Docker容器DevOps应用方案 企业业务代码发布系统
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker_container/" class="md-nav__link">
        轻量级或工业级容器管理工具
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        kubeadm极速部署Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_introduce/" class="md-nav__link">
        kubernetes介绍与集群架构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_way/" class="md-nav__link">
        Kubernetes集群部署方式说明
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_master/" class="md-nav__link">
        kubeadm部署单Master节点kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight/" class="md-nav__link">
        kubeadm部署高可用kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_rke/" class="md-nav__link">
        使用RKE构建企业生产级Kubernetes集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin1/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Docker）一
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_hight_bin2/" class="md-nav__link">
        Kubernetes高可用集群二进制部署（Runtime Docker）二
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        Kubernetes集群UI及主机资源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_sealos/" class="md-nav__link">
        使用sealos部署kubernetes集群并实现集群管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster/" class="md-nav__link">
        kubernetes集群命令语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_core/" class="md-nav__link">
        Kubernetes核心概念
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_nginx_ingress_controller/" class="md-nav__link">
        Kubernetes集群 服务暴露 Nginx Ingress Controller
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Kubernetes集群 服务暴露 Traefik
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_configMap_secret/" class="md-nav__link">
        Kubernetes配置与密钥管理 ConfigMap&Secret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_harbor/" class="md-nav__link">
        Kubernetes集群使用容器镜像仓库Harbor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_safety/" class="md-nav__link">
        Kubernetes集群安全管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_volume/" class="md-nav__link">
        kubernetes持久化存储卷
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_storage_ceph/" class="md-nav__link">
        存储解决方案 Ceph
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_ui/" class="md-nav__link">
        源监控
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          微服务
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          微服务
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/fbs-lock/" class="md-nav__link">
        分布式锁
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/design/" class="md-nav__link">
        微服务设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/distrimsg/" class="md-nav__link">
        分布式系统与消息的投递
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/ddd/" class="md-nav__link">
        基于DDD的微服务设计和开发实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/kafka/" class="md-nav__link">
        Kafka架构原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/redis_cluster/" class="md-nav__link">
        Redis Cluster原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../micro/spring-cloud-micro/" class="md-nav__link">
        分布式架构
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          经验分析
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          经验分析
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/devops/" class="md-nav__link">
        DevOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/micro-service/" class="md-nav__link">
        Micro-Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/raft-gossip/" class="md-nav__link">
        Raft算法和Gossip协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cl/" class="md-nav__link">
        集群和负载均衡
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/ai/" class="md-nav__link">
        人工智能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/code-principle/" class="md-nav__link">
        代码原则
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/techbig/" class="md-nav__link">
        如何成为技术大牛
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/learnweetout/" class="md-nav__link">
        程序员如何技术成长
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/pt/" class="md-nav__link">
        产品与技术
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/four_deep_learning/" class="md-nav__link">
        深度学习框架
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/tl/" class="md-nav__link">
        在阿里做了5年技术Leader，我总结出这些套路！
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../exp/cto/" class="md-nav__link">
        CTO 技能图谱
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          构架
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          构架
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/split/" class="md-nav__link">
        构架拆分
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fgb/" class="md-nav__link">
        分布式、高并发、多线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/agility/" class="md-nav__link">
        如何理解敏捷开发
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/fwork/" class="md-nav__link">
        走向架构师必备的技能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/data_middle/" class="md-nav__link">
        数据中台的思考与总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../framework/algorithm-ten/" class="md-nav__link">
        必学的 10 大算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          情感
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          情感
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/eq/" class="md-nav__link">
        情商
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/workheard/" class="md-nav__link">
        工作心得
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lookbook/" class="md-nav__link">
        看书
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/selfdiscipline/" class="md-nav__link">
        自律
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/livefail/" class="md-nav__link">
        为什么活着失败
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/emotion/" class="md-nav__link">
        情绪管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/losecome/" class="md-nav__link">
        所有的失去，都会以另一种方式归来
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/threeheart/" class="md-nav__link">
        人生有这三种好心态
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/onepath/" class="md-nav__link">
        余生，学会一个人走，不管有没有人陪
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/twopath/" class="md-nav__link">
        往后余生还很精彩，别被熬夜拖垮了
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../emotion/lifetime/" class="md-nav__link">
        心态好的人，一辈子都好
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="kubernetes_traefik">Kubernetes集群 服务暴露 Traefik<a class="headerlink" href="#kubernetes_traefik" title="Permanent link">&para;</a></h1>
<h1 id="traefik">一、认识traefik<a class="headerlink" href="#traefik" title="Permanent link">&para;</a></h1>
<h2 id="11_traefik">1.1 traefik简介<a class="headerlink" href="#11_traefik" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>参考链接: <a href="https://traefik.cn/">https://traefik.cn/</a></p>
</li>
<li>
<p><a href="../../../img/kubernetes/kubernetes_traefik/traefik.zip">traefik的yaml文件</a></p>
</li>
<li>
<p>是一个为了让部署微服务更加便捷而诞生的现代HTTP反向代理、负载均衡工具。 </p>
</li>
<li>
<p>它支持多种后台 (<a href="https://www.docker.com/">Docker</a>, <a href="https://docs.docker.com/swarm">Swarm</a>, <a href="https://kubernetes.io/">Kubernetes</a>, <a href="https://mesosphere.github.io/marathon/">Marathon</a>, <a href="https://github.com/apache/mesos">Mesos</a>, <a href="https://www.consul.io/">Consul</a>, <a href="https://coreos.com/etcd/">Etcd</a>, <a href="https://zookeeper.apache.org/">Zookeeper</a>, <a href="https://github.com/boltdb/bolt">BoltDB</a>, Rest API, file…) 来自动化、动态的应用它的配置文件设置。</p>
</li>
</ul>
<p><img alt="" src="../../../img/kubernetes/kubernetes_traefik/traefik%E5%8A%9F%E8%83%BD.png" /></p>
<h2 id="12_traefix">1.2 traefix 特性<a class="headerlink" href="#12_traefix" title="Permanent link">&para;</a></h2>
<ul>
<li>非常快</li>
<li>无需安装其他依赖，通过Go语言编写的单一可执行文件</li>
<li>支持 Rest API</li>
<li>多种后台支持：Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, 并且还会更多</li>
<li>后台监控, 可以监听后台变化进而自动化应用新的配置文件设置</li>
<li>配置文件热更新。无需重启进程</li>
<li>正常结束http连接</li>
<li>后端断路器</li>
<li>轮询，rebalancer 负载均衡</li>
<li>Rest Metrics</li>
<li>支持最小化官方docker 镜像</li>
<li>前、后台支持SSL</li>
<li>清爽的AngularJS前端页面</li>
<li>支持Websocket</li>
<li>支持HTTP/2</li>
<li>网络错误重试</li>
<li>支持<a href="https://letsencrypt.org/">Let’s Encrypt</a> (自动更新HTTPS证书)</li>
<li>高可用集群模式</li>
</ul>
<h2 id="13_traefiknginx_ingress">1.3 traefik与nginx ingress对比<a class="headerlink" href="#13_traefiknginx_ingress" title="Permanent link">&para;</a></h2>
<p><img alt="20220419021708805" src="../../../img/kubernetes/kubernetes_traefik/image-20220419021708805.png" /></p>
<h2 id="14_traefik">1.4 traefik核心概念及能力<a class="headerlink" href="#14_traefik" title="Permanent link">&para;</a></h2>
<p>Traefik是一个边缘路由器，它会拦截外部的请求并根据逻辑规则选择不同的操作方式，这些规则决定着这些请求到底该如何处理。Traefik提供自动发现能力，会实时检测服务，并自动更新路由规则。</p>
<p><img alt="" src="../../../img/kubernetes/kubernetes_traefik/traefik%E8%83%BD%E5%8A%9B.png" /></p>
<p>从上图可知，请求首先会连接到entrypoints，然后分析这些请求是否与定义的rules匹配，如果匹配，则会通过一系列middlewares，再到对应的services上。</p>
<p>这就涉及到以下几个重要的核心组件。</p>
<ul>
<li>Providers</li>
<li>Entrypoints</li>
<li>Routers</li>
<li>Services</li>
<li>Middlewares</li>
</ul>
<p>下面分别介绍一下：</p>
<ul>
<li>Providers</li>
</ul>
<p>Providers是基础组件，Traefik的配置发现是通过它来实现的，它可以是协调器，容器引擎，云提供商或者键值存储。</p>
<p>Traefik通过查询Providers的API来查询路由的相关信息，一旦检测到变化，就会动态的更新路由。</p>
<ul>
<li>Entrypoints</li>
</ul>
<p>Entrypoints是Traefik的网络入口，它定义接收请求的接口，以及是否监听TCP或者UDP。</p>
<ul>
<li>Routers</li>
</ul>
<p>Routers主要用于分析请求，并负责将这些请求连接到对应的服务上去，在这个过程中，Routers还可以使用Middlewares来更新请求，比如在把请求发到服务之前添加一些Headers。</p>
<ul>
<li>Services</li>
</ul>
<p>Services负责配置如何到达最终将处理传入请求的实际服务。</p>
<ul>
<li>Middlewares</li>
</ul>
<p>Middlewares用来修改请求或者根据请求来做出一些判断（authentication, rate limiting, headers, …），中间件被附件到路由上，是一种在请求发送到你的服务之前（或者在服务的响应发送到客户端之前）调整请求的一种方法。</p>
<h1 id="traefik_1">二、traefik部署<a class="headerlink" href="#traefik_1" title="Permanent link">&para;</a></h1>
<h2 id="21_traefik">2.1 获取traefik部署前置资源清单文件<a class="headerlink" href="#21_traefik" title="Permanent link">&para;</a></h2>
<h3 id="211_crd">2.1.1 创建CRD资源<a class="headerlink" href="#211_crd" title="Permanent link">&para;</a></h3>
<blockquote>
<p>本次Traefik 是部署在 kube-system Namespace 下，如果不想部署到配置的 Namespace，需要修改下面部署文件中的 Namespace 参数。</p>
<p>此yaml资源清单文件可在traefik.io网站直接复制使用：<a href="https://doc.traefik.io/traefik/v2.5/reference/dynamic-configuration/kubernetes-crd/#definitions">https://doc.traefik.io/traefik/v2.5/reference/dynamic-configuration/kubernetes-crd/#definitions</a></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-crd.yaml</span>
<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroutes</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">IngressRouteList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">ingressroutes</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">ingressroute</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">IngressRoute</span> <span class="n">is</span> <span class="n">an</span> <span class="n">Ingress</span> <span class="n">CRD</span> <span class="n">specification</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">IngressRouteSpec</span> <span class="n">is</span> <span class="n">a</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">IngressRouteSpec</span>
              <span class="n">resource</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">entryPoints</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">routes</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">description</span><span class="p">:</span> <span class="n">Route</span> <span class="n">contains</span> <span class="n">the</span> <span class="nb">set </span><span class="n">of</span> <span class="n">routes</span><span class="p">.</span>
                  <span class="n">properties</span><span class="p">:</span>
                    <span class="n">kind</span><span class="p">:</span>
                      <span class="n">enum</span><span class="p">:</span>
                      <span class="p">-</span> <span class="n">Rule</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">match</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">middlewares</span><span class="p">:</span>
                      <span class="n">items</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">MiddlewareRef</span> <span class="n">is</span> <span class="n">a</span> <span class="k">ref</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Middleware</span> <span class="n">resources</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">name</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">namespace</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">required</span><span class="p">:</span>
                        <span class="p">-</span> <span class="n">name</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                    <span class="n">priority</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                    <span class="n">services</span><span class="p">:</span>
                      <span class="n">items</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">Service</span> <span class="n">defines</span> <span class="n">an</span> <span class="n">upstream</span> <span class="n">to</span> <span class="n">proxy</span> <span class="n">traffic</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">kind</span><span class="p">:</span>
                            <span class="n">enum</span><span class="p">:</span>
                            <span class="p">-</span> <span class="n">Service</span>
                            <span class="p">-</span> <span class="n">TraefikService</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">name</span><span class="p">:</span>
                            <span class="n">description</span><span class="p">:</span> <span class="n">Name</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Kubernetes</span> <span class="n">Service</span>
                              <span class="n">object</span> <span class="p">(</span><span class="k">for</span> <span class="n">a</span> <span class="n">load-balancer</span> <span class="n">of</span> <span class="n">servers</span><span class="p">),</span> <span class="n">or</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TraefikService</span>
                              <span class="n">object</span> <span class="p">(</span><span class="n">service</span> <span class="n">load-balancer</span><span class="p">,</span> <span class="n">mirroring</span><span class="p">,</span> <span class="n">etc</span><span class="p">).</span> <span class="n">The</span>
                              <span class="n">differentiation</span> <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">is</span> <span class="n">specified</span> <span class="k">in</span> <span class="n">the</span>
                              <span class="n">Kind</span> <span class="n">field</span><span class="p">.</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">namespace</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">passHostHeader</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                          <span class="n">port</span><span class="p">:</span>
                            <span class="n">anyOf</span><span class="p">:</span>
                            <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                            <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                            <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                          <span class="n">responseForwarding</span><span class="p">:</span>
                            <span class="n">description</span><span class="p">:</span> <span class="n">ResponseForwarding</span> <span class="n">holds</span> <span class="n">configuration</span> <span class="k">for</span>
                              <span class="n">the</span> <span class="n">forward</span> <span class="n">of</span> <span class="n">the</span> <span class="n">response</span><span class="p">.</span>
                            <span class="n">properties</span><span class="p">:</span>
                              <span class="n">flushInterval</span><span class="p">:</span>
                                <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                          <span class="n">scheme</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">serversTransport</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">sticky</span><span class="p">:</span>
                            <span class="n">description</span><span class="p">:</span> <span class="n">Sticky</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span><span class="p">.</span>
                            <span class="n">properties</span><span class="p">:</span>
                              <span class="n">cookie</span><span class="p">:</span>
                                <span class="n">description</span><span class="p">:</span> <span class="n">Cookie</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span>
                                  <span class="n">based</span> <span class="n">on</span> <span class="n">cookie</span><span class="p">.</span>
                                <span class="n">properties</span><span class="p">:</span>
                                  <span class="n">httpOnly</span><span class="p">:</span>
                                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                                  <span class="n">name</span><span class="p">:</span>
                                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                                  <span class="n">sameSite</span><span class="p">:</span>
                                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                                  <span class="n">secure</span><span class="p">:</span>
                                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                          <span class="n">strategy</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">weight</span><span class="p">:</span>
                            <span class="n">description</span><span class="p">:</span> <span class="n">Weight</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">specified</span> <span class="n">when</span> <span class="n">Name</span>
                              <span class="n">references</span> <span class="n">a</span> <span class="n">TraefikService</span> <span class="n">object</span> <span class="p">(</span><span class="n">and</span> <span class="n">to</span> <span class="n">be</span> <span class="n">precise</span><span class="p">,</span>
                              <span class="n">one</span> <span class="n">that</span> <span class="n">embeds</span> <span class="n">a</span> <span class="n">Weighted</span> <span class="n">Round</span> <span class="n">Robin</span><span class="p">).</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                        <span class="n">required</span><span class="p">:</span>
                        <span class="p">-</span> <span class="n">name</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">required</span><span class="p">:</span>
                  <span class="p">-</span> <span class="n">kind</span>
                  <span class="p">-</span> <span class="n">match</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">tls</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;TLS contains the TLS certificates configuration of the</span>
<span class="s2">                  routes. To enable Let&#39;s Encrypt, use an empty TLS struct, e.g. in</span>
<span class="s2">                  YAML: \n \t tls: {} # inline format \n \t tls: \t   secretName:</span>
<span class="s2">                  # block format&quot;</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">certResolver</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">domains</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">description</span><span class="p">:</span> <span class="n">Domain</span> <span class="n">holds</span> <span class="n">a</span> <span class="n">domain</span> <span class="n">name</span> <span class="n">with</span> <span class="n">SANs</span><span class="p">.</span>
                      <span class="n">properties</span><span class="p">:</span>
                        <span class="n">main</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">sans</span><span class="p">:</span>
                          <span class="n">items</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">options</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Options</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TLSOption</span><span class="p">,</span> <span class="n">that</span> <span class="n">specifies</span>
                      <span class="n">the</span> <span class="n">parameters</span> <span class="n">of</span> <span class="n">the</span> <span class="n">TLS</span> <span class="n">connection</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">name</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">namespace</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">required</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">name</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">secretName</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">SecretName</span> <span class="n">is</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">referenced</span> <span class="n">Kubernetes</span>
                      <span class="n">Secret</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">details</span><span class="p">.</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">store</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Store</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TLSStore</span><span class="p">,</span> <span class="n">that</span> <span class="n">specifies</span>
                      <span class="n">the</span> <span class="n">parameters</span> <span class="n">of</span> <span class="n">the</span> <span class="n">TLS</span> <span class="n">store</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">name</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">namespace</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">required</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">name</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
            <span class="n">required</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">routes</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroutetcps</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">IngressRouteTCP</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">IngressRouteTCPList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">ingressroutetcps</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">ingressroutetcp</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">IngressRouteTCP</span> <span class="n">is</span> <span class="n">an</span> <span class="n">Ingress</span> <span class="n">CRD</span> <span class="n">specification</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">IngressRouteTCPSpec</span> <span class="n">is</span> <span class="n">a</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">IngressRouteTCPSpec</span>
              <span class="n">resource</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">entryPoints</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">routes</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">description</span><span class="p">:</span> <span class="n">RouteTCP</span> <span class="n">contains</span> <span class="n">the</span> <span class="nb">set </span><span class="n">of</span> <span class="n">routes</span><span class="p">.</span>
                  <span class="n">properties</span><span class="p">:</span>
                    <span class="n">match</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">middlewares</span><span class="p">:</span>
                      <span class="n">description</span><span class="p">:</span> <span class="n">Middlewares</span> <span class="n">contains</span> <span class="n">references</span> <span class="n">to</span> <span class="n">MiddlewareTCP</span>
                        <span class="n">resources</span><span class="p">.</span>
                      <span class="n">items</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">ObjectReference</span> <span class="n">is</span> <span class="n">a</span> <span class="n">generic</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Traefik</span>
                          <span class="n">resource</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">name</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">namespace</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">required</span><span class="p">:</span>
                        <span class="p">-</span> <span class="n">name</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                    <span class="n">services</span><span class="p">:</span>
                      <span class="n">items</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">ServiceTCP</span> <span class="n">defines</span> <span class="n">an</span> <span class="n">upstream</span> <span class="n">to</span> <span class="n">proxy</span> <span class="n">traffic</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">name</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">namespace</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">port</span><span class="p">:</span>
                            <span class="n">anyOf</span><span class="p">:</span>
                            <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                            <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                            <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                          <span class="n">proxyProtocol</span><span class="p">:</span>
                            <span class="n">description</span><span class="p">:</span> <span class="n">ProxyProtocol</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">ProxyProtocol</span> <span class="n">configuration</span><span class="p">.</span>
                            <span class="n">properties</span><span class="p">:</span>
                              <span class="n">version</span><span class="p">:</span>
                                <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                          <span class="n">terminationDelay</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                          <span class="n">weight</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                        <span class="n">required</span><span class="p">:</span>
                        <span class="p">-</span> <span class="n">name</span>
                        <span class="p">-</span> <span class="n">port</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">required</span><span class="p">:</span>
                  <span class="p">-</span> <span class="n">match</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">tls</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="s2">&quot;TLSTCP contains the TLS certificates configuration of</span>
<span class="s2">                  the routes. To enable Let&#39;s Encrypt, use an empty TLS struct, e.g.</span>
<span class="s2">                  in YAML: \n \t tls: {} # inline format \n \t tls: \t   secretName:</span>
<span class="s2">                  # block format&quot;</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">certResolver</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">domains</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">description</span><span class="p">:</span> <span class="n">Domain</span> <span class="n">holds</span> <span class="n">a</span> <span class="n">domain</span> <span class="n">name</span> <span class="n">with</span> <span class="n">SANs</span><span class="p">.</span>
                      <span class="n">properties</span><span class="p">:</span>
                        <span class="n">main</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">sans</span><span class="p">:</span>
                          <span class="n">items</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">options</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Options</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TLSOption</span><span class="p">,</span> <span class="n">that</span> <span class="n">specifies</span>
                      <span class="n">the</span> <span class="n">parameters</span> <span class="n">of</span> <span class="n">the</span> <span class="n">TLS</span> <span class="n">connection</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">name</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">namespace</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">required</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">name</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">passthrough</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">secretName</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">SecretName</span> <span class="n">is</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">referenced</span> <span class="n">Kubernetes</span>
                      <span class="n">Secret</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">details</span><span class="p">.</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">store</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Store</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TLSStore</span><span class="p">,</span> <span class="n">that</span> <span class="n">specifies</span>
                      <span class="n">the</span> <span class="n">parameters</span> <span class="n">of</span> <span class="n">the</span> <span class="n">TLS</span> <span class="n">store</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">name</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">namespace</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">required</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">name</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
            <span class="n">required</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">routes</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressrouteudps</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">IngressRouteUDP</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">IngressRouteUDPList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">ingressrouteudps</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">ingressrouteudp</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">IngressRouteUDP</span> <span class="n">is</span> <span class="n">an</span> <span class="n">Ingress</span> <span class="n">CRD</span> <span class="n">specification</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">IngressRouteUDPSpec</span> <span class="n">is</span> <span class="n">a</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">IngressRouteUDPSpec</span>
              <span class="n">resource</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">entryPoints</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">routes</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">description</span><span class="p">:</span> <span class="n">RouteUDP</span> <span class="n">contains</span> <span class="n">the</span> <span class="nb">set </span><span class="n">of</span> <span class="n">routes</span><span class="p">.</span>
                  <span class="n">properties</span><span class="p">:</span>
                    <span class="n">services</span><span class="p">:</span>
                      <span class="n">items</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">ServiceUDP</span> <span class="n">defines</span> <span class="n">an</span> <span class="n">upstream</span> <span class="n">to</span> <span class="n">proxy</span> <span class="n">traffic</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">name</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">namespace</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">port</span><span class="p">:</span>
                            <span class="n">anyOf</span><span class="p">:</span>
                            <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                            <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                            <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                          <span class="n">weight</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                        <span class="n">required</span><span class="p">:</span>
                        <span class="p">-</span> <span class="n">name</span>
                        <span class="p">-</span> <span class="n">port</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
            <span class="n">required</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">routes</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">middlewares</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Middleware</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">MiddlewareList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">middlewares</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">middleware</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Middleware</span> <span class="n">is</span> <span class="n">a</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">Middleware</span> <span class="n">resource</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">MiddlewareSpec</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">Middleware</span> <span class="n">configuration</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">addPrefix</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">AddPrefix</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">AddPrefix</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">prefix</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">basicAuth</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">BasicAuth</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">HTTP</span> <span class="n">basic</span> <span class="n">authentication</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">headerField</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">realm</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">removeHeader</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">secret</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">buffering</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Buffering</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">request</span><span class="p">/</span><span class="n">response</span> <span class="n">buffering</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">maxRequestBodyBytes</span><span class="p">:</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">maxResponseBodyBytes</span><span class="p">:</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">memRequestBodyBytes</span><span class="p">:</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">memResponseBodyBytes</span><span class="p">:</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">retryExpression</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">chain</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Chain</span> <span class="n">holds</span> <span class="n">a</span> <span class="n">chain</span> <span class="n">of</span> <span class="n">middlewares</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">middlewares</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">description</span><span class="p">:</span> <span class="n">MiddlewareRef</span> <span class="n">is</span> <span class="n">a</span> <span class="k">ref</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Middleware</span> <span class="n">resources</span><span class="p">.</span>
                      <span class="n">properties</span><span class="p">:</span>
                        <span class="n">name</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">namespace</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">required</span><span class="p">:</span>
                      <span class="p">-</span> <span class="n">name</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">circuitBreaker</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">CircuitBreaker</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">circuit</span> <span class="n">breaker</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">expression</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">compress</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Compress</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">compress</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">excludedContentTypes</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">contentType</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">ContentType</span> <span class="n">middleware</span> <span class="p">-</span> <span class="n">or</span> <span class="n">rather</span> <span class="n">its</span> <span class="n">unique</span> <span class="p">`</span><span class="n">autoDetect</span><span class="p">`</span>
                  <span class="n">option</span> <span class="p">-</span> <span class="n">specifies</span> <span class="n">whether</span> <span class="n">to</span> <span class="n">let</span> <span class="n">the</span> <span class="p">`</span><span class="n">Content-Type</span><span class="p">`</span> <span class="n">header</span><span class="p">,</span> <span class="k">if</span>
                  <span class="n">it</span> <span class="n">has</span> <span class="n">not</span> <span class="n">been</span> <span class="nb">set </span><span class="n">by</span> <span class="n">the</span> <span class="n">backend</span><span class="p">,</span> <span class="n">be</span> <span class="n">automatically</span> <span class="nb">set </span><span class="n">to</span> <span class="n">a</span> <span class="n">value</span>
                  <span class="n">derived</span> <span class="n">from</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">the</span> <span class="n">response</span><span class="p">.</span> <span class="n">As</span> <span class="n">a</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">the</span> <span class="k">default</span>
                  <span class="n">behavior</span> <span class="n">should</span> <span class="n">be</span> <span class="n">to</span> <span class="n">leave</span> <span class="n">the</span> <span class="n">header</span> <span class="n">alone</span><span class="p">,</span> <span class="n">regardless</span> <span class="n">of</span> <span class="n">what</span>
                  <span class="n">the</span> <span class="n">backend</span> <span class="n">did</span> <span class="n">with</span> <span class="n">it</span><span class="p">.</span> <span class="n">However</span><span class="p">,</span> <span class="n">the</span> <span class="n">historic</span> <span class="k">default</span> <span class="n">was</span> <span class="n">to</span> <span class="n">always</span>
                  <span class="n">auto-detect</span> <span class="n">and</span> <span class="nb">set </span><span class="n">the</span> <span class="n">header</span> <span class="k">if</span> <span class="n">it</span> <span class="n">was</span> <span class="n">nil</span><span class="p">,</span> <span class="n">and</span> <span class="n">it</span> <span class="n">is</span> <span class="n">going</span> <span class="n">to</span>
                  <span class="n">be</span> <span class="n">kept</span> <span class="n">that</span> <span class="n">way</span> <span class="k">in</span> <span class="n">order</span> <span class="n">to</span> <span class="n">support</span> <span class="n">users</span> <span class="n">currently</span> <span class="n">relying</span> <span class="n">on</span>
                  <span class="n">it</span><span class="p">.</span> <span class="n">This</span> <span class="n">middleware</span> <span class="n">exists</span> <span class="n">to</span> <span class="n">enable</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">behavior</span> <span class="k">until</span>
                  <span class="n">at</span> <span class="n">least</span> <span class="n">the</span> <span class="k">default</span> <span class="n">one</span> <span class="n">can</span> <span class="n">be</span> <span class="n">changed</span> <span class="k">in</span> <span class="n">a</span> <span class="n">future</span> <span class="n">version</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">autoDetect</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">digestAuth</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">DigestAuth</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">Digest</span> <span class="n">HTTP</span> <span class="n">authentication</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">headerField</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">realm</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">removeHeader</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">secret</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">errors</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">ErrorPage</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">custom</span> <span class="n">error</span> <span class="n">page</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">query</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">service</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Service</span> <span class="n">defines</span> <span class="n">an</span> <span class="n">upstream</span> <span class="n">to</span> <span class="n">proxy</span> <span class="n">traffic</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">kind</span><span class="p">:</span>
                        <span class="n">enum</span><span class="p">:</span>
                        <span class="p">-</span> <span class="n">Service</span>
                        <span class="p">-</span> <span class="n">TraefikService</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">name</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">Name</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Kubernetes</span> <span class="n">Service</span> <span class="n">object</span>
                          <span class="p">(</span><span class="k">for</span> <span class="n">a</span> <span class="n">load-balancer</span> <span class="n">of</span> <span class="n">servers</span><span class="p">),</span> <span class="n">or</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TraefikService</span>
                          <span class="n">object</span> <span class="p">(</span><span class="n">service</span> <span class="n">load-balancer</span><span class="p">,</span> <span class="n">mirroring</span><span class="p">,</span> <span class="n">etc</span><span class="p">).</span> <span class="n">The</span> <span class="n">differentiation</span>
                          <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">is</span> <span class="n">specified</span> <span class="k">in</span> <span class="n">the</span> <span class="n">Kind</span> <span class="n">field</span><span class="p">.</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">namespace</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">passHostHeader</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                      <span class="n">port</span><span class="p">:</span>
                        <span class="n">anyOf</span><span class="p">:</span>
                        <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                        <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                      <span class="n">responseForwarding</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">ResponseForwarding</span> <span class="n">holds</span> <span class="n">configuration</span> <span class="k">for</span> <span class="n">the</span>
                          <span class="n">forward</span> <span class="n">of</span> <span class="n">the</span> <span class="n">response</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">flushInterval</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">scheme</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">serversTransport</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">sticky</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">Sticky</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">cookie</span><span class="p">:</span>
                            <span class="n">description</span><span class="p">:</span> <span class="n">Cookie</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span> <span class="n">based</span>
                              <span class="n">on</span> <span class="n">cookie</span><span class="p">.</span>
                            <span class="n">properties</span><span class="p">:</span>
                              <span class="n">httpOnly</span><span class="p">:</span>
                                <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                              <span class="n">name</span><span class="p">:</span>
                                <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                              <span class="n">sameSite</span><span class="p">:</span>
                                <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                              <span class="n">secure</span><span class="p">:</span>
                                <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">strategy</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">weight</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">Weight</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">specified</span> <span class="n">when</span> <span class="n">Name</span> <span class="n">references</span>
                          <span class="n">a</span> <span class="n">TraefikService</span> <span class="n">object</span> <span class="p">(</span><span class="n">and</span> <span class="n">to</span> <span class="n">be</span> <span class="n">precise</span><span class="p">,</span> <span class="n">one</span> <span class="n">that</span> <span class="n">embeds</span>
                          <span class="n">a</span> <span class="n">Weighted</span> <span class="n">Round</span> <span class="n">Robin</span><span class="p">).</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                    <span class="n">required</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">name</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">status</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">forwardAuth</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">ForwardAuth</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">http</span> <span class="n">forward</span> <span class="n">authentication</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">address</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">authRequestHeaders</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">authResponseHeaders</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">authResponseHeadersRegex</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">tls</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">ClientTLS</span> <span class="n">holds</span> <span class="n">TLS</span> <span class="n">specific</span> <span class="n">configurations</span> <span class="n">as</span> <span class="n">client</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">caOptional</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                      <span class="n">caSecret</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">certSecret</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">insecureSkipVerify</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">trustForwardHeader</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">headers</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Headers</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">custom</span> <span class="n">header</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">accessControlAllowCredentials</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AccessControlAllowCredentials</span> <span class="n">is</span> <span class="n">only</span> <span class="n">valid</span> <span class="k">if</span> <span class="n">true</span><span class="p">.</span>
                      <span class="n">false</span> <span class="n">is</span> <span class="n">ignored</span><span class="p">.</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">accessControlAllowHeaders</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AccessControlAllowHeaders</span> <span class="n">must</span> <span class="n">be</span> <span class="n">used</span> <span class="k">in</span> <span class="n">response</span>
                      <span class="n">to</span> <span class="n">a</span> <span class="n">preflight</span> <span class="n">request</span> <span class="n">with</span> <span class="n">Access-Control-Request-Headers</span> <span class="n">set</span><span class="p">.</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">accessControlAllowMethods</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AccessControlAllowMethods</span> <span class="n">must</span> <span class="n">be</span> <span class="n">used</span> <span class="k">in</span> <span class="n">response</span>
                      <span class="n">to</span> <span class="n">a</span> <span class="n">preflight</span> <span class="n">request</span> <span class="n">with</span> <span class="n">Access-Control-Request-Method</span> <span class="n">set</span><span class="p">.</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">accessControlAllowOriginList</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AccessControlAllowOriginList</span> <span class="n">is</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">allowable</span>
                      <span class="n">origins</span><span class="p">.</span> <span class="n">Can</span> <span class="n">also</span> <span class="n">be</span> <span class="n">a</span> <span class="n">wildcard</span> <span class="n">origin</span> <span class="s2">&quot;*&quot;</span><span class="p">.</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">accessControlAllowOriginListRegex</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AccessControlAllowOriginListRegex</span> <span class="n">is</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">allowable</span>
                      <span class="n">origins</span> <span class="n">written</span> <span class="n">following</span> <span class="n">the</span> <span class="n">Regular</span> <span class="n">Expression</span> <span class="n">syntax</span> <span class="p">(</span><span class="n">https</span><span class="p">://</span><span class="n">golang</span><span class="p">.</span><span class="n">org</span><span class="p">/</span><span class="n">pkg</span><span class="p">/</span><span class="n">regexp</span><span class="p">/).</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">accessControlExposeHeaders</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AccessControlExposeHeaders</span> <span class="n">sets</span> <span class="n">valid</span> <span class="n">headers</span> <span class="k">for</span>
                      <span class="n">the</span> <span class="n">response</span><span class="p">.</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">accessControlMaxAge</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AccessControlMaxAge</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">time</span> <span class="n">that</span> <span class="n">a</span> <span class="n">preflight</span>
                      <span class="n">request</span> <span class="n">may</span> <span class="n">be</span> <span class="n">cached</span><span class="p">.</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">addVaryHeader</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">AddVaryHeader</span> <span class="n">controls</span> <span class="k">if</span> <span class="n">the</span> <span class="n">Vary</span> <span class="n">header</span> <span class="n">is</span> <span class="n">automatically</span>
                      <span class="n">added</span><span class="p">/</span><span class="n">updated</span> <span class="n">when</span> <span class="n">the</span> <span class="n">AccessControlAllowOriginList</span> <span class="n">is</span> <span class="n">set</span><span class="p">.</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">allowedHosts</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">browserXssFilter</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">contentSecurityPolicy</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">contentTypeNosniff</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">customBrowserXSSValue</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">customFrameOptionsValue</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">customRequestHeaders</span><span class="p">:</span>
                    <span class="n">additionalProperties</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">customResponseHeaders</span><span class="p">:</span>
                    <span class="n">additionalProperties</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">featurePolicy</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Deprecated: use PermissionsPolicy instead.&#39;</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">forceSTSHeader</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">frameDeny</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">hostsProxyHeaders</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">isDevelopment</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">permissionsPolicy</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">publicKey</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">referrerPolicy</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">sslForceHost</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Deprecated: use RedirectRegex instead.&#39;</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">sslHost</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Deprecated: use RedirectRegex instead.&#39;</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">sslProxyHeaders</span><span class="p">:</span>
                    <span class="n">additionalProperties</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">sslRedirect</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Deprecated: use EntryPoint redirection or RedirectScheme</span>
<span class="s1">                      instead.&#39;</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">sslTemporaryRedirect</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Deprecated: use EntryPoint redirection or RedirectScheme</span>
<span class="s1">                      instead.&#39;</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">stsIncludeSubdomains</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">stsPreload</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">stsSeconds</span><span class="p">:</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">inFlightReq</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">InFlightReq</span> <span class="n">limits</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">requests</span> <span class="n">being</span> <span class="n">processed</span>
                  <span class="n">and</span> <span class="n">served</span> <span class="n">concurrently</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">amount</span><span class="p">:</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">sourceCriterion</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">SourceCriterion</span> <span class="n">defines</span> <span class="n">what</span> <span class="n">criterion</span> <span class="n">is</span> <span class="n">used</span> <span class="n">to</span>
                      <span class="nb">group </span><span class="n">requests</span> <span class="n">as</span> <span class="n">originating</span> <span class="n">from</span> <span class="n">a</span> <span class="n">common</span> <span class="n">source</span><span class="p">.</span> <span class="k">If</span> <span class="n">none</span>
                      <span class="n">are</span> <span class="n">set</span><span class="p">,</span> <span class="n">the</span> <span class="k">default</span> <span class="n">is</span> <span class="n">to</span> <span class="n">use</span> <span class="n">the</span> <span class="n">request</span><span class="s1">&#39;s remote address</span>
<span class="s1">                      field. All fields are mutually exclusive.</span>
<span class="s1">                    properties:</span>
<span class="s1">                      ipStrategy:</span>
<span class="s1">                        description: IPStrategy holds the ip strategy configuration.</span>
<span class="s1">                        properties:</span>
<span class="s1">                          depth:</span>
<span class="s1">                            type: integer</span>
<span class="s1">                          excludedIPs:</span>
<span class="s1">                            items:</span>
<span class="s1">                              type: string</span>
<span class="s1">                            type: array</span>
<span class="s1">                        type: object</span>
<span class="s1">                      requestHeaderName:</span>
<span class="s1">                        type: string</span>
<span class="s1">                      requestHost:</span>
<span class="s1">                        type: boolean</span>
<span class="s1">                    type: object</span>
<span class="s1">                type: object</span>
<span class="s1">              ipWhiteList:</span>
<span class="s1">                description: IPWhiteList holds the ip white list configuration.</span>
<span class="s1">                properties:</span>
<span class="s1">                  ipStrategy:</span>
<span class="s1">                    description: IPStrategy holds the ip strategy configuration.</span>
<span class="s1">                    properties:</span>
<span class="s1">                      depth:</span>
<span class="s1">                        type: integer</span>
<span class="s1">                      excludedIPs:</span>
<span class="s1">                        items:</span>
<span class="s1">                          type: string</span>
<span class="s1">                        type: array</span>
<span class="s1">                    type: object</span>
<span class="s1">                  sourceRange:</span>
<span class="s1">                    items:</span>
<span class="s1">                      type: string</span>
<span class="s1">                    type: array</span>
<span class="s1">                type: object</span>
<span class="s1">              passTLSClientCert:</span>
<span class="s1">                description: PassTLSClientCert holds the TLS client cert headers configuration.</span>
<span class="s1">                properties:</span>
<span class="s1">                  info:</span>
<span class="s1">                    description: TLSClientCertificateInfo holds the client TLS certificate</span>
<span class="s1">                      info configuration.</span>
<span class="s1">                    properties:</span>
<span class="s1">                      issuer:</span>
<span class="s1">                        description: TLSClientCertificateDNInfo holds the client TLS</span>
<span class="s1">                          certificate distinguished name info configuration. cf https://tools.ietf.org/html/rfc3739</span>
<span class="s1">                        properties:</span>
<span class="s1">                          commonName:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          country:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          domainComponent:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          locality:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          organization:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          province:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          serialNumber:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                        type: object</span>
<span class="s1">                      notAfter:</span>
<span class="s1">                        type: boolean</span>
<span class="s1">                      notBefore:</span>
<span class="s1">                        type: boolean</span>
<span class="s1">                      sans:</span>
<span class="s1">                        type: boolean</span>
<span class="s1">                      serialNumber:</span>
<span class="s1">                        type: boolean</span>
<span class="s1">                      subject:</span>
<span class="s1">                        description: TLSClientCertificateDNInfo holds the client TLS</span>
<span class="s1">                          certificate distinguished name info configuration. cf https://tools.ietf.org/html/rfc3739</span>
<span class="s1">                        properties:</span>
<span class="s1">                          commonName:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          country:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          domainComponent:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          locality:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          organization:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          province:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                          serialNumber:</span>
<span class="s1">                            type: boolean</span>
<span class="s1">                        type: object</span>
<span class="s1">                    type: object</span>
<span class="s1">                  pem:</span>
<span class="s1">                    type: boolean</span>
<span class="s1">                type: object</span>
<span class="s1">              plugin:</span>
<span class="s1">                additionalProperties:</span>
<span class="s1">                  x-kubernetes-preserve-unknown-fields: true</span>
<span class="s1">                type: object</span>
<span class="s1">              rateLimit:</span>
<span class="s1">                description: RateLimit holds the rate limiting configuration for a</span>
<span class="s1">                  given router.</span>
<span class="s1">                properties:</span>
<span class="s1">                  average:</span>
<span class="s1">                    format: int64</span>
<span class="s1">                    type: integer</span>
<span class="s1">                  burst:</span>
<span class="s1">                    format: int64</span>
<span class="s1">                    type: integer</span>
<span class="s1">                  period:</span>
<span class="s1">                    anyOf:</span>
<span class="s1">                    - type: integer</span>
<span class="s1">                    - type: string</span>
<span class="s1">                    x-kubernetes-int-or-string: true</span>
<span class="s1">                  sourceCriterion:</span>
<span class="s1">                    description: SourceCriterion defines what criterion is used to</span>
<span class="s1">                      group requests as originating from a common source. If none</span>
<span class="s1">                      are set, the default is to use the request&#39;</span><span class="n">s</span> <span class="n">remote</span> <span class="n">address</span>
                      <span class="n">field</span><span class="p">.</span> <span class="n">All</span> <span class="n">fields</span> <span class="n">are</span> <span class="n">mutually</span> <span class="n">exclusive</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">ipStrategy</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">IPStrategy</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">ip</span> <span class="n">strategy</span> <span class="n">configuration</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">depth</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                          <span class="n">excludedIPs</span><span class="p">:</span>
                            <span class="n">items</span><span class="p">:</span>
                              <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                      <span class="n">requestHeaderName</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                      <span class="n">requestHost</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">redirectRegex</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">RedirectRegex</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">redirection</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">permanent</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">regex</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">replacement</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">redirectScheme</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">RedirectScheme</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">scheme</span> <span class="n">redirection</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">permanent</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">port</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">scheme</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">replacePath</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">ReplacePath</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">ReplacePath</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">path</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">replacePathRegex</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">ReplacePathRegex</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">ReplacePathRegex</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">regex</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">replacement</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">retry</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Retry</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">retry</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">attempts</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">initialInterval</span><span class="p">:</span>
                    <span class="n">anyOf</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">stripPrefix</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">StripPrefix</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">StripPrefix</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">forceSlash</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">prefixes</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">stripPrefixRegex</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">StripPrefixRegex</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">StripPrefixRegex</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">regex</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">middlewaretcps</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">MiddlewareTCP</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">MiddlewareTCPList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">middlewaretcps</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">middlewaretcp</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">MiddlewareTCP</span> <span class="n">is</span> <span class="n">a</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">MiddlewareTCP</span> <span class="n">resource</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">MiddlewareTCPSpec</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">MiddlewareTCP</span> <span class="n">configuration</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">ipWhiteList</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">TCPIPWhiteList</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">TCP</span> <span class="n">ip</span> <span class="n">white</span> <span class="n">list</span> <span class="n">configuration</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">sourceRange</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">serverstransports</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">ServersTransport</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">ServersTransportList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">serverstransports</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">serverstransport</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">ServersTransport</span> <span class="n">is</span> <span class="n">a</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">ServersTransport</span> <span class="n">resource</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">ServersTransportSpec</span> <span class="n">options</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">communication</span> <span class="n">between</span>
              <span class="n">Traefik</span> <span class="n">and</span> <span class="n">the</span> <span class="n">servers</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">certificatesSecrets</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Certificates</span> <span class="k">for</span> <span class="n">mTLS</span><span class="p">.</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">disableHTTP2</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Disable</span> <span class="n">HTTP</span><span class="p">/</span><span class="n">2</span> <span class="k">for</span> <span class="n">connections</span> <span class="n">with</span> <span class="n">backend</span> <span class="n">servers</span><span class="p">.</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
              <span class="n">forwardingTimeouts</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Timeouts</span> <span class="k">for</span> <span class="n">requests</span> <span class="n">forwarded</span> <span class="n">to</span> <span class="n">the</span> <span class="n">backend</span> <span class="n">servers</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">dialTimeout</span><span class="p">:</span>
                    <span class="n">anyOf</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">The</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">time</span> <span class="n">to</span> <span class="n">wait</span> <span class="k">until</span> <span class="n">a</span> <span class="n">connection</span> <span class="n">to</span>
                      <span class="n">a</span> <span class="n">backend</span> <span class="n">server</span> <span class="n">can</span> <span class="n">be</span> <span class="n">established</span><span class="p">.</span> <span class="k">If</span> <span class="n">zero</span><span class="p">,</span> <span class="n">no</span> <span class="n">timeout</span> <span class="n">exists</span><span class="p">.</span>
                    <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                  <span class="n">idleConnTimeout</span><span class="p">:</span>
                    <span class="n">anyOf</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">The</span> <span class="n">maximum</span> <span class="n">period</span> <span class="k">for</span> <span class="n">which</span> <span class="n">an</span> <span class="n">idle</span> <span class="n">HTTP</span> <span class="n">keep-alive</span>
                      <span class="n">connection</span> <span class="n">will</span> <span class="n">remain</span> <span class="n">open</span> <span class="n">before</span> <span class="n">closing</span> <span class="n">itself</span><span class="p">.</span>
                    <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                  <span class="n">responseHeaderTimeout</span><span class="p">:</span>
                    <span class="n">anyOf</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">The</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">time</span> <span class="n">to</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">a</span> <span class="n">server</span><span class="s1">&#39;s response</span>
<span class="s1">                      headers after fully writing the request (including its body,</span>
<span class="s1">                      if any). If zero, no timeout exists.</span>
<span class="s1">                    x-kubernetes-int-or-string: true</span>
<span class="s1">                type: object</span>
<span class="s1">              insecureSkipVerify:</span>
<span class="s1">                description: Disable SSL certificate verification.</span>
<span class="s1">                type: boolean</span>
<span class="s1">              maxIdleConnsPerHost:</span>
<span class="s1">                description: If non-zero, controls the maximum idle (keep-alive) to</span>
<span class="s1">                  keep per-host. If zero, DefaultMaxIdleConnsPerHost is used.</span>
<span class="s1">                type: integer</span>
<span class="s1">              peerCertURI:</span>
<span class="s1">                description: URI used to match against SAN URI during the peer certificate</span>
<span class="s1">                  verification.</span>
<span class="s1">                type: string</span>
<span class="s1">              rootCAsSecrets:</span>
<span class="s1">                description: Add cert file for self-signed certificate.</span>
<span class="s1">                items:</span>
<span class="s1">                  type: string</span>
<span class="s1">                type: array</span>
<span class="s1">              serverName:</span>
<span class="s1">                description: ServerName used to contact the server.</span>
<span class="s1">                type: string</span>
<span class="s1">            type: object</span>
<span class="s1">        required:</span>
<span class="s1">        - metadata</span>
<span class="s1">        - spec</span>
<span class="s1">        type: object</span>
<span class="s1">    served: true</span>
<span class="s1">    storage: true</span>
<span class="s1">status:</span>
<span class="s1">  acceptedNames:</span>
<span class="s1">    kind: &quot;&quot;</span>
<span class="s1">    plural: &quot;&quot;</span>
<span class="s1">  conditions: []</span>
<span class="s1">  storedVersions: []</span>

<span class="s1">---</span>
<span class="s1">apiVersion: apiextensions.k8s.io/v1</span>
<span class="s1">kind: CustomResourceDefinition</span>
<span class="s1">metadata:</span>
<span class="s1">  annotations:</span>
<span class="s1">    controller-gen.kubebuilder.io/version: v0.6.2</span>
<span class="s1">  creationTimestamp: null</span>
<span class="s1">  name: tlsoptions.traefik.containo.us</span>
<span class="s1">spec:</span>
<span class="s1">  group: traefik.containo.us</span>
<span class="s1">  names:</span>
<span class="s1">    kind: TLSOption</span>
<span class="s1">    listKind: TLSOptionList</span>
<span class="s1">    plural: tlsoptions</span>
<span class="s1">    singular: tlsoption</span>
<span class="s1">  scope: Namespaced</span>
<span class="s1">  versions:</span>
<span class="s1">  - name: v1alpha1</span>
<span class="s1">    schema:</span>
<span class="s1">      openAPIV3Schema:</span>
<span class="s1">        description: TLSOption is a specification for a TLSOption resource.</span>
<span class="s1">        properties:</span>
<span class="s1">          apiVersion:</span>
<span class="s1">            description: &#39;</span><span class="n">APIVersion</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">versioned</span> <span class="n">schema</span> <span class="n">of</span> <span class="n">this</span> <span class="n">representation</span>
              <span class="n">of</span> <span class="n">an</span> <span class="n">object</span><span class="p">.</span> <span class="n">Servers</span> <span class="n">should</span> <span class="n">convert</span> <span class="n">recognized</span> <span class="n">schemas</span> <span class="n">to</span> <span class="n">the</span> <span class="n">latest</span>
              <span class="n">internal</span> <span class="n">value</span><span class="p">,</span> <span class="n">and</span> <span class="n">may</span> <span class="n">reject</span> <span class="n">unrecognized</span> <span class="n">values</span><span class="p">.</span> <span class="n">More</span> <span class="n">info</span><span class="p">:</span> <span class="n">https</span><span class="p">://</span><span class="n">git</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">community</span><span class="p">/</span><span class="n">contributors</span><span class="p">/</span><span class="n">devel</span><span class="p">/</span><span class="n">sig-architecture</span><span class="p">/</span><span class="n">api-conventions</span><span class="p">.</span><span class="n">md</span><span class="c">#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">TLSOptionSpec</span> <span class="n">configures</span> <span class="n">TLS</span> <span class="k">for</span> <span class="n">an</span> <span class="n">entry</span> <span class="n">point</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">alpnProtocols</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">cipherSuites</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">clientAuth</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">ClientAuth</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">parameters</span> <span class="n">of</span> <span class="n">the</span> <span class="n">client</span> <span class="n">authentication</span>
                  <span class="n">part</span> <span class="n">of</span> <span class="n">the</span> <span class="n">TLS</span> <span class="n">connection</span><span class="p">,</span> <span class="k">if</span> <span class="n">any</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">clientAuthType</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">ClientAuthType</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">client</span> <span class="n">authentication</span>
                      <span class="nb">type </span><span class="n">to</span> <span class="n">apply</span><span class="p">.</span>
                    <span class="n">enum</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">NoClientCert</span>
                    <span class="p">-</span> <span class="n">RequestClientCert</span>
                    <span class="p">-</span> <span class="n">RequireAnyClientCert</span>
                    <span class="p">-</span> <span class="n">VerifyClientCertIfGiven</span>
                    <span class="p">-</span> <span class="n">RequireAndVerifyClientCert</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">secretNames</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">SecretName</span> <span class="n">is</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">referenced</span> <span class="n">Kubernetes</span>
                      <span class="n">Secret</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">details</span><span class="p">.</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">curvePreferences</span><span class="p">:</span>
                <span class="n">items</span><span class="p">:</span>
                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
              <span class="n">maxVersion</span><span class="p">:</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
              <span class="n">minVersion</span><span class="p">:</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
              <span class="n">preferServerCipherSuites</span><span class="p">:</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
              <span class="n">sniStrict</span><span class="p">:</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">tlsstores</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">TLSStore</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">TLSStoreList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">tlsstores</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">tlsstore</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">TLSStore</span> <span class="n">is</span> <span class="n">a</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">TLSStore</span> <span class="n">resource</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">TLSStoreSpec</span> <span class="n">configures</span> <span class="n">a</span> <span class="n">TLSStore</span> <span class="n">resource</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">defaultCertificate</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">DefaultCertificate</span> <span class="n">holds</span> <span class="n">a</span> <span class="n">secret</span> <span class="n">name</span> <span class="k">for</span> <span class="n">the</span> <span class="n">TLSOption</span>
                  <span class="n">resource</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">secretName</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">SecretName</span> <span class="n">is</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">referenced</span> <span class="n">Kubernetes</span>
                      <span class="n">Secret</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">details</span><span class="p">.</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                <span class="n">required</span><span class="p">:</span>
                <span class="p">-</span> <span class="n">secretName</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
            <span class="n">required</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">defaultCertificate</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">CustomResourceDefinition</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">controller-gen</span><span class="p">.</span><span class="n">kubebuilder</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">version</span><span class="p">:</span> <span class="n">v0</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">2</span>
  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="n">null</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefikservices</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">group</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
  <span class="n">names</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
    <span class="n">listKind</span><span class="p">:</span> <span class="n">TraefikServiceList</span>
    <span class="n">plural</span><span class="p">:</span> <span class="n">traefikservices</span>
    <span class="n">singular</span><span class="p">:</span> <span class="n">traefikservice</span>
  <span class="n">scope</span><span class="p">:</span> <span class="n">Namespaced</span>
  <span class="n">versions</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">v1alpha1</span>
    <span class="n">schema</span><span class="p">:</span>
      <span class="n">openAPIV3Schema</span><span class="p">:</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">TraefikService</span> <span class="n">is</span> <span class="n">the</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">a</span> <span class="n">service</span> <span class="p">(</span><span class="n">that</span> <span class="n">an</span> <span class="n">IngressRoute</span>
          <span class="n">refers</span> <span class="n">to</span><span class="p">)</span> <span class="n">that</span> <span class="n">is</span> <span class="n">usually</span> <span class="n">not</span> <span class="n">a</span> <span class="n">terminal</span> <span class="n">service</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span> <span class="n">not</span> <span class="n">a</span> <span class="n">pod</span> <span class="n">of</span> <span class="n">servers</span><span class="p">),</span>
          <span class="n">as</span> <span class="n">opposed</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Kubernetes</span> <span class="n">Service</span><span class="p">.</span> <span class="n">That</span> <span class="n">is</span> <span class="n">to</span> <span class="n">say</span><span class="p">,</span> <span class="n">it</span> <span class="n">usually</span> <span class="n">refers</span> <span class="n">to</span>
          <span class="n">other</span> <span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="n">services</span><span class="p">,</span> <span class="n">which</span> <span class="n">themselves</span> <span class="n">can</span> <span class="n">be</span> <span class="n">TraefikServices</span> <span class="n">or</span> <span class="n">Services</span><span class="p">.</span>
        <span class="n">properties</span><span class="p">:</span>
          <span class="n">apiVersion</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;APIVersion defines the versioned schema of this representation</span>
<span class="s1">              of an object. Servers should convert recognized schemas to the latest</span>
<span class="s1">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">kind</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="s1">&#39;Kind is a string value representing the REST resource this</span>
<span class="s1">              object represents. Servers may infer this from the endpoint the client</span>
<span class="s1">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
          <span class="n">metadata</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
          <span class="n">spec</span><span class="p">:</span>
            <span class="n">description</span><span class="p">:</span> <span class="n">ServiceSpec</span> <span class="n">defines</span> <span class="n">whether</span> <span class="n">a</span> <span class="n">TraefikService</span> <span class="n">is</span> <span class="n">a</span> <span class="n">load-balancer</span>
              <span class="n">of</span> <span class="n">services</span> <span class="n">or</span> <span class="n">a</span> <span class="n">mirroring</span> <span class="n">service</span><span class="p">.</span>
            <span class="n">properties</span><span class="p">:</span>
              <span class="n">mirroring</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">Mirroring</span> <span class="n">defines</span> <span class="n">a</span> <span class="n">mirroring</span> <span class="n">service</span><span class="p">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">composed</span>
                  <span class="n">of</span> <span class="n">a</span> <span class="n">main</span> <span class="n">load-balancer</span><span class="p">,</span> <span class="n">and</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">mirrors</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">kind</span><span class="p">:</span>
                    <span class="n">enum</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">Service</span>
                    <span class="p">-</span> <span class="n">TraefikService</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">maxBodySize</span><span class="p">:</span>
                    <span class="n">format</span><span class="p">:</span> <span class="n">int64</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                  <span class="n">mirrors</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">description</span><span class="p">:</span> <span class="n">MirrorService</span> <span class="n">defines</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">mirrors</span> <span class="n">of</span> <span class="n">a</span> <span class="n">Mirroring</span>
                        <span class="n">service</span><span class="p">.</span>
                      <span class="n">properties</span><span class="p">:</span>
                        <span class="n">kind</span><span class="p">:</span>
                          <span class="n">enum</span><span class="p">:</span>
                          <span class="p">-</span> <span class="n">Service</span>
                          <span class="p">-</span> <span class="n">TraefikService</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">name</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">Name</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Kubernetes</span> <span class="n">Service</span>
                            <span class="n">object</span> <span class="p">(</span><span class="k">for</span> <span class="n">a</span> <span class="n">load-balancer</span> <span class="n">of</span> <span class="n">servers</span><span class="p">),</span> <span class="n">or</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TraefikService</span>
                            <span class="n">object</span> <span class="p">(</span><span class="n">service</span> <span class="n">load-balancer</span><span class="p">,</span> <span class="n">mirroring</span><span class="p">,</span> <span class="n">etc</span><span class="p">).</span> <span class="n">The</span> <span class="n">differentiation</span>
                            <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">is</span> <span class="n">specified</span> <span class="k">in</span> <span class="n">the</span> <span class="n">Kind</span> <span class="n">field</span><span class="p">.</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">namespace</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">passHostHeader</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                        <span class="n">percent</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                        <span class="n">port</span><span class="p">:</span>
                          <span class="n">anyOf</span><span class="p">:</span>
                          <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                          <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                        <span class="n">responseForwarding</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">ResponseForwarding</span> <span class="n">holds</span> <span class="n">configuration</span> <span class="k">for</span>
                            <span class="n">the</span> <span class="n">forward</span> <span class="n">of</span> <span class="n">the</span> <span class="n">response</span><span class="p">.</span>
                          <span class="n">properties</span><span class="p">:</span>
                            <span class="n">flushInterval</span><span class="p">:</span>
                              <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                        <span class="n">scheme</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">serversTransport</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">sticky</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">Sticky</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span><span class="p">.</span>
                          <span class="n">properties</span><span class="p">:</span>
                            <span class="n">cookie</span><span class="p">:</span>
                              <span class="n">description</span><span class="p">:</span> <span class="n">Cookie</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span> <span class="n">based</span>
                                <span class="n">on</span> <span class="n">cookie</span><span class="p">.</span>
                              <span class="n">properties</span><span class="p">:</span>
                                <span class="n">httpOnly</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                                <span class="n">name</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                                <span class="n">sameSite</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                                <span class="n">secure</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                              <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                        <span class="n">strategy</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">weight</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">Weight</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">specified</span> <span class="n">when</span> <span class="n">Name</span> <span class="n">references</span>
                            <span class="n">a</span> <span class="n">TraefikService</span> <span class="n">object</span> <span class="p">(</span><span class="n">and</span> <span class="n">to</span> <span class="n">be</span> <span class="n">precise</span><span class="p">,</span> <span class="n">one</span> <span class="n">that</span> <span class="n">embeds</span>
                            <span class="n">a</span> <span class="n">Weighted</span> <span class="n">Round</span> <span class="n">Robin</span><span class="p">).</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                      <span class="n">required</span><span class="p">:</span>
                      <span class="p">-</span> <span class="n">name</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">name</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Name</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Kubernetes</span> <span class="n">Service</span> <span class="n">object</span>
                      <span class="p">(</span><span class="k">for</span> <span class="n">a</span> <span class="n">load-balancer</span> <span class="n">of</span> <span class="n">servers</span><span class="p">),</span> <span class="n">or</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TraefikService</span> <span class="n">object</span>
                      <span class="p">(</span><span class="n">service</span> <span class="n">load-balancer</span><span class="p">,</span> <span class="n">mirroring</span><span class="p">,</span> <span class="n">etc</span><span class="p">).</span> <span class="n">The</span> <span class="n">differentiation</span>
                      <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">is</span> <span class="n">specified</span> <span class="k">in</span> <span class="n">the</span> <span class="n">Kind</span> <span class="n">field</span><span class="p">.</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">namespace</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">passHostHeader</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                  <span class="n">port</span><span class="p">:</span>
                    <span class="n">anyOf</span><span class="p">:</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                    <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                  <span class="n">responseForwarding</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">ResponseForwarding</span> <span class="n">holds</span> <span class="n">configuration</span> <span class="k">for</span> <span class="n">the</span> <span class="n">forward</span>
                      <span class="n">of</span> <span class="n">the</span> <span class="n">response</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">flushInterval</span><span class="p">:</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">scheme</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">serversTransport</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">sticky</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Sticky</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">cookie</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">Cookie</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span> <span class="n">based</span> <span class="n">on</span>
                          <span class="n">cookie</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">httpOnly</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                          <span class="n">name</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">sameSite</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">secure</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                  <span class="n">strategy</span><span class="p">:</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                  <span class="n">weight</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Weight</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">specified</span> <span class="n">when</span> <span class="n">Name</span> <span class="n">references</span>
                      <span class="n">a</span> <span class="n">TraefikService</span> <span class="n">object</span> <span class="p">(</span><span class="n">and</span> <span class="n">to</span> <span class="n">be</span> <span class="n">precise</span><span class="p">,</span> <span class="n">one</span> <span class="n">that</span> <span class="n">embeds</span>
                      <span class="n">a</span> <span class="n">Weighted</span> <span class="n">Round</span> <span class="n">Robin</span><span class="p">).</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                <span class="n">required</span><span class="p">:</span>
                <span class="p">-</span> <span class="n">name</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
              <span class="n">weighted</span><span class="p">:</span>
                <span class="n">description</span><span class="p">:</span> <span class="n">WeightedRoundRobin</span> <span class="n">defines</span> <span class="n">a</span> <span class="n">load-balancer</span> <span class="n">of</span> <span class="n">services</span><span class="p">.</span>
                <span class="n">properties</span><span class="p">:</span>
                  <span class="n">services</span><span class="p">:</span>
                    <span class="n">items</span><span class="p">:</span>
                      <span class="n">description</span><span class="p">:</span> <span class="n">Service</span> <span class="n">defines</span> <span class="n">an</span> <span class="n">upstream</span> <span class="n">to</span> <span class="n">proxy</span> <span class="n">traffic</span><span class="p">.</span>
                      <span class="n">properties</span><span class="p">:</span>
                        <span class="n">kind</span><span class="p">:</span>
                          <span class="n">enum</span><span class="p">:</span>
                          <span class="p">-</span> <span class="n">Service</span>
                          <span class="p">-</span> <span class="n">TraefikService</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">name</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">Name</span> <span class="n">is</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Kubernetes</span> <span class="n">Service</span>
                            <span class="n">object</span> <span class="p">(</span><span class="k">for</span> <span class="n">a</span> <span class="n">load-balancer</span> <span class="n">of</span> <span class="n">servers</span><span class="p">),</span> <span class="n">or</span> <span class="n">to</span> <span class="n">a</span> <span class="n">TraefikService</span>
                            <span class="n">object</span> <span class="p">(</span><span class="n">service</span> <span class="n">load-balancer</span><span class="p">,</span> <span class="n">mirroring</span><span class="p">,</span> <span class="n">etc</span><span class="p">).</span> <span class="n">The</span> <span class="n">differentiation</span>
                            <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">is</span> <span class="n">specified</span> <span class="k">in</span> <span class="n">the</span> <span class="n">Kind</span> <span class="n">field</span><span class="p">.</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">namespace</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">passHostHeader</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                        <span class="n">port</span><span class="p">:</span>
                          <span class="n">anyOf</span><span class="p">:</span>
                          <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                          <span class="p">-</span> <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">x-kubernetes-int</span><span class="o">-or</span><span class="n">-string</span><span class="p">:</span> <span class="n">true</span>
                        <span class="n">responseForwarding</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">ResponseForwarding</span> <span class="n">holds</span> <span class="n">configuration</span> <span class="k">for</span>
                            <span class="n">the</span> <span class="n">forward</span> <span class="n">of</span> <span class="n">the</span> <span class="n">response</span><span class="p">.</span>
                          <span class="n">properties</span><span class="p">:</span>
                            <span class="n">flushInterval</span><span class="p">:</span>
                              <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                        <span class="n">scheme</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">serversTransport</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">sticky</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">Sticky</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span><span class="p">.</span>
                          <span class="n">properties</span><span class="p">:</span>
                            <span class="n">cookie</span><span class="p">:</span>
                              <span class="n">description</span><span class="p">:</span> <span class="n">Cookie</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span> <span class="n">based</span>
                                <span class="n">on</span> <span class="n">cookie</span><span class="p">.</span>
                              <span class="n">properties</span><span class="p">:</span>
                                <span class="n">httpOnly</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                                <span class="n">name</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                                <span class="n">sameSite</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                                <span class="n">secure</span><span class="p">:</span>
                                  <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                              <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                        <span class="n">strategy</span><span class="p">:</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                        <span class="n">weight</span><span class="p">:</span>
                          <span class="n">description</span><span class="p">:</span> <span class="n">Weight</span> <span class="n">should</span> <span class="n">only</span> <span class="n">be</span> <span class="n">specified</span> <span class="n">when</span> <span class="n">Name</span> <span class="n">references</span>
                            <span class="n">a</span> <span class="n">TraefikService</span> <span class="n">object</span> <span class="p">(</span><span class="n">and</span> <span class="n">to</span> <span class="n">be</span> <span class="n">precise</span><span class="p">,</span> <span class="n">one</span> <span class="n">that</span> <span class="n">embeds</span>
                            <span class="n">a</span> <span class="n">Weighted</span> <span class="n">Round</span> <span class="n">Robin</span><span class="p">).</span>
                          <span class="n">type</span><span class="p">:</span> <span class="n">integer</span>
                      <span class="n">required</span><span class="p">:</span>
                      <span class="p">-</span> <span class="n">name</span>
                      <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">array</span>
                  <span class="n">sticky</span><span class="p">:</span>
                    <span class="n">description</span><span class="p">:</span> <span class="n">Sticky</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span><span class="p">.</span>
                    <span class="n">properties</span><span class="p">:</span>
                      <span class="n">cookie</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">:</span> <span class="n">Cookie</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">sticky</span> <span class="n">configuration</span> <span class="n">based</span> <span class="n">on</span>
                          <span class="n">cookie</span><span class="p">.</span>
                        <span class="n">properties</span><span class="p">:</span>
                          <span class="n">httpOnly</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                          <span class="n">name</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">sameSite</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">string</span>
                          <span class="n">secure</span><span class="p">:</span>
                            <span class="n">type</span><span class="p">:</span> <span class="n">boolean</span>
                        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                    <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
                <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
        <span class="n">required</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">metadata</span>
        <span class="p">-</span> <span class="n">spec</span>
        <span class="n">type</span><span class="p">:</span> <span class="n">object</span>
    <span class="n">served</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">storage</span><span class="p">:</span> <span class="n">true</span>
<span class="n">status</span><span class="p">:</span>
  <span class="n">acceptedNames</span><span class="p">:</span>
    <span class="n">kind</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plural</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">conditions</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">storedVersions</span><span class="p">:</span> <span class="p">[]</span>
</code></pre></div>
<h3 id="212_rbac">2.1.2 创建RBAC权限<a class="headerlink" href="#212_rbac" title="Permanent link">&para;</a></h3>
<blockquote>
<p>基于角色的访问控制（RBAC）策略，方便对Kubernetes资源和API进行细粒度控制</p>
<p>traefik需要一定的权限，需要提前创建ServiceAccount并分配一定的权限。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-rbac.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="p">.</span><span class="n">authorization</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
<span class="n">rules</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="p">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">services</span>
      <span class="p">-</span> <span class="n">endpoints</span>
      <span class="p">-</span> <span class="n">secrets</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">get</span>
      <span class="p">-</span> <span class="n">list</span>
      <span class="p">-</span> <span class="n">watch</span>
  <span class="p">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">extensions</span>
      <span class="p">-</span> <span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">ingresses</span>
      <span class="p">-</span> <span class="n">ingressclasses</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">get</span>
      <span class="p">-</span> <span class="n">list</span>
      <span class="p">-</span> <span class="n">watch</span>
  <span class="p">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">extensions</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">ingresses</span><span class="p">/</span><span class="n">status</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">update</span>
  <span class="p">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">middlewares</span>
      <span class="p">-</span> <span class="n">middlewaretcps</span>
      <span class="p">-</span> <span class="n">ingressroutes</span>
      <span class="p">-</span> <span class="n">traefikservices</span>
      <span class="p">-</span> <span class="n">ingressroutetcps</span>
      <span class="p">-</span> <span class="n">ingressrouteudps</span>
      <span class="p">-</span> <span class="n">tlsoptions</span>
      <span class="p">-</span> <span class="n">tlsstores</span>
      <span class="p">-</span> <span class="n">serverstransports</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">get</span>
      <span class="p">-</span> <span class="n">list</span>
      <span class="p">-</span> <span class="n">watch</span>
<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="p">.</span><span class="n">authorization</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRoleBinding</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
<span class="n">roleRef</span><span class="p">:</span>
  <span class="n">apiGroup</span><span class="p">:</span> <span class="n">rbac</span><span class="p">.</span><span class="n">authorization</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span>
  <span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
<span class="n">subjects</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
</code></pre></div>
<h3 id="213_traefik">2.1.3 创建traefik配置文件<a class="headerlink" href="#213_traefik" title="Permanent link">&para;</a></h3>
<blockquote>
<p>由traefik配置很多，通过CLI定义不方便，一般都通过配置文件对traefik进行参数配置，例如使用ConfigMap将配置挂载至traefik中</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-configmap.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ConfigMap</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">traefik</span><span class="p">.</span><span class="n">yaml</span><span class="p">:</span> <span class="p">|-</span>
    <span class="n">serversTransport</span><span class="p">:</span>
      <span class="n">insecureSkipVerify</span><span class="p">:</span> <span class="n">true</span> <span class="c">## 略验证代理服务的 TLS 证书</span>
    <span class="n">api</span><span class="p">:</span>
      <span class="n">insecure</span><span class="p">:</span> <span class="n">true</span>  <span class="c">## 允许 HTTP 方式访问 API</span>
      <span class="n">dashboard</span><span class="p">:</span> <span class="n">true</span>  <span class="c">## 启用 Dashboard</span>
      <span class="n">debug</span><span class="p">:</span> <span class="n">true</span>  <span class="c">## 启用 Debug 调试模式</span>
    <span class="n">metrics</span><span class="p">:</span>
      <span class="n">prometheus</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>  <span class="c">## 配置 Prometheus 监控指标数据，并使用默认配置</span>
    <span class="n">entryPoints</span><span class="p">:</span>
      <span class="n">web</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:80&quot;</span> <span class="c">## 配置 80 端口，并设置入口名称为 web</span>
      <span class="n">websecure</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:443&quot;</span>  <span class="c">## 配置 443 端口，并设置入口名称为 websecure</span>
      <span class="n">metrics</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8082&quot;</span> <span class="c">## 配置 8082端口，并设置入口名称为 metrics</span>
      <span class="n">tcpep</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8083&quot;</span>  <span class="c">## 配置 8083端口，并设置入口名称为 tcpep,做为tcp入口</span>
      <span class="n">udpep</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8084/udp&quot;</span>  <span class="c">## 配置 8084端口，并设置入口名称为 udpep，做为udp入口</span>
    <span class="n">providers</span><span class="p">:</span>
      <span class="n">kubernetesCRD</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>  <span class="c">## 启用 Kubernetes CRD 方式来配置路由规则</span>
      <span class="n">kubernetesingress</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>  <span class="c">## 启用 Kubernetes Ingress 方式来配置路由规则</span>
      <span class="n">kubernetesGateway</span><span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="c">## 启用 Kubernetes Gateway API</span>
    <span class="n">experimental</span><span class="p">:</span>
      <span class="n">kubernetesGateway</span><span class="p">:</span> <span class="n">true</span>  <span class="c">## 允许使用 Kubernetes Gateway API</span>
    <span class="n">log</span><span class="p">:</span>
      <span class="n">filePath</span><span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="c">## 设置调试日志文件存储路径，如果为空则输出到控制台</span>
      <span class="n">level</span><span class="p">:</span> <span class="n">error</span> <span class="c">## 设置调试日志级别</span>
      <span class="n">format</span><span class="p">:</span> <span class="n">json</span>  <span class="c">## 设置调试日志格式</span>
    <span class="n">accessLog</span><span class="p">:</span>
      <span class="n">filePath</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>  <span class="c">## 设置访问日志文件存储路径，如果为空则输出到控制台</span>
      <span class="n">format</span><span class="p">:</span> <span class="n">json</span>  <span class="c">## 设置访问调试日志格式</span>
      <span class="n">bufferingSize</span><span class="p">:</span> <span class="n">0</span>  <span class="c">## 设置访问日志缓存行数</span>
      <span class="n">filters</span><span class="p">:</span>
        <span class="n">retryAttempts</span><span class="p">:</span> <span class="n">true</span>  <span class="c">## 设置代理访问重试失败时，保留访问日志</span>
        <span class="n">minDuration</span><span class="p">:</span> <span class="n">20</span>   <span class="c">## 设置保留请求时间超过指定持续时间的访问日志</span>
      <span class="n">fields</span><span class="p">:</span>             <span class="c">## 设置访问日志中的字段是否保留（keep 保留、drop 不保留）</span>
        <span class="n">defaultMode</span><span class="p">:</span> <span class="n">keep</span> <span class="c">## 设置默认保留访问日志字段</span>
        <span class="n">names</span><span class="p">:</span>
          <span class="n">ClientUsername</span><span class="p">:</span> <span class="n">drop</span>  
        <span class="n">headers</span><span class="p">:</span>
          <span class="n">defaultMode</span><span class="p">:</span> <span class="n">keep</span>  <span class="c">##  设置 Header 中字段是否保留,设置默认保留 Header 中字段</span>
          <span class="n">names</span><span class="p">:</span>  <span class="c">## 针对 Header 中特别字段特别配置保留模式</span>
            <span class="n">User-Agent</span><span class="p">:</span> <span class="n">redact</span>
            <span class="n">Authorization</span><span class="p">:</span> <span class="n">drop</span>
            <span class="n">Content-Type</span><span class="p">:</span> <span class="n">keep</span>
</code></pre></div>
<h3 id="214">2.1.4 应用上述资源清单文件<a class="headerlink" href="#214" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefik-crd.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefik-rbac.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefik-config.yaml</span>
</code></pre></div>
<h3 id="215_label">2.1.5 设置节点Label<a class="headerlink" href="#215_label" title="Permanent link">&para;</a></h3>
<blockquote>
<p>由于使用DaemonSet方式部署Traefik，所以需要为节点设置label，当应用部署时会根据节点Label进行选择。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">设置节点标签</span>
<span class="c"># kubectl label nodes --all IngressProxy=true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">查看节点标签</span>
<span class="c"># kubectl get nodes --show-labels</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">如需要取消时</span><span class="err">，</span><span class="n">可执行下述命令</span>
<span class="c"># kubectl label nodes --all IngressProxy-</span>
</code></pre></div>
<h2 id="22_traefik">2.2 部署Traefik<a class="headerlink" href="#22_traefik" title="Permanent link">&para;</a></h2>
<h3 id="221_deploy">2.2.1 deploy资源清单文件准备<a class="headerlink" href="#221_deploy" title="Permanent link">&para;</a></h3>
<blockquote>
<p>本次将用Daemonset方式部署traefik,便于后期扩展</p>
<p>本次部署通过hostport方式把Pod中容器内的80、443映射到物理机，方便集群外访问。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-deploy.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">DaemonSet</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">serviceAccountName</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">traefik</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">7</span>
          <span class="n">args</span><span class="p">:</span>
            <span class="p">-</span> <span class="p">-</span><span class="n">-configfile</span><span class="p">=/</span><span class="n">config</span><span class="p">/</span><span class="n">traefik</span><span class="p">.</span><span class="n">yaml</span>
          <span class="n">volumeMounts</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="p">/</span><span class="n">config</span>
              <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">web</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">80</span>  <span class="c">## 将容器端口绑定所在服务器的 80 端口</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">websecure</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">443</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">443</span>  <span class="c">## 将容器端口绑定所在服务器的 443 端口</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">admin</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8080</span>  <span class="c">## Traefik Dashboard 端口</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">tcpep</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8083</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">8083</span>  <span class="c">## 将容器端口绑定所在服务器的 8083 端口</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">udpep</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8084</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">8084</span>  <span class="c">## 将容器端口绑定所在服务器的 8084 端口</span>
              <span class="n">protocol</span><span class="p">:</span> <span class="n">UDP</span>
      <span class="n">volumes</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
          <span class="n">configMap</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
      <span class="n">tolerations</span><span class="p">:</span>              <span class="c">## 设置容忍所有污点，防止节点被设置污点</span>
        <span class="p">-</span> <span class="n">operator</span><span class="p">:</span> <span class="s2">&quot;Exists&quot;</span>
      <span class="n">nodeSelector</span><span class="p">:</span>             <span class="c">## 设置node筛选器，在特定label的节点上启动</span>
        <span class="n">IngressProxy</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">验证端口配置是否正确</span>
<span class="c"># kubectl get daemonset traefik -n kube-system -o yaml</span>
</code></pre></div>
<h3 id="222_deploy">2.2.2 应用deploy资源清单文件<a class="headerlink" href="#222_deploy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefix-deploy.yaml</span>
</code></pre></div>
<h3 id="223_service">2.2.3 service资源清单文件准备<a class="headerlink" href="#223_service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefix-service.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">web</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">admin</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">websecure</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">443</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">tcpep</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8083</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">UDP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">udpep</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8084</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
</code></pre></div>
<h3 id="224_service">2.2.4 应用service资源清单文件<a class="headerlink" href="#224_service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefik-service.yaml</span>
</code></pre></div>
<h2 id="23_traefik_dashboard">2.3 配置访问traefik dashboard路由规则<a class="headerlink" href="#23_traefik_dashboard" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Traefik 应用已经部署完成，但是想让外部访问 Kubernetes 内部服务，还需要配置路由规则，上面部署 Traefik 时开启了 Traefik Dashboard，这是 Traefik 提供的视图看板，所以，首先配置基于 HTTP 的 Traefik Dashboard 路由规则，使外部能够访问 Traefik Dashboard。这里使用 IngressRoute方式进行演示。</p>
</blockquote>
<h3 id="231_traefik">2.3.1 Traefik创建路由规则方法<a class="headerlink" href="#231_traefik" title="Permanent link">&para;</a></h3>
<ul>
<li>原生ingress</li>
<li>CRD IngressRoute</li>
<li>Gateway API</li>
</ul>
<p><img alt="image-20220418185227777" src="../../../img/kubernetes/kubernetes_traefik/image-20220418185227777.png" /></p>
<h3 id="232_ingresstraefik_dashboard">2.3.2 通过原生ingress方式暴露traefik dashboard<a class="headerlink" href="#232_ingresstraefik_dashboard" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get svc -n kube-system</span>
<span class="n">NAME</span>             <span class="nb">TYPE </span>       <span class="n">CLUSTER-IP</span>     <span class="n">EXTERNAL-IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                                     <span class="n">AGE</span>
<span class="n">traefik</span>          <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">174</span><span class="p">.</span><span class="n">88</span>   <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">80</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">8080</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">443</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">8083</span><span class="p">/</span><span class="n">TCP</span><span class="p">,</span><span class="n">8084</span><span class="p">/</span><span class="n">UDP</span>   <span class="n">6h44m</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get endpoints -n kube-system</span>
<span class="n">NAME</span>             <span class="n">ENDPOINTS</span>                                                           <span class="n">AGE</span>
<span class="n">traefik</span>          <span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">135</span><span class="p">.</span><span class="n">204</span><span class="p">:</span><span class="n">80</span><span class="p">,</span><span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">159</span><span class="p">.</span><span class="n">141</span><span class="p">:</span><span class="n">80</span><span class="p">,</span><span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">194</span><span class="p">.</span><span class="n">92</span><span class="p">:</span><span class="n">80</span> <span class="p">+</span> <span class="n">17</span> <span class="n">more</span><span class="p">...</span>   <span class="n">6h44m</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># cat traefik-dashboard-native-ingress.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Ingress</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik-dashboard-ingress</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
  <span class="n">annotations</span><span class="p">:</span>
    <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">ingress</span><span class="p">.</span><span class="n">class</span><span class="p">:</span> <span class="n">traefik</span>
    <span class="n">traefik</span><span class="p">.</span><span class="n">ingress</span><span class="p">.</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">router</span><span class="p">.</span><span class="n">entrypoints</span><span class="p">:</span> <span class="n">web</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">rules</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">host</span><span class="p">:</span> <span class="n">tfni</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
    <span class="n">http</span><span class="p">:</span>
      <span class="n">paths</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">pathType</span><span class="p">:</span> <span class="n">Prefix</span>
        <span class="n">path</span><span class="p">:</span> <span class="p">/</span>
        <span class="n">backend</span><span class="p">:</span>
          <span class="n">service</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
            <span class="n">port</span><span class="p">:</span>
              <span class="n">number</span><span class="p">:</span> <span class="n">8080</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefik-dashboard-native-ingress.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingress -n kube-system</span>
<span class="n">NAME</span>                        <span class="n">CLASS</span>    <span class="n">HOSTS</span>              <span class="n">ADDRESS</span>   <span class="n">PORTS</span>   <span class="n">AGE</span>
<span class="n">traefik-dashboard-ingress</span>   <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>   <span class="n">tfni</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>             <span class="n">80</span>      <span class="n">56m</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl describe ingress traefik-dashboard-ingress -n kube-system</span>
<span class="n">Name</span><span class="p">:</span>             <span class="n">traefik-dashboard-ingress</span>
<span class="n">Namespace</span><span class="p">:</span>        <span class="n">kube-system</span>
<span class="n">Address</span><span class="p">:</span>
<span class="k">Default</span> <span class="n">backend</span><span class="p">:</span>  <span class="k">default</span><span class="n">-http-backend</span><span class="p">:</span><span class="n">80</span> <span class="p">(&lt;</span><span class="n">error</span><span class="p">:</span> <span class="n">endpoints</span> <span class="s2">&quot;default-http-backend&quot;</span> <span class="n">not</span> <span class="n">found</span><span class="p">&gt;)</span>
<span class="n">Rules</span><span class="p">:</span>
  <span class="n">Host</span>              <span class="n">Path</span>  <span class="n">Backends</span>
  <span class="p">----</span>              <span class="p">----</span>  <span class="p">--------</span>
  <span class="n">tfni</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
                    <span class="p">/</span>   <span class="n">traefik</span><span class="p">:</span><span class="n">8080</span> <span class="p">(</span><span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">135</span><span class="p">.</span><span class="n">204</span><span class="p">:</span><span class="n">8080</span><span class="p">,</span><span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">159</span><span class="p">.</span><span class="n">141</span><span class="p">:</span><span class="n">8080</span><span class="p">,</span><span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">194</span><span class="p">.</span><span class="n">92</span><span class="p">:</span><span class="n">8080</span> <span class="p">+</span> <span class="n">1</span> <span class="n">more</span><span class="p">...)</span>
<span class="n">Annotations</span><span class="p">:</span>        <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">ingress</span><span class="p">.</span><span class="n">class</span><span class="p">:</span> <span class="n">traefik</span>
                    <span class="n">traefik</span><span class="p">.</span><span class="n">ingress</span><span class="p">.</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">router</span><span class="p">.</span><span class="n">entrypoints</span><span class="p">:</span> <span class="n">web</span>
<span class="n">Events</span><span class="p">:</span>             <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>
</code></pre></div>
<p><strong>在集群之外主机访问</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># vim /etc/hosts</span>
<span class="p">......</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">tfni</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<p><img alt="image-20220418185030751" src="../../../img/kubernetes/kubernetes_traefik/image-20220418185030751.png" /></p>
<h3 id="233_dashboard_ingress_route">2.3.3 创建dashboard ingress route资源清单文件<a class="headerlink" href="#233_dashboard_ingress_route" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-dashboard-ingress-route.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">web</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">traefik</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span> <span class="p">&amp;&amp;</span> <span class="n">PathPrefix</span><span class="p">(`/`)</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
</code></pre></div>
<h3 id="234">2.3.4 应用资源清单文件<a class="headerlink" href="#234" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefik-dashboard-ingress-route.yaml</span>
</code></pre></div>
<h3 id="235">2.3.5 在集群内或集群外主机配置域名解析<a class="headerlink" href="#235" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">把域名解析为kubernetes集群任意节点IP既可</span><span class="err">。</span>
<span class="c"># vim /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">traefik</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<h3 id="236_traefik_dashboard">2.3.6 通过域名访问traefik dashboard<a class="headerlink" href="#236_traefik_dashboard" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># firefox http://traefik.kubemsb.com &amp;</span>
</code></pre></div>
<p><img alt="image-20220416095227915" src="../../../img/kubernetes/kubernetes_traefik/image-20220416095227915.png" /></p>
<h1 id="traefik_2">三、traefik基础应用<a class="headerlink" href="#traefik_2" title="Permanent link">&para;</a></h1>
<h2 id="31_kubernetes_dashboard">3.1 配置kubernetes dashboard路由规则<a class="headerlink" href="#31_kubernetes_dashboard" title="Permanent link">&para;</a></h2>
<blockquote>
<p>必须使用SSL证书创建secret密钥</p>
</blockquote>
<h3 id="311_kubernetes_dashboard_service">3.1.1 查看kubernetes dashboard service状态<a class="headerlink" href="#311_kubernetes_dashboard_service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get svc -n kubernetes-dashboard</span>
<span class="n">NAME</span>                        <span class="nb">TYPE </span>       <span class="n">CLUSTER-IP</span>    <span class="n">EXTERNAL-IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>         <span class="n">AGE</span>
<span class="n">dashboard-metrics-scraper</span>   <span class="n">ClusterIP</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">100</span><span class="p">.</span><span class="n">4</span>   <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">8000</span><span class="p">/</span><span class="n">TCP</span>        <span class="n">21d</span>
<span class="n">kubernetes-dashboard</span>        <span class="n">NodePort</span>    <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">19</span><span class="p">.</span><span class="n">1</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>        <span class="n">443</span><span class="p">:</span><span class="n">30000</span><span class="p">/</span><span class="n">TCP</span>   <span class="n">21d</span>
</code></pre></div>
<h3 id="312_kubernetes_dashboard">3.1.2 编写访问kubernetes dashboard 路由规则<a class="headerlink" href="#312_kubernetes_dashboard" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># ls</span>
<span class="n">6864844_kubemsb</span><span class="p">.</span><span class="n">com_nginx</span><span class="p">.</span><span class="n">zip</span>  <span class="n">kubemsb</span><span class="p">.</span><span class="n">key</span>  <span class="n">kubemsb</span><span class="p">.</span><span class="n">pem</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl create secret tls kubemsb-tls --cert=kubemsb.pem --key=kubemsb.key</span>
<span class="n">secret</span><span class="p">/</span><span class="n">kubemsb-tls</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get secret</span>
<span class="n">NAME</span>                                 <span class="nb">TYPE </span>                                 <span class="n">DATA</span>   <span class="n">AGE</span>
<span class="k">default</span><span class="n">-token-x4qbc</span>                  <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">service-account-token</span>   <span class="n">3</span>      <span class="n">24d</span>
<span class="n">kubemsb-tls</span>                          <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">tls</span>                     <span class="n">2</span>      <span class="n">11s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim kubernetes-dashboard-ir.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">kubernetes-dashboard</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kubernetes-dashboard</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">websecure</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">dashboard</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">kubernetes-dashboard</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">443</span>
  <span class="n">tls</span><span class="p">:</span>
    <span class="n">secretName</span><span class="p">:</span> <span class="n">kubemsb-tls</span>
</code></pre></div>
<h3 id="313">3.1.3 应用上述路由规则文件<a class="headerlink" href="#313" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f kubernetes-dashboard-ir.yaml</span>
</code></pre></div>
<p><img alt="image-20220416090128886" src="../../../img/kubernetes/kubernetes_traefik/image-20220416090128886.png" /></p>
<p><img alt="image-20220416090950402" src="../../../img/kubernetes/kubernetes_traefik/image-20220416090950402.png" /></p>
<h3 id="314">3.1.4 配置域名解析及访问<a class="headerlink" href="#314" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">dashboard</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<p><img alt="image-20220416091040903" src="../../../img/kubernetes/kubernetes_traefik/image-20220416091040903.png" /></p>
<p><img alt="image-20220416192909766" src="../../../img/kubernetes/kubernetes_traefik/image-20220416192909766.png" /></p>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get secret -n kubernetes-dashboard</span>
<span class="n">NAME</span>                               <span class="nb">TYPE </span>                                 <span class="n">DATA</span>   <span class="n">AGE</span>
<span class="p">......</span>
<span class="n">kubernetes-dashboard-token</span><span class="p">-</span><span class="n">8tm5n</span>   <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">service-account-token</span>   <span class="n">3</span>      <span class="n">21d</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl describe secret kubernetes-dashboard-token-8tm5n -n kubernetes-dashboard</span>
<span class="n">Name</span><span class="p">:</span>         <span class="n">kubernetes-dashboard-token</span><span class="p">-</span><span class="n">8tm5n</span>
<span class="n">Namespace</span><span class="p">:</span>    <span class="n">kubernetes-dashboard</span>
<span class="n">Labels</span><span class="p">:</span>       <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>
<span class="n">Annotations</span><span class="p">:</span>  <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">service-account</span><span class="p">.</span><span class="n">name</span><span class="p">:</span> <span class="n">kubernetes-dashboard</span>
              <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">service-account</span><span class="p">.</span><span class="n">uid</span><span class="p">:</span> <span class="n">47d19e14-e3ed</span><span class="p">-</span><span class="n">4733</span><span class="p">-</span><span class="n">9799</span><span class="p">-</span><span class="n">02396dfb436a</span>

<span class="n">Type</span><span class="p">:</span>  <span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">service-account-token</span>

<span class="n">Data</span>
<span class="p">====</span>
<span class="n">ca</span><span class="p">.</span><span class="n">crt</span><span class="p">:</span>     <span class="n">1359</span> <span class="n">bytes</span>
<span class="n">namespace</span><span class="p">:</span>  <span class="n">20</span> <span class="n">bytes</span>
<span class="n">token</span><span class="p">:</span>      <span class="n">eyJhbGciOiJSUzI1NiIsImtpZCI6ImVGc2xjT05uekl0MlVOZ0VCSlhHSURfOXd6WGFvVnZFZmNwREwtVk1STlEifQ</span><span class="p">.</span><span class="n">eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC10b2tlbi04dG01biIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjQ3ZDE5ZTE0LWUzZWQtNDczMy05Nzk5LTAyMzk2ZGZiNDM2YSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDprdWJlcm5ldGVzLWRhc2hib2FyZCJ9</span><span class="p">.</span><span class="n">rY5YFoJD3ZUg1e31uxrPhKl0a_mslAmVG5r1ZDia0z7WKKtGjs8XwSu5cIDqKa</span><span class="p">-</span><span class="n">1FUV6ixxgfDwm5Rd-nK8TCMVRrDY_7r2I5-u2ebh4rEAXCBvQw0gtJu16-e1Z_TQqNuc73E9fDS0AqHr2qGOWAQcz_FjWGAGjZKzYlKPcA3mFI2wsAIRgxh29-S2f4SxB2zgWyYQdbW-fiHDHWK6dQ-a3glIlCk4jnPtzrX1HNK3BSRPoKaZg_9Ot0dABex2ro5QkQ0wyuT3NLio-n8v21MbhKG5ehBEFRNrTcTPM2CLt4XaUJezphKHShdc3VbUlizPge5DleAJcp9JrFzyqBQ</span>
</code></pre></div>
<p><img alt="image-20220416192957609" src="../../../img/kubernetes/kubernetes_traefik/image-20220416192957609.png" /></p>
<p><img alt="image-20220416193057872" src="../../../img/kubernetes/kubernetes_traefik/image-20220416193057872.png" /></p>
<h2 id="32_http">3.2 配置HTTP路由规则<a class="headerlink" href="#32_http" title="Permanent link">&para;</a></h2>
<h3 id="321">3.2.1 创建应用及服务资源清单文件并应用<a class="headerlink" href="#321" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim whoami.yaml</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">whoami</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">whoami</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">2</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
      <span class="n">task</span><span class="p">:</span> <span class="n">whoami</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
        <span class="n">task</span><span class="p">:</span> <span class="n">whoami</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">whoami</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">traefik</span><span class="p">/</span><span class="n">whoami</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">whoami</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
    <span class="n">task</span><span class="p">:</span> <span class="n">whoami</span>

<span class="p">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">whoamitcp</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">whoamitcp</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">2</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
      <span class="n">task</span><span class="p">:</span> <span class="n">whoamitcp</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
        <span class="n">task</span><span class="p">:</span> <span class="n">whoamitcp</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">whoamitcp</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">traefik</span><span class="p">/</span><span class="n">whoamitcp</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">8080</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">whoamitcp</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
    <span class="n">task</span><span class="p">:</span> <span class="n">whoamitcp</span>

<span class="p">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">whoamiudp</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">whoamiudp</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">2</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
      <span class="n">task</span><span class="p">:</span> <span class="n">whoamiudp</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
        <span class="n">task</span><span class="p">:</span> <span class="n">whoamiudp</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">whoamiudp</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">traefik</span><span class="p">/</span><span class="n">whoamiudp</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">8080</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">whoamiudp</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
      <span class="n">protocol</span><span class="p">:</span> <span class="n">UDP</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefiklabs</span>
    <span class="n">task</span><span class="p">:</span> <span class="n">whoamiudp</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f whoami.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get all</span>
<span class="n">NAME</span>                            <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">pod</span><span class="p">/</span><span class="n">whoami</span><span class="p">-</span><span class="n">7d666f84d8-ffbdv</span>     <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">35m</span>
<span class="n">pod</span><span class="p">/</span><span class="n">whoami</span><span class="p">-</span><span class="n">7d666f84d8-n75wb</span>     <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">35m</span>
<span class="n">pod</span><span class="p">/</span><span class="n">whoamitcp</span><span class="p">-</span><span class="n">744cc4b47-g98fv</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">35m</span>
<span class="n">pod</span><span class="p">/</span><span class="n">whoamitcp</span><span class="p">-</span><span class="n">744cc4b47-s2m7h</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">35m</span>
<span class="n">pod</span><span class="p">/</span><span class="n">whoamiudp</span><span class="p">-</span><span class="n">58f6cf7b8</span><span class="p">-</span><span class="n">54552</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">35m</span>
<span class="n">pod</span><span class="p">/</span><span class="n">whoamiudp</span><span class="p">-</span><span class="n">58f6cf7b8-dzxpg</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">35m</span>

<span class="n">NAME</span>                    <span class="nb">TYPE </span>          <span class="n">CLUSTER-IP</span>      <span class="n">EXTERNAL-IP</span>     <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>          <span class="n">AGE</span>
<span class="n">service</span><span class="p">/</span><span class="n">kubernetes</span>      <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>       <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">443</span><span class="p">/</span><span class="n">TCP</span>          <span class="n">25d</span>
<span class="n">service</span><span class="p">/</span><span class="n">nginx-metallb</span>   <span class="n">LoadBalancer</span>   <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">109</span><span class="p">.</span><span class="n">6</span>     <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">90</span>   <span class="n">8090</span><span class="p">:</span><span class="n">30259</span><span class="p">/</span><span class="n">TCP</span>   <span class="n">14d</span>
<span class="n">service</span><span class="p">/</span><span class="n">whoami</span>          <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">251</span><span class="p">.</span><span class="n">213</span>   <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">80</span><span class="p">/</span><span class="n">TCP</span>           <span class="n">35m</span>
<span class="n">service</span><span class="p">/</span><span class="n">whoamitcp</span>       <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">20</span><span class="p">.</span><span class="n">1</span>      <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">8080</span><span class="p">/</span><span class="n">TCP</span>         <span class="n">35m</span>
<span class="n">service</span><span class="p">/</span><span class="n">whoamiudp</span>       <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">85</span><span class="p">.</span><span class="n">175</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">8080</span><span class="p">/</span><span class="n">UDP</span>         <span class="n">35m</span>

<span class="n">NAME</span>                        <span class="n">READY</span>   <span class="n">UP-TO-DATE</span>   <span class="n">AVAILABLE</span>   <span class="n">AGE</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">whoami</span>      <span class="n">2</span><span class="p">/</span><span class="n">2</span>     <span class="n">2</span>            <span class="n">2</span>           <span class="n">35m</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">whoamitcp</span>   <span class="n">2</span><span class="p">/</span><span class="n">2</span>     <span class="n">2</span>            <span class="n">2</span>           <span class="n">35m</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">whoamiudp</span>   <span class="n">2</span><span class="p">/</span><span class="n">2</span>     <span class="n">2</span>            <span class="n">2</span>           <span class="n">35m</span>

<span class="n">NAME</span>                                  <span class="n">DESIRED</span>   <span class="n">CURRENT</span>   <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">replicaset</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">whoami</span><span class="p">-</span><span class="n">7d666f84d8</span>     <span class="n">2</span>         <span class="n">2</span>         <span class="n">2</span>       <span class="n">35m</span>
<span class="n">replicaset</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">whoamitcp</span><span class="p">-</span><span class="n">744cc4b47</span>   <span class="n">2</span>         <span class="n">2</span>         <span class="n">2</span>       <span class="n">35m</span>
<span class="n">replicaset</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">whoamiudp</span><span class="p">-</span><span class="n">58f6cf7b8</span>   <span class="n">2</span>         <span class="n">2</span>         <span class="n">2</span>       <span class="n">35m</span>
</code></pre></div>
<h3 id="322_whoamiingress_route">3.2.2 创建whoami应用ingress route资源清单文件并应用<a class="headerlink" href="#322_whoamiingress_route" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim whoami-ingressroute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">myingressroute</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">web</span>

  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">whoami</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span> <span class="p">&amp;&amp;</span> <span class="n">PathPrefix</span><span class="p">(`/`)</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">whoami</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f whoami-ingressroute.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingressroute</span>
<span class="n">NAME</span>             <span class="n">AGE</span>
<span class="n">myingressroute</span>   <span class="n">29m</span>
</code></pre></div>
<p><img alt="image-20220416182934718" src="../../../img/kubernetes/kubernetes_traefik/image-20220416182934718.png" /></p>
<p><img alt="image-20220416182828875" src="../../../img/kubernetes/kubernetes_traefik/image-20220416182828875.png" /></p>
<h2 id="33_https">3.3 配置HTTPS路由规则<a class="headerlink" href="#33_https" title="Permanent link">&para;</a></h2>
<p>如果我们需要用 HTTPS 来访问我们这个应用的话，就需要监听 websecure 这个入口点，也就是通过 443 端口来访问，同样用 HTTPS 访问应用必然就需要证书</p>
<h3 id="331">3.3.1 自签名证书<a class="headerlink" href="#331" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &quot;/CN=whoamissl.kubemsb.com&quot;</span>
</code></pre></div>
<h3 id="332_secret">3.3.2  创建secret<a class="headerlink" href="#332_secret" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl create secret tls who-tls --cert=tls.crt --key=tls.key</span>
</code></pre></div>
<h3 id="333_https">3.3.3 创建https应用路由规则<a class="headerlink" href="#333_https" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim whoamissl-ingressroute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroutetls</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">websecure</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">whoamissl</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">whoami</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">tls</span><span class="p">:</span>
    <span class="n">secretName</span><span class="p">:</span> <span class="n">who-tls</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f whoamissl-ingressroute.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingressroute</span>
<span class="n">NAME</span>              <span class="n">AGE</span>
<span class="n">ingressroutetls</span>   <span class="n">17s</span>
</code></pre></div>
<p><img alt="image-20220416184943571" src="../../../img/kubernetes/kubernetes_traefik/image-20220416184943571.png" /></p>
<div class="highlight"><pre><span></span><code><span class="c"># cat /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">whoamissl</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<p><img alt="image-20220416185151502" src="../../../img/kubernetes/kubernetes_traefik/image-20220416185151502.png" /></p>
<p><img alt="image-20220416185217631" src="../../../img/kubernetes/kubernetes_traefik/image-20220416185217631.png" /></p>
<h2 id="34_tcp">3.4 配置TCP路由规则<a class="headerlink" href="#34_tcp" title="Permanent link">&para;</a></h2>
<blockquote>
<p>SNI为服务名称标识，是 TLS 协议的扩展。因此，只有 TLS 路由才能使用该规则指定域名。但是，非 TLS 路由必须使用带有 <code>*</code> 的规则（每个域）来声明每个非 TLS 请求都将由路由进行处理。</p>
</blockquote>
<h3 id="341">3.4.1 实验案例配置<a class="headerlink" href="#341" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim whoami-ingressroutetcp.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRouteTCP</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroutetcpwho</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">tcpep</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">HostSNI</span><span class="p">(`*`)</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">whoamitcp</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingressroutetcp</span>
<span class="n">NAME</span>                 <span class="n">AGE</span>
<span class="n">ingressroutetcpwho</span>   <span class="n">17s</span>
</code></pre></div>
<p><img alt="image-20220416194607990" src="../../../img/kubernetes/kubernetes_traefik/image-20220416194607990.png" /></p>
<p><img alt="image-20220416194637687" src="../../../img/kubernetes/kubernetes_traefik/image-20220416194637687.png" /></p>
<p><img alt="image-20220416194801740" src="../../../img/kubernetes/kubernetes_traefik/image-20220416194801740.png" /></p>
<h3 id="342_mysqltraefik">3.4.2 生产案例配置 MySQL部署及traefik代理<a class="headerlink" href="#342_mysqltraefik" title="Permanent link">&para;</a></h3>
<h4 id="3421_traefik-configmapyaml">3.4.2.1 修改traefik-configmap.yaml<a class="headerlink" href="#3421_traefik-configmapyaml" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># cat traefik-configmap.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ConfigMap</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">traefik</span><span class="p">.</span><span class="n">yaml</span><span class="p">:</span> <span class="p">|-</span>
    <span class="n">serversTransport</span><span class="p">:</span>
      <span class="n">insecureSkipVerify</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">api</span><span class="p">:</span>
      <span class="n">insecure</span><span class="p">:</span> <span class="n">true</span>
      <span class="n">dashboard</span><span class="p">:</span> <span class="n">true</span>
      <span class="n">debug</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">metrics</span><span class="p">:</span>
      <span class="n">prometheus</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">entryPoints</span><span class="p">:</span>
      <span class="n">web</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:80&quot;</span>
      <span class="n">websecure</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:443&quot;</span>
      <span class="n">metrics</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8082&quot;</span>
      <span class="n">tcpep</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8083&quot;</span>
      <span class="n">udpep</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8084/udp&quot;</span>
      <span class="n">mysql</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:3312&quot;</span>
    <span class="n">providers</span><span class="p">:</span>
      <span class="n">kubernetesCRD</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">kubernetesingress</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">log</span><span class="p">:</span>
      <span class="n">filePath</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">level</span><span class="p">:</span> <span class="n">error</span>
      <span class="n">format</span><span class="p">:</span> <span class="n">json</span>
    <span class="n">accessLog</span><span class="p">:</span>
      <span class="n">filePath</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">format</span><span class="p">:</span> <span class="n">json</span>
      <span class="n">bufferingSize</span><span class="p">:</span> <span class="n">0</span>
      <span class="n">filters</span><span class="p">:</span>
        <span class="n">retryAttempts</span><span class="p">:</span> <span class="n">true</span>
        <span class="n">minDuration</span><span class="p">:</span> <span class="n">20</span>
      <span class="n">fields</span><span class="p">:</span>
        <span class="n">defaultMode</span><span class="p">:</span> <span class="n">keep</span>
        <span class="n">names</span><span class="p">:</span>
          <span class="n">ClientUsername</span><span class="p">:</span> <span class="n">drop</span>
        <span class="n">headers</span><span class="p">:</span>
          <span class="n">defaultMode</span><span class="p">:</span> <span class="n">keep</span>
          <span class="n">names</span><span class="p">:</span>
            <span class="n">User-Agent</span><span class="p">:</span> <span class="n">redact</span>
            <span class="n">Authorization</span><span class="p">:</span> <span class="n">drop</span>
            <span class="n">Content-Type</span><span class="p">:</span> <span class="n">keep</span>
</code></pre></div>
<h4 id="3422_traefik-deployyaml">3.4.2.2 修改traefik-deploy.yaml<a class="headerlink" href="#3422_traefik-deployyaml" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-deploy.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">DaemonSet</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">serviceAccountName</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">traefik</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">7</span>
          <span class="n">args</span><span class="p">:</span>
            <span class="p">-</span> <span class="p">-</span><span class="n">-configfile</span><span class="p">=/</span><span class="n">config</span><span class="p">/</span><span class="n">traefik</span><span class="p">.</span><span class="n">yaml</span>
          <span class="n">volumeMounts</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="p">/</span><span class="n">config</span>
              <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">web</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">80</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">websecure</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">443</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">443</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">admin</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8080</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">tcpep</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8083</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">8083</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">udpep</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8084</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">8084</span>
              <span class="n">protocol</span><span class="p">:</span> <span class="n">UDP</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">3312</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">3306</span>
      <span class="n">volumes</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
          <span class="n">configMap</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-service.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">web</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">admin</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">websecure</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">443</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">tcpep</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8083</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">UDP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">udpep</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">8084</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">3312</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">删除以前的配置及应用</span>
<span class="c"># kubectl delete -f traefix-configmap.yaml</span>
<span class="c"># kubectl delete -f traefix-deploy.yaml</span>
<span class="c"># kubectl delete -f traefix-service.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">重新部署</span>
<span class="c"># kubectl apply -f traefix-configmap.yaml</span>
<span class="c"># kubectl apply -f traefix-deploy.yaml</span>
<span class="c"># kubectl apply -f traefix-service.yaml</span>
</code></pre></div>
<p><img alt="image-20220416214209085" src="../../../img/kubernetes/kubernetes_traefik/image-20220416214209085.png" /></p>
<h4 id="3423_mysql">3.4.2.3 部署mysql应用<a class="headerlink" href="#3423_mysql" title="Permanent link">&para;</a></h4>
<blockquote>
<p>关于端口的说明：
traefik Pod：3312:3306（traefik Pod:k8s Node），3312是traefik配置的mysql入口点的端口，3306是k8s Node的端口，traefik请求入口</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim mysql-configmap.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ConfigMap</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">my</span><span class="p">.</span><span class="n">cnf</span><span class="p">:</span> <span class="p">|</span>
    <span class="no">[mysqld]</span>
    <span class="n">character-set-server</span> <span class="p">=</span> <span class="n">utf8mb4</span>
    <span class="n">collation-server</span> <span class="p">=</span> <span class="n">utf8mb4_unicode_ci</span>
    <span class="nb">skip-character</span><span class="n">-set-client-handshake</span> <span class="p">=</span> <span class="n">1</span>
    <span class="k">default</span><span class="n">-storage-engine</span> <span class="p">=</span> <span class="n">INNODB</span>
    <span class="n">max_allowed_packet</span> <span class="p">=</span> <span class="n">500M</span>
    <span class="n">explicit_defaults_for_timestamp</span> <span class="p">=</span> <span class="n">1</span>
    <span class="n">long_query_time</span> <span class="p">=</span> <span class="n">10</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim mysql-deploy.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">mysql</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">mysql</span><span class="p">:</span><span class="n">5</span><span class="p">.</span><span class="n">7</span>
        <span class="n">imagePullPolicy</span><span class="p">:</span> <span class="n">IfNotPresent</span>
        <span class="n">env</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">MYSQL_ROOT_PASSWORD</span>
          <span class="n">value</span><span class="p">:</span> <span class="n">abc123</span>
        <span class="n">ports</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">3306</span>
        <span class="n">volumeMounts</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="p">/</span><span class="n">var</span><span class="p">/</span><span class="n">lib</span><span class="p">/</span><span class="n">mysql</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">pv</span>
        <span class="p">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="p">/</span><span class="n">etc</span><span class="p">/</span><span class="n">mysql</span><span class="p">/</span><span class="n">conf</span><span class="p">.</span><span class="n">d</span><span class="p">/</span><span class="n">my</span><span class="p">.</span><span class="n">cnf</span>
          <span class="n">subPath</span><span class="p">:</span> <span class="n">my</span><span class="p">.</span><span class="n">cnf</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">cm</span>
      <span class="n">volumes</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">pv</span>
          <span class="n">hostPath</span><span class="p">:</span>
            <span class="n">path</span><span class="p">:</span> <span class="p">/</span><span class="n">opt</span><span class="p">/</span><span class="n">mysqldata</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cm</span>
          <span class="n">configMap</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim mysql-service.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">port</span><span class="p">:</span> <span class="n">3306</span>
      <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">targetPort</span><span class="p">:</span> <span class="n">3306</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">mysql</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mysql-configmap.yaml</span>
<span class="n">configmap</span><span class="p">/</span><span class="n">mysql</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mysql-deploy.yaml</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">mysql</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mysql-service.yaml</span>
<span class="n">service</span><span class="p">/</span><span class="n">mysql</span> <span class="n">created</span>
</code></pre></div>
<h4 id="3424_mysqlingressroute">3.4.2.4 为mysql应用创建ingressroute<a class="headerlink" href="#3424_mysqlingressroute" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># vim mysql-ingressroutetcp.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRouteTCP</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">mysql</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">HostSNI</span><span class="p">(`*`)</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">3306</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mysql-ingressroutetcp.yaml</span>
<span class="n">ingressroutetcp</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">mysql</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingressroutetcp</span>
<span class="n">NAME</span>                 <span class="n">AGE</span>
<span class="n">mysql</span>                <span class="n">8s</span>
</code></pre></div>
<h4 id="3425">3.4.2.5 验证<a class="headerlink" href="#3425" title="Permanent link">&para;</a></h4>
<p><img alt="image-20220416223942162" src="../../../img/kubernetes/kubernetes_traefik/image-20220416223942162.png" /></p>
<p><strong>在集群之外主机上执行如下操作</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># cat /etc/hosts</span>
<span class="p">......</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">mysql</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># mysql -h mysql.kubemsb.com  -uroot -pabc123 -P3306</span>
<span class="n">mysql</span><span class="p">:</span> <span class="no">[Warning]</span> <span class="n">Using</span> <span class="n">a</span> <span class="n">password</span> <span class="n">on</span> <span class="n">the</span> <span class="n">command</span> <span class="n">line</span> <span class="n">interface</span> <span class="n">can</span> <span class="n">be</span> <span class="n">insecure</span><span class="p">.</span>
<span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">MySQL</span> <span class="n">monitor</span><span class="p">.</span>  <span class="n">Commands</span> <span class="k">end</span> <span class="n">with</span> <span class="p">;</span> <span class="n">or</span> <span class="p">\</span><span class="n">g</span><span class="p">.</span>
<span class="n">Your</span> <span class="n">MySQL</span> <span class="n">connection</span> <span class="n">id</span> <span class="n">is</span> <span class="n">3</span>
<span class="n">Server</span> <span class="n">version</span><span class="p">:</span> <span class="n">5</span><span class="p">.</span><span class="n">7</span><span class="p">.</span><span class="n">36</span> <span class="n">MySQL</span> <span class="n">Community</span> <span class="n">Server</span> <span class="p">(</span><span class="n">GPL</span><span class="p">)</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">2000</span><span class="p">,</span> <span class="n">2022</span><span class="p">,</span> <span class="n">Oracle</span> <span class="n">and</span><span class="p">/</span><span class="n">or</span> <span class="n">its</span> <span class="n">affiliates</span><span class="p">.</span>

<span class="n">Oracle</span> <span class="n">is</span> <span class="n">a</span> <span class="n">registered</span> <span class="n">trademark</span> <span class="n">of</span> <span class="n">Oracle</span> <span class="n">Corporation</span> <span class="n">and</span><span class="p">/</span><span class="n">or</span> <span class="n">its</span>
<span class="n">affiliates</span><span class="p">.</span> <span class="n">Other</span> <span class="n">names</span> <span class="n">may</span> <span class="n">be</span> <span class="n">trademarks</span> <span class="n">of</span> <span class="n">their</span> <span class="n">respective</span>
<span class="n">owners</span><span class="p">.</span>

<span class="nb">Type </span><span class="s1">&#39;help;&#39;</span> <span class="n">or</span> <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> <span class="n">help</span><span class="p">.</span> <span class="nb">Type </span><span class="s1">&#39;\c&#39;</span> <span class="n">to</span> <span class="nb">clear </span><span class="n">the</span> <span class="n">current</span> <span class="n">input</span> <span class="n">statement</span><span class="p">.</span>

<span class="n">mysql</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="343_redistraefik">3.4.3 生产案例 Redis部署及traefik代理<a class="headerlink" href="#343_redistraefik" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim  redis.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">redis</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">redis</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">redis</span><span class="p">:</span><span class="n">6</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">6</span>
        <span class="n">ports</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">6379</span>
          <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">port</span><span class="p">:</span> <span class="n">6379</span>
    <span class="n">targetPort</span><span class="p">:</span> <span class="n">6379</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">redis</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f redis.yaml</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">redis</span> <span class="n">created</span>
<span class="n">service</span><span class="p">/</span><span class="n">redis</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-configmap.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ConfigMap</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">traefik</span><span class="p">.</span><span class="n">yaml</span><span class="p">:</span> <span class="p">|-</span>
    <span class="n">serversTransport</span><span class="p">:</span>
      <span class="n">insecureSkipVerify</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">api</span><span class="p">:</span>
      <span class="n">insecure</span><span class="p">:</span> <span class="n">true</span>
      <span class="n">dashboard</span><span class="p">:</span> <span class="n">true</span>
      <span class="n">debug</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">metrics</span><span class="p">:</span>
      <span class="n">prometheus</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">entryPoints</span><span class="p">:</span>
      <span class="n">web</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:80&quot;</span>
      <span class="n">websecure</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:443&quot;</span>
      <span class="n">metrics</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8082&quot;</span>
      <span class="n">tcpep</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8083&quot;</span>
      <span class="n">udpep</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:8084/udp&quot;</span>
      <span class="n">mysql</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:3312&quot;</span>
      <span class="n">redis</span><span class="p">:</span>
        <span class="n">address</span><span class="p">:</span> <span class="s2">&quot;:6379&quot;</span>
    <span class="n">providers</span><span class="p">:</span>
      <span class="n">kubernetesCRD</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">kubernetesingress</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
    <span class="n">log</span><span class="p">:</span>
      <span class="n">filePath</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">level</span><span class="p">:</span> <span class="n">error</span>
      <span class="n">format</span><span class="p">:</span> <span class="n">json</span>
    <span class="n">accessLog</span><span class="p">:</span>
      <span class="n">filePath</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">format</span><span class="p">:</span> <span class="n">json</span>
      <span class="n">bufferingSize</span><span class="p">:</span> <span class="n">0</span>
      <span class="n">filters</span><span class="p">:</span>
        <span class="n">retryAttempts</span><span class="p">:</span> <span class="n">true</span>
        <span class="n">minDuration</span><span class="p">:</span> <span class="n">20</span>
      <span class="n">fields</span><span class="p">:</span>
        <span class="n">defaultMode</span><span class="p">:</span> <span class="n">keep</span>
        <span class="n">names</span><span class="p">:</span>
          <span class="n">ClientUsername</span><span class="p">:</span> <span class="n">drop</span>
        <span class="n">headers</span><span class="p">:</span>
          <span class="n">defaultMode</span><span class="p">:</span> <span class="n">keep</span>
          <span class="n">names</span><span class="p">:</span>
            <span class="n">User-Agent</span><span class="p">:</span> <span class="n">redact</span>
            <span class="n">Authorization</span><span class="p">:</span> <span class="n">drop</span>
            <span class="n">Content-Type</span><span class="p">:</span> <span class="n">keep</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">删除原configmap</span><span class="p">,</span><span class="n">再重新创建</span>
<span class="c"># kubectl delete -f traefik-configmap.yaml</span>

<span class="c"># kubectl apply -f traefik-configmap.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefix-deploy.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">DaemonSet</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">serviceAccountName</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">traefik</span><span class="p">:</span><span class="n">v2</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">7</span>
          <span class="n">args</span><span class="p">:</span>
            <span class="p">-</span> <span class="p">-</span><span class="n">-configfile</span><span class="p">=/</span><span class="n">config</span><span class="p">/</span><span class="n">traefik</span><span class="p">.</span><span class="n">yaml</span>
          <span class="n">volumeMounts</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="p">/</span><span class="n">config</span>
              <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">web</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">80</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">websecure</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">443</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">443</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">admin</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8080</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">tcpep</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8083</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">8083</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">udpep</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">8084</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">8084</span>
              <span class="n">protocol</span><span class="p">:</span> <span class="n">UDP</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mysql</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">3312</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">3306</span>
            <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
              <span class="n">containerPort</span><span class="p">:</span> <span class="n">6379</span>
              <span class="n">hostPort</span><span class="p">:</span> <span class="n">6379</span>
      <span class="n">volumes</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">config</span>
          <span class="n">configMap</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">删除原deploy</span><span class="p">,</span><span class="n">再重新创建</span>
<span class="c"># kubectl delete -f traefik-deploy.yaml</span>

<span class="c"># kubectl apply -f traefik-deploy.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">验证是否添加成功</span>
<span class="c"># kubectl get daemonset traefik -n kube-system -o yaml</span>
<span class="p">...</span>
<span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">6379</span>
          <span class="n">hostPort</span><span class="p">:</span> <span class="n">6379</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
          <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
<span class="p">...</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim  redis-ingressroutetcp.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRouteTCP</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">redis</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">HostSNI</span><span class="p">(`*`)</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">redis</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">6379</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingressroutetcp</span>
<span class="n">NAME</span>                 <span class="n">AGE</span>
<span class="n">redis</span>                <span class="n">8s</span>
</code></pre></div>
<p><img alt="image-20220417011156699" src="../../../img/kubernetes/kubernetes_traefik/image-20220417011156699.png" /></p>
<p><img alt="image-20220417011339455" src="../../../img/kubernetes/kubernetes_traefik/image-20220417011339455.png" /></p>
<p><strong>在集群之外主机添加域名解析</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># cat /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">15</span> <span class="n">redis</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code> <span class="c"># wget http://download.redis.io/releases/redis-3.2.8.tar.gz</span>
 <span class="c"># tar xf redis-3.2.8.tar.gz</span>
 <span class="c"># make</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># ./src/redis-cli -h redis.kubemsb.com -p 6379</span>
<span class="n">redis</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">:</span><span class="n">6379</span><span class="p">&gt;</span> <span class="n">ping</span>
<span class="n">PONG</span>
<span class="n">redis</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">:</span><span class="n">6379</span><span class="p">&gt;</span> <span class="nb">set </span><span class="n">hello</span> <span class="n">world</span>
<span class="n">OK</span>
<span class="n">redis</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">:</span><span class="n">6379</span><span class="p">&gt;</span> <span class="n">get</span> <span class="n">hello</span>
<span class="s2">&quot;world&quot;</span>
</code></pre></div>
<h2 id="35_udp">3.5 配置UDP路由规则<a class="headerlink" href="#35_udp" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c"># vim whoami-ingressrouteudp.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRouteUDP</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressrouteudpwho</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>                  
    <span class="p">-</span> <span class="n">udpep</span>
  <span class="n">routes</span><span class="p">:</span>                      
  <span class="p">-</span> <span class="n">services</span><span class="p">:</span>                  
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">whoamiudp</span>                 
      <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingressrouteudp</span>
<span class="n">NAME</span>                 <span class="n">AGE</span>
<span class="n">ingressrouteudpwho</span>   <span class="n">11s</span>
</code></pre></div>
<p><img alt="image-20220416195402099" src="../../../img/kubernetes/kubernetes_traefik/image-20220416195402099.png" /></p>
<p><img alt="image-20220416195433680" src="../../../img/kubernetes/kubernetes_traefik/image-20220416195433680.png" /></p>
<p><img alt="image-20220416195459722" src="../../../img/kubernetes/kubernetes_traefik/image-20220416195459722.png" /></p>
<p><strong>验证可有性</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get svc</span>
<span class="n">NAME</span>            <span class="nb">TYPE </span>          <span class="n">CLUSTER-IP</span>      <span class="n">EXTERNAL-IP</span>     <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>          <span class="n">AGE</span>

<span class="n">whoamiudp</span>       <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">85</span><span class="p">.</span><span class="n">175</span>    <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">8080</span><span class="p">/</span><span class="n">TCP</span>         <span class="n">6h35m</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">echo </span><span class="s2">&quot;WHO&quot;</span> <span class="p">|</span> <span class="n">socat</span> <span class="p">-</span> <span class="n">udp4-datagram</span><span class="p">:</span><span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">85</span><span class="p">.</span><span class="n">175</span><span class="p">:</span><span class="n">8080</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">echo </span><span class="s2">&quot;othermessage&quot;</span> <span class="p">|</span> <span class="n">socat</span> <span class="p">-</span> <span class="n">udp4-datagram</span><span class="p">:</span><span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">85</span><span class="p">.</span><span class="n">175</span><span class="p">:</span><span class="n">8080</span>
</code></pre></div>
<p><strong>输出</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># echo &quot;WHO&quot; | socat - udp4-datagram:192.168.10.12:8084</span>
<span class="n">Hostname</span><span class="p">:</span> <span class="n">whoamiudp</span><span class="p">-</span><span class="n">58f6cf7b8</span><span class="p">-</span><span class="n">54552</span>
<span class="n">IP</span><span class="p">:</span> <span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
<span class="n">IP</span><span class="p">:</span> <span class="p">::</span><span class="n">1</span>
<span class="n">IP</span><span class="p">:</span> <span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">159</span><span class="p">.</span><span class="n">187</span>
<span class="n">IP</span><span class="p">:</span> <span class="n">fe80</span><span class="p">::</span><span class="n">1cb4</span><span class="p">:</span><span class="n">e1ff</span><span class="p">:</span><span class="n">fe66</span><span class="p">:</span><span class="n">d9b</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># echo &quot;othermessage&quot; | socat - udp4-datagram:192.168.10.12:8084</span>
<span class="n">Received</span><span class="p">:</span> <span class="n">othermessage</span>
</code></pre></div>
<h1 id="traefik_middleware">四、traefik中间件 MiddleWare<a class="headerlink" href="#traefik_middleware" title="Permanent link">&para;</a></h1>
<h2 id="41_traefik_middleware">4.1 traefik中间件介绍 MiddleWare<a class="headerlink" href="#41_traefik_middleware" title="Permanent link">&para;</a></h2>
<p>中间件是 Traefik2.0 中一个非常有特色的功能，我们可以根据自己的各种需求去选择不同的中间件来满足服务，Traefik 官方已经内置了许多不同功能的中间件，其中包括修改请求头信息；重定向；身份验证等等，而且中间件还可以通过链式组合的方式来适用各种情况。例如：强制跳转https、去除访问前缀、访问白名单等。</p>
<p><img alt="" src="../../../img/kubernetes/kubernetes_traefik/traefik-middleware.png" /></p>
<h2 id="42_traefik_ipwhitelist">4.2 traefik 中间件应用案例  ipWhiteList<a class="headerlink" href="#42_traefik_ipwhitelist" title="Permanent link">&para;</a></h2>
<blockquote>
<p>在工作 中，有一些URL并不希望对外暴露，比如prometheus、grafana等，我们就可以通过白名单IP来过到要求，可以使用Traefix中的ipWhiteList中间件来完成。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim deploy-service.yaml</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-middleware</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">middle</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">middle</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-c</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">service-middle</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">middle</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f deploy-service.yaml</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">nginx-web-middleware</span> <span class="n">created</span>
<span class="n">service</span><span class="p">/</span><span class="n">service-middle</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim middleware-ipwhitelist.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Middleware</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">gs-ipwhitelist</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">ipWhiteList</span><span class="p">:</span>
    <span class="n">sourceRange</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
      <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
      <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">12</span>
      <span class="p">-</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">24</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f middleware-ipwhitelist.yaml</span>
<span class="n">middleware</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">gs-ipwhitelist</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim deploy-service-middle.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroutemiddle</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">web</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">middleware</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span> <span class="p">&amp;&amp;</span> <span class="n">PathPrefix</span><span class="p">(`/`)</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">service-middle</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
    <span class="n">middlewares</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">gs-ipwhitelist</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f deploy-service-middle.yaml</span>
<span class="n">ingressroute</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">ingressroutemiddle</span> <span class="n">created</span>
</code></pre></div>
<p><img alt="image-20220417144538252" src="../../../img/kubernetes/kubernetes_traefik/image-20220417144538252.png" /></p>
<p><img alt="image-20220417144726075" src="../../../img/kubernetes/kubernetes_traefik/image-20220417144726075.png" /></p>
<p><strong>在集群之外的主机上访问</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># vim  /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">15</span> <span class="n">middleware</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># curl http://middleware.kubemsb.com</span>
</code></pre></div>
<p><strong>把集群外主机所在的网段从白名单中删除，发现无法访问。</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># cat middleware-ipwhitelist.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Middleware</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">gs-ipwhitelist</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">ipWhiteList</span><span class="p">:</span>
    <span class="n">sourceRange</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">127</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">1</span>
      <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">244</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
      <span class="p">-</span> <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">12</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f middleware-ipwhitelist.yaml</span>
<span class="n">middleware</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">gs-ipwhitelist</span> <span class="n">configured</span>
</code></pre></div>
<p><img alt="image-20220417145252982" src="../../../img/kubernetes/kubernetes_traefik/image-20220417145252982.png" /></p>
<p><strong>在集群外主机访问</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># curl http://middleware.kubemsb.com</span>
<span class="n">Forbidden</span>
</code></pre></div>
<h1 id="traefik_3">五、traefik高级应用<a class="headerlink" href="#traefik_3" title="Permanent link">&para;</a></h1>
<p>在实际的生产环境，除了上线业务之外，还有更复杂的使用要求。
在开始traefik的高级用法之前，还需要了解一个TraefikService，通过把TraefikService注册到CRD来实现更复杂的请求设置。</p>
<div class="highlight"><pre><span></span><code><span class="n">TraefikService</span> <span class="n">目前能用于以下功能</span>
    <span class="n">servers</span>  <span class="n">load</span> <span class="n">balancing</span><span class="p">.</span><span class="err">（</span><span class="n">负载均衡</span><span class="err">）</span>
    <span class="n">services</span>  <span class="n">Weighted</span> <span class="n">Round</span> <span class="n">Robin</span> <span class="n">load</span> <span class="n">balancing</span><span class="p">.</span><span class="err">（</span><span class="n">权重轮询</span><span class="err">）</span>
    <span class="n">services</span>  <span class="n">mirroring</span><span class="p">.</span><span class="err">（</span><span class="n">镜像</span><span class="err">）</span>
</code></pre></div>
<h2 id="51">5.1 负载均衡<a class="headerlink" href="#51" title="Permanent link">&para;</a></h2>
<h3 id="511_deployment">5.1.1 创建deployment控制器类型应用<a class="headerlink" href="#511_deployment" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim loadbalancer-deploy.yaml</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web1</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-c</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
<span class="p">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web2</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-c</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f loadbalancer-deploy.yaml</span>
</code></pre></div>
<p><strong>修改容器中网站页面信息</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get pods</span>
<span class="n">NAME</span>                          <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">nginx-web1</span><span class="p">-</span><span class="n">856c759646</span><span class="p">-</span><span class="n">58snd</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">2m34s</span>
<span class="n">nginx-web2</span><span class="p">-</span><span class="n">5d547f7c5f-vd8n7</span>   <span class="n">1</span><span class="p">/</span><span class="n">1</span>     <span class="n">Running</span>   <span class="n">0</span>          <span class="n">2m34s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl exec -it nginx-web1-856c759646-58snd -- sh</span>
<span class="c"># echo &quot;svc1&quot; &gt; /usr/share/nginx/html/index.html</span>
<span class="c"># exit</span>


<span class="c"># kubectl exec -it nginx-web2-5d547f7c5f-vd8n7 -- sh</span>
<span class="c"># echo &quot;svc2&quot; &gt; /usr/share/nginx/html/index.html</span>
<span class="c"># exit</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim loadbalancer-deploy.yaml</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web1</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-c</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">lifecycle</span><span class="p">:</span>
            <span class="n">postStart</span><span class="p">:</span>
              <span class="n">exec</span><span class="p">:</span>
                <span class="n">command</span><span class="p">:</span>  <span class="p">[</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;echo svc1 &gt; /usr/share/nginx/html/index.html&quot;</span><span class="p">]</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
<span class="p">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web2</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-c</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">lifecycle</span><span class="p">:</span>
            <span class="n">postStart</span><span class="p">:</span>
              <span class="n">exec</span><span class="p">:</span>
                <span class="n">command</span><span class="p">:</span>  <span class="p">[</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;echo svc2 &gt; /usr/share/nginx/html/index.html&quot;</span><span class="p">]</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
</code></pre></div>
<h3 id="512_service">5.1.2 创建service<a class="headerlink" href="#512_service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim loadbalancer-deploy-service.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">svc1</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">svc2</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f loadbalancer-deploy-service.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get svc</span>
<span class="n">NAME</span>            <span class="nb">TYPE </span>          <span class="n">CLUSTER-IP</span>      <span class="n">EXTERNAL-IP</span>     <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>          <span class="n">AGE</span>
<span class="n">svc1</span>            <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">136</span><span class="p">.</span><span class="n">245</span>   <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">80</span><span class="p">/</span><span class="n">TCP</span>           <span class="n">3s</span>
<span class="n">svc2</span>            <span class="n">ClusterIP</span>      <span class="n">10</span><span class="p">.</span><span class="n">96</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">4</span>       <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>          <span class="n">80</span><span class="p">/</span><span class="n">TCP</span>           <span class="n">3s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># curl http://10.96.136.245</span>
<span class="n">svc1</span>

<span class="c"># curl http://10.96.2.4</span>
<span class="n">svc2</span>
</code></pre></div>
<h3 id="513_ingressroute">5.1.3 创建ingressroute<a class="headerlink" href="#513_ingressroute" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim loadbalancer-deploy-service-ingressroute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressrouteweblb</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">web</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span> <span class="p">&amp;&amp;</span> <span class="n">PathPrefix</span><span class="p">(`/`)</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">svc1</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">svc2</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f loadbalancer-deploy-service-ingressroute.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get ingressroute</span>
<span class="n">NAME</span>                <span class="n">AGE</span>
<span class="n">ingressrouteweblb</span>   <span class="n">9s</span>
</code></pre></div>
<p><img alt="image-20220417091705273" src="../../../img/kubernetes/kubernetes_traefik/image-20220417091705273.png" /></p>
<p><img alt="image-20220417091742077" src="../../../img/kubernetes/kubernetes_traefik/image-20220417091742077.png" /></p>
<h3 id="514">5.1.4 访问验证<a class="headerlink" href="#514" title="Permanent link">&para;</a></h3>
<blockquote>
<p>在集群之外的主机上访问</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># cat /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">15</span> <span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># curl http://lb.kubemsb.com</span>
<span class="n">svc1</span>


<span class="c"># curl http://lb.kubemsb.com</span>
<span class="n">svc2</span>
</code></pre></div>
<h2 id="52">5.2 灰度发布<a class="headerlink" href="#52" title="Permanent link">&para;</a></h2>
<blockquote>
<p>基于上述负载均衡案例基础之上实施。</p>
<p>灰度发布也称为金丝雀发布，让一部分即将上线的服务发布到线上，观察是否达到上线要求，主要通过权重轮询的方式实现。</p>
</blockquote>
<p><img alt="image-20220419015820945" src="../../../img/kubernetes/kubernetes_traefik/image-20220419015820945.png" /></p>
<h3 id="521_traefikservice">5.2.1 创建TraefikService<a class="headerlink" href="#521_traefikservice" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefikservice.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">wrr</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">weighted</span><span class="p">:</span>
    <span class="n">services</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">svc1</span>    
        <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
        <span class="n">weight</span><span class="p">:</span> <span class="n">3</span>          <span class="c"># 定义权重</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>      <span class="c"># 可选，默认就是 Service </span>
      <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">svc2</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">80</span>     
        <span class="n">weight</span><span class="p">:</span> <span class="n">1</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefikservice.yaml</span>
<span class="n">traefikservice</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">wrr</span> <span class="n">created</span>
</code></pre></div>
<h3 id="522_ingressroute">5.2.2 创建ingressroute<a class="headerlink" href="#522_ingressroute" title="Permanent link">&para;</a></h3>
<blockquote>
<p>需要注意的是现在我们配置的 Service 不再是直接的 Kubernetes 对象了，而是上面我们定义的 TraefikService 对象</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-wrr.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroutewrr</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">web</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span> <span class="p">&amp;&amp;</span> <span class="n">PathPrefix</span><span class="p">(`/`)</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">wrr</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f traefik-wrr.yaml</span>
<span class="n">ingressroute</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">ingressroutewrr</span> <span class="n">created</span>
</code></pre></div>
<p><img alt="image-20220417093350378" src="../../../img/kubernetes/kubernetes_traefik/image-20220417093350378.png" /></p>
<p><img alt="image-20220417093427267" src="../../../img/kubernetes/kubernetes_traefik/image-20220417093427267.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">第一次</span>
<span class="c"># curl http://lb.kubemsb.com</span>
<span class="n">svc1</span>

<span class="n">第二次</span>
<span class="c"># curl http://lb.kubemsb.com</span>
<span class="n">svc1</span>

<span class="n">第三次</span>
<span class="c"># curl http://lb.kubemsb.com</span>
<span class="n">svc2</span>

<span class="n">第四次</span>
<span class="c"># curl http://lb.kubemsb.com</span>
<span class="n">svc1</span>
</code></pre></div>
<h2 id="53">5.3 流量复制<a class="headerlink" href="#53" title="Permanent link">&para;</a></h2>
<blockquote>
<p>在负责均衡案例基础之上实施</p>
<p>所谓的流量复制，也称为镜像服务是指将请求的流量按规则复制一份发送给其它服务，并且会忽略这部分请求的响应，这个功能在做一些压测或者问题复现的时候很有用。</p>
</blockquote>
<h3 id="531_kubernetes_service">5.3.1 指定流量来自己于kubernetes service对象<a class="headerlink" href="#531_kubernetes_service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim mirror_from_service.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">mirror-from-service</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">mirroring</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">svc1</span>       <span class="c"># 发送 100% 的请求到 K8S 的 Service &quot;v1&quot;</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
    <span class="n">mirrors</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">svc2</span>   <span class="c"># 然后复制 20% 的请求到 v2</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
        <span class="n">percent</span><span class="p">:</span> <span class="n">20</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mirror_from_service.yaml</span>
<span class="n">traefikservice</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">mirror-from-service</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim mirror-from-service-ingressroute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroute-mirror</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">web</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span> <span class="p">&amp;&amp;</span> <span class="n">PathPrefix</span><span class="p">(`/`)</span> 
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mirror-from-service</span>         
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mirror-from-service-ingressroute.yaml</span>
<span class="n">ingressroute</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">ingressroute-mirror</span> <span class="n">created</span>
</code></pre></div>
<p><img alt="image-20220417095009228" src="../../../img/kubernetes/kubernetes_traefik/image-20220417095009228.png" /></p>
<p><img alt="image-20220417095043019" src="../../../img/kubernetes/kubernetes_traefik/image-20220417095043019.png" /></p>
<p><img alt="image-20220417095553462" src="../../../img/kubernetes/kubernetes_traefik/image-20220417095553462.png" /></p>
<div class="highlight"><pre><span></span><code><span class="c"># while true</span>
<span class="k">do</span>
<span class="nb">curl </span><span class="n">http</span><span class="p">://</span><span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
<span class="nb">sleep </span><span class="n">1</span>
<span class="n">done</span>
</code></pre></div>
<h3 id="532_traefikservice">5.3.2 通过traefikservice导入流量<a class="headerlink" href="#532_traefikservice" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># vim mirror-from-traefikservice.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">mirror-from-traefikservice</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">mirroring</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">mirror-from-service</span>      <span class="c">#流量入口从TraefikService 来</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
    <span class="n">mirrors</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">svc2</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
      <span class="n">percent</span><span class="p">:</span> <span class="n">20</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mirror-from-traefikservice.yaml</span>
<span class="n">traefikservice</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">mirror-from-traefikservice</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim mirror-from-traefikservice-ingressroute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">IngressRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ingressroute-mirror-traefikservice</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">entryPoints</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">web</span>
  <span class="n">routes</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">match</span><span class="p">:</span> <span class="n">Host</span><span class="p">(`</span><span class="n">lb</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span><span class="p">`)</span> <span class="p">&amp;&amp;</span> <span class="n">PathPrefix</span><span class="p">(`/`)</span>  
    <span class="n">kind</span><span class="p">:</span> <span class="n">Rule</span>
    <span class="n">services</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mirror-from-traefikservice</span>         
      <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">TraefikService</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f mirror-from-tradfikservice-ingressroute.yaml</span>
<span class="n">ingressroute</span><span class="p">.</span><span class="n">traefik</span><span class="p">.</span><span class="n">containo</span><span class="p">.</span><span class="n">us</span><span class="p">/</span><span class="n">ingressroute-mirror-traefikservice</span> <span class="n">created</span>
</code></pre></div>
<p><img alt="image-20220417101212376" src="../../../img/kubernetes/kubernetes_traefik/image-20220417101212376.png" /></p>
<p><img alt="image-20220417101255133" src="../../../img/kubernetes/kubernetes_traefik/image-20220417101255133.png" /></p>
<p><img alt="image-20220417101321919" src="../../../img/kubernetes/kubernetes_traefik/image-20220417101321919.png" /></p>
<div class="highlight"><pre><span></span><code><span class="c"># while true; do curl http://lb.kubemsb.com; sleep 1; done</span>
</code></pre></div>
<h3 id="533">5.3.3 流量复制小结<a class="headerlink" href="#533" title="Permanent link">&para;</a></h3>
<p>通过上述的演示我们会发现所有的流量100%发送了svc1,有20%的流量被复制到svc2，且用户收到响应均来自svc1，svc2并没有响应，可通过查看svc1及svc2应用日志获取访问日志。</p>
<h1 id="kubernetes_gateway_api">六、Kubernetes Gateway API<a class="headerlink" href="#kubernetes_gateway_api" title="Permanent link">&para;</a></h1>
<h2 id="61_gateway_api">6.1 Gateway API介绍<a class="headerlink" href="#61_gateway_api" title="Permanent link">&para;</a></h2>
<h3 id="611_gateway_api">6.1.1 Gateway API架构<a class="headerlink" href="#611_gateway_api" title="Permanent link">&para;</a></h3>
<p>Gateway API（之前叫 Service API）是由 SIG-NETWORK 社区管理的开源项目，项目地址：<a href="https://gateway-api.sigs.k8s.io/">https://gateway-api.sigs.k8s.io/</a>。主要原因是 Ingress 资源对象不能很好的满足网络需求，很多场景下 Ingress 控制器都需要通过定义 annotations 或者 crd 来进行功能扩展，这对于使用标准和支持是非常不利的，新推出的 Gateway API 旨在通过可扩展的面向角色的接口来增强服务网络。</p>
<p>Gateway API 是 Kubernetes 中的一个 API 资源集合，包括 GatewayClass、Gateway、HTTPRoute、TCPRoute、Service 等，这些资源共同为各种网络用例构建模型。</p>
<p><img alt="image-20220418105312470" src="../../../img/kubernetes/kubernetes_traefik/image-20220418105312470.png" /></p>
<p>Gateway API 的改进比当前的 Ingress 资源对象有很多更好的设计：</p>
<ul>
<li>面向角色 - Gateway 由各种 API 资源组成，这些资源根据使用和配置 Kubernetes 服务网络的角色进行建模。</li>
<li>通用性 - 和 Ingress 一样是一个具有众多实现的通用规范，Gateway API 是一个被设计成由许多实现支持的规范标准。</li>
<li>更具表现力 - Gateway API 资源支持基于 Header 头的匹配、流量权重等核心功能，这些功能在 Ingress 中只能通过自定义注解才能实现。</li>
<li>可扩展性 - Gateway API 允许自定义资源链接到 API 的各个层，这就允许在 API 结构的适当位置进行更精细的定制。</li>
</ul>
<p>还有一些其他值得关注的功能：</p>
<ul>
<li>GatewayClasses - GatewayClasses 将负载均衡实现的类型形式化，这些类使用户可以很容易了解到通过 Kubernetes 资源可以获得什么样的能力。</li>
<li>共享网关和跨命名空间支持 - 它们允许共享负载均衡器和 VIP，允许独立的路由资源绑定到同一个网关，这使得团队可以安全地共享（包括跨命名空间）基础设施，而不需要直接协调。</li>
<li>规范化路由和后端 - Gateway API 支持类型化的路由资源和不同类型的后端，这使得 API 可以灵活地支持各种协议（如 HTTP 和 gRPC）和各种后端服务（如 Kubernetes Service、存储桶或函数）。</li>
</ul>
<h3 id="612">6.1.2 面向角色设计<a class="headerlink" href="#612" title="Permanent link">&para;</a></h3>
<p>无论是道路、电力、数据中心还是 Kubernetes 集群，基础设施都是为了共享而建的，然而共享基础设施提供了一个共同的挑战，那就是如何为基础设施用户提供灵活性的同时还能被所有者控制。</p>
<p>Gateway API 通过对 Kubernetes 服务网络进行面向角色的设计来实现这一目标，平衡了灵活性和集中控制。它允许共享的网络基础设施（硬件负载均衡器、云网络、集群托管的代理等）被许多不同的团队使用，所有这些都受到集群运维设置的各种策略和约束。下面的例子显示了是如何在实践中运行的。</p>
<p><img alt="image-20220418133026558" src="../../../img/kubernetes/kubernetes_traefik/image-20220418133026558.png" /></p>
<p>一个集群运维人员创建了一个基于 GatewayClass 的 Gateway 资源，这个 Gateway 部署或配置了它所代表的基础网络资源，集群运维和特定的团队必须沟通什么可以附加到这个 Gateway 上来暴露他们的应用。集中的策略，如 TLS，可以由集群运维在 Gateway 上强制执行，同时，Store 和 Site 应用在他们自己的命名空间中运行，但将他们的路由附加到相同的共享网关上，允许他们独立控制他们的路由逻辑。</p>
<p>这种关注点分离的设计可以使不同的团队能够管理他们自己的流量，同时将集中的策略和控制留给集群运维。</p>
<h3 id="613_gateway_api">6.1.3 Gateway API概念<a class="headerlink" href="#613_gateway_api" title="Permanent link">&para;</a></h3>
<p>在整个 Gateway API 中涉及到3个角色：基础设施提供商、集群管理员、应用开发人员，在某些场景下可能还会涉及到应用管理员等角色。Gateway API 中定义了3种主要的资源模型：GatewayClass、Gateway、Route。</p>
<h4 id="6131_gatewayclass">6.1.3.1 GatewayClass<a class="headerlink" href="#6131_gatewayclass" title="Permanent link">&para;</a></h4>
<p>GatewayClass 定义了一组共享相同配置和动作的网关。每个GatewayClass 由一个控制器处理，是一个集群范围的资源，必须至少有一个 GatewayClass 被定义。</p>
<p>这与 Ingress 的 IngressClass 类似，在 Ingress v1beta1 版本中，与 GatewayClass 类似的是 ingress-class 注解，而在Ingress V1 版本中，最接近的就是 IngressClass 资源对象。</p>
<h4 id="6132_gateway">6.1.3.2 Gateway<a class="headerlink" href="#6132_gateway" title="Permanent link">&para;</a></h4>
<p>Gateway 网关描述了如何将流量转化为集群内的服务，也就是说，它定义了一个请求，要求将流量从不了解 Kubernetes 的地方转换到集群内的服务。例如，由云端负载均衡器、集群内代理或外部硬件负载均衡器发送到 Kubernetes 服务的流量。</p>
<p>它定义了对特定负载均衡器配置的请求，该配置实现了 GatewayClass 的配置和行为规范，该资源可以由管理员直接创建，也可以由处理 GatewayClass 的控制器创建。</p>
<p>Gateway 可以附加到一个或多个路由引用上，这些路由引用的作用是将流量的一个子集导向特定的服务。</p>
<h4 id="6133_route">6.1.3.3 Route 资源<a class="headerlink" href="#6133_route" title="Permanent link">&para;</a></h4>
<p>路由资源定义了特定的规则，用于将请求从网关映射到 Kubernetes 服务。</p>
<p>从 v1alpha2 版本开始，API 中包含四种 Route 路由资源类型，对于其他未定义的协议，鼓励采用特定实现的自定义路由类型，当然未来也可能会添加新的路由类型。</p>
<h5 id="61331_httproute">6.1.3.3.1 HTTPRoute<a class="headerlink" href="#61331_httproute" title="Permanent link">&para;</a></h5>
<p>HTTPRoute 适用于 HTTP 或 HTTPS 连接，适用于我们想要检查 HTTP 请求并使用 HTTP 请求进行路由或修改的场景，比如使用 HTTP Headers 头进行路由，或在请求过程中对它们进行修改。</p>
<h5 id="61332_tlsroute">6.1.3.3.2 TLSRoute<a class="headerlink" href="#61332_tlsroute" title="Permanent link">&para;</a></h5>
<p>TLSRoute 用于 TLS 连接，通过 SNI 进行区分，它适用于希望使用 SNI 作为主要路由方法的地方，并且对 HTTP 等更高级别协议的属性不感兴趣，连接的字节流不经任何检查就被代理到后端。</p>
<h5 id="61333_tcproute_udproute">6.1.3.3.3 TCPRoute 和 UDPRoute<a class="headerlink" href="#61333_tcproute_udproute" title="Permanent link">&para;</a></h5>
<p>TCPRoute（和UDPRoute）旨在用于将一个或多个端口映射到单个后端。在这种情况下，没有可以用来选择同一端口的不同后端的判别器，所以每个 TCPRoute 在监听器上需要一个不同的端口。你可以使用 TLS，在这种情况下，未加密的字节流会被传递到后端，当然也可以不使用 TLS，这样加密的字节流将传递到后端。</p>
<h3 id="614_gateway_api">6.1.4 Gateway API概念之间关系<a class="headerlink" href="#614_gateway_api" title="Permanent link">&para;</a></h3>
<p>GatewayClass、Gateway、xRoute 和 Service 的组合定义了一个可实施的负载均衡器。下图说明了不同资源之间的关系:</p>
<p><img alt="image-20220418133554117" src="../../../img/kubernetes/kubernetes_traefik/image-20220418133554117.png" /></p>
<p>使用反向代理实现的网关的典型客户端/网关 API 请求流程如下所示：</p>
<ol>
<li>客户端向 <a href="http://foo.example.com">http://foo.example.com</a> 发出请求</li>
<li>DNS 将域名解析为 Gateway 网关地址</li>
<li>反向代理在监听器上接收请求，并使用 Host Header 来匹配HTTPRoute</li>
<li>(可选)反向代理可以根据 HTTPRoute 的匹配规则进行路由</li>
<li>(可选)反向代理可以根据 HTTPRoute 的过滤规则修改请求，即添加或删除 headers</li>
<li>最后，反向代理根据 HTTPRoute 的 forwardTo 规则，将请求转发给集群中的一个或多个对象，即服务。</li>
</ol>
<h2 id="62_kubernetes_gateway_crd">6.2 kubernetes gateway CRD安装<a class="headerlink" href="#62_kubernetes_gateway_crd" title="Permanent link">&para;</a></h2>
<p>要在 Traefik 中使用 Gateway API，首先我们需要先手动安装 Gateway API 的 CRDs，使用如下命令即可安装，这将安装包括 GatewayClass、Gateway、HTTPRoute、TCPRoute 等 CRDs：</p>
<div class="highlight"><pre><span></span><code><span class="c">#  kubectl apply -k &quot;github.com/kubernetes-sigs/service-apis/config/crd?ref=v0.3.0&quot;</span>

<span class="n">输出</span><span class="err">：</span>
<span class="n">customresourcedefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">gatewayclasses</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="n">created</span>
<span class="n">customresourcedefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">gateways</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="n">created</span>
<span class="n">customresourcedefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">httproutes</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="n">created</span>
<span class="n">customresourcedefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">referencepolicies</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="n">created</span>
<span class="n">customresourcedefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">tcproutes</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="n">created</span>
<span class="n">customresourcedefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">tlsroutes</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="n">created</span>
<span class="n">customresourcedefinition</span><span class="p">.</span><span class="n">apiextensions</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">udproutes</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span> <span class="n">created</span>
</code></pre></div>
<p><img alt="image-20220418121243955" src="../../../img/kubernetes/kubernetes_traefik/image-20220418121243955.png" /></p>
<h2 id="63_traefikrbac">6.3 为traefik授权（RBAC）<a class="headerlink" href="#63_traefikrbac" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-gatewayapi-rbac.yaml</span>
<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="p">.</span><span class="n">authorization</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">gateway-role</span>
<span class="n">rules</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="p">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">services</span>
      <span class="p">-</span> <span class="n">endpoints</span>
      <span class="p">-</span> <span class="n">secrets</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">get</span>
      <span class="p">-</span> <span class="n">list</span>
      <span class="p">-</span> <span class="n">watch</span>
  <span class="p">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">gatewayclasses</span>
      <span class="p">-</span> <span class="n">gateways</span>
      <span class="p">-</span> <span class="n">httproutes</span>
      <span class="p">-</span> <span class="n">tcproutes</span>
      <span class="p">-</span> <span class="n">tlsroutes</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">get</span>
      <span class="p">-</span> <span class="n">list</span>
      <span class="p">-</span> <span class="n">watch</span>
  <span class="p">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">gatewayclasses</span><span class="p">/</span><span class="n">status</span>
      <span class="p">-</span> <span class="n">gateways</span><span class="p">/</span><span class="n">status</span>
      <span class="p">-</span> <span class="n">httproutes</span><span class="p">/</span><span class="n">status</span>
      <span class="p">-</span> <span class="n">tcproutes</span><span class="p">/</span><span class="n">status</span>
      <span class="p">-</span> <span class="n">tlsroutes</span><span class="p">/</span><span class="n">status</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="p">-</span> <span class="n">update</span>

<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="p">.</span><span class="n">authorization</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRoleBinding</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">gateway-controller</span>

<span class="n">roleRef</span><span class="p">:</span>
  <span class="n">apiGroup</span><span class="p">:</span> <span class="n">rbac</span><span class="p">.</span><span class="n">authorization</span><span class="p">.</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span>
  <span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">gateway-role</span>
<span class="n">subjects</span><span class="p">:</span>
  <span class="p">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">traefik-ingress-controller</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span> 
</code></pre></div>
<h2 id="64_traefikgateway_api">6.4 Traefik开启Gateway api支持<a class="headerlink" href="#64_traefikgateway_api" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c"># vim traefik-configmap.yaml</span>
<span class="p">......</span>
    <span class="n">providers</span><span class="p">:</span>
      <span class="n">kubernetesCRD</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">kubernetesingress</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="n">kubernetesGateway</span><span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="n">添加此行</span>
    <span class="n">experimental</span><span class="p">:</span> <span class="n">添加此行</span>
      <span class="n">kubernetesGateway</span><span class="p">:</span> <span class="n">true</span> <span class="n">添加此行</span>
<span class="p">......</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">删除</span>
<span class="c"># kubectl delete  -f traefik-configmap.yaml</span>
<span class="c"># kubectl delete -f traefik-deploy.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">重新运行</span>
<span class="c"># kubectl apply  -f traefik-configmap.yaml</span>
<span class="c"># kubectl apply  -f traefik-deploy.yaml</span>
</code></pre></div>
<p><img alt="image-20220418134757719" src="../../../img/kubernetes/kubernetes_traefik/image-20220418134757719.png" /></p>
<h2 id="65_gateway_apigatewayclass">6.5 创建Gateway API的GatewayClass<a class="headerlink" href="#65_gateway_apigatewayclass" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c"># vim gatewayclass.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">GatewayClass</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefik</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">controller</span><span class="p">:</span> <span class="n">traefik</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">gateway-controller</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f gatewayclass.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get gatewayclass</span>
<span class="n">NAME</span>      <span class="n">CONTROLLER</span>                      <span class="n">AGE</span>
<span class="n">traefik</span>   <span class="n">traefik</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">gateway-controller</span>   <span class="n">2m59s</span>
</code></pre></div>
<h2 id="66_gateway_api">6.6 Gateway API应用案例<a class="headerlink" href="#66_gateway_api" title="Permanent link">&para;</a></h2>
<h3 id="661_gateway_apitraefik_dashboard">6.6.1 通过Gateway API方式暴露traefik dashboard<a class="headerlink" href="#661_gateway_apitraefik_dashboard" title="Permanent link">&para;</a></h3>
<h4 id="6611_gateway">6.6.1.1 创建gateway<a class="headerlink" href="#6611_gateway" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># vim gateway.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Gateway</span>
<span class="n">metadata</span><span class="p">:</span> 
  <span class="n">name</span><span class="p">:</span> <span class="n">http-gateway</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span> 
<span class="n">spec</span><span class="p">:</span> 
  <span class="n">gatewayClassName</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">listeners</span><span class="p">:</span> 
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">HTTP</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span> 
      <span class="n">routes</span><span class="p">:</span> 
        <span class="n">kind</span><span class="p">:</span> <span class="n">HTTPRoute</span>
        <span class="n">namespaces</span><span class="p">:</span>
          <span class="n">from</span><span class="p">:</span> <span class="n">All</span>
        <span class="n">selector</span><span class="p">:</span>
          <span class="n">matchLabels</span><span class="p">:</span>
            <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f gateway.yaml</span>
<span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">http-gateway</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get gateway</span>
<span class="n">NAME</span>           <span class="n">CLASS</span>     <span class="n">AGE</span>
<span class="n">http-gateway</span>   <span class="n">traefik</span>   <span class="n">6s</span>
</code></pre></div>
<h4 id="6512_httproute">6.5.1.2 创建HTTPRoute<a class="headerlink" href="#6512_httproute" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># vim httproute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">HTTPRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">traefix-dashboard-gateway-api-route</span> 
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">hostnames</span><span class="p">:</span>
    <span class="p">-</span> <span class="s2">&quot;traefikdashboard.kubemsb.com&quot;</span>
  <span class="n">rules</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">matches</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">Prefix</span>
            <span class="n">value</span><span class="p">:</span> <span class="p">/</span>
      <span class="n">forwardTo</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">serviceName</span><span class="p">:</span> <span class="n">traefik</span> 
          <span class="n">port</span><span class="p">:</span> <span class="n">8080</span>
          <span class="n">weight</span><span class="p">:</span> <span class="n">1</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f httproute.yaml</span>
<span class="n">httproute</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">traefix-dashboard-gateway-api-route</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get httproute</span>
<span class="n">NAME</span>                                  <span class="n">HOSTNAMES</span>                          <span class="n">AGE</span>
<span class="n">traefix-dashboard-gateway-api-route</span>   <span class="p">[</span><span class="s2">&quot;traefikdashboard.kubemsb.com&quot;</span><span class="p">]</span>   <span class="n">6s</span>
</code></pre></div>
<h4 id="6513">6.5.1.3 在集群之外主机访问<a class="headerlink" href="#6513" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c"># vim /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">traefikdashboard</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<p><img alt="image-20220418162326429" src="../../../img/kubernetes/kubernetes_traefik/image-20220418162326429.png" /></p>
<p><img alt="image-20220418162355210" src="../../../img/kubernetes/kubernetes_traefik/image-20220418162355210.png" /></p>
<p><img alt="image-20220418162539822" src="../../../img/kubernetes/kubernetes_traefik/image-20220418162539822.png" /></p>
<h3 id="662_gateway_apiweb">6.6.2 通过Gateway API方式暴露WEB应用<a class="headerlink" href="#662_gateway_apiweb" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c"># cat gatewayapi-web.yaml</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-gatewayapi</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">gatewayweb</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">gatewayweb</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">lifecycle</span><span class="p">:</span>
            <span class="n">postStart</span><span class="p">:</span>
              <span class="n">exec</span><span class="p">:</span>
                <span class="n">command</span><span class="p">:</span>  <span class="p">[</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;echo gatewayweb &gt; /usr/share/nginx/html/index.html&quot;</span><span class="p">]</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-gatewayapi-svc</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="k">default</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">gatewayweb</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f gatewayapi-web.yaml</span>
<span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">nginx-web-gatewayapi</span> <span class="n">created</span>
<span class="n">service</span><span class="p">/</span><span class="n">nginx-web-gatewayapi-svc</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim gatewayapi-web-gateway.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Gateway</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-gateway</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">gatewayClassName</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">listeners</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">protocol</span><span class="p">:</span> <span class="n">HTTP</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
      <span class="n">routes</span><span class="p">:</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">HTTPRoute</span>
        <span class="n">namespaces</span><span class="p">:</span>
          <span class="n">from</span><span class="p">:</span> <span class="n">All</span>
        <span class="n">selector</span><span class="p">:</span>
          <span class="n">matchLabels</span><span class="p">:</span>
            <span class="n">app</span><span class="p">:</span> <span class="n">gatewayweb</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f gatewayapi-web-gateway.yaml</span>
<span class="n">gateway</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">nginx-web-gateway</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get gateway</span>
<span class="n">NAME</span>                <span class="n">CLASS</span>     <span class="n">AGE</span>
<span class="n">nginx-web-gateway</span>   <span class="n">traefik</span>   <span class="n">7s</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl describe gateway nginx-web-gateway</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># cat gatewayapi-web-httproute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">HTTPRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-gateway-api-route</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">gatewayweb</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">hostnames</span><span class="p">:</span>
    <span class="p">-</span> <span class="s2">&quot;nginx.kubemsb.com&quot;</span>
  <span class="n">rules</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">matches</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">type</span><span class="p">:</span> <span class="n">Prefix</span>
            <span class="n">value</span><span class="p">:</span> <span class="p">/</span>
      <span class="n">forwardTo</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">serviceName</span><span class="p">:</span> <span class="n">nginx-web-gatewayapi-svc</span>
          <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
          <span class="n">weight</span><span class="p">:</span> <span class="n">1</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f gatewayapi-web-httproute.yaml</span>
<span class="n">httproute</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">nginx-web-gateway-api-route</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">kubectl</span> <span class="n">get</span> <span class="n">httproute</span>
<span class="n">NAME</span>                          <span class="n">HOSTNAMES</span>               <span class="n">AGE</span>
<span class="n">nginx-web-gateway-api-route</span>   <span class="p">[</span><span class="s2">&quot;nginx.kubemsb.com&quot;</span><span class="p">]</span>   <span class="n">6s</span>
</code></pre></div>
<p><strong>在集群之外主机访问</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># vim /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">nginx</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># curl http://nginx.kubemsb.com</span>
<span class="n">gatewayweb</span>
</code></pre></div>
<h3 id="663">6.6.3 金丝雀发布<a class="headerlink" href="#663" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Gateway APIs 规范可以支持的另一个功能是金丝雀发布，假设你想在一个端点上运行两个不同的服务（或同一服务的两个版本），并将一部分请求路由到每个端点，则可以通过修改你的 HTTPRoute 来实现。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c"># vim gateway-cn-deploy.yaml</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web1</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-c</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">lifecycle</span><span class="p">:</span>
            <span class="n">postStart</span><span class="p">:</span>
              <span class="n">exec</span><span class="p">:</span>
                <span class="n">command</span><span class="p">:</span>  <span class="p">[</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;echo svc1 &gt; /usr/share/nginx/html/index.html&quot;</span><span class="p">]</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
<span class="p">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="p">/</span><span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web2</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="n">1</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx-web-c</span>
          <span class="n">image</span><span class="p">:</span> <span class="n">nginx</span><span class="p">:</span><span class="n">latest</span>
          <span class="n">lifecycle</span><span class="p">:</span>
            <span class="n">postStart</span><span class="p">:</span>
              <span class="n">exec</span><span class="p">:</span>
                <span class="n">command</span><span class="p">:</span>  <span class="p">[</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;echo svc2 &gt; /usr/share/nginx/html/index.html&quot;</span><span class="p">]</span>
          <span class="n">ports</span><span class="p">:</span>
            <span class="p">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="n">80</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f gateway-cn-deploy.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim gateway-cn-deploy-svc.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">svc1</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">v1</span>
<span class="p">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">svc2</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">ports</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">http</span>
      <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">v2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -fgateway-cn-deploy-svc.yaml</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># vim gateway-cn-httproute.yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">v1alpha1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">HTTPRoute</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">traefik</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">nginxweb-app</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube-system</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">hostnames</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">canary</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
  <span class="n">rules</span><span class="p">:</span>
    <span class="p">-</span> <span class="n">forwardTo</span><span class="p">:</span>
        <span class="p">-</span> <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
          <span class="n">serviceName</span><span class="p">:</span> <span class="n">svc1</span>
          <span class="n">weight</span><span class="p">:</span> <span class="n">3</span>  <span class="c"># 3/4 的请求到svc1</span>
        <span class="p">-</span> <span class="n">port</span><span class="p">:</span> <span class="n">80</span>
          <span class="n">serviceName</span><span class="p">:</span> <span class="n">svc2</span>
          <span class="n">weight</span><span class="p">:</span> <span class="n">1</span>  <span class="c"># 1/4 的请求到svc2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl apply -f gateway-cn-httproute.yaml</span>
<span class="n">httproute</span><span class="p">.</span><span class="n">networking</span><span class="p">.</span><span class="n">x-k8s</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">nginxweb-app</span> <span class="n">created</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c"># kubectl get httproute -n kube-system</span>
<span class="n">NAME</span>                          <span class="n">HOSTNAMES</span>                <span class="n">AGE</span>
<span class="n">nginxweb-app</span>                  <span class="p">[</span><span class="s2">&quot;canary.kubemsb.com&quot;</span><span class="p">]</span>   <span class="n">7s</span>
</code></pre></div>
<p><strong>在 集群之外主机访问</strong></p>
<div class="highlight"><pre><span></span><code><span class="c"># vim /etc/hosts</span>
<span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">canary</span><span class="p">.</span><span class="n">kubemsb</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="nv">@dockerhost</span> <span class="p">~]</span><span class="c"># curl http://canary.kubemsb.com</span>
<span class="n">svc1</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@dockerhost</span> <span class="p">~]</span><span class="c"># curl http://canary.kubemsb.com</span>
<span class="n">svc1</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@dockerhost</span> <span class="p">~]</span><span class="c"># curl http://canary.kubemsb.com</span>
<span class="n">svc1</span>
<span class="p">[</span><span class="n">root</span><span class="nv">@dockerhost</span> <span class="p">~]</span><span class="c"># curl http://canary.kubemsb.com</span>
<span class="n">svc2</span>
</code></pre></div>
<blockquote>
<p>以上使用 Traefik 来测试了 Kubernetes Gateway APIs 的使用。目前，Traefik 对 Gateway APIs 的实现是基于 v1alpha1 版本的规范，目前最新的规范是 v1alpha2，所以和最新的规范可能有一些出入的地方。</p>
</blockquote>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      BurningMyself<a href='https://beian.miit.gov.cn/' target='_blank'>  蜀ICP备15033200号-1</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/burningmyself" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://gitee.com/burningmyself" target="_blank" rel="noopener" title="gitee.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 488 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../../js/extra.js"></script>
      
        <script src="../../../js/baidu-tongji.js"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155084439-1"></script>
      
        <script src="https://www.googletagmanager.com/gtag/js?id=UA-155132293-1"></script>
      
        <script src="../../../js/google.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>